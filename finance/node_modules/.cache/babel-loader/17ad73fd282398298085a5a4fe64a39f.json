{"ast":null,"code":"import { extend, addClass, removeClass, setValue, isBlazor, closest } from '@syncfusion/ej2-base';\nimport { remove, classList, updateBlazorTemplate, blazorTemplates, resetBlazorTemplate } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, isUndefined } from '@syncfusion/ej2-base';\nimport { CellType } from '../base/enum';\nimport { parentsUntil, inArray, refreshForeignData, getObject, alignFrozenEditForm, getScrollBarWidth } from '../base/util';\nimport * as events from '../base/constant';\nimport { RowRenderer } from '../renderer/row-renderer';\nimport { CellRenderer } from '../renderer/cell-renderer';\nimport { Row } from '../models/row';\nimport { Cell } from '../models/cell';\nimport { RowModelGenerator } from '../services/row-model-generator';\nimport { DataUtil } from '@syncfusion/ej2-data';\n/**\n * `BatchEdit` module is used to handle batch editing actions.\n * @hidden\n */\n\nvar BatchEdit =\n/** @class */\nfunction () {\n  function BatchEdit(parent, serviceLocator, renderer) {\n    this.cellDetails = {};\n    this.originalCell = {};\n    this.cloneCell = {};\n    this.editNext = false;\n    this.preventSaveCell = false;\n    this.parent = parent;\n    this.serviceLocator = serviceLocator;\n    this.renderer = renderer;\n    this.focus = serviceLocator.getService('focus');\n    this.addEventListener();\n  }\n  /**\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.click, this.clickHandler, this);\n    this.parent.on(events.dblclick, this.dblClickHandler, this);\n    this.parent.on(events.beforeCellFocused, this.onBeforeCellFocused, this);\n    this.parent.on(events.cellFocused, this.onCellFocused, this);\n    this.dataBoundFunction = this.dataBound.bind(this);\n    this.batchCancelFunction = this.batchCancel.bind(this);\n    this.parent.addEventListener(events.dataBound, this.dataBoundFunction);\n    this.parent.addEventListener(events.batchCancel, this.batchCancelFunction);\n    this.parent.on(events.doubleTap, this.dblClickHandler, this);\n    this.parent.on(events.keyPressed, this.keyDownHandler, this);\n    this.parent.on(events.editNextValCell, this.editNextValCell, this);\n    this.parent.on('closebatch', this.closeForm, this);\n  };\n  /**\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.click, this.clickHandler);\n    this.parent.off(events.dblclick, this.dblClickHandler);\n    this.parent.off(events.beforeCellFocused, this.onBeforeCellFocused);\n    this.parent.off(events.cellFocused, this.onCellFocused);\n    this.parent.removeEventListener(events.dataBound, this.dataBoundFunction);\n    this.parent.removeEventListener(events.batchCancel, this.batchCancelFunction);\n    this.parent.off(events.doubleTap, this.dblClickHandler);\n    this.parent.off(events.keyPressed, this.keyDownHandler);\n    this.parent.off(events.editNextValCell, this.editNextValCell);\n    this.parent.off('closebatch', this.closeForm);\n  };\n\n  BatchEdit.prototype.batchCancel = function (args) {\n    this.parent.focusModule.restoreFocus();\n  };\n\n  BatchEdit.prototype.dataBound = function () {\n    this.parent.notify(events.toolbarRefresh, {});\n  };\n  /**\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n\n  BatchEdit.prototype.clickHandler = function (e) {\n    if (!parentsUntil(e.target, this.parent.element.id + '_add', true)) {\n      if (this.parent.isEdit && closest(this.form, 'td') !== closest(e.target, 'td')) {\n        this.saveCell();\n        this.editNextValCell();\n      }\n\n      if (parentsUntil(e.target, 'e-rowcell') && !this.parent.isEdit) {\n        this.setCellIdx(e.target);\n      }\n    }\n  };\n\n  BatchEdit.prototype.dblClickHandler = function (e) {\n    var target = parentsUntil(e.target, 'e-rowcell');\n    var tr = parentsUntil(e.target, 'e-row');\n\n    if (target && tr && !isNaN(parseInt(target.getAttribute('aria-colindex'), 10)) && !target.parentElement.classList.contains('e-editedrow')) {\n      this.editCell(parseInt(tr.getAttribute('aria-rowindex'), 10), this.parent.getColumns()[parseInt(target.getAttribute('aria-colindex'), 10)].field, this.isAddRow(parseInt(tr.getAttribute('aria-rowindex'), 10)));\n    }\n  };\n\n  BatchEdit.prototype.onBeforeCellFocused = function (e) {\n    if (this.parent.isEdit && this.validateFormObj() && (e.byClick || ['tab', 'shiftTab', 'enter', 'shiftEnter'].indexOf(e.keyArgs.action) > -1)) {\n      e.cancel = true;\n\n      if (e.byClick) {\n        e.clickArgs.preventDefault();\n      } else {\n        e.keyArgs.preventDefault();\n      }\n    }\n  };\n\n  BatchEdit.prototype.onCellFocused = function (e) {\n    var frzCols = this.parent.getFrozenColumns();\n    var mCont = this.parent.getContent().querySelector('.e-movablecontent');\n    var mHdr = this.parent.getHeaderContent().querySelector('.e-movableheader');\n    var clear = (!e.container.isContent || !e.container.isDataCell) && !(this.parent.frozenRows && e.container.isHeader);\n\n    if (!e.byKey || clear) {\n      if (this.parent.isEdit && clear) {\n        this.saveCell();\n      }\n\n      return;\n    }\n\n    var _a = e.container.indexes,\n        rowIndex = _a[0],\n        cellIndex = _a[1];\n\n    if (frzCols && (mCont.contains(e.element) || this.parent.frozenRows && mHdr.contains(e.element))) {\n      cellIndex += frzCols;\n    }\n\n    if (this.parent.frozenRows && e.container.isContent) {\n      rowIndex += this.parent.frozenRows;\n    }\n\n    var isEdit = this.parent.isEdit;\n\n    if (!this.parent.element.querySelectorAll('.e-popup-open').length) {\n      isEdit = isEdit && !this.validateFormObj();\n\n      switch (e.keyArgs.action) {\n        case 'tab':\n        case 'shiftTab':\n          var col = this.parent.getColumns()[e.indexes[1]];\n\n          if (col && !this.parent.isEdit) {\n            this.editCell(e.indexes[0], col.field);\n          }\n\n          if (isEdit || this.parent.isLastCellPrimaryKey) {\n            this.editCellFromIndex(rowIndex, cellIndex);\n          }\n\n          break;\n\n        case 'enter':\n        case 'shiftEnter':\n          e.keyArgs.preventDefault();\n\n          if (isEdit) {\n            this.editCell(rowIndex, this.cellDetails.column.field);\n          }\n\n          break;\n\n        case 'f2':\n          this.editCellFromIndex(rowIndex, cellIndex);\n          this.focus.focus();\n          break;\n      }\n    }\n  };\n\n  BatchEdit.prototype.isAddRow = function (index) {\n    return this.parent.getDataRows()[index].classList.contains('e-insertedrow');\n  };\n\n  BatchEdit.prototype.editCellFromIndex = function (rowIdx, cellIdx) {\n    this.cellDetails.rowIndex = rowIdx;\n    this.cellDetails.cellIndex = cellIdx;\n    this.editCell(rowIdx, this.parent.getColumns()[cellIdx].field, this.isAddRow(rowIdx));\n  }; // tslint:disable-next-line:max-func-body-length\n\n\n  BatchEdit.prototype.closeEdit = function () {\n    var gObj = this.parent;\n    var rows = this.parent.getRowsObject();\n    var argument = {\n      cancel: false,\n      batchChanges: this.getBatchChanges()\n    };\n    gObj.notify(events.beforeBatchCancel, argument);\n\n    if (argument.cancel) {\n      return;\n    }\n\n    if (gObj.frozenColumns && rows.length < this.parent.currentViewData.length * 2 && !(isBlazor() && gObj.isServerRendered)) {\n      rows.push.apply(rows, this.parent.getMovableRowsObject());\n    }\n\n    var cols = this.parent.getColumns();\n\n    if (isBlazor()) {\n      for (var i = 0; i < cols.length; i++) {\n        var col = cols[i];\n\n        if (col.template) {\n          updateBlazorTemplate(this.parent.element.id + col.uid, 'Template', col, false);\n        }\n      }\n    }\n\n    var rowRenderer = new RowRenderer(this.serviceLocator, null, this.parent);\n    var tr;\n    var mTr;\n    var movObj;\n\n    if (gObj.isEdit) {\n      this.saveCell(true);\n    }\n\n    this.isAdded = false;\n    gObj.clearSelection();\n\n    for (var i = 0; i < rows.length; i++) {\n      if (rows[i].isDirty) {\n        if (gObj.frozenColumns) {\n          movObj = gObj.getMovableRowsObject()[rows[i].index];\n          movObj.isDirty = true;\n        }\n\n        tr = gObj.getContentTable().querySelector('[data-uid=' + rows[i].uid + ']');\n\n        if (gObj.frozenRows && !tr) {\n          tr = gObj.getHeaderContent().querySelector('[data-uid=' + rows[i].uid + ']');\n        }\n\n        if (gObj.frozenColumns) {\n          if (gObj.frozenRows) {\n            mTr = gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('[data-uid=' + rows[i].uid + ']');\n\n            if (!mTr) {\n              mTr = gObj.getContent().querySelector('.e-movablecontent').querySelector('[data-uid=' + rows[i].uid + ']');\n            }\n          } else {\n            mTr = gObj.getContent().querySelector('.e-movablecontent').querySelector('[data-uid=' + rows[i].uid + ']');\n          }\n        }\n\n        if (tr || mTr) {\n          if (tr && tr.classList.contains('e-insertedrow') || mTr && mTr.classList.contains('e-insertedrow')) {\n            if (tr) {\n              remove(tr);\n            }\n\n            if (mTr && (gObj.frozenColumns || gObj.frozenRows)) {\n              remove(mTr);\n            }\n\n            this.removeRowObjectFromUID(rows[i].uid);\n            i--;\n          } else {\n            refreshForeignData(rows[i], this.parent.getForeignKeyColumns(), rows[i].data);\n            delete rows[i].changes;\n            delete rows[i].edit;\n            rows[i].isDirty = false;\n            var ftr = mTr ? mTr : tr;\n\n            if (isBlazor() && gObj.isServerRendered) {\n              if (gObj.getFrozenColumns()) {\n                this.removeHideAndSelection(mTr);\n              }\n\n              this.removeHideAndSelection(tr);\n              this.closeForm();\n            } else {\n              classList(ftr, [], ['e-hiddenrow', 'e-updatedtd']);\n              rowRenderer.refresh(rows[i], gObj.getColumns(), false);\n            }\n          }\n\n          if (this.parent.aggregates.length > 0) {\n            var type = 'type';\n            var editType = [];\n            editType[type] = 'cancel';\n            this.parent.notify(events.refreshFooterRenderer, editType);\n\n            if (this.parent.groupSettings.columns.length > 0) {\n              this.parent.notify(events.groupAggregates, editType);\n            }\n          }\n        }\n      }\n    }\n\n    if (isBlazor() && gObj.isServerRendered) {\n      gObj.selectRow(gObj.selectionModule.prevRowIndex);\n    }\n\n    if (!gObj.getContentTable().querySelector('tr.e-row')) {\n      gObj.renderModule.renderEmptyRow();\n    }\n\n    var args = {\n      requestType: 'batchCancel',\n      rows: this.parent.getRowsObject()\n    };\n    gObj.notify(events.batchCancel, {\n      rows: this.parent.getRowsObject().length ? this.parent.getRowsObject() : [new Row({\n        isDataRow: true,\n        cells: [new Cell({\n          isDataCell: true,\n          visible: true\n        })]\n      })]\n    });\n    gObj.selectRow(this.cellDetails.rowIndex);\n    this.refreshRowIdx();\n    gObj.notify(events.toolbarRefresh, {});\n    this.parent.notify(events.tooltipDestroy, {});\n    args = {\n      requestType: 'batchCancel',\n      rows: this.parent.getRowsObject()\n    };\n    gObj.trigger(events.batchCancel, args);\n\n    if (gObj.frozenColumns) {\n      rows.splice(this.parent.getMovableRowsObject().length, rows.length);\n    }\n  };\n\n  BatchEdit.prototype.removeHideAndSelection = function (tr) {\n    if (tr.classList.contains('e-hiddenrow')) {\n      tr.removeAttribute('aria-selected');\n      var tdElements = [].slice.call(tr.querySelectorAll('.e-selectionbackground'));\n\n      for (var i = 0; i < tdElements.length; i++) {\n        removeClass([tdElements[i]], ['e-selectionbackground', 'e-active']);\n      }\n    }\n\n    classList(tr, [], ['e-hiddenrow', 'e-updatedtd']);\n  };\n\n  BatchEdit.prototype.deleteRecord = function (fieldname, data) {\n    this.saveCell();\n\n    if (this.validateFormObj()) {\n      this.saveCell(true);\n    }\n\n    this.isAdded = false;\n    this.bulkDelete(fieldname, data);\n\n    if (this.parent.aggregates.length > 0) {\n      this.parent.notify(events.refreshFooterRenderer, {});\n\n      if (this.parent.groupSettings.columns.length > 0) {\n        this.parent.notify(events.groupAggregates, {});\n      }\n    }\n  };\n\n  BatchEdit.prototype.addRecord = function (data) {\n    this.bulkAddRow(data);\n  };\n\n  BatchEdit.prototype.endEdit = function (data) {\n    if (this.parent.isEdit && this.validateFormObj()) {\n      return;\n    }\n\n    this.batchSave();\n  };\n\n  BatchEdit.prototype.closeForm = function () {\n    for (var i = 0; i < Object.keys(this.originalCell).length; i++) {\n      for (var j = 0; j < Object.keys(this.cloneCell).length; j++) {\n        if (Object.keys(this.originalCell)[i] === Object.keys(this.cloneCell)[j]) {\n          this.cloneCell[Object.keys(this.cloneCell)[j]].replaceWith(this.originalCell[Object.keys(this.originalCell)[i]]);\n\n          if (this.originalCell[Object.keys(this.originalCell)[i]].classList.contains('e-selectionbackground')) {\n            this.originalCell[Object.keys(this.originalCell)[i]].classList.remove('e-selectionbackground', 'e-cellselectionbackground', 'e-active');\n          }\n        }\n      }\n    }\n\n    this.cloneCell = {};\n    this.originalCell = {};\n  };\n\n  BatchEdit.prototype.validateFormObj = function () {\n    return this.parent.editModule.formObj && !this.parent.editModule.formObj.validate();\n  };\n\n  BatchEdit.prototype.batchSave = function () {\n    var _this = this;\n\n    var gObj = this.parent;\n    var deletedRecords = 'deletedRecords';\n\n    if (gObj.isCheckBoxSelection) {\n      var checkAllBox = gObj.element.querySelector('.e-checkselectall').parentElement;\n\n      if (checkAllBox.classList.contains('e-checkbox-disabled') && gObj.pageSettings.totalRecordsCount > gObj.currentViewData.length) {\n        removeClass([checkAllBox], ['e-checkbox-disabled']);\n      }\n    }\n\n    var cols = this.parent.getColumns();\n\n    if (isBlazor()) {\n      for (var i = 0; i < cols.length; i++) {\n        var col = cols[i];\n\n        if (col.template) {\n          blazorTemplates[this.parent.element.id + col.uid] = [];\n          resetBlazorTemplate(this.parent.element.id + col.uid, 'Template');\n        }\n      }\n    }\n\n    this.saveCell();\n\n    if (gObj.isEdit || this.editNextValCell() || gObj.isEdit) {\n      return;\n    }\n\n    var changes = this.getBatchChanges();\n\n    if (this.parent.selectionSettings.type === 'Multiple' && changes[deletedRecords].length && this.parent.selectionSettings.persistSelection) {\n      changes[deletedRecords] = this.removeSelectedData;\n      this.removeSelectedData = [];\n    }\n\n    var original = {\n      changedRecords: this.parent.getRowsObject().filter(function (row) {\n        return row.isDirty && ['add', 'delete'].indexOf(row.edit) === -1;\n      }).map(function (row) {\n        return row.data;\n      })\n    };\n    var args = {\n      batchChanges: changes,\n      cancel: false\n    };\n    gObj.trigger(events.beforeBatchSave, args, function (beforeBatchSaveArgs) {\n      if (beforeBatchSaveArgs.cancel) {\n        return;\n      }\n\n      if (isBlazor() && _this.parent.isServerRendered) {\n        var content = _this.parent.getContent();\n\n        _this.closeForm();\n\n        removeClass(content.querySelectorAll('.e-updatedtd'), ['e-updatedtd']);\n\n        if (content.querySelector('.e-insertedrow, .e-hiddenrow')) {\n          removeClass(content.querySelectorAll('.e-hiddenrow'), ['e-hiddenrow']);\n          var insertedRow = [].slice.call(content.querySelectorAll('.e-insertedrow'));\n\n          for (var i = 0; i < insertedRow.length; i++) {\n            insertedRow[i].remove();\n          }\n        }\n\n        _this.refreshRowIdx();\n      }\n\n      gObj.showSpinner();\n      gObj.notify(events.bulkSave, {\n        changes: changes,\n        original: original\n      });\n    });\n  };\n\n  BatchEdit.prototype.getBatchChanges = function () {\n    var changes = {\n      addedRecords: [],\n      deletedRecords: [],\n      changedRecords: []\n    };\n    var rows = this.parent.getRowsObject();\n\n    for (var _i = 0, rows_1 = rows; _i < rows_1.length; _i++) {\n      var row = rows_1[_i];\n\n      if (row.isDirty) {\n        switch (row.edit) {\n          case 'add':\n            changes.addedRecords.push(row.changes);\n            break;\n\n          case 'delete':\n            changes.deletedRecords.push(row.data);\n            break;\n\n          default:\n            changes.changedRecords.push(row.changes);\n        }\n      }\n    }\n\n    return changes;\n  };\n  /**\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.removeRowObjectFromUID = function (uid) {\n    var rows = this.parent.getRowsObject();\n    var i = 0;\n\n    for (var len = rows.length; i < len; i++) {\n      if (rows[i].uid === uid) {\n        break;\n      }\n    }\n\n    rows.splice(i, 1);\n  };\n  /**\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.addRowObject = function (row) {\n    var isTop = this.parent.editSettings.newRowPosition === 'Top';\n    var frozenColumnsCount = this.parent.getFrozenColumns();\n\n    if (frozenColumnsCount) {\n      var mRow = this.parent.getMovableRowsObject();\n      var mEle = row.clone();\n      mEle.cells = mEle.cells.slice(frozenColumnsCount);\n      row.cells = row.cells.slice(0, frozenColumnsCount);\n      isTop ? mRow.unshift(mEle) : mRow.push(mEle);\n    }\n\n    isTop ? this.parent.getRowsObject().unshift(row) : this.parent.getRowsObject().push(row);\n  }; // tslint:disable-next-line:max-func-body-length\n\n\n  BatchEdit.prototype.bulkDelete = function (fieldname, data) {\n    var _this = this;\n\n    this.removeSelectedData = [];\n    var gObj = this.parent;\n    var index = gObj.selectedRowIndex;\n    var selectedRows = gObj.getSelectedRows();\n    var args = {\n      primaryKey: this.parent.getPrimaryKeyFieldNames(),\n      rowIndex: index,\n      rowData: data ? data : gObj.getSelectedRecords()[0],\n      cancel: false\n    };\n\n    if (!isBlazor() || this.parent.isJsComponent) {\n      if (data) {\n        args.row = gObj.editModule.deleteRowUid ? gObj.getRowElementByUID(gObj.editModule.deleteRowUid) : gObj.getRows()[gObj.getCurrentViewRecords().indexOf(data)];\n      } else {\n        args.row = data ? gObj.getRows()[index] : selectedRows[0];\n      }\n\n      if (!args.row) {\n        return;\n      }\n    }\n\n    gObj.trigger(events.beforeBatchDelete, args, function (beforeBatchDeleteArgs) {\n      if (beforeBatchDeleteArgs.cancel) {\n        return;\n      }\n\n      _this.removeSelectedData = gObj.getSelectedRecords();\n      gObj.clearSelection();\n      beforeBatchDeleteArgs.row = beforeBatchDeleteArgs.row ? beforeBatchDeleteArgs.row : data ? gObj.getRows()[index] : selectedRows[0];\n\n      if (_this.parent.getFrozenColumns()) {\n        if (data) {\n          index = parseInt(beforeBatchDeleteArgs.row.getAttribute('aria-rowindex'), 10);\n          selectedRows = [beforeBatchDeleteArgs.row];\n\n          if (parentsUntil(beforeBatchDeleteArgs.row, 'e-frozencontent') || parentsUntil(beforeBatchDeleteArgs.row, 'e-frozenheader')) {\n            selectedRows = selectedRows.concat(gObj.getMovableRowByIndex(index));\n          } else if (parentsUntil(beforeBatchDeleteArgs.row, 'e-movablecontent') || parentsUntil(beforeBatchDeleteArgs.row, 'e-movableheader')) {\n            selectedRows = selectedRows.concat(gObj.getFrozenRowByIndex(index));\n          }\n        }\n\n        for (var i = 0; i < selectedRows.length; i++) {\n          var uid = selectedRows[i].getAttribute('data-uid');\n\n          if (selectedRows[i].classList.contains('e-insertedrow')) {\n            _this.removeRowObjectFromUID(uid);\n\n            remove(selectedRows[i]);\n          } else {\n            var rowObj = gObj.getRowObjectFromUID(uid);\n            rowObj.isDirty = true;\n            rowObj.edit = 'delete';\n            classList(selectedRows[i], ['e-hiddenrow', 'e-updatedtd'], []);\n\n            if (gObj.frozenRows && index < gObj.frozenRows && gObj.getMovableDataRows().length >= gObj.frozenRows) {\n              gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody').appendChild(gObj.getMovableRowByIndex(gObj.frozenRows - 1));\n              gObj.getHeaderContent().querySelector('.e-frozenheader').querySelector('tbody').appendChild(gObj.getRowByIndex(gObj.frozenRows - 1));\n            }\n\n            if (gObj.frozenRows && index < gObj.frozenRows && gObj.getDataRows().length >= gObj.frozenRows) {\n              gObj.getHeaderContent().querySelector('tbody').appendChild(gObj.getRowByIndex(gObj.frozenRows - 1));\n            }\n          }\n\n          delete selectedRows[i];\n        }\n\n        var fCont = gObj.getContent().querySelector('.e-frozencontent');\n        var mCont = gObj.getContent().querySelector('.e-movablecontent');\n        fCont.style.height = mCont.offsetHeight - getScrollBarWidth() + 'px';\n      } else if (!_this.parent.getFrozenColumns() && (selectedRows.length === 1 || data)) {\n        var uid = beforeBatchDeleteArgs.row.getAttribute('data-uid');\n        uid = data && _this.parent.editModule.deleteRowUid ? uid = _this.parent.editModule.deleteRowUid : uid;\n\n        if (beforeBatchDeleteArgs.row.classList.contains('e-insertedrow')) {\n          _this.removeRowObjectFromUID(uid);\n\n          remove(beforeBatchDeleteArgs.row);\n        } else {\n          var rowObj = gObj.getRowObjectFromUID(uid);\n          rowObj.isDirty = true;\n          rowObj.edit = 'delete';\n          classList(beforeBatchDeleteArgs.row, ['e-hiddenrow', 'e-updatedtd'], []);\n        }\n\n        delete beforeBatchDeleteArgs.row;\n      } else {\n        for (var i = 0; i < selectedRows.length; i++) {\n          var uniqueid = selectedRows[i].getAttribute('data-uid');\n\n          if (selectedRows[i].classList.contains('e-insertedrow')) {\n            _this.removeRowObjectFromUID(uniqueid);\n\n            remove(selectedRows[i]);\n          } else {\n            classList(selectedRows[i], ['e-hiddenrow', 'e-updatedtd'], []);\n            var selectedRow = gObj.getRowObjectFromUID(uniqueid);\n            selectedRow.isDirty = true;\n            selectedRow.edit = 'delete';\n            delete selectedRows[i];\n          }\n        }\n      }\n\n      _this.refreshRowIdx();\n\n      if (data) {\n        gObj.editModule.deleteRowUid = undefined;\n\n        if (gObj.getSelectedRows().length) {\n          index = parseInt(gObj.getSelectedRows()[0].getAttribute('aria-rowindex'), 10);\n        }\n      }\n\n      if (!gObj.isCheckBoxSelection) {\n        gObj.selectRow(index);\n      }\n\n      gObj.trigger(events.batchDelete, beforeBatchDeleteArgs);\n      gObj.notify(events.batchDelete, {\n        rows: _this.parent.getRowsObject()\n      });\n      gObj.notify(events.toolbarRefresh, {});\n    });\n  };\n\n  BatchEdit.prototype.refreshRowIdx = function () {\n    var rows = [];\n    var mRows = [];\n    var nonMovableRows = [];\n    var frzCols = this.parent.getFrozenColumns();\n\n    if (this.parent.frozenRows) {\n      rows = [].slice.call(this.parent.getHeaderTable().querySelector('tbody').children);\n\n      if (frzCols) {\n        mRows = [].slice.call(this.parent.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody').children);\n\n        for (var i = 0; i < mRows.length; i++) {\n          nonMovableRows[i] = this.parent.createElement('tr', {\n            className: 'emptynonmv'\n          });\n        }\n      }\n    }\n\n    if (frzCols) {\n      mRows = mRows.concat([].slice.call(this.parent.getContentTable().querySelector('tbody').children));\n      nonMovableRows = nonMovableRows.concat([].slice.call(this.parent.element.querySelector('.e-movablecontent').querySelector('tbody').children));\n    }\n\n    rows = rows.concat([].slice.call(this.parent.getContentTable().querySelector('tbody').children));\n\n    for (var i = 0, j = 0, len = rows.length; i < len; i++) {\n      if (rows[i].classList.contains('e-row') && !rows[i].classList.contains('e-hiddenrow')) {\n        rows[i].setAttribute('aria-rowindex', j.toString());\n\n        if (frzCols) {\n          mRows[i].setAttribute('aria-rowindex', j.toString());\n\n          if (nonMovableRows[i].classList.contains('e-row')) {\n            nonMovableRows[i].setAttribute('aria-rowindex', j.toString());\n          }\n        }\n\n        j++;\n      } else {\n        rows[i].removeAttribute('aria-rowindex');\n\n        if (frzCols) {\n          mRows[i].removeAttribute('aria-rowindex');\n        }\n      }\n    }\n  };\n\n  BatchEdit.prototype.getIndexFromData = function (data) {\n    return inArray(data, this.parent.getCurrentViewRecords());\n  };\n\n  BatchEdit.prototype.bulkAddRow = function (data) {\n    var _this = this;\n\n    var gObj = this.parent;\n\n    if (!gObj.editSettings.allowAdding) {\n      return;\n    }\n\n    if (gObj.isEdit) {\n      this.saveCell();\n      this.parent.notify(events.editNextValCell, {});\n    }\n\n    if (gObj.isEdit) {\n      return;\n    }\n\n    this.parent.element.classList.add('e-editing');\n    var defaultData = data ? data : this.getDefaultData();\n    var args = {\n      defaultData: defaultData,\n      primaryKey: gObj.getPrimaryKeyFieldNames(),\n      cancel: false\n    };\n    gObj.trigger(events.beforeBatchAdd, args, function (beforeBatchAddArgs) {\n      if (beforeBatchAddArgs.cancel) {\n        return;\n      }\n\n      _this.isAdded = true;\n      gObj.clearSelection();\n      var mTr;\n      var mTbody;\n      var row = new RowRenderer(_this.serviceLocator, null, _this.parent);\n      var model = new RowModelGenerator(_this.parent);\n      var modelData = model.generateRows([beforeBatchAddArgs.defaultData]);\n      var tr = row.render(modelData[0], gObj.getColumns());\n      var col;\n      var index;\n\n      for (var i = 0; i < _this.parent.groupSettings.columns.length; i++) {\n        tr.insertBefore(_this.parent.createElement('td', {\n          className: 'e-indentcell'\n        }), tr.firstChild);\n        modelData[0].cells.unshift(new Cell({\n          cellType: CellType.Indent\n        }));\n      }\n\n      var tbody = gObj.getContentTable().querySelector('tbody');\n      tr.classList.add('e-insertedrow');\n\n      if (tbody.querySelector('.e-emptyrow')) {\n        var emptyRow = tbody.querySelector('.e-emptyrow');\n        emptyRow.parentNode.removeChild(emptyRow);\n\n        if (_this.parent.getFrozenColumns()) {\n          var moveTbody = _this.parent.getContent().querySelector('.e-movablecontent').querySelector('tbody');\n\n          moveTbody.firstElementChild.parentNode.removeChild(moveTbody.firstElementChild);\n        }\n      }\n\n      if (gObj.getFrozenColumns()) {\n        mTr = _this.renderMovable(tr);\n\n        if (gObj.frozenRows && gObj.editSettings.newRowPosition === 'Top') {\n          mTbody = gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody');\n        } else {\n          mTbody = gObj.getContent().querySelector('.e-movablecontent').querySelector('tbody');\n        }\n\n        _this.parent.editSettings.newRowPosition === 'Top' ? mTbody.insertBefore(mTr, mTbody.firstChild) : mTbody.appendChild(mTr);\n        addClass(mTr.querySelectorAll('.e-rowcell'), ['e-updatedtd']);\n\n        if (_this.parent.height === 'auto') {\n          _this.parent.notify(events.frozenHeight, {});\n        }\n      }\n\n      if (gObj.frozenRows && gObj.editSettings.newRowPosition === 'Top') {\n        tbody = gObj.getHeaderContent().querySelector('tbody');\n      } else {\n        tbody = gObj.getContent().querySelector('tbody');\n      }\n\n      _this.parent.editSettings.newRowPosition === 'Top' ? tbody.insertBefore(tr, tbody.firstChild) : tbody.appendChild(tr);\n      addClass(tr.querySelectorAll('.e-rowcell'), ['e-updatedtd']);\n      modelData[0].isDirty = true;\n      modelData[0].changes = extend({}, {}, modelData[0].data, true);\n      modelData[0].edit = 'add';\n\n      _this.addRowObject(modelData[0]);\n\n      _this.refreshRowIdx();\n\n      _this.focus.forgetPrevious();\n\n      gObj.notify(events.batchAdd, {\n        rows: _this.parent.getRowsObject(),\n        args: {\n          isFrozen: _this.parent.getFrozenColumns()\n        }\n      });\n\n      var changes = _this.getBatchChanges();\n\n      var addedRecords = 'addedRecords';\n      var dRecords = 'deletedRecords';\n      var btmIdx = _this.parent.getCurrentViewRecords().length + changes[addedRecords].length - changes[dRecords].length - 1;\n      _this.parent.editSettings.newRowPosition === 'Top' ? gObj.selectRow(0) : gObj.selectRow(btmIdx);\n\n      if (!data) {\n        index = _this.findNextEditableCell(0, true);\n        col = gObj.getColumns()[index];\n        _this.parent.editSettings.newRowPosition === 'Top' ? _this.editCell(0, col.field, true) : _this.editCell(btmIdx, col.field, true);\n      }\n\n      if (_this.parent.aggregates.length > 0 && (data || changes[addedRecords].length)) {\n        _this.parent.notify(events.refreshFooterRenderer, {});\n      }\n\n      var args1 = {\n        defaultData: beforeBatchAddArgs.defaultData,\n        row: tr,\n        columnObject: col,\n        columnIndex: index,\n        primaryKey: beforeBatchAddArgs.primaryKey,\n        cell: tr.cells[index]\n      };\n      gObj.trigger(events.batchAdd, args1);\n\n      if (gObj.getFrozenColumns()) {\n        alignFrozenEditForm(mTr.querySelector('td:not(.e-hide)'), tr.querySelector('td:not(.e-hide)'));\n      }\n\n      if (isBlazor()) {\n        _this.parent.notify(events.toolbarRefresh, {});\n\n        _this.parent.notify('start-add', {});\n      }\n    });\n  };\n\n  BatchEdit.prototype.renderMovable = function (ele) {\n    var mEle = ele.cloneNode(true);\n\n    for (var i = 0; i < this.parent.getFrozenColumns(); i++) {\n      mEle.removeChild(mEle.children[0]);\n    }\n\n    for (var i = this.parent.getFrozenColumns(), len = ele.childElementCount; i < len; i++) {\n      ele.removeChild(ele.children[ele.childElementCount - 1]);\n    }\n\n    return mEle;\n  };\n\n  BatchEdit.prototype.findNextEditableCell = function (columnIndex, isAdd, isValOnly) {\n    var cols = this.parent.getColumns();\n    var endIndex = cols.length;\n    var validation;\n\n    for (var i = columnIndex; i < endIndex; i++) {\n      validation = isValOnly ? isNullOrUndefined(cols[i].validationRules) : false;\n\n      if (!isAdd && this.checkNPCell(cols[i])) {\n        return i;\n      } else if (isAdd && !cols[i].template && cols[i].visible && cols[i].allowEditing && !(cols[i].isIdentity && cols[i].isPrimaryKey) && !validation) {\n        return i;\n      }\n    }\n\n    return -1;\n  };\n\n  BatchEdit.prototype.checkNPCell = function (col) {\n    return !col.template && col.visible && !col.isPrimaryKey && !col.isIdentity && col.allowEditing;\n  };\n\n  BatchEdit.prototype.getDefaultData = function () {\n    var gObj = this.parent;\n    var data = {};\n    var dValues = {\n      'number': 0,\n      'string': null,\n      'boolean': false,\n      'date': null,\n      'datetime': null\n    };\n\n    for (var _i = 0, _a = gObj.columnModel; _i < _a.length; _i++) {\n      var col = _a[_i];\n\n      if (col.field) {\n        setValue(col.field, col.defaultValue ? col.defaultValue : dValues[col.type], data);\n      }\n    }\n\n    return data;\n  };\n\n  BatchEdit.prototype.setCellIdx = function (target) {\n    var gLen = 0;\n\n    if (this.parent.allowGrouping) {\n      gLen = this.parent.groupSettings.columns.length;\n    }\n\n    this.cellDetails.cellIndex = target.cellIndex - gLen;\n    this.cellDetails.rowIndex = parseInt(target.getAttribute('index'), 10);\n  };\n\n  BatchEdit.prototype.editCell = function (index, field, isAdd) {\n    var gObj = this.parent;\n    var col = gObj.getColumnByField(field);\n    this.index = index;\n    this.field = field;\n    this.isAdd = isAdd;\n    var checkEdit = gObj.isEdit && !(this.cellDetails.column.field === field && this.cellDetails.rowIndex === index && this.parent.getDataRows().length - 1 !== index);\n\n    if (isBlazor() && col.template && !isAdd) {\n      resetBlazorTemplate(this.parent.element.id + col.uid, 'Template', index);\n    }\n\n    if (gObj.editSettings.allowEditing) {\n      if (!checkEdit && col.allowEditing) {\n        this.editCellExtend(index, field, isAdd);\n      } else if (checkEdit) {\n        this.editNext = true;\n        this.saveCell();\n      }\n    }\n  };\n\n  BatchEdit.prototype.editCellExtend = function (index, field, isAdd) {\n    var _this = this;\n\n    var gObj = this.parent;\n    var col = gObj.getColumnByField(field);\n    var keys = gObj.getPrimaryKeyFieldNames();\n\n    if (gObj.isEdit) {\n      return;\n    }\n\n    var row;\n    var rowData;\n    var mRowData;\n    var colIdx = gObj.getColumnIndexByField(field);\n    var frzCols = gObj.getFrozenColumns();\n\n    if (frzCols && colIdx >= frzCols) {\n      row = gObj.getMovableDataRows()[index];\n      mRowData = this.parent.getRowObjectFromUID(this.parent.getMovableDataRows()[index].getAttribute('data-uid'));\n      rowData = mRowData.changes ? extend({}, {}, mRowData.changes, true) : extend({}, {}, this.getDataByIndex(index), true);\n    } else {\n      row = gObj.getDataRows()[index];\n      rowData = extend({}, {}, this.getDataByIndex(index), true);\n    }\n\n    if (keys[0] === col.field && !row.classList.contains('e-insertedrow') || col.columns || col.isPrimaryKey && col.isIdentity) {\n      this.parent.isLastCellPrimaryKey = true;\n      return;\n    }\n\n    this.parent.isLastCellPrimaryKey = false;\n    this.parent.element.classList.add('e-editing');\n    var rowObj = gObj.getRowObjectFromUID(row.getAttribute('data-uid'));\n    var cells = [].slice.apply(row.cells);\n    var args = {\n      columnName: col.field,\n      isForeignKey: !isNullOrUndefined(col.foreignKeyValue),\n      primaryKey: keys,\n      rowData: rowData,\n      validationRules: extend({}, col.validationRules ? col.validationRules : {}),\n      value: getObject(col.field, rowData),\n      type: !isAdd ? 'edit' : 'add',\n      cancel: false,\n      foreignKeyData: rowObj && rowObj.foreignKeyData\n    };\n\n    if (!isBlazor() || this.parent.isJsComponent) {\n      args.cell = cells[this.getColIndex(cells, this.getCellIdx(col.uid))];\n      args.row = row;\n      args.columnObject = col;\n\n      if (!args.cell) {\n        return;\n      }\n    }\n\n    gObj.trigger(events.cellEdit, args, function (cellEditArgs) {\n      if (cellEditArgs.cancel) {\n        return;\n      }\n\n      cellEditArgs.cell = cellEditArgs.cell ? cellEditArgs.cell : cells[_this.getColIndex(cells, _this.getCellIdx(col.uid))];\n      cellEditArgs.row = cellEditArgs.row ? cellEditArgs.row : row;\n      cellEditArgs.columnObject = cellEditArgs.columnObject ? cellEditArgs.columnObject : col;\n      cellEditArgs.columnObject.index = isNullOrUndefined(cellEditArgs.columnObject.index) ? 0 : cellEditArgs.columnObject.index;\n      _this.cellDetails = {\n        rowData: rowData,\n        column: col,\n        value: cellEditArgs.value,\n        isForeignKey: cellEditArgs.isForeignKey,\n        rowIndex: index,\n        cellIndex: parseInt(cellEditArgs.cell.getAttribute('aria-colindex'), 10),\n        foreignKeyData: cellEditArgs.foreignKeyData\n      };\n\n      if (cellEditArgs.cell.classList.contains('e-updatedtd')) {\n        _this.isColored = true;\n        cellEditArgs.cell.classList.remove('e-updatedtd');\n      }\n\n      if (isBlazor() && gObj.isServerRendered) {\n        var cell = 'cells';\n        var cloneCell = 'cloneCell';\n        var indent = cellEditArgs.row.querySelectorAll('.e-indentcell, .e-detailrowcollapse, .e-detailrowexpand, .e-rowdragdrop').length;\n        _this.cloneCell[\"\" + _this.cellDetails.rowIndex + cellEditArgs.columnObject.index] = cellEditArgs[cloneCell] = cellEditArgs.cell.cloneNode(true);\n\n        if (parentsUntil(cellEditArgs.cell, 'e-movableheader') || parentsUntil(cellEditArgs.cell, 'e-movablecontent')) {\n          cellEditArgs.row.insertCell(cellEditArgs.columnObject.index - gObj.getFrozenColumns());\n          cellEditArgs.row.replaceChild(cellEditArgs[cloneCell], cellEditArgs.row[cell][cellEditArgs.columnObject.index - gObj.getFrozenColumns()]);\n        } else {\n          cellEditArgs.row.insertCell(cellEditArgs.columnObject.index + indent);\n          cellEditArgs.row.replaceChild(cellEditArgs[cloneCell], cellEditArgs.row[cell][cellEditArgs.columnObject.index + indent]);\n        }\n\n        _this.originalCell[\"\" + _this.cellDetails.rowIndex + cellEditArgs.columnObject.index] = cellEditArgs.cell.parentElement.removeChild(cellEditArgs.cell);\n        removeClass([_this.cloneCell[\"\" + _this.cellDetails.rowIndex + cellEditArgs.columnObject.index]], ['e-focus', 'e-focused']);\n      }\n\n      gObj.isEdit = true;\n      gObj.clearSelection();\n\n      if (!gObj.isCheckBoxSelection || !gObj.isPersistSelection) {\n        gObj.selectRow(_this.cellDetails.rowIndex, true);\n      }\n\n      _this.renderer.update(cellEditArgs);\n\n      _this.parent.notify(events.batchEditFormRendered, cellEditArgs);\n\n      _this.form = gObj.element.querySelector('#' + gObj.element.id + 'EditForm');\n      gObj.editModule.applyFormValidation([col]);\n      _this.parent.element.querySelector('.e-gridpopup').style.display = 'none';\n    });\n  };\n\n  BatchEdit.prototype.updateCell = function (rowIndex, field, value) {\n    var col = this.parent.getColumnByField(field);\n    var index = this.parent.getColumnIndexByField(field);\n\n    if (col && !col.isPrimaryKey) {\n      var td = this.parent.getDataRows()[rowIndex].querySelectorAll('.e-rowcell')[index];\n\n      if (this.parent.getFrozenColumns()) {\n        var cells = [].slice.call(this.parent.getDataRows()[rowIndex].querySelectorAll('.e-rowcell')).concat([].slice.call(this.parent.getMovableDataRows()[rowIndex].querySelectorAll('.e-rowcell')));\n        td = cells[index];\n      }\n\n      var rowObj = parentsUntil(td, 'e-movablecontent') ? this.parent.getMovableRowsObject()[rowIndex] : this.parent.getRowObjectFromUID(td.parentElement.getAttribute('data-uid'));\n      this.refreshTD(td, col, rowObj, value);\n      this.parent.trigger(events.queryCellInfo, {\n        cell: td,\n        column: col,\n        data: rowObj.changes\n      });\n    }\n  };\n\n  BatchEdit.prototype.setChanges = function (rowObj, field, value, td) {\n    var currentRowObj;\n\n    if (!this.parent.getFrozenColumns()) {\n      if (!rowObj.changes) {\n        rowObj.changes = extend({}, {}, rowObj.data, true);\n      }\n\n      if (!isNullOrUndefined(field)) {\n        DataUtil.setValue(field, value, rowObj.changes);\n      }\n\n      if (rowObj.data[field] !== value) {\n        rowObj.isDirty = true;\n      }\n    } else {\n      var rowEle = this.parent.getRowElementByUID(rowObj.uid);\n      var rowIndex = parseInt(rowEle.getAttribute('aria-rowindex'), 10);\n      currentRowObj = this.parent.getRowsObject()[rowIndex];\n\n      if (!currentRowObj.changes) {\n        currentRowObj.changes = extend({}, {}, rowObj.data, true);\n      }\n\n      if (!isNullOrUndefined(field)) {\n        setValue(field, value, currentRowObj.changes);\n      }\n\n      var movableRowObject = void 0;\n\n      if (isBlazor() && this.parent.isServerRendered && (parentsUntil(td, 'e-movableheader') || parentsUntil(td, 'e-movablecontent'))) {\n        var movRowEle = this.parent.getMovableRowByIndex(this.cellDetails.rowIndex);\n        var movRowIndex = parseInt(movRowEle.getAttribute('aria-rowindex'), 10);\n        movableRowObject = this.parent.getMovableRowsObject()[movRowIndex];\n      } else {\n        movableRowObject = this.parent.getMovableRowsObject()[rowIndex];\n      }\n\n      movableRowObject.changes = extend({}, {}, currentRowObj.changes, true);\n\n      if (rowObj.data[field] !== value) {\n        movableRowObject.isDirty = true;\n        currentRowObj.isDirty = true;\n      }\n    }\n  };\n\n  BatchEdit.prototype.updateRow = function (index, data) {\n    var keys = Object.keys(data);\n\n    for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n      var col = keys_1[_i];\n      this.updateCell(index, col, data[col]);\n    }\n  };\n\n  BatchEdit.prototype.getCellIdx = function (uid) {\n    var cIdx = this.parent.getColumnIndexByUid(uid) + this.parent.groupSettings.columns.length;\n\n    if (!isNullOrUndefined(this.parent.detailTemplate) || !isNullOrUndefined(this.parent.childGrid)) {\n      cIdx++;\n    }\n\n    if (this.parent.isRowDragable()) {\n      cIdx++;\n    }\n\n    return cIdx;\n  };\n\n  BatchEdit.prototype.refreshTD = function (td, column, rowObj, value) {\n    var cell = new CellRenderer(this.parent, this.serviceLocator);\n    var rowcell;\n    value = column.type === 'number' && !isNullOrUndefined(value) ? parseFloat(value) : value;\n    this.setChanges(rowObj, column.field, value, td);\n    var frzCols = this.parent.getFrozenColumns();\n    frzCols = frzCols && this.parent.isRowDragable() ? frzCols + 1 : frzCols;\n    refreshForeignData(rowObj, this.parent.getForeignKeyColumns(), rowObj.changes);\n\n    if (frzCols && this.getCellIdx(column.uid) >= frzCols && this.parent.getColumns().length === rowObj.cells.length) {\n      rowcell = rowObj.cells.slice(frzCols, rowObj.cells.length);\n    } else {\n      rowcell = rowObj.cells;\n    }\n\n    var parentElement;\n    var cellIndex;\n\n    if (this.parent.isReact) {\n      parentElement = td.parentElement;\n      cellIndex = td.cellIndex;\n    }\n\n    cell.refreshTD(td, rowcell[this.getCellIdx(column.uid) - (this.getCellIdx(column.uid) >= frzCols ? frzCols : 0)], rowObj.changes, {\n      'index': this.getCellIdx(column.uid)\n    });\n\n    if (this.parent.isReact) {\n      this.newReactTd = parentElement.cells[cellIndex];\n      parentElement.cells[cellIndex].classList.add('e-updatedtd');\n    } else {\n      td.classList.add('e-updatedtd');\n    }\n\n    td.classList.add('e-updatedtd');\n    this.parent.notify(events.toolbarRefresh, {});\n  };\n\n  BatchEdit.prototype.getColIndex = function (cells, index) {\n    var cIdx = 0;\n\n    if (this.parent.allowGrouping && this.parent.groupSettings.columns) {\n      cIdx = this.parent.groupSettings.columns.length;\n    }\n\n    if (!isNullOrUndefined(this.parent.detailTemplate) || !isNullOrUndefined(this.parent.childGrid)) {\n      cIdx++;\n    }\n\n    if (this.parent.isRowDragable()) {\n      cIdx++;\n    }\n\n    for (var m = 0; m < cells.length; m++) {\n      var colIndex = parseInt(cells[m].getAttribute('aria-colindex'), 10);\n\n      if (colIndex === index - cIdx) {\n        return m;\n      }\n    }\n\n    return -1;\n  };\n\n  BatchEdit.prototype.editNextValCell = function () {\n    var gObj = this.parent;\n    var changes = this.getBatchChanges();\n    var addedRecords = 'addedRecords';\n    var dRecords = 'deletedRecords';\n    var btmIdx = this.parent.getCurrentViewRecords().length + changes[addedRecords].length - changes[dRecords].length - 1;\n\n    if (this.isAdded && !gObj.isEdit) {\n      for (var i = this.cellDetails.cellIndex; i < gObj.getColumns().length; i++) {\n        if (gObj.isEdit) {\n          return;\n        }\n\n        var index = this.findNextEditableCell(this.cellDetails.cellIndex + 1, true, true);\n        var col = gObj.getColumns()[index];\n\n        if (col) {\n          this.parent.editSettings.newRowPosition === 'Bottom' ? this.editCell(btmIdx, col.field, true) : this.editCell(0, col.field, true);\n          this.saveCell();\n        }\n      }\n\n      if (!gObj.isEdit) {\n        this.isAdded = false;\n      }\n    }\n  };\n\n  BatchEdit.prototype.escapeCellEdit = function () {\n    var args = this.generateCellArgs();\n    args.value = args.previousValue;\n    this.successCallBack(args, args.cell.parentElement, args.column, true)(args);\n  };\n\n  BatchEdit.prototype.generateCellArgs = function () {\n    var gObj = this.parent;\n    this.parent.element.classList.remove('e-editing');\n    var column = this.cellDetails.column;\n    var obj = {};\n    obj[column.field] = getObject(column.field, this.cellDetails.rowData);\n    var editedData = gObj.editModule.getCurrentEditedData(this.form, obj);\n    var cloneEditedData = extend({}, editedData);\n    editedData = extend({}, editedData, this.cellDetails.rowData);\n    var value = getObject(column.field, cloneEditedData);\n\n    if (!isNullOrUndefined(column.field) && !isUndefined(value)) {\n      setValue(column.field, value, editedData);\n    }\n\n    var args = {\n      columnName: column.field,\n      value: getObject(column.field, editedData),\n      rowData: this.cellDetails.rowData,\n      column: column,\n      previousValue: this.cellDetails.value,\n      isForeignKey: this.cellDetails.isForeignKey,\n      cancel: false\n    };\n\n    if (!isBlazor() || this.parent.isJsComponent) {\n      args.cell = this.form.parentElement;\n      args.columnObject = column;\n    }\n\n    return args;\n  };\n\n  BatchEdit.prototype.saveCell = function (isForceSave) {\n    if (this.preventSaveCell) {\n      return;\n    }\n\n    var gObj = this.parent;\n\n    if (!isForceSave && (!gObj.isEdit || this.validateFormObj())) {\n      return;\n    }\n\n    this.preventSaveCell = true;\n    var args = this.generateCellArgs();\n    var tr = isBlazor() ? parentsUntil(this.form, 'e-row') : args.cell.parentElement;\n    var col = isBlazor() ? this.cellDetails.column : args.column;\n\n    if (isBlazor()) {\n      delete args.column;\n    }\n\n    if (!isForceSave) {\n      gObj.trigger(events.cellSave, args, this.successCallBack(args, tr, col));\n      gObj.notify(events.batchForm, {\n        formObj: this.form\n      });\n    } else {\n      this.successCallBack(args, tr, col)(args);\n    }\n  };\n\n  BatchEdit.prototype.successCallBack = function (cellSaveArgs, tr, column, isEscapeCellEdit) {\n    var _this = this;\n\n    return function (cellSaveArgs) {\n      var gObj = _this.parent;\n      cellSaveArgs.cell = cellSaveArgs.cell ? cellSaveArgs.cell : _this.form.parentElement;\n      cellSaveArgs.columnObject = cellSaveArgs.columnObject ? cellSaveArgs.columnObject : column;\n      cellSaveArgs.columnObject.index = isNullOrUndefined(cellSaveArgs.columnObject.index) ? 0 : cellSaveArgs.columnObject.index;\n\n      if (cellSaveArgs.cancel) {\n        _this.preventSaveCell = false;\n\n        if (_this.editNext) {\n          _this.editNext = false;\n\n          if (_this.cellDetails.rowIndex === _this.index && _this.cellDetails.column.field === _this.field) {\n            return;\n          }\n\n          _this.editCellExtend(_this.index, _this.field, _this.isAdd);\n        }\n\n        return;\n      }\n\n      gObj.editModule.destroyWidgets([column]);\n      gObj.isEdit = false;\n      gObj.editModule.destroyForm();\n\n      if (isBlazor() && column.template && !cellSaveArgs.cell.parentElement.classList.contains('e-insertedrow')) {\n        updateBlazorTemplate(gObj.element.id + column.uid, 'Template', column, false);\n      }\n\n      _this.parent.notify(events.tooltipDestroy, {});\n\n      if (isBlazor() && gObj.isServerRendered && (parentsUntil(cellSaveArgs.cell, 'e-movableheader') || parentsUntil(cellSaveArgs.cell, 'e-movablecontent'))) {\n        _this.refreshTD(cellSaveArgs.cell, column, gObj.getMovableRowsObject()[_this.cellDetails.rowIndex], cellSaveArgs.value);\n      } else {\n        var rowObj = parentsUntil(cellSaveArgs.cell, 'e-movablecontent') ? gObj.getMovableRowsObject()[_this.cellDetails.rowIndex] : gObj.getRowObjectFromUID(tr.getAttribute('data-uid'));\n\n        _this.refreshTD(cellSaveArgs.cell, column, rowObj, cellSaveArgs.value);\n\n        if (_this.parent.isReact) {\n          cellSaveArgs.cell = _this.newReactTd;\n        }\n      }\n\n      removeClass([tr], ['e-editedrow', 'e-batchrow']);\n      removeClass([cellSaveArgs.cell], ['e-editedbatchcell', 'e-boolcell']);\n\n      if (!isNullOrUndefined(cellSaveArgs.value) && cellSaveArgs.value.toString() === (!isNullOrUndefined(_this.cellDetails.value) ? _this.cellDetails.value : '').toString() && !_this.isColored || isNullOrUndefined(cellSaveArgs.value) && isNullOrUndefined(_this.cellDetails.value) && !cellSaveArgs.cell.parentElement.classList.contains('e-insertedrow')) {\n        cellSaveArgs.cell.classList.remove('e-updatedtd');\n\n        if (isBlazor() && gObj.isServerRendered && (!isNullOrUndefined(cellSaveArgs.value) ? cellSaveArgs.value : '').toString() === (!isNullOrUndefined(_this.cellDetails.value) ? _this.cellDetails.value : '').toString()) {\n          if (_this.cloneCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index].classList.contains('e-selectionbackground')) {\n            _this.originalCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index].classList.add('e-selectionbackground', 'e-active');\n          } else {\n            _this.originalCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index].classList.remove('e-selectionbackground', 'e-active');\n          }\n\n          _this.cloneCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index].replaceWith(_this.originalCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index]);\n        }\n      }\n\n      if (isNullOrUndefined(isEscapeCellEdit)) {\n        gObj.trigger(events.cellSaved, cellSaveArgs);\n      }\n\n      gObj.notify(events.toolbarRefresh, {});\n      _this.isColored = false;\n\n      if (_this.parent.aggregates.length > 0) {\n        _this.parent.notify(events.refreshFooterRenderer, {});\n\n        if (_this.parent.groupSettings.columns.length > 0 && !_this.isAddRow(_this.cellDetails.rowIndex)) {\n          _this.parent.notify(events.groupAggregates, {});\n        }\n      }\n\n      _this.preventSaveCell = false;\n\n      if (_this.editNext) {\n        _this.editNext = false;\n\n        if (_this.cellDetails.rowIndex === _this.index && _this.cellDetails.column.field === _this.field) {\n          return;\n        }\n\n        var col = gObj.getColumnByField(_this.field);\n\n        if (col && col.allowEditing) {\n          _this.editCellExtend(_this.index, _this.field, _this.isAdd);\n        }\n      }\n\n      if (isEscapeCellEdit) {\n        gObj.notify(events.restoreFocus, {});\n      }\n    };\n  };\n\n  BatchEdit.prototype.getDataByIndex = function (index) {\n    var row = this.parent.getRowObjectFromUID(this.parent.getDataRows()[index].getAttribute('data-uid'));\n    return row.changes ? row.changes : row.data;\n  };\n\n  BatchEdit.prototype.keyDownHandler = function (e) {\n    if ((e.action === 'tab' || e.action === 'shiftTab') && this.parent.isEdit) {\n      var gObj = this.parent;\n      var changes = this.getBatchChanges();\n      var addedRecords = 'addedRecords';\n      var dRecords = 'deletedRecords';\n      var btmIdx = this.parent.getCurrentViewRecords().length + changes[addedRecords].length - changes[dRecords].length - 1;\n      var rowcell = parentsUntil(e.target, 'e-rowcell');\n\n      if (rowcell) {\n        var cell = rowcell.querySelector('.e-field');\n\n        if (cell) {\n          var visibleColumns = this.parent.getVisibleColumns();\n          var columnIndex = e.action === 'tab' ? visibleColumns.length - 1 : 0;\n\n          if (visibleColumns[columnIndex].field === cell.getAttribute('id').slice(this.parent.element.id.length)) {\n            if (this.cellDetails.rowIndex === btmIdx && e.action === 'tab') {\n              if (gObj.editSettings.newRowPosition === 'Top') {\n                gObj.editSettings.newRowPosition = 'Bottom';\n                this.addRecord();\n                gObj.editSettings.newRowPosition = 'Top';\n              } else {\n                this.addRecord();\n              }\n            } else {\n              this.saveCell();\n            }\n          }\n        }\n      }\n    }\n  };\n  /**\n   * @hidden\n   */\n\n\n  BatchEdit.prototype.addCancelWhilePaging = function () {\n    if (this.validateFormObj()) {\n      this.parent.notify(events.destroyForm, {});\n      this.parent.isEdit = false;\n      this.isColored = false;\n    }\n  };\n\n  return BatchEdit;\n}();\n\nexport { BatchEdit };","map":{"version":3,"sources":["D:/Projects/TCC/Finances/node_modules/@syncfusion/ej2-grids/src/grid/actions/batch-edit.js"],"names":["extend","addClass","removeClass","setValue","isBlazor","closest","remove","classList","updateBlazorTemplate","blazorTemplates","resetBlazorTemplate","isNullOrUndefined","isUndefined","CellType","parentsUntil","inArray","refreshForeignData","getObject","alignFrozenEditForm","getScrollBarWidth","events","RowRenderer","CellRenderer","Row","Cell","RowModelGenerator","DataUtil","BatchEdit","parent","serviceLocator","renderer","cellDetails","originalCell","cloneCell","editNext","preventSaveCell","focus","getService","addEventListener","prototype","isDestroyed","on","click","clickHandler","dblclick","dblClickHandler","beforeCellFocused","onBeforeCellFocused","cellFocused","onCellFocused","dataBoundFunction","dataBound","bind","batchCancelFunction","batchCancel","doubleTap","keyPressed","keyDownHandler","editNextValCell","closeForm","removeEventListener","off","args","focusModule","restoreFocus","notify","toolbarRefresh","destroy","e","target","element","id","isEdit","form","saveCell","setCellIdx","tr","isNaN","parseInt","getAttribute","parentElement","contains","editCell","getColumns","field","isAddRow","validateFormObj","byClick","indexOf","keyArgs","action","cancel","clickArgs","preventDefault","frzCols","getFrozenColumns","mCont","getContent","querySelector","mHdr","getHeaderContent","clear","container","isContent","isDataCell","frozenRows","isHeader","byKey","_a","indexes","rowIndex","cellIndex","querySelectorAll","length","col","isLastCellPrimaryKey","editCellFromIndex","column","index","getDataRows","rowIdx","cellIdx","closeEdit","gObj","rows","getRowsObject","argument","batchChanges","getBatchChanges","beforeBatchCancel","frozenColumns","currentViewData","isServerRendered","push","apply","getMovableRowsObject","cols","i","template","uid","rowRenderer","mTr","movObj","isAdded","clearSelection","isDirty","getContentTable","removeRowObjectFromUID","getForeignKeyColumns","data","changes","edit","ftr","removeHideAndSelection","refresh","aggregates","type","editType","refreshFooterRenderer","groupSettings","columns","groupAggregates","selectRow","selectionModule","prevRowIndex","renderModule","renderEmptyRow","requestType","isDataRow","cells","visible","refreshRowIdx","tooltipDestroy","trigger","splice","removeAttribute","tdElements","slice","call","deleteRecord","fieldname","bulkDelete","addRecord","bulkAddRow","endEdit","batchSave","Object","keys","j","replaceWith","editModule","formObj","validate","_this","deletedRecords","isCheckBoxSelection","checkAllBox","pageSettings","totalRecordsCount","selectionSettings","persistSelection","removeSelectedData","original","changedRecords","filter","row","map","beforeBatchSave","beforeBatchSaveArgs","content","insertedRow","showSpinner","bulkSave","addedRecords","_i","rows_1","len","addRowObject","isTop","editSettings","newRowPosition","frozenColumnsCount","mRow","mEle","clone","unshift","selectedRowIndex","selectedRows","getSelectedRows","primaryKey","getPrimaryKeyFieldNames","rowData","getSelectedRecords","isJsComponent","deleteRowUid","getRowElementByUID","getRows","getCurrentViewRecords","beforeBatchDelete","beforeBatchDeleteArgs","concat","getMovableRowByIndex","getFrozenRowByIndex","rowObj","getRowObjectFromUID","getMovableDataRows","appendChild","getRowByIndex","fCont","style","height","offsetHeight","uniqueid","selectedRow","undefined","batchDelete","mRows","nonMovableRows","getHeaderTable","children","createElement","className","setAttribute","toString","getIndexFromData","allowAdding","add","defaultData","getDefaultData","beforeBatchAdd","beforeBatchAddArgs","mTbody","model","modelData","generateRows","render","insertBefore","firstChild","cellType","Indent","tbody","emptyRow","parentNode","removeChild","moveTbody","firstElementChild","renderMovable","frozenHeight","forgetPrevious","batchAdd","isFrozen","dRecords","btmIdx","findNextEditableCell","args1","columnObject","columnIndex","cell","ele","cloneNode","childElementCount","isAdd","isValOnly","endIndex","validation","validationRules","checkNPCell","allowEditing","isIdentity","isPrimaryKey","dValues","columnModel","defaultValue","gLen","allowGrouping","getColumnByField","checkEdit","editCellExtend","mRowData","colIdx","getColumnIndexByField","getDataByIndex","columnName","isForeignKey","foreignKeyValue","value","foreignKeyData","getColIndex","getCellIdx","cellEdit","cellEditArgs","isColored","indent","insertCell","replaceChild","isPersistSelection","update","batchEditFormRendered","applyFormValidation","display","updateCell","td","refreshTD","queryCellInfo","setChanges","currentRowObj","rowEle","movableRowObject","movRowEle","movRowIndex","updateRow","keys_1","cIdx","getColumnIndexByUid","detailTemplate","childGrid","isRowDragable","rowcell","parseFloat","isReact","newReactTd","m","colIndex","escapeCellEdit","generateCellArgs","previousValue","successCallBack","obj","editedData","getCurrentEditedData","cloneEditedData","isForceSave","cellSave","batchForm","cellSaveArgs","isEscapeCellEdit","destroyWidgets","destroyForm","cellSaved","visibleColumns","getVisibleColumns","addCancelWhilePaging"],"mappings":"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","sourcesContent":["import { extend, addClass, removeClass, setValue, isBlazor, closest } from '@syncfusion/ej2-base';\nimport { remove, classList, updateBlazorTemplate, blazorTemplates, resetBlazorTemplate } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, isUndefined } from '@syncfusion/ej2-base';\nimport { CellType } from '../base/enum';\nimport { parentsUntil, inArray, refreshForeignData, getObject, alignFrozenEditForm, getScrollBarWidth } from '../base/util';\nimport * as events from '../base/constant';\nimport { RowRenderer } from '../renderer/row-renderer';\nimport { CellRenderer } from '../renderer/cell-renderer';\nimport { Row } from '../models/row';\nimport { Cell } from '../models/cell';\nimport { RowModelGenerator } from '../services/row-model-generator';\nimport { DataUtil } from '@syncfusion/ej2-data';\n/**\n * `BatchEdit` module is used to handle batch editing actions.\n * @hidden\n */\nvar BatchEdit = /** @class */ (function () {\n    function BatchEdit(parent, serviceLocator, renderer) {\n        this.cellDetails = {};\n        this.originalCell = {};\n        this.cloneCell = {};\n        this.editNext = false;\n        this.preventSaveCell = false;\n        this.parent = parent;\n        this.serviceLocator = serviceLocator;\n        this.renderer = renderer;\n        this.focus = serviceLocator.getService('focus');\n        this.addEventListener();\n    }\n    /**\n     * @hidden\n     */\n    BatchEdit.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.click, this.clickHandler, this);\n        this.parent.on(events.dblclick, this.dblClickHandler, this);\n        this.parent.on(events.beforeCellFocused, this.onBeforeCellFocused, this);\n        this.parent.on(events.cellFocused, this.onCellFocused, this);\n        this.dataBoundFunction = this.dataBound.bind(this);\n        this.batchCancelFunction = this.batchCancel.bind(this);\n        this.parent.addEventListener(events.dataBound, this.dataBoundFunction);\n        this.parent.addEventListener(events.batchCancel, this.batchCancelFunction);\n        this.parent.on(events.doubleTap, this.dblClickHandler, this);\n        this.parent.on(events.keyPressed, this.keyDownHandler, this);\n        this.parent.on(events.editNextValCell, this.editNextValCell, this);\n        this.parent.on('closebatch', this.closeForm, this);\n    };\n    /**\n     * @hidden\n     */\n    BatchEdit.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.click, this.clickHandler);\n        this.parent.off(events.dblclick, this.dblClickHandler);\n        this.parent.off(events.beforeCellFocused, this.onBeforeCellFocused);\n        this.parent.off(events.cellFocused, this.onCellFocused);\n        this.parent.removeEventListener(events.dataBound, this.dataBoundFunction);\n        this.parent.removeEventListener(events.batchCancel, this.batchCancelFunction);\n        this.parent.off(events.doubleTap, this.dblClickHandler);\n        this.parent.off(events.keyPressed, this.keyDownHandler);\n        this.parent.off(events.editNextValCell, this.editNextValCell);\n        this.parent.off('closebatch', this.closeForm);\n    };\n    BatchEdit.prototype.batchCancel = function (args) {\n        this.parent.focusModule.restoreFocus();\n    };\n    BatchEdit.prototype.dataBound = function () {\n        this.parent.notify(events.toolbarRefresh, {});\n    };\n    /**\n     * @hidden\n     */\n    BatchEdit.prototype.destroy = function () {\n        this.removeEventListener();\n    };\n    BatchEdit.prototype.clickHandler = function (e) {\n        if (!parentsUntil(e.target, this.parent.element.id + '_add', true)) {\n            if (this.parent.isEdit && closest(this.form, 'td') !== closest(e.target, 'td')) {\n                this.saveCell();\n                this.editNextValCell();\n            }\n            if (parentsUntil(e.target, 'e-rowcell') && !this.parent.isEdit) {\n                this.setCellIdx(e.target);\n            }\n        }\n    };\n    BatchEdit.prototype.dblClickHandler = function (e) {\n        var target = parentsUntil(e.target, 'e-rowcell');\n        var tr = parentsUntil(e.target, 'e-row');\n        if (target && tr && !isNaN(parseInt(target.getAttribute('aria-colindex'), 10))\n            && !target.parentElement.classList.contains('e-editedrow')) {\n            this.editCell(parseInt(tr.getAttribute('aria-rowindex'), 10), this.parent.getColumns()[parseInt(target.getAttribute('aria-colindex'), 10)].field, this.isAddRow(parseInt(tr.getAttribute('aria-rowindex'), 10)));\n        }\n    };\n    BatchEdit.prototype.onBeforeCellFocused = function (e) {\n        if (this.parent.isEdit && this.validateFormObj() &&\n            (e.byClick || (['tab', 'shiftTab', 'enter', 'shiftEnter'].indexOf(e.keyArgs.action) > -1))) {\n            e.cancel = true;\n            if (e.byClick) {\n                e.clickArgs.preventDefault();\n            }\n            else {\n                e.keyArgs.preventDefault();\n            }\n        }\n    };\n    BatchEdit.prototype.onCellFocused = function (e) {\n        var frzCols = this.parent.getFrozenColumns();\n        var mCont = this.parent.getContent().querySelector('.e-movablecontent');\n        var mHdr = this.parent.getHeaderContent().querySelector('.e-movableheader');\n        var clear = (!e.container.isContent || !e.container.isDataCell) && !(this.parent.frozenRows && e.container.isHeader);\n        if (!e.byKey || clear) {\n            if (this.parent.isEdit && clear) {\n                this.saveCell();\n            }\n            return;\n        }\n        var _a = e.container.indexes, rowIndex = _a[0], cellIndex = _a[1];\n        if (frzCols && (mCont.contains(e.element) || (this.parent.frozenRows && mHdr.contains(e.element)))) {\n            cellIndex += frzCols;\n        }\n        if (this.parent.frozenRows && e.container.isContent) {\n            rowIndex += this.parent.frozenRows;\n        }\n        var isEdit = this.parent.isEdit;\n        if (!this.parent.element.querySelectorAll('.e-popup-open').length) {\n            isEdit = isEdit && !this.validateFormObj();\n            switch (e.keyArgs.action) {\n                case 'tab':\n                case 'shiftTab':\n                    var col = this.parent.getColumns()[e.indexes[1]];\n                    if (col && !this.parent.isEdit) {\n                        this.editCell(e.indexes[0], col.field);\n                    }\n                    if (isEdit || this.parent.isLastCellPrimaryKey) {\n                        this.editCellFromIndex(rowIndex, cellIndex);\n                    }\n                    break;\n                case 'enter':\n                case 'shiftEnter':\n                    e.keyArgs.preventDefault();\n                    if (isEdit) {\n                        this.editCell(rowIndex, this.cellDetails.column.field);\n                    }\n                    break;\n                case 'f2':\n                    this.editCellFromIndex(rowIndex, cellIndex);\n                    this.focus.focus();\n                    break;\n            }\n        }\n    };\n    BatchEdit.prototype.isAddRow = function (index) {\n        return this.parent.getDataRows()[index].classList.contains('e-insertedrow');\n    };\n    BatchEdit.prototype.editCellFromIndex = function (rowIdx, cellIdx) {\n        this.cellDetails.rowIndex = rowIdx;\n        this.cellDetails.cellIndex = cellIdx;\n        this.editCell(rowIdx, this.parent.getColumns()[cellIdx].field, this.isAddRow(rowIdx));\n    };\n    // tslint:disable-next-line:max-func-body-length\n    BatchEdit.prototype.closeEdit = function () {\n        var gObj = this.parent;\n        var rows = this.parent.getRowsObject();\n        var argument = { cancel: false, batchChanges: this.getBatchChanges() };\n        gObj.notify(events.beforeBatchCancel, argument);\n        if (argument.cancel) {\n            return;\n        }\n        if (gObj.frozenColumns && rows.length < this.parent.currentViewData.length * 2 && !(isBlazor() && gObj.isServerRendered)) {\n            rows.push.apply(rows, this.parent.getMovableRowsObject());\n        }\n        var cols = this.parent.getColumns();\n        if (isBlazor()) {\n            for (var i = 0; i < cols.length; i++) {\n                var col = cols[i];\n                if (col.template) {\n                    updateBlazorTemplate(this.parent.element.id + col.uid, 'Template', col, false);\n                }\n            }\n        }\n        var rowRenderer = new RowRenderer(this.serviceLocator, null, this.parent);\n        var tr;\n        var mTr;\n        var movObj;\n        if (gObj.isEdit) {\n            this.saveCell(true);\n        }\n        this.isAdded = false;\n        gObj.clearSelection();\n        for (var i = 0; i < rows.length; i++) {\n            if (rows[i].isDirty) {\n                if (gObj.frozenColumns) {\n                    movObj = gObj.getMovableRowsObject()[rows[i].index];\n                    movObj.isDirty = true;\n                }\n                tr = gObj.getContentTable().querySelector('[data-uid=' + rows[i].uid + ']');\n                if (gObj.frozenRows && !tr) {\n                    tr = gObj.getHeaderContent().querySelector('[data-uid=' + rows[i].uid + ']');\n                }\n                if (gObj.frozenColumns) {\n                    if (gObj.frozenRows) {\n                        mTr = gObj.getHeaderContent().querySelector('.e-movableheader')\n                            .querySelector('[data-uid=' + rows[i].uid + ']');\n                        if (!mTr) {\n                            mTr = gObj.getContent().querySelector('.e-movablecontent')\n                                .querySelector('[data-uid=' + rows[i].uid + ']');\n                        }\n                    }\n                    else {\n                        mTr = gObj.getContent().querySelector('.e-movablecontent')\n                            .querySelector('[data-uid=' + rows[i].uid + ']');\n                    }\n                }\n                if (tr || mTr) {\n                    if (tr && tr.classList.contains('e-insertedrow') || mTr && mTr.classList.contains('e-insertedrow')) {\n                        if (tr) {\n                            remove(tr);\n                        }\n                        if (mTr && (gObj.frozenColumns || gObj.frozenRows)) {\n                            remove(mTr);\n                        }\n                        this.removeRowObjectFromUID(rows[i].uid);\n                        i--;\n                    }\n                    else {\n                        refreshForeignData(rows[i], this.parent.getForeignKeyColumns(), rows[i].data);\n                        delete rows[i].changes;\n                        delete rows[i].edit;\n                        rows[i].isDirty = false;\n                        var ftr = mTr ? mTr : tr;\n                        if (isBlazor() && gObj.isServerRendered) {\n                            if (gObj.getFrozenColumns()) {\n                                this.removeHideAndSelection(mTr);\n                            }\n                            this.removeHideAndSelection(tr);\n                            this.closeForm();\n                        }\n                        else {\n                            classList(ftr, [], ['e-hiddenrow', 'e-updatedtd']);\n                            rowRenderer.refresh(rows[i], gObj.getColumns(), false);\n                        }\n                    }\n                    if (this.parent.aggregates.length > 0) {\n                        var type = 'type';\n                        var editType = [];\n                        editType[type] = 'cancel';\n                        this.parent.notify(events.refreshFooterRenderer, editType);\n                        if (this.parent.groupSettings.columns.length > 0) {\n                            this.parent.notify(events.groupAggregates, editType);\n                        }\n                    }\n                }\n            }\n        }\n        if (isBlazor() && gObj.isServerRendered) {\n            gObj.selectRow(gObj.selectionModule.prevRowIndex);\n        }\n        if (!gObj.getContentTable().querySelector('tr.e-row')) {\n            gObj.renderModule.renderEmptyRow();\n        }\n        var args = {\n            requestType: 'batchCancel', rows: this.parent.getRowsObject()\n        };\n        gObj.notify(events.batchCancel, {\n            rows: this.parent.getRowsObject().length ? this.parent.getRowsObject() :\n                [new Row({ isDataRow: true, cells: [new Cell({ isDataCell: true, visible: true })] })]\n        });\n        gObj.selectRow(this.cellDetails.rowIndex);\n        this.refreshRowIdx();\n        gObj.notify(events.toolbarRefresh, {});\n        this.parent.notify(events.tooltipDestroy, {});\n        args = { requestType: 'batchCancel', rows: this.parent.getRowsObject() };\n        gObj.trigger(events.batchCancel, args);\n        if (gObj.frozenColumns) {\n            rows.splice(this.parent.getMovableRowsObject().length, rows.length);\n        }\n    };\n    BatchEdit.prototype.removeHideAndSelection = function (tr) {\n        if (tr.classList.contains('e-hiddenrow')) {\n            tr.removeAttribute('aria-selected');\n            var tdElements = [].slice.call(tr.querySelectorAll('.e-selectionbackground'));\n            for (var i = 0; i < tdElements.length; i++) {\n                removeClass([tdElements[i]], ['e-selectionbackground', 'e-active']);\n            }\n        }\n        classList(tr, [], ['e-hiddenrow', 'e-updatedtd']);\n    };\n    BatchEdit.prototype.deleteRecord = function (fieldname, data) {\n        this.saveCell();\n        if (this.validateFormObj()) {\n            this.saveCell(true);\n        }\n        this.isAdded = false;\n        this.bulkDelete(fieldname, data);\n        if (this.parent.aggregates.length > 0) {\n            this.parent.notify(events.refreshFooterRenderer, {});\n            if (this.parent.groupSettings.columns.length > 0) {\n                this.parent.notify(events.groupAggregates, {});\n            }\n        }\n    };\n    BatchEdit.prototype.addRecord = function (data) {\n        this.bulkAddRow(data);\n    };\n    BatchEdit.prototype.endEdit = function (data) {\n        if (this.parent.isEdit && this.validateFormObj()) {\n            return;\n        }\n        this.batchSave();\n    };\n    BatchEdit.prototype.closeForm = function () {\n        for (var i = 0; i < Object.keys(this.originalCell).length; i++) {\n            for (var j = 0; j < Object.keys(this.cloneCell).length; j++) {\n                if (Object.keys(this.originalCell)[i] === Object.keys(this.cloneCell)[j]) {\n                    this.cloneCell[Object.keys(this.cloneCell)[j]].replaceWith(this.originalCell[Object.keys(this.originalCell)[i]]);\n                    if (this.originalCell[Object.keys(this.originalCell)[i]].classList.contains('e-selectionbackground')) {\n                        this.originalCell[Object.keys(this.originalCell)[i]]\n                            .classList.remove('e-selectionbackground', 'e-cellselectionbackground', 'e-active');\n                    }\n                }\n            }\n        }\n        this.cloneCell = {};\n        this.originalCell = {};\n    };\n    BatchEdit.prototype.validateFormObj = function () {\n        return this.parent.editModule.formObj && !this.parent.editModule.formObj.validate();\n    };\n    BatchEdit.prototype.batchSave = function () {\n        var _this = this;\n        var gObj = this.parent;\n        var deletedRecords = 'deletedRecords';\n        if (gObj.isCheckBoxSelection) {\n            var checkAllBox = gObj.element.querySelector('.e-checkselectall').parentElement;\n            if (checkAllBox.classList.contains('e-checkbox-disabled') &&\n                gObj.pageSettings.totalRecordsCount > gObj.currentViewData.length) {\n                removeClass([checkAllBox], ['e-checkbox-disabled']);\n            }\n        }\n        var cols = this.parent.getColumns();\n        if (isBlazor()) {\n            for (var i = 0; i < cols.length; i++) {\n                var col = cols[i];\n                if (col.template) {\n                    blazorTemplates[this.parent.element.id + col.uid] = [];\n                    resetBlazorTemplate(this.parent.element.id + col.uid, 'Template');\n                }\n            }\n        }\n        this.saveCell();\n        if (gObj.isEdit || this.editNextValCell() || gObj.isEdit) {\n            return;\n        }\n        var changes = this.getBatchChanges();\n        if (this.parent.selectionSettings.type === 'Multiple' && changes[deletedRecords].length &&\n            this.parent.selectionSettings.persistSelection) {\n            changes[deletedRecords] = this.removeSelectedData;\n            this.removeSelectedData = [];\n        }\n        var original = {\n            changedRecords: this.parent.getRowsObject()\n                .filter(function (row) { return row.isDirty && ['add', 'delete'].indexOf(row.edit) === -1; })\n                .map(function (row) { return row.data; })\n        };\n        var args = { batchChanges: changes, cancel: false };\n        gObj.trigger(events.beforeBatchSave, args, function (beforeBatchSaveArgs) {\n            if (beforeBatchSaveArgs.cancel) {\n                return;\n            }\n            if (isBlazor() && _this.parent.isServerRendered) {\n                var content = _this.parent.getContent();\n                _this.closeForm();\n                removeClass(content.querySelectorAll('.e-updatedtd'), ['e-updatedtd']);\n                if (content.querySelector('.e-insertedrow, .e-hiddenrow')) {\n                    removeClass(content.querySelectorAll('.e-hiddenrow'), ['e-hiddenrow']);\n                    var insertedRow = [].slice.call(content.querySelectorAll('.e-insertedrow'));\n                    for (var i = 0; i < insertedRow.length; i++) {\n                        insertedRow[i].remove();\n                    }\n                }\n                _this.refreshRowIdx();\n            }\n            gObj.showSpinner();\n            gObj.notify(events.bulkSave, { changes: changes, original: original });\n        });\n    };\n    BatchEdit.prototype.getBatchChanges = function () {\n        var changes = {\n            addedRecords: [],\n            deletedRecords: [],\n            changedRecords: []\n        };\n        var rows = this.parent.getRowsObject();\n        for (var _i = 0, rows_1 = rows; _i < rows_1.length; _i++) {\n            var row = rows_1[_i];\n            if (row.isDirty) {\n                switch (row.edit) {\n                    case 'add':\n                        changes.addedRecords.push(row.changes);\n                        break;\n                    case 'delete':\n                        changes.deletedRecords.push(row.data);\n                        break;\n                    default:\n                        changes.changedRecords.push(row.changes);\n                }\n            }\n        }\n        return changes;\n    };\n    /**\n     * @hidden\n     */\n    BatchEdit.prototype.removeRowObjectFromUID = function (uid) {\n        var rows = this.parent.getRowsObject();\n        var i = 0;\n        for (var len = rows.length; i < len; i++) {\n            if (rows[i].uid === uid) {\n                break;\n            }\n        }\n        rows.splice(i, 1);\n    };\n    /**\n     * @hidden\n     */\n    BatchEdit.prototype.addRowObject = function (row) {\n        var isTop = this.parent.editSettings.newRowPosition === 'Top';\n        var frozenColumnsCount = this.parent.getFrozenColumns();\n        if (frozenColumnsCount) {\n            var mRow = this.parent.getMovableRowsObject();\n            var mEle = row.clone();\n            mEle.cells = mEle.cells.slice(frozenColumnsCount);\n            row.cells = row.cells.slice(0, frozenColumnsCount);\n            isTop ? mRow.unshift(mEle) : mRow.push(mEle);\n        }\n        isTop ? this.parent.getRowsObject().unshift(row) :\n            this.parent.getRowsObject().push(row);\n    };\n    // tslint:disable-next-line:max-func-body-length\n    BatchEdit.prototype.bulkDelete = function (fieldname, data) {\n        var _this = this;\n        this.removeSelectedData = [];\n        var gObj = this.parent;\n        var index = gObj.selectedRowIndex;\n        var selectedRows = gObj.getSelectedRows();\n        var args = {\n            primaryKey: this.parent.getPrimaryKeyFieldNames(),\n            rowIndex: index,\n            rowData: data ? data : gObj.getSelectedRecords()[0],\n            cancel: false\n        };\n        if (!isBlazor() || this.parent.isJsComponent) {\n            if (data) {\n                args.row = gObj.editModule.deleteRowUid ? gObj.getRowElementByUID(gObj.editModule.deleteRowUid)\n                    : gObj.getRows()[gObj.getCurrentViewRecords().indexOf(data)];\n            }\n            else {\n                args.row = data ? gObj.getRows()[index] : selectedRows[0];\n            }\n            if (!args.row) {\n                return;\n            }\n        }\n        gObj.trigger(events.beforeBatchDelete, args, function (beforeBatchDeleteArgs) {\n            if (beforeBatchDeleteArgs.cancel) {\n                return;\n            }\n            _this.removeSelectedData = gObj.getSelectedRecords();\n            gObj.clearSelection();\n            beforeBatchDeleteArgs.row = beforeBatchDeleteArgs.row ?\n                beforeBatchDeleteArgs.row : data ? gObj.getRows()[index] : selectedRows[0];\n            if (_this.parent.getFrozenColumns()) {\n                if (data) {\n                    index = parseInt(beforeBatchDeleteArgs.row.getAttribute('aria-rowindex'), 10);\n                    selectedRows = [beforeBatchDeleteArgs.row];\n                    if (parentsUntil(beforeBatchDeleteArgs.row, 'e-frozencontent')\n                        || parentsUntil(beforeBatchDeleteArgs.row, 'e-frozenheader')) {\n                        selectedRows = selectedRows.concat(gObj.getMovableRowByIndex(index));\n                    }\n                    else if (parentsUntil(beforeBatchDeleteArgs.row, 'e-movablecontent')\n                        || (parentsUntil(beforeBatchDeleteArgs.row, 'e-movableheader'))) {\n                        selectedRows = selectedRows.concat(gObj.getFrozenRowByIndex(index));\n                    }\n                }\n                for (var i = 0; i < selectedRows.length; i++) {\n                    var uid = selectedRows[i].getAttribute('data-uid');\n                    if (selectedRows[i].classList.contains('e-insertedrow')) {\n                        _this.removeRowObjectFromUID(uid);\n                        remove(selectedRows[i]);\n                    }\n                    else {\n                        var rowObj = gObj.getRowObjectFromUID(uid);\n                        rowObj.isDirty = true;\n                        rowObj.edit = 'delete';\n                        classList(selectedRows[i], ['e-hiddenrow', 'e-updatedtd'], []);\n                        if (gObj.frozenRows && index < gObj.frozenRows && gObj.getMovableDataRows().length >= gObj.frozenRows) {\n                            gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody')\n                                .appendChild(gObj.getMovableRowByIndex(gObj.frozenRows - 1));\n                            gObj.getHeaderContent().querySelector('.e-frozenheader').querySelector('tbody')\n                                .appendChild(gObj.getRowByIndex(gObj.frozenRows - 1));\n                        }\n                        if (gObj.frozenRows && index < gObj.frozenRows && gObj.getDataRows().length >= gObj.frozenRows) {\n                            gObj.getHeaderContent().querySelector('tbody').appendChild(gObj.getRowByIndex(gObj.frozenRows - 1));\n                        }\n                    }\n                    delete selectedRows[i];\n                }\n                var fCont = gObj.getContent().querySelector('.e-frozencontent');\n                var mCont = gObj.getContent().querySelector('.e-movablecontent');\n                fCont.style.height = mCont.offsetHeight - getScrollBarWidth() + 'px';\n            }\n            else if (!_this.parent.getFrozenColumns() && (selectedRows.length === 1 || data)) {\n                var uid = beforeBatchDeleteArgs.row.getAttribute('data-uid');\n                uid = data && _this.parent.editModule.deleteRowUid ? uid = _this.parent.editModule.deleteRowUid : uid;\n                if (beforeBatchDeleteArgs.row.classList.contains('e-insertedrow')) {\n                    _this.removeRowObjectFromUID(uid);\n                    remove(beforeBatchDeleteArgs.row);\n                }\n                else {\n                    var rowObj = gObj.getRowObjectFromUID(uid);\n                    rowObj.isDirty = true;\n                    rowObj.edit = 'delete';\n                    classList(beforeBatchDeleteArgs.row, ['e-hiddenrow', 'e-updatedtd'], []);\n                }\n                delete beforeBatchDeleteArgs.row;\n            }\n            else {\n                for (var i = 0; i < selectedRows.length; i++) {\n                    var uniqueid = selectedRows[i].getAttribute('data-uid');\n                    if (selectedRows[i].classList.contains('e-insertedrow')) {\n                        _this.removeRowObjectFromUID(uniqueid);\n                        remove(selectedRows[i]);\n                    }\n                    else {\n                        classList(selectedRows[i], ['e-hiddenrow', 'e-updatedtd'], []);\n                        var selectedRow = gObj.getRowObjectFromUID(uniqueid);\n                        selectedRow.isDirty = true;\n                        selectedRow.edit = 'delete';\n                        delete selectedRows[i];\n                    }\n                }\n            }\n            _this.refreshRowIdx();\n            if (data) {\n                gObj.editModule.deleteRowUid = undefined;\n                if (gObj.getSelectedRows().length) {\n                    index = parseInt(gObj.getSelectedRows()[0].getAttribute('aria-rowindex'), 10);\n                }\n            }\n            if (!gObj.isCheckBoxSelection) {\n                gObj.selectRow(index);\n            }\n            gObj.trigger(events.batchDelete, beforeBatchDeleteArgs);\n            gObj.notify(events.batchDelete, { rows: _this.parent.getRowsObject() });\n            gObj.notify(events.toolbarRefresh, {});\n        });\n    };\n    BatchEdit.prototype.refreshRowIdx = function () {\n        var rows = [];\n        var mRows = [];\n        var nonMovableRows = [];\n        var frzCols = this.parent.getFrozenColumns();\n        if (this.parent.frozenRows) {\n            rows = [].slice.call(this.parent.getHeaderTable().querySelector('tbody').children);\n            if (frzCols) {\n                mRows = [].slice.call(this.parent.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody').children);\n                for (var i = 0; i < mRows.length; i++) {\n                    nonMovableRows[i] = this.parent.createElement('tr', { className: 'emptynonmv' });\n                }\n            }\n        }\n        if (frzCols) {\n            mRows = mRows.concat([].slice.call(this.parent.getContentTable().querySelector('tbody').children));\n            nonMovableRows = nonMovableRows.concat([].slice.call(this.parent.element.querySelector('.e-movablecontent').querySelector('tbody').children));\n        }\n        rows = rows.concat([].slice.call(this.parent.getContentTable().querySelector('tbody').children));\n        for (var i = 0, j = 0, len = rows.length; i < len; i++) {\n            if (rows[i].classList.contains('e-row') && !rows[i].classList.contains('e-hiddenrow')) {\n                rows[i].setAttribute('aria-rowindex', j.toString());\n                if (frzCols) {\n                    mRows[i].setAttribute('aria-rowindex', j.toString());\n                    if (nonMovableRows[i].classList.contains('e-row')) {\n                        nonMovableRows[i].setAttribute('aria-rowindex', j.toString());\n                    }\n                }\n                j++;\n            }\n            else {\n                rows[i].removeAttribute('aria-rowindex');\n                if (frzCols) {\n                    mRows[i].removeAttribute('aria-rowindex');\n                }\n            }\n        }\n    };\n    BatchEdit.prototype.getIndexFromData = function (data) {\n        return inArray(data, this.parent.getCurrentViewRecords());\n    };\n    BatchEdit.prototype.bulkAddRow = function (data) {\n        var _this = this;\n        var gObj = this.parent;\n        if (!gObj.editSettings.allowAdding) {\n            return;\n        }\n        if (gObj.isEdit) {\n            this.saveCell();\n            this.parent.notify(events.editNextValCell, {});\n        }\n        if (gObj.isEdit) {\n            return;\n        }\n        this.parent.element.classList.add('e-editing');\n        var defaultData = data ? data : this.getDefaultData();\n        var args = {\n            defaultData: defaultData,\n            primaryKey: gObj.getPrimaryKeyFieldNames(),\n            cancel: false\n        };\n        gObj.trigger(events.beforeBatchAdd, args, function (beforeBatchAddArgs) {\n            if (beforeBatchAddArgs.cancel) {\n                return;\n            }\n            _this.isAdded = true;\n            gObj.clearSelection();\n            var mTr;\n            var mTbody;\n            var row = new RowRenderer(_this.serviceLocator, null, _this.parent);\n            var model = new RowModelGenerator(_this.parent);\n            var modelData = model.generateRows([beforeBatchAddArgs.defaultData]);\n            var tr = row.render(modelData[0], gObj.getColumns());\n            var col;\n            var index;\n            for (var i = 0; i < _this.parent.groupSettings.columns.length; i++) {\n                tr.insertBefore(_this.parent.createElement('td', { className: 'e-indentcell' }), tr.firstChild);\n                modelData[0].cells.unshift(new Cell({ cellType: CellType.Indent }));\n            }\n            var tbody = gObj.getContentTable().querySelector('tbody');\n            tr.classList.add('e-insertedrow');\n            if (tbody.querySelector('.e-emptyrow')) {\n                var emptyRow = tbody.querySelector('.e-emptyrow');\n                emptyRow.parentNode.removeChild(emptyRow);\n                if (_this.parent.getFrozenColumns()) {\n                    var moveTbody = _this.parent.getContent().querySelector('.e-movablecontent').querySelector('tbody');\n                    (moveTbody.firstElementChild).parentNode.removeChild(moveTbody.firstElementChild);\n                }\n            }\n            if (gObj.getFrozenColumns()) {\n                mTr = _this.renderMovable(tr);\n                if (gObj.frozenRows && gObj.editSettings.newRowPosition === 'Top') {\n                    mTbody = gObj.getHeaderContent().querySelector('.e-movableheader').querySelector('tbody');\n                }\n                else {\n                    mTbody = gObj.getContent().querySelector('.e-movablecontent').querySelector('tbody');\n                }\n                _this.parent.editSettings.newRowPosition === 'Top' ? mTbody.insertBefore(mTr, mTbody.firstChild) : mTbody.appendChild(mTr);\n                addClass(mTr.querySelectorAll('.e-rowcell'), ['e-updatedtd']);\n                if (_this.parent.height === 'auto') {\n                    _this.parent.notify(events.frozenHeight, {});\n                }\n            }\n            if (gObj.frozenRows && gObj.editSettings.newRowPosition === 'Top') {\n                tbody = gObj.getHeaderContent().querySelector('tbody');\n            }\n            else {\n                tbody = gObj.getContent().querySelector('tbody');\n            }\n            _this.parent.editSettings.newRowPosition === 'Top' ? tbody.insertBefore(tr, tbody.firstChild) : tbody.appendChild(tr);\n            addClass(tr.querySelectorAll('.e-rowcell'), ['e-updatedtd']);\n            modelData[0].isDirty = true;\n            modelData[0].changes = extend({}, {}, modelData[0].data, true);\n            modelData[0].edit = 'add';\n            _this.addRowObject(modelData[0]);\n            _this.refreshRowIdx();\n            _this.focus.forgetPrevious();\n            gObj.notify(events.batchAdd, { rows: _this.parent.getRowsObject(), args: { isFrozen: _this.parent.getFrozenColumns() } });\n            var changes = _this.getBatchChanges();\n            var addedRecords = 'addedRecords';\n            var dRecords = 'deletedRecords';\n            var btmIdx = _this.parent.getCurrentViewRecords().length + changes[addedRecords].length - changes[dRecords].length - 1;\n            _this.parent.editSettings.newRowPosition === 'Top' ? gObj.selectRow(0) : gObj.selectRow(btmIdx);\n            if (!data) {\n                index = _this.findNextEditableCell(0, true);\n                col = gObj.getColumns()[index];\n                _this.parent.editSettings.newRowPosition === 'Top' ? _this.editCell(0, col.field, true) :\n                    _this.editCell(btmIdx, col.field, true);\n            }\n            if (_this.parent.aggregates.length > 0 && (data || changes[addedRecords].length)) {\n                _this.parent.notify(events.refreshFooterRenderer, {});\n            }\n            var args1 = {\n                defaultData: beforeBatchAddArgs.defaultData, row: tr,\n                columnObject: col, columnIndex: index, primaryKey: beforeBatchAddArgs.primaryKey, cell: tr.cells[index]\n            };\n            gObj.trigger(events.batchAdd, args1);\n            if (gObj.getFrozenColumns()) {\n                alignFrozenEditForm(mTr.querySelector('td:not(.e-hide)'), tr.querySelector('td:not(.e-hide)'));\n            }\n            if (isBlazor()) {\n                _this.parent.notify(events.toolbarRefresh, {});\n                _this.parent.notify('start-add', {});\n            }\n        });\n    };\n    BatchEdit.prototype.renderMovable = function (ele) {\n        var mEle = ele.cloneNode(true);\n        for (var i = 0; i < this.parent.getFrozenColumns(); i++) {\n            mEle.removeChild(mEle.children[0]);\n        }\n        for (var i = this.parent.getFrozenColumns(), len = ele.childElementCount; i < len; i++) {\n            ele.removeChild(ele.children[ele.childElementCount - 1]);\n        }\n        return mEle;\n    };\n    BatchEdit.prototype.findNextEditableCell = function (columnIndex, isAdd, isValOnly) {\n        var cols = this.parent.getColumns();\n        var endIndex = cols.length;\n        var validation;\n        for (var i = columnIndex; i < endIndex; i++) {\n            validation = isValOnly ? isNullOrUndefined(cols[i].validationRules) : false;\n            if (!isAdd && this.checkNPCell(cols[i])) {\n                return i;\n            }\n            else if (isAdd && !cols[i].template && cols[i].visible && cols[i].allowEditing &&\n                !(cols[i].isIdentity && cols[i].isPrimaryKey) && !validation) {\n                return i;\n            }\n        }\n        return -1;\n    };\n    BatchEdit.prototype.checkNPCell = function (col) {\n        return !col.template && col.visible && !col.isPrimaryKey && !col.isIdentity && col.allowEditing;\n    };\n    BatchEdit.prototype.getDefaultData = function () {\n        var gObj = this.parent;\n        var data = {};\n        var dValues = { 'number': 0, 'string': null, 'boolean': false, 'date': null, 'datetime': null };\n        for (var _i = 0, _a = (gObj.columnModel); _i < _a.length; _i++) {\n            var col = _a[_i];\n            if (col.field) {\n                setValue(col.field, col.defaultValue ? col.defaultValue : dValues[col.type], data);\n            }\n        }\n        return data;\n    };\n    BatchEdit.prototype.setCellIdx = function (target) {\n        var gLen = 0;\n        if (this.parent.allowGrouping) {\n            gLen = this.parent.groupSettings.columns.length;\n        }\n        this.cellDetails.cellIndex = target.cellIndex - gLen;\n        this.cellDetails.rowIndex = parseInt(target.getAttribute('index'), 10);\n    };\n    BatchEdit.prototype.editCell = function (index, field, isAdd) {\n        var gObj = this.parent;\n        var col = gObj.getColumnByField(field);\n        this.index = index;\n        this.field = field;\n        this.isAdd = isAdd;\n        var checkEdit = gObj.isEdit && !(this.cellDetails.column.field === field\n            && (this.cellDetails.rowIndex === index && this.parent.getDataRows().length - 1 !== index));\n        if (isBlazor() && col.template && !isAdd) {\n            resetBlazorTemplate(this.parent.element.id + col.uid, 'Template', index);\n        }\n        if (gObj.editSettings.allowEditing) {\n            if (!checkEdit && col.allowEditing) {\n                this.editCellExtend(index, field, isAdd);\n            }\n            else if (checkEdit) {\n                this.editNext = true;\n                this.saveCell();\n            }\n        }\n    };\n    BatchEdit.prototype.editCellExtend = function (index, field, isAdd) {\n        var _this = this;\n        var gObj = this.parent;\n        var col = gObj.getColumnByField(field);\n        var keys = gObj.getPrimaryKeyFieldNames();\n        if (gObj.isEdit) {\n            return;\n        }\n        var row;\n        var rowData;\n        var mRowData;\n        var colIdx = gObj.getColumnIndexByField(field);\n        var frzCols = gObj.getFrozenColumns();\n        if (frzCols && colIdx >= frzCols) {\n            row = gObj.getMovableDataRows()[index];\n            mRowData = this.parent.getRowObjectFromUID(this.parent.getMovableDataRows()[index].getAttribute('data-uid'));\n            rowData = mRowData.changes ? extend({}, {}, mRowData.changes, true) : extend({}, {}, this.getDataByIndex(index), true);\n        }\n        else {\n            row = gObj.getDataRows()[index];\n            rowData = extend({}, {}, this.getDataByIndex(index), true);\n        }\n        if ((keys[0] === col.field && !row.classList.contains('e-insertedrow')) || col.columns ||\n            (col.isPrimaryKey && col.isIdentity)) {\n            this.parent.isLastCellPrimaryKey = true;\n            return;\n        }\n        this.parent.isLastCellPrimaryKey = false;\n        this.parent.element.classList.add('e-editing');\n        var rowObj = gObj.getRowObjectFromUID(row.getAttribute('data-uid'));\n        var cells = [].slice.apply(row.cells);\n        var args = {\n            columnName: col.field, isForeignKey: !isNullOrUndefined(col.foreignKeyValue),\n            primaryKey: keys, rowData: rowData,\n            validationRules: extend({}, col.validationRules ? col.validationRules : {}),\n            value: getObject(col.field, rowData),\n            type: !isAdd ? 'edit' : 'add', cancel: false,\n            foreignKeyData: rowObj && rowObj.foreignKeyData\n        };\n        if (!isBlazor() || this.parent.isJsComponent) {\n            args.cell = cells[this.getColIndex(cells, this.getCellIdx(col.uid))];\n            args.row = row;\n            args.columnObject = col;\n            if (!args.cell) {\n                return;\n            }\n        }\n        gObj.trigger(events.cellEdit, args, function (cellEditArgs) {\n            if (cellEditArgs.cancel) {\n                return;\n            }\n            cellEditArgs.cell = cellEditArgs.cell ? cellEditArgs.cell : cells[_this.getColIndex(cells, _this.getCellIdx(col.uid))];\n            cellEditArgs.row = cellEditArgs.row ? cellEditArgs.row : row;\n            cellEditArgs.columnObject = cellEditArgs.columnObject ? cellEditArgs.columnObject : col;\n            cellEditArgs.columnObject.index = isNullOrUndefined(cellEditArgs.columnObject.index) ? 0 : cellEditArgs.columnObject.index;\n            _this.cellDetails = {\n                rowData: rowData, column: col, value: cellEditArgs.value, isForeignKey: cellEditArgs.isForeignKey, rowIndex: index,\n                cellIndex: parseInt(cellEditArgs.cell.getAttribute('aria-colindex'), 10),\n                foreignKeyData: cellEditArgs.foreignKeyData\n            };\n            if (cellEditArgs.cell.classList.contains('e-updatedtd')) {\n                _this.isColored = true;\n                cellEditArgs.cell.classList.remove('e-updatedtd');\n            }\n            if (isBlazor() && gObj.isServerRendered) {\n                var cell = 'cells';\n                var cloneCell = 'cloneCell';\n                var indent = cellEditArgs.row.querySelectorAll('.e-indentcell, .e-detailrowcollapse, .e-detailrowexpand, .e-rowdragdrop').length;\n                _this.cloneCell[\"\" + _this.cellDetails.rowIndex + cellEditArgs.columnObject.index] =\n                    cellEditArgs[cloneCell] = cellEditArgs.cell.cloneNode(true);\n                if ((parentsUntil(cellEditArgs.cell, 'e-movableheader') || parentsUntil(cellEditArgs.cell, 'e-movablecontent'))) {\n                    cellEditArgs.row.insertCell(cellEditArgs.columnObject.index - gObj.getFrozenColumns());\n                    cellEditArgs.row.replaceChild(cellEditArgs[cloneCell], cellEditArgs.row[cell][cellEditArgs.columnObject.index - gObj.getFrozenColumns()]);\n                }\n                else {\n                    cellEditArgs.row.insertCell(cellEditArgs.columnObject.index + indent);\n                    cellEditArgs.row.replaceChild(cellEditArgs[cloneCell], cellEditArgs.row[cell][cellEditArgs.columnObject.index + indent]);\n                }\n                _this.originalCell[\"\" + _this.cellDetails.rowIndex + cellEditArgs.columnObject.index] =\n                    cellEditArgs.cell.parentElement.removeChild(cellEditArgs.cell);\n                removeClass([_this.cloneCell[\"\" + _this.cellDetails.rowIndex + cellEditArgs.columnObject.index]], ['e-focus', 'e-focused']);\n            }\n            gObj.isEdit = true;\n            gObj.clearSelection();\n            if (!gObj.isCheckBoxSelection || !gObj.isPersistSelection) {\n                gObj.selectRow(_this.cellDetails.rowIndex, true);\n            }\n            _this.renderer.update(cellEditArgs);\n            _this.parent.notify(events.batchEditFormRendered, cellEditArgs);\n            _this.form = gObj.element.querySelector('#' + gObj.element.id + 'EditForm');\n            gObj.editModule.applyFormValidation([col]);\n            _this.parent.element.querySelector('.e-gridpopup').style.display = 'none';\n        });\n    };\n    BatchEdit.prototype.updateCell = function (rowIndex, field, value) {\n        var col = this.parent.getColumnByField(field);\n        var index = this.parent.getColumnIndexByField(field);\n        if (col && !col.isPrimaryKey) {\n            var td = this.parent.getDataRows()[rowIndex].querySelectorAll('.e-rowcell')[index];\n            if (this.parent.getFrozenColumns()) {\n                var cells = [].slice.call(this.parent.getDataRows()[rowIndex].querySelectorAll('.e-rowcell')).concat([].slice.call(this.parent.getMovableDataRows()[rowIndex].querySelectorAll('.e-rowcell')));\n                td = cells[index];\n            }\n            var rowObj = parentsUntil(td, 'e-movablecontent') ? this.parent.getMovableRowsObject()[rowIndex] :\n                this.parent.getRowObjectFromUID(td.parentElement.getAttribute('data-uid'));\n            this.refreshTD(td, col, rowObj, value);\n            this.parent.trigger(events.queryCellInfo, {\n                cell: td, column: col, data: rowObj.changes\n            });\n        }\n    };\n    BatchEdit.prototype.setChanges = function (rowObj, field, value, td) {\n        var currentRowObj;\n        if (!this.parent.getFrozenColumns()) {\n            if (!rowObj.changes) {\n                rowObj.changes = extend({}, {}, rowObj.data, true);\n            }\n            if (!isNullOrUndefined(field)) {\n                DataUtil.setValue(field, value, rowObj.changes);\n            }\n            if (rowObj.data[field] !== value) {\n                rowObj.isDirty = true;\n            }\n        }\n        else {\n            var rowEle = this.parent.getRowElementByUID(rowObj.uid);\n            var rowIndex = parseInt(rowEle.getAttribute('aria-rowindex'), 10);\n            currentRowObj = this.parent.getRowsObject()[rowIndex];\n            if (!currentRowObj.changes) {\n                currentRowObj.changes = extend({}, {}, rowObj.data, true);\n            }\n            if (!isNullOrUndefined(field)) {\n                setValue(field, value, currentRowObj.changes);\n            }\n            var movableRowObject = void 0;\n            if (isBlazor() && this.parent.isServerRendered && (parentsUntil(td, 'e-movableheader') ||\n                parentsUntil(td, 'e-movablecontent'))) {\n                var movRowEle = this.parent.getMovableRowByIndex(this.cellDetails.rowIndex);\n                var movRowIndex = parseInt(movRowEle.getAttribute('aria-rowindex'), 10);\n                movableRowObject = this.parent.getMovableRowsObject()[movRowIndex];\n            }\n            else {\n                movableRowObject = this.parent.getMovableRowsObject()[rowIndex];\n            }\n            movableRowObject.changes = extend({}, {}, currentRowObj.changes, true);\n            if (rowObj.data[field] !== value) {\n                movableRowObject.isDirty = true;\n                currentRowObj.isDirty = true;\n            }\n        }\n    };\n    BatchEdit.prototype.updateRow = function (index, data) {\n        var keys = Object.keys(data);\n        for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n            var col = keys_1[_i];\n            this.updateCell(index, col, data[col]);\n        }\n    };\n    BatchEdit.prototype.getCellIdx = function (uid) {\n        var cIdx = this.parent.getColumnIndexByUid(uid) + this.parent.groupSettings.columns.length;\n        if (!isNullOrUndefined(this.parent.detailTemplate) || !isNullOrUndefined(this.parent.childGrid)) {\n            cIdx++;\n        }\n        if (this.parent.isRowDragable()) {\n            cIdx++;\n        }\n        return cIdx;\n    };\n    BatchEdit.prototype.refreshTD = function (td, column, rowObj, value) {\n        var cell = new CellRenderer(this.parent, this.serviceLocator);\n        var rowcell;\n        value = column.type === 'number' && !isNullOrUndefined(value) ? parseFloat(value) : value;\n        this.setChanges(rowObj, column.field, value, td);\n        var frzCols = this.parent.getFrozenColumns();\n        frzCols = frzCols && this.parent.isRowDragable() ? frzCols + 1 : frzCols;\n        refreshForeignData(rowObj, this.parent.getForeignKeyColumns(), rowObj.changes);\n        if (frzCols && this.getCellIdx(column.uid) >= frzCols && this.parent.getColumns().length === rowObj.cells.length) {\n            rowcell = rowObj.cells.slice(frzCols, rowObj.cells.length);\n        }\n        else {\n            rowcell = rowObj.cells;\n        }\n        var parentElement;\n        var cellIndex;\n        if (this.parent.isReact) {\n            parentElement = td.parentElement;\n            cellIndex = td.cellIndex;\n        }\n        cell.refreshTD(td, rowcell[this.getCellIdx(column.uid) - (this.getCellIdx(column.uid) >= frzCols ? frzCols : 0)], rowObj.changes, { 'index': this.getCellIdx(column.uid) });\n        if (this.parent.isReact) {\n            this.newReactTd = parentElement.cells[cellIndex];\n            parentElement.cells[cellIndex].classList.add('e-updatedtd');\n        }\n        else {\n            td.classList.add('e-updatedtd');\n        }\n        td.classList.add('e-updatedtd');\n        this.parent.notify(events.toolbarRefresh, {});\n    };\n    BatchEdit.prototype.getColIndex = function (cells, index) {\n        var cIdx = 0;\n        if (this.parent.allowGrouping && this.parent.groupSettings.columns) {\n            cIdx = this.parent.groupSettings.columns.length;\n        }\n        if (!isNullOrUndefined(this.parent.detailTemplate) || !isNullOrUndefined(this.parent.childGrid)) {\n            cIdx++;\n        }\n        if (this.parent.isRowDragable()) {\n            cIdx++;\n        }\n        for (var m = 0; m < cells.length; m++) {\n            var colIndex = parseInt(cells[m].getAttribute('aria-colindex'), 10);\n            if (colIndex === index - cIdx) {\n                return m;\n            }\n        }\n        return -1;\n    };\n    BatchEdit.prototype.editNextValCell = function () {\n        var gObj = this.parent;\n        var changes = this.getBatchChanges();\n        var addedRecords = 'addedRecords';\n        var dRecords = 'deletedRecords';\n        var btmIdx = (this.parent.getCurrentViewRecords().length + changes[addedRecords].length - changes[dRecords].length) - 1;\n        if (this.isAdded && !gObj.isEdit) {\n            for (var i = this.cellDetails.cellIndex; i < gObj.getColumns().length; i++) {\n                if (gObj.isEdit) {\n                    return;\n                }\n                var index = this.findNextEditableCell(this.cellDetails.cellIndex + 1, true, true);\n                var col = gObj.getColumns()[index];\n                if (col) {\n                    this.parent.editSettings.newRowPosition === 'Bottom' ? this.editCell(btmIdx, col.field, true) :\n                        this.editCell(0, col.field, true);\n                    this.saveCell();\n                }\n            }\n            if (!gObj.isEdit) {\n                this.isAdded = false;\n            }\n        }\n    };\n    BatchEdit.prototype.escapeCellEdit = function () {\n        var args = this.generateCellArgs();\n        args.value = args.previousValue;\n        this.successCallBack(args, args.cell.parentElement, args.column, true)(args);\n    };\n    BatchEdit.prototype.generateCellArgs = function () {\n        var gObj = this.parent;\n        this.parent.element.classList.remove('e-editing');\n        var column = this.cellDetails.column;\n        var obj = {};\n        obj[column.field] = getObject(column.field, this.cellDetails.rowData);\n        var editedData = gObj.editModule.getCurrentEditedData(this.form, obj);\n        var cloneEditedData = extend({}, editedData);\n        editedData = extend({}, editedData, this.cellDetails.rowData);\n        var value = getObject(column.field, cloneEditedData);\n        if (!isNullOrUndefined(column.field) && !isUndefined(value)) {\n            setValue(column.field, value, editedData);\n        }\n        var args = {\n            columnName: column.field,\n            value: getObject(column.field, editedData),\n            rowData: this.cellDetails.rowData,\n            column: column,\n            previousValue: this.cellDetails.value,\n            isForeignKey: this.cellDetails.isForeignKey,\n            cancel: false\n        };\n        if (!isBlazor() || this.parent.isJsComponent) {\n            args.cell = this.form.parentElement;\n            args.columnObject = column;\n        }\n        return args;\n    };\n    BatchEdit.prototype.saveCell = function (isForceSave) {\n        if (this.preventSaveCell) {\n            return;\n        }\n        var gObj = this.parent;\n        if (!isForceSave && (!gObj.isEdit || this.validateFormObj())) {\n            return;\n        }\n        this.preventSaveCell = true;\n        var args = this.generateCellArgs();\n        var tr = isBlazor() ? parentsUntil(this.form, 'e-row') : args.cell.parentElement;\n        var col = isBlazor() ? this.cellDetails.column : args.column;\n        if (isBlazor()) {\n            delete args.column;\n        }\n        if (!isForceSave) {\n            gObj.trigger(events.cellSave, args, this.successCallBack(args, tr, col));\n            gObj.notify(events.batchForm, { formObj: this.form });\n        }\n        else {\n            this.successCallBack(args, tr, col)(args);\n        }\n    };\n    BatchEdit.prototype.successCallBack = function (cellSaveArgs, tr, column, isEscapeCellEdit) {\n        var _this = this;\n        return function (cellSaveArgs) {\n            var gObj = _this.parent;\n            cellSaveArgs.cell = cellSaveArgs.cell ? cellSaveArgs.cell : _this.form.parentElement;\n            cellSaveArgs.columnObject = cellSaveArgs.columnObject ? cellSaveArgs.columnObject : column;\n            cellSaveArgs.columnObject.index = isNullOrUndefined(cellSaveArgs.columnObject.index) ? 0 : cellSaveArgs.columnObject.index;\n            if (cellSaveArgs.cancel) {\n                _this.preventSaveCell = false;\n                if (_this.editNext) {\n                    _this.editNext = false;\n                    if (_this.cellDetails.rowIndex === _this.index && _this.cellDetails.column.field === _this.field) {\n                        return;\n                    }\n                    _this.editCellExtend(_this.index, _this.field, _this.isAdd);\n                }\n                return;\n            }\n            gObj.editModule.destroyWidgets([column]);\n            gObj.isEdit = false;\n            gObj.editModule.destroyForm();\n            if (isBlazor() && column.template && !cellSaveArgs.cell.parentElement.classList.contains('e-insertedrow')) {\n                updateBlazorTemplate(gObj.element.id + column.uid, 'Template', column, false);\n            }\n            _this.parent.notify(events.tooltipDestroy, {});\n            if (isBlazor() && gObj.isServerRendered && (parentsUntil(cellSaveArgs.cell, 'e-movableheader') ||\n                parentsUntil(cellSaveArgs.cell, 'e-movablecontent'))) {\n                _this.refreshTD(cellSaveArgs.cell, column, gObj.getMovableRowsObject()[_this.cellDetails.rowIndex], cellSaveArgs.value);\n            }\n            else {\n                var rowObj = parentsUntil(cellSaveArgs.cell, 'e-movablecontent') ?\n                    gObj.getMovableRowsObject()[_this.cellDetails.rowIndex] : gObj.getRowObjectFromUID(tr.getAttribute('data-uid'));\n                _this.refreshTD(cellSaveArgs.cell, column, rowObj, cellSaveArgs.value);\n                if (_this.parent.isReact) {\n                    cellSaveArgs.cell = _this.newReactTd;\n                }\n            }\n            removeClass([tr], ['e-editedrow', 'e-batchrow']);\n            removeClass([cellSaveArgs.cell], ['e-editedbatchcell', 'e-boolcell']);\n            if (!isNullOrUndefined(cellSaveArgs.value) && cellSaveArgs.value.toString() ===\n                (!isNullOrUndefined(_this.cellDetails.value) ? _this.cellDetails.value : '').toString() && !_this.isColored\n                || (isNullOrUndefined(cellSaveArgs.value) && isNullOrUndefined(_this.cellDetails.value) &&\n                    !cellSaveArgs.cell.parentElement.classList.contains('e-insertedrow'))) {\n                cellSaveArgs.cell.classList.remove('e-updatedtd');\n                if (isBlazor() && gObj.isServerRendered && (!isNullOrUndefined(cellSaveArgs.value) ? cellSaveArgs.value : '').toString() ===\n                    (!isNullOrUndefined(_this.cellDetails.value) ? _this.cellDetails.value : '').toString()) {\n                    if (_this.cloneCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index].\n                        classList.contains('e-selectionbackground')) {\n                        _this.originalCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index].\n                            classList.add('e-selectionbackground', 'e-active');\n                    }\n                    else {\n                        _this.originalCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index].\n                            classList.remove('e-selectionbackground', 'e-active');\n                    }\n                    _this.cloneCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index]\n                        .replaceWith(_this.originalCell[\"\" + parseInt(tr.getAttribute('aria-rowindex'), 10) + cellSaveArgs.columnObject.index]);\n                }\n            }\n            if (isNullOrUndefined(isEscapeCellEdit)) {\n                gObj.trigger(events.cellSaved, cellSaveArgs);\n            }\n            gObj.notify(events.toolbarRefresh, {});\n            _this.isColored = false;\n            if (_this.parent.aggregates.length > 0) {\n                _this.parent.notify(events.refreshFooterRenderer, {});\n                if (_this.parent.groupSettings.columns.length > 0 && !_this.isAddRow(_this.cellDetails.rowIndex)) {\n                    _this.parent.notify(events.groupAggregates, {});\n                }\n            }\n            _this.preventSaveCell = false;\n            if (_this.editNext) {\n                _this.editNext = false;\n                if (_this.cellDetails.rowIndex === _this.index && _this.cellDetails.column.field === _this.field) {\n                    return;\n                }\n                var col = gObj.getColumnByField(_this.field);\n                if (col && col.allowEditing) {\n                    _this.editCellExtend(_this.index, _this.field, _this.isAdd);\n                }\n            }\n            if (isEscapeCellEdit) {\n                gObj.notify(events.restoreFocus, {});\n            }\n        };\n    };\n    BatchEdit.prototype.getDataByIndex = function (index) {\n        var row = this.parent.getRowObjectFromUID(this.parent.getDataRows()[index].getAttribute('data-uid'));\n        return row.changes ? row.changes : row.data;\n    };\n    BatchEdit.prototype.keyDownHandler = function (e) {\n        if ((e.action === 'tab' || e.action === 'shiftTab') && this.parent.isEdit) {\n            var gObj = this.parent;\n            var changes = this.getBatchChanges();\n            var addedRecords = 'addedRecords';\n            var dRecords = 'deletedRecords';\n            var btmIdx = (this.parent.getCurrentViewRecords().length + changes[addedRecords].length - changes[dRecords].length) - 1;\n            var rowcell = parentsUntil(e.target, 'e-rowcell');\n            if (rowcell) {\n                var cell = rowcell.querySelector('.e-field');\n                if (cell) {\n                    var visibleColumns = this.parent.getVisibleColumns();\n                    var columnIndex = e.action === 'tab' ? visibleColumns.length - 1 : 0;\n                    if (visibleColumns[columnIndex].field === cell.getAttribute('id').slice(this.parent.element.id.length)) {\n                        if (this.cellDetails.rowIndex === btmIdx && e.action === 'tab') {\n                            if (gObj.editSettings.newRowPosition === 'Top') {\n                                gObj.editSettings.newRowPosition = 'Bottom';\n                                this.addRecord();\n                                gObj.editSettings.newRowPosition = 'Top';\n                            }\n                            else {\n                                this.addRecord();\n                            }\n                        }\n                        else {\n                            this.saveCell();\n                        }\n                    }\n                }\n            }\n        }\n    };\n    /**\n     * @hidden\n     */\n    BatchEdit.prototype.addCancelWhilePaging = function () {\n        if (this.validateFormObj()) {\n            this.parent.notify(events.destroyForm, {});\n            this.parent.isEdit = false;\n            this.isColored = false;\n        }\n    };\n    return BatchEdit;\n}());\nexport { BatchEdit };\n"]},"metadata":{},"sourceType":"module"}