{"ast":null,"code":"import { Draggable, isBlazor, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { removeClass } from '@syncfusion/ej2-base';\nimport { remove, closest as closestElement, classList } from '@syncfusion/ej2-base';\nimport { parentsUntil, removeElement, getPosition, addRemoveActiveClasses, isActionPrevent } from '../base/util';\nimport * as events from '../base/constant';\nimport { Scroll } from '../actions/scroll';\nimport { Query } from '@syncfusion/ej2-data';\n/**\n *\n * Reorder module is used to handle row reordering.\n * @hidden\n */\n\nvar RowDD =\n/** @class */\nfunction () {\n  /**\n   * Constructor for the Grid print module\n   * @hidden\n   */\n  function RowDD(parent) {\n    var _this = this;\n\n    this.selectedRows = [];\n    this.isOverflowBorder = true;\n    this.selectedRowColls = [];\n    this.isRefresh = true;\n    this.isReplaceDragEle = true;\n    /* tslint:disable-next-line:max-line-length */\n    // tslint:disable-next-line:max-func-body-length\n\n    this.helper = function (e) {\n      var gObj = _this.parent;\n      var target = _this.draggable.currentStateTarget;\n\n      var visualElement = _this.parent.createElement('div', {\n        className: 'e-cloneproperties e-draganddrop e-grid e-dragclone',\n        styles: 'height:\"auto\", z-index:2, width:' + gObj.element.offsetWidth\n      });\n\n      var table = _this.parent.createElement('table', {\n        styles: 'width:' + gObj.element.offsetWidth\n      });\n\n      var tbody = _this.parent.createElement('tbody');\n\n      if (document.getElementsByClassName('e-griddragarea').length || gObj.rowDropSettings.targetID && !target.classList.contains('e-selectionbackground') && gObj.selectionSettings.type !== 'Single' || !gObj.rowDropSettings.targetID && !parentsUntil(e.sender.target, 'e-rowdragdrop')) {\n        return false;\n      }\n\n      if (gObj.rowDropSettings.targetID && gObj.selectionSettings.mode === 'Row' && gObj.selectionSettings.type === 'Single') {\n        gObj.selectRow(parseInt(_this.draggable.currentStateTarget.parentElement.getAttribute('aria-rowindex'), 10));\n      }\n\n      _this.startedRow = closestElement(target, 'tr').cloneNode(true);\n\n      var frzCols = _this.parent.getFrozenColumns();\n\n      if (frzCols) {\n        var rowIndex = parseInt(closestElement(target, 'tr').getAttribute('aria-rowindex'), 10);\n        _this.startedRow.innerHTML = _this.parent.getRows()[rowIndex].innerHTML + _this.parent.getMovableRows()[rowIndex].innerHTML;\n      }\n\n      _this.processArgs(target);\n\n      var args = {\n        selectedRow: _this.rows,\n        dragelement: target,\n        cloneElement: visualElement,\n        cancel: false,\n        data: _this.rowData\n      };\n      var selectedRows = gObj.getSelectedRows();\n      gObj.trigger(events.rowDragStartHelper, args);\n      var cancel = 'cancel';\n      var cloneElement = 'cloneElement';\n\n      if (args[cancel]) {\n        return false;\n      }\n\n      removeElement(_this.startedRow, '.e-indentcell');\n      removeElement(_this.startedRow, '.e-detailrowcollapse');\n      removeElement(_this.startedRow, '.e-detailrowexpand');\n\n      _this.removeCell(_this.startedRow, 'e-gridchkbox');\n\n      var exp = new RegExp('e-active', 'g'); //high contrast issue\n\n      _this.startedRow.innerHTML = _this.startedRow.innerHTML.replace(exp, '');\n      tbody.appendChild(_this.startedRow);\n\n      if (gObj.getSelectedRowIndexes().length > 1 && _this.startedRow.hasAttribute('aria-selected')) {\n        var dropCountEle = _this.parent.createElement('span', {\n          className: 'e-dropitemscount',\n          innerHTML: frzCols ? '' + selectedRows.length / 2 : '' + selectedRows.length\n        });\n\n        visualElement.appendChild(dropCountEle);\n      }\n\n      var ele = closestElement(target, 'tr').querySelector('.e-icon-rowdragicon');\n\n      if (ele) {\n        ele.classList.add('e-dragstartrow');\n      }\n\n      table.appendChild(tbody);\n      visualElement.appendChild(table);\n      gObj.element.appendChild(visualElement);\n      return visualElement;\n    };\n\n    this.dragStart = function (e) {\n      var gObj = _this.parent;\n\n      if (document.getElementsByClassName('e-griddragarea').length) {\n        return;\n      }\n\n      var target = e.target;\n\n      var spanCssEle = _this.parent.element.querySelector('.e-dropitemscount');\n\n      if (_this.parent.getSelectedRecords().length > 1 && spanCssEle) {\n        spanCssEle.style.left = _this.parent.element.querySelector('.e-cloneproperties table').offsetWidth - 5 + 'px';\n      }\n\n      _this.processArgs(target);\n\n      gObj.trigger(events.rowDragStart, {\n        rows: isBlazor() ? null : _this.rows,\n        target: isBlazor() ? null : e.target,\n        draggableType: 'rows',\n        fromIndex: parseInt(_this.rows[0].getAttribute('aria-rowindex'), 10),\n        data: Object.keys(_this.rowData[0]).length > 0 ? _this.rowData : _this.currentViewData()\n      });\n\n      if (isBlazor()) {\n        e.bindEvents(e.dragElement);\n      }\n\n      _this.dragStartData = _this.rowData;\n      var dropElem = document.getElementById(gObj.rowDropSettings.targetID);\n\n      if (gObj.rowDropSettings.targetID && dropElem && dropElem.ej2_instances && dropElem.ej2_instances[0].getModuleName() === 'grid') {\n        dropElem.ej2_instances[0].getContent().classList.add('e-allowRowDrop');\n      }\n    };\n\n    this.drag = function (e) {\n      var gObj = _this.parent;\n\n      var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n\n      var target = _this.getElementFromPosition(cloneElement, e.event);\n\n      classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur', 'e-movecur']);\n      _this.isOverflowBorder = true;\n      _this.hoverState = gObj.enableHover;\n      var trElement = parentsUntil(target, 'e-grid') ? closestElement(e.target, 'tr') : null;\n      gObj.enableHover = false;\n\n      if (!e.target) {\n        return;\n      }\n\n      _this.processArgs(target);\n\n      var args = {\n        rows: _this.rows,\n        target: target,\n        draggableType: 'rows',\n        data: _this.rowData,\n        originalEvent: e,\n        cancel: false\n      };\n      gObj.trigger(events.rowDrag, args);\n\n      _this.stopTimer();\n\n      if (args.cancel) {\n        return;\n      }\n\n      gObj.element.classList.add('e-rowdrag');\n      _this.dragTarget = trElement && parentsUntil(target, 'e-grid').id === cloneElement.parentElement.id ? parseInt(trElement.getAttribute('aria-rowindex'), 10) : parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10);\n\n      if (gObj.rowDropSettings.targetID) {\n        if (!parentsUntil(target, 'e-grid') || parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(target, 'e-grid').id) {\n          classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);\n        } else {\n          classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur']);\n        }\n      } else {\n        var elem = parentsUntil(target, 'e-grid');\n\n        if (elem && elem.id === cloneElement.parentElement.id) {\n          classList(cloneElement, ['e-movecur'], ['e-defaultcur']);\n        } else {\n          classList(cloneElement, ['e-notallowedcur'], ['e-movecur']);\n        }\n      }\n\n      if (!gObj.rowDropSettings.targetID && (!gObj.groupSettings.columns.length || e.target.classList.contains('e-selectionbackground'))) {\n        if (parentsUntil(target, 'e-grid')) {\n          _this.updateScrollPostion(e.event, target);\n        }\n\n        if ((_this.isOverflowBorder || _this.parent.frozenRows > _this.dragTarget) && parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10) !== _this.dragTarget) {\n          _this.moveDragRows(e, _this.startedRow, trElement);\n        } else {\n          if (trElement && _this.parent.getRowByIndex(_this.parent.getCurrentViewRecords().length - 1).getAttribute('data-uid') === trElement.getAttribute('data-uid')) {\n            var bottomborder = _this.parent.createElement('div', {\n              className: 'e-lastrow-dragborder'\n            });\n\n            var gridcontentEle = _this.parent.getContent();\n\n            bottomborder.style.width = _this.parent.element.offsetWidth - _this.getScrollWidth() + 'px';\n\n            if (!gridcontentEle.querySelectorAll('.e-lastrow-dragborder').length) {\n              gridcontentEle.classList.add('e-grid-relative');\n              gridcontentEle.appendChild(bottomborder);\n              bottomborder.style.bottom = _this.getScrollWidth() + 'px';\n            }\n          }\n\n          _this.removeBorder(trElement);\n        }\n      }\n    };\n\n    this.dragStop = function (e) {\n      if (isActionPrevent(_this.parent)) {\n        _this.parent.notify(events.preventBatch, {\n          instance: _this,\n          handler: _this.processDragStop,\n          arg1: e\n        });\n      } else {\n        _this.processDragStop(e);\n      }\n    };\n\n    this.processDragStop = function (e) {\n      var gObj = _this.parent;\n\n      if (_this.parent.isDestroyed) {\n        return;\n      }\n\n      var targetEle = _this.getElementFromPosition(e.helper, e.event);\n\n      var target = targetEle && !targetEle.classList.contains('e-dlg-overlay') ? targetEle : e.target;\n\n      var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n\n      gObj.element.classList.remove('e-rowdrag');\n      var dropElement = document.getElementById(gObj.rowDropSettings.targetID);\n\n      if (gObj.rowDropSettings.targetID && dropElement && dropElement.ej2_instances && dropElement.ej2_instances[0].getModuleName() === 'grid') {\n        dropElement.ej2_instances[0].getContent().classList.remove('e-allowRowDrop');\n      }\n\n      if (gObj.isRowDragable()) {\n        _this.stopTimer();\n\n        gObj.enableHover = _this.hoverState;\n\n        _this.parent.getContent().classList.remove('e-grid-relative');\n\n        _this.removeBorder(targetEle);\n\n        var stRow = gObj.element.querySelector('.e-dragstartrow');\n\n        if (stRow) {\n          stRow.classList.remove('e-dragstartrow');\n        }\n      }\n\n      _this.processArgs(target);\n\n      var args = {\n        target: isBlazor() ? null : target,\n        draggableType: 'rows',\n        cancel: false,\n        fromIndex: parseInt(_this.rows[0].getAttribute('aria-rowindex'), 10),\n        dropIndex: _this.dragTarget,\n        rows: isBlazor() ? null : _this.rows,\n        data: Object.keys(_this.dragStartData[0]).length > 0 ? _this.dragStartData : _this.currentViewData()\n      };\n      gObj.trigger(events.rowDrop, args, function () {\n        if (!(parentsUntil(target, 'e-row') || parentsUntil(target, 'e-emptyrow')) || args.cancel) {\n          _this.dragTarget = null;\n          remove(e.helper);\n          return;\n        }\n\n        _this.isRefresh = false;\n\n        var selectedIndexes = _this.parent.getSelectedRowIndexes();\n\n        if (gObj.isRowDragable()) {\n          if (!isBlazor()) {\n            if (!_this.parent.rowDropSettings.targetID && _this.startedRow.querySelector('td.e-selectionbackground') && selectedIndexes.length > 1 && selectedIndexes.length !== _this.parent.getCurrentViewRecords().length) {\n              _this.reorderRows(selectedIndexes, args.dropIndex);\n            } else {\n              _this.reorderRows([parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10)], _this.dragTarget);\n            }\n          } else {\n            var draggedData = _this.parent.getSelectedRecords().length ? _this.parent.getSelectedRecords() : _this.currentViewData();\n            var changeRecords = {\n              addedRecords: [],\n              deletedRecords: draggedData,\n              changedRecords: []\n            };\n            var toIdx = _this.dragTarget ? _this.dragTarget : args.dropIndex;\n            var dragDropDestinationIndex = 'dragDropDestinationIndex';\n            var query = new Query();\n            query[dragDropDestinationIndex] = toIdx;\n\n            _this.saveChange(changeRecords, query);\n\n            changeRecords.deletedRecords = [];\n            changeRecords.addedRecords = draggedData;\n\n            _this.saveChange(changeRecords, query);\n          }\n\n          _this.dragTarget = null;\n\n          if (!gObj.rowDropSettings.targetID) {\n            remove(e.helper);\n            gObj.refresh();\n          }\n        }\n\n        _this.isRefresh = true;\n      });\n    };\n\n    this.removeCell = function (targetRow, className) {\n      return [].slice.call(targetRow.querySelectorAll('td')).filter(function (cell) {\n        if (cell.classList.contains(className)) {\n          targetRow.deleteCell(cell.cellIndex);\n        }\n      });\n    };\n\n    this.parent = parent;\n\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.initialEnd, this.initializeDrag, this);\n    this.parent.on(events.columnDrop, this.columnDrop, this);\n    this.onDataBoundFn = this.onDataBound.bind(this);\n    this.parent.addEventListener(events.dataBound, this.onDataBoundFn);\n    this.parent.on(events.uiUpdate, this.enableAfterRender, this);\n  }\n\n  RowDD.prototype.currentViewData = function () {\n    var selectedIndexes = this.parent.getSelectedRowIndexes();\n    var currentVdata = [];\n    var fromIdx = parseInt(this.startedRow.getAttribute('aria-rowindex'), 10);\n\n    for (var i = 0, n = selectedIndexes.length; i < n; i++) {\n      var currentV = 'currentViewData';\n      currentVdata[i] = this.parent[currentV][selectedIndexes[i]];\n    }\n\n    if (!this.parent.rowDropSettings.targetID && selectedIndexes.length === 0) {\n      currentVdata[0] = this.parent.currentViewData[fromIdx];\n    }\n\n    return currentVdata;\n  };\n\n  RowDD.prototype.saveChange = function (changeRecords, query) {\n    var _this = this;\n\n    this.parent.getDataModule().saveChanges(changeRecords, this.parent.getPrimaryKeyFieldNames()[0], {}, query).then(function () {\n      _this.parent.notify(events.modelChanged, {\n        type: events.actionBegin,\n        requestType: 'rowdraganddrop'\n      });\n    }).catch(function (e) {\n      var error = 'error';\n      var message = 'message';\n\n      if (!isNullOrUndefined(e[error]) && !isNullOrUndefined(e[error][message])) {\n        e[error] = e[error][message];\n      }\n\n      _this.parent.trigger(events.actionFailure, e);\n    });\n  };\n\n  RowDD.prototype.reorderRows = function (fromIndexes, toIndex) {\n    var selectedIndexes = this.parent.getSelectedRowIndexes();\n    var selectedRecords = [];\n    var draggedRecords = [];\n    var currentViewData = this.parent.renderModule.data.dataManager.dataSource.json;\n    var dropIdx = toIndex;\n    var actualIdx = fromIndexes[0];\n\n    for (var i = 0, len = fromIndexes.length; i < len; i++) {\n      draggedRecords[i] = currentViewData[fromIndexes[i]];\n    }\n\n    for (var i = 0, len = selectedIndexes.length; i < len; i++) {\n      selectedRecords[i] = currentViewData[selectedIndexes[i]];\n    }\n\n    for (var i = 0, len = draggedRecords.length; i < len; i++) {\n      if (i !== 0) {\n        for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n          if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(draggedRecords[i])) {\n            actualIdx = j;\n            break;\n          }\n        }\n\n        for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n          if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(draggedRecords[i - 1])) {\n            if (actualIdx > j) {\n              dropIdx = j + 1;\n            }\n\n            break;\n          }\n        }\n      }\n\n      this.reorderRow(actualIdx, dropIdx);\n    }\n\n    if (this.isRefresh) {\n      this.parent.notify(events.modelChanged, {\n        type: events.actionBegin,\n        requestType: 'rowdraganddrop'\n      });\n    }\n\n    for (var i = 0, len = selectedRecords.length; i < len; i++) {\n      for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n        if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(selectedRecords[i])) {\n          selectedIndexes[i] = j;\n          break;\n        }\n      }\n    }\n\n    this.selectedRowColls = selectedIndexes;\n  };\n\n  RowDD.prototype.stopTimer = function () {\n    window.clearInterval(this.timer);\n  };\n\n  RowDD.prototype.initializeDrag = function () {\n    var gObj = this.parent;\n    this.draggable = new Draggable(gObj.element, {\n      dragTarget: '.e-rowcelldrag, .e-rowdragdrop, .e-rowcell',\n      distance: 5,\n      helper: this.helper,\n      dragStart: this.dragStart,\n      drag: this.drag,\n      dragStop: this.dragStop,\n      isReplaceDragEle: this.isReplaceDragEle\n    });\n  };\n\n  RowDD.prototype.updateScrollPostion = function (e, target) {\n    var _this = this;\n\n    var frzCols = this.parent.getFrozenColumns();\n    var y = getPosition(e).y;\n    var cliRect = this.parent.getContent().getBoundingClientRect();\n    var rowHeight = this.parent.getRowHeight() - 15;\n    var scrollElem = frzCols ? this.parent.getContent().querySelector('.e-movablecontent') : this.parent.getContent().firstElementChild;\n\n    if (cliRect.top + rowHeight >= y) {\n      var scrollPixel_1 = -this.parent.getRowHeight();\n      this.isOverflowBorder = false;\n      this.timer = window.setInterval(function () {\n        _this.setScrollDown(scrollElem, scrollPixel_1, true);\n      }, 200);\n    } else if (cliRect.top + this.parent.getContent().clientHeight - rowHeight - 33 <= y) {\n      var scrollPixel_2 = this.parent.getRowHeight();\n      this.isOverflowBorder = false;\n      this.timer = window.setInterval(function () {\n        _this.setScrollDown(scrollElem, scrollPixel_2, true);\n      }, 200);\n    }\n  };\n\n  RowDD.prototype.setScrollDown = function (scrollElem, scrollPixel, isLeft) {\n    scrollElem.scrollTop = scrollElem.scrollTop + scrollPixel;\n  };\n\n  RowDD.prototype.moveDragRows = function (e, startedRow, targetRow) {\n    var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n    var element = closestElement(e.target, 'tr');\n\n    if (parentsUntil(element, 'e-grid') && parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(element, 'e-grid').id) {\n      var targetElement = element ? element : this.startedRow;\n      this.setBorder(targetElement, e.event, startedRow, targetRow);\n    }\n  };\n\n  RowDD.prototype.setBorder = function (element, event, startedRow, targetRow) {\n    var node = this.parent.element;\n    var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n    this.removeFirstRowBorder(element);\n    this.removeLastRowBorder(element);\n\n    if (parentsUntil(element, 'e-grid') && parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(element, 'e-grid').id) {\n      removeClass(node.querySelectorAll('.e-rowcell,.e-rowdragdrop'), ['e-dragborder']);\n      var rowElement = [];\n      var targetRowIndex = parseInt(targetRow.getAttribute('aria-rowindex'), 10);\n\n      if (targetRow && targetRowIndex === 0) {\n        var div = this.parent.createElement('div', {\n          className: 'e-firstrow-dragborder'\n        });\n        var gridheaderEle = this.parent.getHeaderContent();\n        gridheaderEle.classList.add('e-grid-relative');\n        div.style.width = node.offsetWidth - this.getScrollWidth() + 'px';\n\n        if (!gridheaderEle.querySelectorAll('.e-firstrow-dragborder').length) {\n          gridheaderEle.appendChild(div);\n        }\n      } else if (targetRow && parseInt(startedRow.getAttribute('aria-rowindex'), 10) > targetRowIndex) {\n        element = this.parent.getRowByIndex(targetRowIndex - 1);\n        rowElement = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n      } else {\n        rowElement = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n      }\n\n      var frzCols = this.parent.getFrozenColumns();\n\n      if (targetRow && targetRowIndex !== 0 && frzCols) {\n        var rowIndex = parseInt(element.getAttribute('aria-rowindex'), 10);\n        var selector = '.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse';\n        rowElement = [].slice.call(this.parent.getRows()[rowIndex].querySelectorAll(selector)).concat([].slice.call(this.parent.getMovableRows()[rowIndex].querySelectorAll(selector)));\n      }\n\n      if (rowElement.length > 0) {\n        addRemoveActiveClasses(rowElement, true, 'e-dragborder');\n      }\n    }\n  };\n\n  RowDD.prototype.getScrollWidth = function () {\n    var scrollElem = this.parent.getContent().firstElementChild;\n    return scrollElem.scrollWidth > scrollElem.offsetWidth ? Scroll.getScrollBarWidth() : 0;\n  };\n\n  RowDD.prototype.removeFirstRowBorder = function (element) {\n    if (this.parent.element.getElementsByClassName('e-firstrow-dragborder').length > 0 && element && element.rowIndex !== 0) {\n      this.parent.element.getElementsByClassName('e-firstrow-dragborder')[0].remove();\n    }\n  };\n\n  RowDD.prototype.removeLastRowBorder = function (element) {\n    var islastRowIndex = element && this.parent.getRowByIndex(this.parent.getCurrentViewRecords().length - 1).getAttribute('data-uid') !== element.getAttribute('data-uid');\n\n    if (this.parent.element.getElementsByClassName('e-lastrow-dragborder').length > 0 && element && islastRowIndex) {\n      this.parent.element.getElementsByClassName('e-lastrow-dragborder')[0].remove();\n    }\n  };\n\n  RowDD.prototype.removeBorder = function (element) {\n    this.removeFirstRowBorder(element);\n    this.removeLastRowBorder(element);\n    element = this.parent.getRows().filter(function (row) {\n      return row.querySelector('td.e-dragborder');\n    })[0];\n\n    if (element) {\n      var rowElement = [].slice.call(element.querySelectorAll('.e-dragborder'));\n\n      if (this.parent.getFrozenColumns()) {\n        var rowIndex = parseInt(element.getAttribute('aria-rowindex'), 10);\n        rowElement = [].slice.call(this.parent.getRows()[rowIndex].querySelectorAll('.e-dragborder')).concat([].slice.call(this.parent.getMovableRows()[rowIndex].querySelectorAll('.e-dragborder')));\n      }\n\n      addRemoveActiveClasses(rowElement, false, 'e-dragborder');\n    }\n  };\n\n  RowDD.prototype.getElementFromPosition = function (element, event) {\n    var target;\n    var position = getPosition(event);\n    element.style.display = 'none';\n    target = document.elementFromPoint(position.x, position.y);\n    element.style.display = '';\n    return target;\n  };\n\n  RowDD.prototype.onDataBound = function (e) {\n    if (this.selectedRowColls.length > 0) {\n      this.parent.selectRows(this.selectedRowColls);\n      this.selectedRowColls = [];\n    }\n  };\n\n  RowDD.prototype.getTargetIdx = function (targetRow) {\n    return targetRow ? parseInt(targetRow.getAttribute('aria-rowindex'), 10) : 0;\n  };\n\n  RowDD.prototype.singleRowDrop = function (e) {\n    var targetRow = closestElement(e.target, 'tr');\n    var currentIndex;\n    var srcControl;\n    srcControl = e.droppedElement.parentElement.ej2_instances[0];\n    currentIndex = targetRow ? targetRow.rowIndex : srcControl.currentViewData.length - 1;\n    this.reorderRow(this.startedRowIndex, currentIndex);\n  };\n\n  RowDD.prototype.columnDrop = function (e) {\n    var gObj = this.parent;\n    var draggObj = e.droppedElement.parentElement.ej2_instances[0];\n\n    if (e.droppedElement.getAttribute('action') !== 'grouping' && (parentsUntil(e.target, 'e-row') || parentsUntil(e.target, 'e-emptyrow'))) {\n      var targetRow = closestElement(e.target, 'tr');\n      var srcControl_1;\n      var currentIndex = void 0;\n\n      if (e.droppedElement.querySelector('tr').getAttribute('single-dragrow') !== 'true' && e.droppedElement.parentElement.id === gObj.element.id || e.droppedElement.querySelector('tr').getAttribute('single-dragrow') === 'true' && e.droppedElement.parentElement.id !== gObj.element.id) {\n        return;\n      }\n\n      if (e.droppedElement.parentElement.id !== gObj.element.id) {\n        srcControl_1 = e.droppedElement.parentElement.ej2_instances[0];\n      } else if (this.isSingleRowDragDrop || e.droppedElement.querySelector('tr').getAttribute('single-dragrow') === 'true') {\n        this.singleRowDrop(e);\n        return;\n      }\n\n      if (srcControl_1.element.id !== gObj.element.id && srcControl_1.rowDropSettings.targetID !== gObj.element.id) {\n        return;\n      }\n\n      var records = srcControl_1.getSelectedRecords();\n      var targetIndex = currentIndex = this.getTargetIdx(targetRow);\n      var count = 0;\n\n      if (isNaN(targetIndex)) {\n        targetIndex = currentIndex = 0;\n      }\n\n      if (gObj.allowPaging) {\n        targetIndex = targetIndex + gObj.pageSettings.currentPage * gObj.pageSettings.pageSize - gObj.pageSettings.pageSize;\n      } //Todo: drag and drop mapper & BatchChanges\n\n\n      if (!isBlazor()) {\n        gObj.notify(events.rowsAdded, {\n          toIndex: targetIndex,\n          records: records\n        });\n        gObj.notify(events.modelChanged, {\n          type: events.actionBegin,\n          requestType: 'rowdraganddrop'\n        });\n        var selectedRows = srcControl_1.getSelectedRowIndexes();\n        var skip = srcControl_1.allowPaging ? srcControl_1.pageSettings.currentPage * srcControl_1.pageSettings.pageSize - srcControl_1.pageSettings.pageSize : 0;\n        this.selectedRows = [];\n\n        for (var i = 0, len = records.length; i < len; i++) {\n          this.selectedRows.push(skip + selectedRows[i]);\n        }\n\n        srcControl_1.notify(events.rowsRemoved, {\n          indexes: this.selectedRows,\n          records: records\n        });\n        srcControl_1.notify(events.modelChanged, {\n          type: events.actionBegin,\n          requestType: 'rowdraganddrop'\n        });\n      } else {\n        var currentVdata = [];\n        var selectedIndex = srcControl_1.getSelectedRowIndexes();\n\n        for (var i = 0; i < selectedIndex.length; i++) {\n          currentVdata[i] = srcControl_1.currentViewData[selectedIndex[i]];\n        }\n\n        records = currentVdata;\n        var changes = {\n          addedRecords: records,\n          deletedRecords: [],\n          changedRecords: []\n        };\n        var dragDropDestinationIndex = 'dragDropDestinationIndex';\n        var query = new Query();\n        query[dragDropDestinationIndex] = targetIndex;\n        gObj.getDataModule().saveChanges(changes, gObj.getPrimaryKeyFieldNames()[0], {}, query).then(function () {\n          gObj.notify(events.modelChanged, {\n            type: events.actionBegin,\n            requestType: 'rowdraganddrop'\n          });\n        }).catch(function (e) {\n          var message = 'message';\n          var error = 'error';\n\n          if (!isNullOrUndefined(e[error]) && !isNullOrUndefined(e[error][message])) {\n            e[error] = e[error][message];\n          }\n\n          gObj.trigger(events.actionFailure, e);\n        });\n        changes.deletedRecords = records;\n        changes.addedRecords = [];\n        srcControl_1.getDataModule().saveChanges(changes, srcControl_1.getPrimaryKeyFieldNames()[0], {}, query).then(function () {\n          srcControl_1.notify(events.modelChanged, {\n            type: events.actionBegin,\n            requestType: 'rowdraganddrop'\n          });\n        }).catch(function (e) {\n          var error = 'error';\n          var msg = 'message';\n\n          if (!isNullOrUndefined(e[error]) && !isNullOrUndefined(e[error][msg])) {\n            e[error] = e[error][msg];\n          }\n\n          srcControl_1.trigger(events.actionFailure, e);\n        });\n      }\n    }\n  };\n\n  RowDD.prototype.reorderRow = function (fromIndexes, toIndex) {\n    var gObj = this.parent;\n\n    if (!gObj.sortSettings.columns.length && !gObj.groupSettings.columns.length && !gObj.filterSettings.columns.length) {\n      //Todo: drag and drop mapper & BatchChanges                 \n      var skip = gObj.allowPaging ? gObj.pageSettings.currentPage * gObj.pageSettings.pageSize - gObj.pageSettings.pageSize : 0;\n      var fromIndex = fromIndexes;\n      toIndex = toIndex + skip;\n      this.selectedRows = gObj.getSelectedRowIndexes();\n      gObj.notify(events.rowPositionChanged, {\n        fromIndex: fromIndexes + skip,\n        toIndex: toIndex\n      });\n    }\n  };\n\n  RowDD.prototype.enableAfterRender = function (e) {\n    if (e.module === this.getModuleName() && e.enable) {\n      this.initializeDrag();\n    }\n  };\n  /**\n   * To destroy the print\n   * @return {void}\n   * @hidden\n   */\n\n\n  RowDD.prototype.destroy = function () {\n    var gridElement = this.parent.element;\n\n    if (this.parent.isDestroyed || !gridElement || !gridElement.querySelector('.e-gridheader') && !gridElement.querySelector('.e-gridcontent')) {\n      return;\n    }\n\n    this.draggable.destroy();\n    this.parent.off(events.initialEnd, this.initializeDrag);\n    this.parent.off(events.columnDrop, this.columnDrop);\n    this.parent.removeEventListener(events.dataBound, this.onDataBoundFn);\n    this.parent.off(events.uiUpdate, this.enableAfterRender); //destory ejdrag and drop\n  };\n  /**\n   * For internal use only - Get the module name.\n   * @private\n   */\n\n\n  RowDD.prototype.getModuleName = function () {\n    return 'rowDragAndDrop';\n  };\n\n  RowDD.prototype.processArgs = function (target) {\n    var gObj = this.parent;\n\n    if (gObj.getSelectedRecords().length > 0 && this.startedRow.cells[0].classList.contains('e-selectionbackground') === false || gObj.getSelectedRecords().length === 0) {\n      this.rows = [this.startedRow];\n      this.rowData = [this.parent.getRowInfo(this.startedRow.querySelector('.e-rowcell')).rowData];\n    } else {\n      this.rows = gObj.getSelectedRows();\n      this.rowData = gObj.getSelectedRecords();\n    }\n  };\n\n  return RowDD;\n}();\n\nexport { RowDD };","map":{"version":3,"sources":["D:/Projects/TCC/Finances/node_modules/@syncfusion/ej2-grids/src/grid/actions/row-reorder.js"],"names":["Draggable","isBlazor","isNullOrUndefined","removeClass","remove","closest","closestElement","classList","parentsUntil","removeElement","getPosition","addRemoveActiveClasses","isActionPrevent","events","Scroll","Query","RowDD","parent","_this","selectedRows","isOverflowBorder","selectedRowColls","isRefresh","isReplaceDragEle","helper","e","gObj","target","draggable","currentStateTarget","visualElement","createElement","className","styles","element","offsetWidth","table","tbody","document","getElementsByClassName","length","rowDropSettings","targetID","contains","selectionSettings","type","sender","mode","selectRow","parseInt","parentElement","getAttribute","startedRow","cloneNode","frzCols","getFrozenColumns","rowIndex","innerHTML","getRows","getMovableRows","processArgs","args","selectedRow","rows","dragelement","cloneElement","cancel","data","rowData","getSelectedRows","trigger","rowDragStartHelper","removeCell","exp","RegExp","replace","appendChild","getSelectedRowIndexes","hasAttribute","dropCountEle","ele","querySelector","add","dragStart","spanCssEle","getSelectedRecords","style","left","rowDragStart","draggableType","fromIndex","Object","keys","currentViewData","bindEvents","dragElement","dragStartData","dropElem","getElementById","ej2_instances","getModuleName","getContent","drag","getElementFromPosition","event","hoverState","enableHover","trElement","originalEvent","rowDrag","stopTimer","dragTarget","id","elem","groupSettings","columns","updateScrollPostion","frozenRows","moveDragRows","getRowByIndex","getCurrentViewRecords","bottomborder","gridcontentEle","width","getScrollWidth","querySelectorAll","bottom","removeBorder","dragStop","notify","preventBatch","instance","handler","processDragStop","arg1","isDestroyed","targetEle","dropElement","isRowDragable","stRow","dropIndex","rowDrop","selectedIndexes","reorderRows","draggedData","changeRecords","addedRecords","deletedRecords","changedRecords","toIdx","dragDropDestinationIndex","query","saveChange","refresh","targetRow","slice","call","filter","cell","deleteCell","cellIndex","on","initialEnd","initializeDrag","columnDrop","onDataBoundFn","onDataBound","bind","addEventListener","dataBound","uiUpdate","enableAfterRender","prototype","currentVdata","fromIdx","i","n","currentV","getDataModule","saveChanges","getPrimaryKeyFieldNames","then","modelChanged","actionBegin","requestType","catch","error","message","actionFailure","fromIndexes","toIndex","selectedRecords","draggedRecords","renderModule","dataManager","dataSource","json","dropIdx","actualIdx","len","j","len1","JSON","stringify","reorderRow","window","clearInterval","timer","distance","y","cliRect","getBoundingClientRect","rowHeight","getRowHeight","scrollElem","firstElementChild","top","scrollPixel_1","setInterval","setScrollDown","clientHeight","scrollPixel_2","scrollPixel","isLeft","scrollTop","targetElement","setBorder","node","removeFirstRowBorder","removeLastRowBorder","rowElement","targetRowIndex","div","gridheaderEle","getHeaderContent","selector","concat","scrollWidth","getScrollBarWidth","islastRowIndex","row","position","display","elementFromPoint","x","selectRows","getTargetIdx","singleRowDrop","currentIndex","srcControl","droppedElement","startedRowIndex","draggObj","srcControl_1","isSingleRowDragDrop","records","targetIndex","count","isNaN","allowPaging","pageSettings","currentPage","pageSize","rowsAdded","skip","push","rowsRemoved","indexes","selectedIndex","changes","msg","sortSettings","filterSettings","rowPositionChanged","module","enable","destroy","gridElement","off","removeEventListener","cells","getRowInfo"],"mappings":"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","sourcesContent":["import { Draggable, isBlazor, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { removeClass } from '@syncfusion/ej2-base';\nimport { remove, closest as closestElement, classList } from '@syncfusion/ej2-base';\nimport { parentsUntil, removeElement, getPosition, addRemoveActiveClasses, isActionPrevent } from '../base/util';\nimport * as events from '../base/constant';\nimport { Scroll } from '../actions/scroll';\nimport { Query } from '@syncfusion/ej2-data';\n/**\n *\n * Reorder module is used to handle row reordering.\n * @hidden\n */\nvar RowDD = /** @class */ (function () {\n    /**\n     * Constructor for the Grid print module\n     * @hidden\n     */\n    function RowDD(parent) {\n        var _this = this;\n        this.selectedRows = [];\n        this.isOverflowBorder = true;\n        this.selectedRowColls = [];\n        this.isRefresh = true;\n        this.isReplaceDragEle = true;\n        /* tslint:disable-next-line:max-line-length */\n        // tslint:disable-next-line:max-func-body-length\n        this.helper = function (e) {\n            var gObj = _this.parent;\n            var target = _this.draggable.currentStateTarget;\n            var visualElement = _this.parent.createElement('div', {\n                className: 'e-cloneproperties e-draganddrop e-grid e-dragclone',\n                styles: 'height:\"auto\", z-index:2, width:' + gObj.element.offsetWidth\n            });\n            var table = _this.parent.createElement('table', { styles: 'width:' + gObj.element.offsetWidth });\n            var tbody = _this.parent.createElement('tbody');\n            if (document.getElementsByClassName('e-griddragarea').length ||\n                (gObj.rowDropSettings.targetID && (!target.classList.contains('e-selectionbackground')\n                    && gObj.selectionSettings.type !== 'Single')) ||\n                (!gObj.rowDropSettings.targetID && !parentsUntil(e.sender.target, 'e-rowdragdrop'))) {\n                return false;\n            }\n            if (gObj.rowDropSettings.targetID &&\n                gObj.selectionSettings.mode === 'Row' && gObj.selectionSettings.type === 'Single') {\n                gObj.selectRow(parseInt(_this.draggable.currentStateTarget.parentElement.getAttribute('aria-rowindex'), 10));\n            }\n            _this.startedRow = closestElement(target, 'tr').cloneNode(true);\n            var frzCols = _this.parent.getFrozenColumns();\n            if (frzCols) {\n                var rowIndex = parseInt(closestElement(target, 'tr').getAttribute('aria-rowindex'), 10);\n                _this.startedRow.innerHTML = _this.parent.getRows()[rowIndex].innerHTML +\n                    _this.parent.getMovableRows()[rowIndex].innerHTML;\n            }\n            _this.processArgs(target);\n            var args = {\n                selectedRow: _this.rows, dragelement: target,\n                cloneElement: visualElement, cancel: false, data: _this.rowData\n            };\n            var selectedRows = gObj.getSelectedRows();\n            gObj.trigger(events.rowDragStartHelper, args);\n            var cancel = 'cancel';\n            var cloneElement = 'cloneElement';\n            if (args[cancel]) {\n                return false;\n            }\n            removeElement(_this.startedRow, '.e-indentcell');\n            removeElement(_this.startedRow, '.e-detailrowcollapse');\n            removeElement(_this.startedRow, '.e-detailrowexpand');\n            _this.removeCell(_this.startedRow, 'e-gridchkbox');\n            var exp = new RegExp('e-active', 'g'); //high contrast issue\n            _this.startedRow.innerHTML = _this.startedRow.innerHTML.replace(exp, '');\n            tbody.appendChild(_this.startedRow);\n            if (gObj.getSelectedRowIndexes().length > 1 && _this.startedRow.hasAttribute('aria-selected')) {\n                var dropCountEle = _this.parent.createElement('span', {\n                    className: 'e-dropitemscount', innerHTML: frzCols ? '' + selectedRows.length / 2 : '' + selectedRows.length,\n                });\n                visualElement.appendChild(dropCountEle);\n            }\n            var ele = closestElement(target, 'tr').querySelector('.e-icon-rowdragicon');\n            if (ele) {\n                ele.classList.add('e-dragstartrow');\n            }\n            table.appendChild(tbody);\n            visualElement.appendChild(table);\n            gObj.element.appendChild(visualElement);\n            return visualElement;\n        };\n        this.dragStart = function (e) {\n            var gObj = _this.parent;\n            if (document.getElementsByClassName('e-griddragarea').length) {\n                return;\n            }\n            var target = e.target;\n            var spanCssEle = _this.parent.element.querySelector('.e-dropitemscount');\n            if (_this.parent.getSelectedRecords().length > 1 && spanCssEle) {\n                spanCssEle.style.left = _this.parent.element.querySelector('.e-cloneproperties table')\n                    .offsetWidth - 5 + 'px';\n            }\n            _this.processArgs(target);\n            gObj.trigger(events.rowDragStart, {\n                rows: (isBlazor()) ? null : _this.rows, target: (isBlazor()) ? null : e.target,\n                draggableType: 'rows', fromIndex: parseInt(_this.rows[0].getAttribute('aria-rowindex'), 10),\n                data: (Object.keys(_this.rowData[0]).length > 0) ? _this.rowData : _this.currentViewData()\n            });\n            if (isBlazor()) {\n                e.bindEvents(e.dragElement);\n            }\n            _this.dragStartData = _this.rowData;\n            var dropElem = document.getElementById(gObj.rowDropSettings.targetID);\n            if (gObj.rowDropSettings.targetID && dropElem && dropElem.ej2_instances &&\n                dropElem.ej2_instances[0].getModuleName() === 'grid') {\n                dropElem.ej2_instances[0].getContent().classList.add('e-allowRowDrop');\n            }\n        };\n        this.drag = function (e) {\n            var gObj = _this.parent;\n            var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n            var target = _this.getElementFromPosition(cloneElement, e.event);\n            classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur', 'e-movecur']);\n            _this.isOverflowBorder = true;\n            _this.hoverState = gObj.enableHover;\n            var trElement = parentsUntil(target, 'e-grid') ? closestElement(e.target, 'tr') : null;\n            gObj.enableHover = false;\n            if (!e.target) {\n                return;\n            }\n            _this.processArgs(target);\n            var args = {\n                rows: _this.rows, target: target, draggableType: 'rows',\n                data: _this.rowData, originalEvent: e, cancel: false\n            };\n            gObj.trigger(events.rowDrag, args);\n            _this.stopTimer();\n            if (args.cancel) {\n                return;\n            }\n            gObj.element.classList.add('e-rowdrag');\n            _this.dragTarget = trElement && parentsUntil(target, 'e-grid').id === cloneElement.parentElement.id ?\n                parseInt(trElement.getAttribute('aria-rowindex'), 10) : parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10);\n            if (gObj.rowDropSettings.targetID) {\n                if (!parentsUntil(target, 'e-grid') ||\n                    parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(target, 'e-grid').id) {\n                    classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);\n                }\n                else {\n                    classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur']);\n                }\n            }\n            else {\n                var elem = parentsUntil(target, 'e-grid');\n                if (elem && elem.id === cloneElement.parentElement.id) {\n                    classList(cloneElement, ['e-movecur'], ['e-defaultcur']);\n                }\n                else {\n                    classList(cloneElement, ['e-notallowedcur'], ['e-movecur']);\n                }\n            }\n            if (!gObj.rowDropSettings.targetID &&\n                (!gObj.groupSettings.columns.length || e.target.classList.contains('e-selectionbackground'))) {\n                if (parentsUntil(target, 'e-grid')) {\n                    _this.updateScrollPostion(e.event, target);\n                }\n                if ((_this.isOverflowBorder || _this.parent.frozenRows > _this.dragTarget) &&\n                    parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10) !== _this.dragTarget) {\n                    _this.moveDragRows(e, _this.startedRow, trElement);\n                }\n                else {\n                    if (trElement && _this.parent.getRowByIndex(_this.parent.getCurrentViewRecords().length - 1).getAttribute('data-uid') ===\n                        trElement.getAttribute('data-uid')) {\n                        var bottomborder = _this.parent.createElement('div', { className: 'e-lastrow-dragborder' });\n                        var gridcontentEle = _this.parent.getContent();\n                        bottomborder.style.width = _this.parent.element.offsetWidth - _this.getScrollWidth() + 'px';\n                        if (!gridcontentEle.querySelectorAll('.e-lastrow-dragborder').length) {\n                            gridcontentEle.classList.add('e-grid-relative');\n                            gridcontentEle.appendChild(bottomborder);\n                            bottomborder.style.bottom = _this.getScrollWidth() + 'px';\n                        }\n                    }\n                    _this.removeBorder(trElement);\n                }\n            }\n        };\n        this.dragStop = function (e) {\n            if (isActionPrevent(_this.parent)) {\n                _this.parent.notify(events.preventBatch, {\n                    instance: _this, handler: _this.processDragStop, arg1: e\n                });\n            }\n            else {\n                _this.processDragStop(e);\n            }\n        };\n        this.processDragStop = function (e) {\n            var gObj = _this.parent;\n            if (_this.parent.isDestroyed) {\n                return;\n            }\n            var targetEle = _this.getElementFromPosition(e.helper, e.event);\n            var target = targetEle && !targetEle.classList.contains('e-dlg-overlay') ?\n                targetEle : e.target;\n            var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n            gObj.element.classList.remove('e-rowdrag');\n            var dropElement = document.getElementById(gObj.rowDropSettings.targetID);\n            if (gObj.rowDropSettings.targetID && dropElement && dropElement.ej2_instances &&\n                dropElement.ej2_instances[0].getModuleName() === 'grid') {\n                dropElement.ej2_instances[0].getContent().classList.remove('e-allowRowDrop');\n            }\n            if (gObj.isRowDragable()) {\n                _this.stopTimer();\n                gObj.enableHover = _this.hoverState;\n                _this.parent.getContent().classList.remove('e-grid-relative');\n                _this.removeBorder(targetEle);\n                var stRow = gObj.element.querySelector('.e-dragstartrow');\n                if (stRow) {\n                    stRow.classList.remove('e-dragstartrow');\n                }\n            }\n            _this.processArgs(target);\n            var args = {\n                target: (isBlazor()) ? null : target, draggableType: 'rows',\n                cancel: false,\n                fromIndex: parseInt(_this.rows[0].getAttribute('aria-rowindex'), 10),\n                dropIndex: _this.dragTarget, rows: (isBlazor()) ? null : _this.rows,\n                data: (Object.keys(_this.dragStartData[0]).length > 0) ? _this.dragStartData : _this.currentViewData()\n            };\n            gObj.trigger(events.rowDrop, args, function () {\n                if (!(parentsUntil(target, 'e-row') || parentsUntil(target, 'e-emptyrow')) || args.cancel) {\n                    _this.dragTarget = null;\n                    remove(e.helper);\n                    return;\n                }\n                _this.isRefresh = false;\n                var selectedIndexes = _this.parent.getSelectedRowIndexes();\n                if (gObj.isRowDragable()) {\n                    if (!isBlazor()) {\n                        if (!_this.parent.rowDropSettings.targetID &&\n                            _this.startedRow.querySelector('td.e-selectionbackground') && selectedIndexes.length > 1 &&\n                            selectedIndexes.length !== _this.parent.getCurrentViewRecords().length) {\n                            _this.reorderRows(selectedIndexes, args.dropIndex);\n                        }\n                        else {\n                            _this.reorderRows([parseInt(_this.startedRow.getAttribute('aria-rowindex'), 10)], _this.dragTarget);\n                        }\n                    }\n                    else {\n                        var draggedData = _this.parent.getSelectedRecords().length ?\n                            _this.parent.getSelectedRecords() : _this.currentViewData();\n                        var changeRecords = {\n                            addedRecords: [],\n                            deletedRecords: draggedData,\n                            changedRecords: []\n                        };\n                        var toIdx = _this.dragTarget ? _this.dragTarget : args.dropIndex;\n                        var dragDropDestinationIndex = 'dragDropDestinationIndex';\n                        var query = new Query;\n                        query[dragDropDestinationIndex] = toIdx;\n                        _this.saveChange(changeRecords, query);\n                        changeRecords.deletedRecords = [];\n                        changeRecords.addedRecords = draggedData;\n                        _this.saveChange(changeRecords, query);\n                    }\n                    _this.dragTarget = null;\n                    if (!gObj.rowDropSettings.targetID) {\n                        remove(e.helper);\n                        gObj.refresh();\n                    }\n                }\n                _this.isRefresh = true;\n            });\n        };\n        this.removeCell = function (targetRow, className) {\n            return [].slice.call(targetRow.querySelectorAll('td')).filter(function (cell) {\n                if (cell.classList.contains(className)) {\n                    targetRow.deleteCell(cell.cellIndex);\n                }\n            });\n        };\n        this.parent = parent;\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.initialEnd, this.initializeDrag, this);\n        this.parent.on(events.columnDrop, this.columnDrop, this);\n        this.onDataBoundFn = this.onDataBound.bind(this);\n        this.parent.addEventListener(events.dataBound, this.onDataBoundFn);\n        this.parent.on(events.uiUpdate, this.enableAfterRender, this);\n    }\n    RowDD.prototype.currentViewData = function () {\n        var selectedIndexes = this.parent.getSelectedRowIndexes();\n        var currentVdata = [];\n        var fromIdx = parseInt(this.startedRow.getAttribute('aria-rowindex'), 10);\n        for (var i = 0, n = selectedIndexes.length; i < n; i++) {\n            var currentV = 'currentViewData';\n            currentVdata[i] = this.parent[currentV][selectedIndexes[i]];\n        }\n        if (!this.parent.rowDropSettings.targetID && selectedIndexes.length === 0) {\n            currentVdata[0] = this.parent.currentViewData[fromIdx];\n        }\n        return currentVdata;\n    };\n    RowDD.prototype.saveChange = function (changeRecords, query) {\n        var _this = this;\n        this.parent.getDataModule().saveChanges(changeRecords, this.parent.getPrimaryKeyFieldNames()[0], {}, query)\n            .then(function () {\n            _this.parent.notify(events.modelChanged, {\n                type: events.actionBegin, requestType: 'rowdraganddrop'\n            });\n        }).catch(function (e) {\n            var error = 'error';\n            var message = 'message';\n            if (!isNullOrUndefined(e[error]) && !isNullOrUndefined(e[error][message])) {\n                e[error] = e[error][message];\n            }\n            _this.parent.trigger(events.actionFailure, e);\n        });\n    };\n    RowDD.prototype.reorderRows = function (fromIndexes, toIndex) {\n        var selectedIndexes = this.parent.getSelectedRowIndexes();\n        var selectedRecords = [];\n        var draggedRecords = [];\n        var currentViewData = this.parent.renderModule.data.dataManager.dataSource.json;\n        var dropIdx = toIndex;\n        var actualIdx = fromIndexes[0];\n        for (var i = 0, len = fromIndexes.length; i < len; i++) {\n            draggedRecords[i] = currentViewData[fromIndexes[i]];\n        }\n        for (var i = 0, len = selectedIndexes.length; i < len; i++) {\n            selectedRecords[i] = currentViewData[selectedIndexes[i]];\n        }\n        for (var i = 0, len = draggedRecords.length; i < len; i++) {\n            if (i !== 0) {\n                for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n                    if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) ===\n                        JSON.stringify(draggedRecords[i])) {\n                        actualIdx = j;\n                        break;\n                    }\n                }\n                for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n                    if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(draggedRecords[i - 1])) {\n                        if (actualIdx > j) {\n                            dropIdx = j + 1;\n                        }\n                        break;\n                    }\n                }\n            }\n            this.reorderRow(actualIdx, dropIdx);\n        }\n        if (this.isRefresh) {\n            this.parent.notify(events.modelChanged, {\n                type: events.actionBegin, requestType: 'rowdraganddrop'\n            });\n        }\n        for (var i = 0, len = selectedRecords.length; i < len; i++) {\n            for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n                if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(selectedRecords[i])) {\n                    selectedIndexes[i] = j;\n                    break;\n                }\n            }\n        }\n        this.selectedRowColls = selectedIndexes;\n    };\n    RowDD.prototype.stopTimer = function () {\n        window.clearInterval(this.timer);\n    };\n    RowDD.prototype.initializeDrag = function () {\n        var gObj = this.parent;\n        this.draggable = new Draggable(gObj.element, {\n            dragTarget: '.e-rowcelldrag, .e-rowdragdrop, .e-rowcell',\n            distance: 5,\n            helper: this.helper,\n            dragStart: this.dragStart,\n            drag: this.drag,\n            dragStop: this.dragStop,\n            isReplaceDragEle: this.isReplaceDragEle,\n        });\n    };\n    RowDD.prototype.updateScrollPostion = function (e, target) {\n        var _this = this;\n        var frzCols = this.parent.getFrozenColumns();\n        var y = getPosition(e).y;\n        var cliRect = this.parent.getContent().getBoundingClientRect();\n        var rowHeight = this.parent.getRowHeight() - 15;\n        var scrollElem = frzCols ? this.parent.getContent().querySelector('.e-movablecontent')\n            : this.parent.getContent().firstElementChild;\n        if (cliRect.top + rowHeight >= y) {\n            var scrollPixel_1 = -(this.parent.getRowHeight());\n            this.isOverflowBorder = false;\n            this.timer = window.setInterval(function () { _this.setScrollDown(scrollElem, scrollPixel_1, true); }, 200);\n        }\n        else if (cliRect.top + this.parent.getContent().clientHeight - rowHeight - 33 <= y) {\n            var scrollPixel_2 = (this.parent.getRowHeight());\n            this.isOverflowBorder = false;\n            this.timer = window.setInterval(function () { _this.setScrollDown(scrollElem, scrollPixel_2, true); }, 200);\n        }\n    };\n    RowDD.prototype.setScrollDown = function (scrollElem, scrollPixel, isLeft) {\n        scrollElem.scrollTop = scrollElem.scrollTop + scrollPixel;\n    };\n    RowDD.prototype.moveDragRows = function (e, startedRow, targetRow) {\n        var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n        var element = closestElement(e.target, 'tr');\n        if (parentsUntil(element, 'e-grid') &&\n            parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(element, 'e-grid').id) {\n            var targetElement = element ?\n                element : this.startedRow;\n            this.setBorder(targetElement, e.event, startedRow, targetRow);\n        }\n    };\n    RowDD.prototype.setBorder = function (element, event, startedRow, targetRow) {\n        var node = this.parent.element;\n        var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n        this.removeFirstRowBorder(element);\n        this.removeLastRowBorder(element);\n        if (parentsUntil(element, 'e-grid') &&\n            parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(element, 'e-grid').id) {\n            removeClass(node.querySelectorAll('.e-rowcell,.e-rowdragdrop'), ['e-dragborder']);\n            var rowElement = [];\n            var targetRowIndex = parseInt(targetRow.getAttribute('aria-rowindex'), 10);\n            if (targetRow && targetRowIndex === 0) {\n                var div = this.parent.createElement('div', { className: 'e-firstrow-dragborder' });\n                var gridheaderEle = this.parent.getHeaderContent();\n                gridheaderEle.classList.add('e-grid-relative');\n                div.style.width = node.offsetWidth - this.getScrollWidth() + 'px';\n                if (!gridheaderEle.querySelectorAll('.e-firstrow-dragborder').length) {\n                    gridheaderEle.appendChild(div);\n                }\n            }\n            else if (targetRow && parseInt(startedRow.getAttribute('aria-rowindex'), 10) > targetRowIndex) {\n                element = this.parent.getRowByIndex(targetRowIndex - 1);\n                rowElement = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n            }\n            else {\n                rowElement = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n            }\n            var frzCols = this.parent.getFrozenColumns();\n            if (targetRow && targetRowIndex !== 0 && frzCols) {\n                var rowIndex = parseInt(element.getAttribute('aria-rowindex'), 10);\n                var selector = '.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse';\n                rowElement = [].slice.call(this.parent.getRows()[rowIndex].querySelectorAll(selector)).\n                    concat([].slice.call(this.parent.getMovableRows()[rowIndex].querySelectorAll(selector)));\n            }\n            if (rowElement.length > 0) {\n                addRemoveActiveClasses(rowElement, true, 'e-dragborder');\n            }\n        }\n    };\n    RowDD.prototype.getScrollWidth = function () {\n        var scrollElem = this.parent.getContent().firstElementChild;\n        return scrollElem.scrollWidth > scrollElem.offsetWidth ? Scroll.getScrollBarWidth() : 0;\n    };\n    RowDD.prototype.removeFirstRowBorder = function (element) {\n        if (this.parent.element.getElementsByClassName('e-firstrow-dragborder').length > 0 && element &&\n            element.rowIndex !== 0) {\n            this.parent.element.getElementsByClassName('e-firstrow-dragborder')[0].remove();\n        }\n    };\n    RowDD.prototype.removeLastRowBorder = function (element) {\n        var islastRowIndex = element &&\n            this.parent.getRowByIndex(this.parent.getCurrentViewRecords().length - 1).getAttribute('data-uid') !==\n                element.getAttribute('data-uid');\n        if (this.parent.element.getElementsByClassName('e-lastrow-dragborder').length > 0 && element && islastRowIndex) {\n            this.parent.element.getElementsByClassName('e-lastrow-dragborder')[0].remove();\n        }\n    };\n    RowDD.prototype.removeBorder = function (element) {\n        this.removeFirstRowBorder(element);\n        this.removeLastRowBorder(element);\n        element = this.parent.getRows().filter(function (row) {\n            return row.querySelector('td.e-dragborder');\n        })[0];\n        if (element) {\n            var rowElement = [].slice.call(element.querySelectorAll('.e-dragborder'));\n            if (this.parent.getFrozenColumns()) {\n                var rowIndex = parseInt(element.getAttribute('aria-rowindex'), 10);\n                rowElement = [].slice.call(this.parent.getRows()[rowIndex].querySelectorAll('.e-dragborder')).\n                    concat([].slice.call(this.parent.getMovableRows()[rowIndex].querySelectorAll('.e-dragborder')));\n            }\n            addRemoveActiveClasses(rowElement, false, 'e-dragborder');\n        }\n    };\n    RowDD.prototype.getElementFromPosition = function (element, event) {\n        var target;\n        var position = getPosition(event);\n        element.style.display = 'none';\n        target = document.elementFromPoint(position.x, position.y);\n        element.style.display = '';\n        return target;\n    };\n    RowDD.prototype.onDataBound = function (e) {\n        if (this.selectedRowColls.length > 0) {\n            this.parent.selectRows(this.selectedRowColls);\n            this.selectedRowColls = [];\n        }\n    };\n    RowDD.prototype.getTargetIdx = function (targetRow) {\n        return targetRow ? parseInt(targetRow.getAttribute('aria-rowindex'), 10) : 0;\n    };\n    RowDD.prototype.singleRowDrop = function (e) {\n        var targetRow = closestElement(e.target, 'tr');\n        var currentIndex;\n        var srcControl;\n        srcControl = e.droppedElement.parentElement.ej2_instances[0];\n        currentIndex = targetRow ? targetRow.rowIndex : srcControl.currentViewData.length - 1;\n        this.reorderRow(this.startedRowIndex, currentIndex);\n    };\n    RowDD.prototype.columnDrop = function (e) {\n        var gObj = this.parent;\n        var draggObj = e.droppedElement.parentElement.ej2_instances[0];\n        if (e.droppedElement.getAttribute('action') !== 'grouping' &&\n            (parentsUntil(e.target, 'e-row') || parentsUntil(e.target, 'e-emptyrow'))) {\n            var targetRow = closestElement(e.target, 'tr');\n            var srcControl_1;\n            var currentIndex = void 0;\n            if ((e.droppedElement.querySelector('tr').getAttribute('single-dragrow') !== 'true' &&\n                e.droppedElement.parentElement.id === gObj.element.id)\n                || (e.droppedElement.querySelector('tr').getAttribute('single-dragrow') === 'true' &&\n                    e.droppedElement.parentElement.id !== gObj.element.id)) {\n                return;\n            }\n            if (e.droppedElement.parentElement.id !== gObj.element.id) {\n                srcControl_1 = e.droppedElement.parentElement.ej2_instances[0];\n            }\n            else if (this.isSingleRowDragDrop || e.droppedElement.querySelector('tr').getAttribute('single-dragrow') === 'true') {\n                this.singleRowDrop(e);\n                return;\n            }\n            if (srcControl_1.element.id !== gObj.element.id && srcControl_1.rowDropSettings.targetID !== gObj.element.id) {\n                return;\n            }\n            var records = srcControl_1.getSelectedRecords();\n            var targetIndex = currentIndex = this.getTargetIdx(targetRow);\n            var count = 0;\n            if (isNaN(targetIndex)) {\n                targetIndex = currentIndex = 0;\n            }\n            if (gObj.allowPaging) {\n                targetIndex = targetIndex + (gObj.pageSettings.currentPage * gObj.pageSettings.pageSize) - gObj.pageSettings.pageSize;\n            }\n            //Todo: drag and drop mapper & BatchChanges\n            if (!isBlazor()) {\n                gObj.notify(events.rowsAdded, { toIndex: targetIndex, records: records });\n                gObj.notify(events.modelChanged, {\n                    type: events.actionBegin, requestType: 'rowdraganddrop'\n                });\n                var selectedRows = srcControl_1.getSelectedRowIndexes();\n                var skip = srcControl_1.allowPaging ?\n                    (srcControl_1.pageSettings.currentPage * srcControl_1.pageSettings.pageSize) - srcControl_1.pageSettings.pageSize : 0;\n                this.selectedRows = [];\n                for (var i = 0, len = records.length; i < len; i++) {\n                    this.selectedRows.push(skip + selectedRows[i]);\n                }\n                srcControl_1.notify(events.rowsRemoved, { indexes: this.selectedRows, records: records });\n                srcControl_1.notify(events.modelChanged, {\n                    type: events.actionBegin, requestType: 'rowdraganddrop'\n                });\n            }\n            else {\n                var currentVdata = [];\n                var selectedIndex = srcControl_1.getSelectedRowIndexes();\n                for (var i = 0; i < selectedIndex.length; i++) {\n                    currentVdata[i] = srcControl_1.currentViewData[selectedIndex[i]];\n                }\n                records = currentVdata;\n                var changes = {\n                    addedRecords: records,\n                    deletedRecords: [],\n                    changedRecords: []\n                };\n                var dragDropDestinationIndex = 'dragDropDestinationIndex';\n                var query = new Query;\n                query[dragDropDestinationIndex] = targetIndex;\n                gObj.getDataModule().saveChanges(changes, gObj.getPrimaryKeyFieldNames()[0], {}, query)\n                    .then(function () {\n                    gObj.notify(events.modelChanged, {\n                        type: events.actionBegin, requestType: 'rowdraganddrop'\n                    });\n                }).catch(function (e) {\n                    var message = 'message';\n                    var error = 'error';\n                    if (!isNullOrUndefined(e[error]) && !isNullOrUndefined(e[error][message])) {\n                        e[error] = e[error][message];\n                    }\n                    gObj.trigger(events.actionFailure, e);\n                });\n                changes.deletedRecords = records;\n                changes.addedRecords = [];\n                srcControl_1.getDataModule().saveChanges(changes, srcControl_1.getPrimaryKeyFieldNames()[0], {}, query)\n                    .then(function () {\n                    srcControl_1.notify(events.modelChanged, {\n                        type: events.actionBegin, requestType: 'rowdraganddrop'\n                    });\n                }).catch(function (e) {\n                    var error = 'error';\n                    var msg = 'message';\n                    if (!isNullOrUndefined(e[error]) && !isNullOrUndefined(e[error][msg])) {\n                        e[error] = e[error][msg];\n                    }\n                    srcControl_1.trigger(events.actionFailure, e);\n                });\n            }\n        }\n    };\n    RowDD.prototype.reorderRow = function (fromIndexes, toIndex) {\n        var gObj = this.parent;\n        if (!gObj.sortSettings.columns.length && !gObj.groupSettings.columns.length && !gObj.filterSettings.columns.length) {\n            //Todo: drag and drop mapper & BatchChanges                 \n            var skip = gObj.allowPaging ?\n                (gObj.pageSettings.currentPage * gObj.pageSettings.pageSize) - gObj.pageSettings.pageSize : 0;\n            var fromIndex = fromIndexes;\n            toIndex = toIndex + skip;\n            this.selectedRows = gObj.getSelectedRowIndexes();\n            gObj.notify(events.rowPositionChanged, {\n                fromIndex: fromIndexes + skip,\n                toIndex: toIndex\n            });\n        }\n    };\n    RowDD.prototype.enableAfterRender = function (e) {\n        if (e.module === this.getModuleName() && e.enable) {\n            this.initializeDrag();\n        }\n    };\n    /**\n     * To destroy the print\n     * @return {void}\n     * @hidden\n     */\n    RowDD.prototype.destroy = function () {\n        var gridElement = this.parent.element;\n        if (this.parent.isDestroyed || !gridElement || (!gridElement.querySelector('.e-gridheader') &&\n            !gridElement.querySelector('.e-gridcontent'))) {\n            return;\n        }\n        this.draggable.destroy();\n        this.parent.off(events.initialEnd, this.initializeDrag);\n        this.parent.off(events.columnDrop, this.columnDrop);\n        this.parent.removeEventListener(events.dataBound, this.onDataBoundFn);\n        this.parent.off(events.uiUpdate, this.enableAfterRender);\n        //destory ejdrag and drop\n    };\n    /**\n     * For internal use only - Get the module name.\n     * @private\n     */\n    RowDD.prototype.getModuleName = function () {\n        return 'rowDragAndDrop';\n    };\n    RowDD.prototype.processArgs = function (target) {\n        var gObj = this.parent;\n        if ((gObj.getSelectedRecords().length > 0 && this.startedRow.cells[0].classList.contains('e-selectionbackground') === false)\n            || gObj.getSelectedRecords().length === 0) {\n            this.rows = [this.startedRow];\n            this.rowData = [this.parent.getRowInfo((this.startedRow).querySelector('.e-rowcell')).rowData];\n        }\n        else {\n            this.rows = gObj.getSelectedRows();\n            this.rowData = gObj.getSelectedRecords();\n        }\n    };\n    return RowDD;\n}());\nexport { RowDD };\n"]},"metadata":{},"sourceType":"module"}