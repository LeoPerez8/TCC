{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport { Browser, EventHandler, createElement, isBlazor } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, isUndefined, addClass, removeClass } from '@syncfusion/ej2-base';\nimport { remove, closest } from '@syncfusion/ej2-base';\nimport { Query } from '@syncfusion/ej2-data';\nimport { setCssInGridPopUp, getPosition, isGroupAdaptive, parentsUntil, addRemoveActiveClasses, removeAddCboxClasses } from '../base/util';\nimport * as events from '../base/constant';\nimport { RenderType } from '../base/enum';\nimport { iterateExtend, setChecked } from '../base/util';\n/**\n * The `Selection` module is used to handle cell and row selection.\n */\n\nvar Selection =\n/** @class */\nfunction () {\n  /**\n   * Constructor for the Grid selection module\n   * @hidden\n   */\n  function Selection(parent, selectionSettings, locator) {\n    //Internal letiables       \n\n    /**\n     * @hidden\n     */\n    this.selectedRowIndexes = [];\n    /**\n     * @hidden\n     */\n\n    this.selectedRowCellIndexes = [];\n    /**\n     * @hidden\n     */\n\n    this.selectedRecords = [];\n    /**\n     * @hidden\n     */\n\n    this.preventFocus = false;\n    this.checkBoxState = false;\n    this.isMultiShiftRequest = false;\n    this.isMultiCtrlRequest = false;\n    this.enableSelectMultiTouch = false;\n    this.clearRowCheck = false;\n    this.selectRowCheck = false;\n    this.selectedRowState = {};\n    this.totalRecordsCount = 0;\n    this.chkAllCollec = [];\n    this.isCheckedOnAdd = false;\n    this.persistSelectedData = [];\n    this.isCancelDeSelect = false;\n    this.isPreventCellSelect = false;\n    this.disableUI = false;\n    this.isPersisted = false;\n    this.cmdKeyPressed = false;\n    this.cellselected = false;\n    this.isMultiSelection = false;\n    this.isAddRowsToSelection = false;\n    this.initialRowSelection = false;\n    /**\n     * @hidden\n     */\n\n    this.autoFillRLselection = true;\n    this.parent = parent;\n    this.selectionSettings = selectionSettings;\n    this.factory = locator.getService('rendererFactory');\n    this.focus = locator.getService('focus');\n    this.addEventListener();\n    this.wireEvents();\n  }\n\n  Selection.prototype.initializeSelection = function () {\n    this.parent.log('selection_key_missing');\n    this.render();\n  };\n  /**\n   * The function used to trigger onActionBegin\n   * @return {void}\n   * @hidden\n   */\n\n\n  Selection.prototype.onActionBegin = function (args, type) {\n    this.parent.trigger(type, this.fDataUpdate(args));\n  };\n\n  Selection.prototype.fDataUpdate = function (args) {\n    if (!this.isMultiSelection && (!isNullOrUndefined(args.cellIndex) || !isNullOrUndefined(args.rowIndex))) {\n      var rowObj = this.getRowObj(isNullOrUndefined(args.rowIndex) ? isNullOrUndefined(args.cellIndex) ? this.currentIndex : args.cellIndex.rowIndex : args.rowIndex);\n      args.foreignKeyData = rowObj.foreignKeyData;\n    }\n\n    return args;\n  };\n  /**\n   * The function used to trigger onActionComplete\n   * @return {void}\n   * @hidden\n   */\n\n\n  Selection.prototype.onActionComplete = function (args, type) {\n    this.parent.trigger(type, this.fDataUpdate(args));\n    this.isMultiSelection = false;\n  };\n  /**\n   * For internal use only - Get the module name.\n   * @private\n   */\n\n\n  Selection.prototype.getModuleName = function () {\n    return 'selection';\n  };\n  /**\n   * To destroy the selection\n   * @return {void}\n   * @hidden\n   */\n\n\n  Selection.prototype.destroy = function () {\n    var gridElement = this.parent.element;\n\n    if (!gridElement || !gridElement.querySelector('.e-gridheader') && !gridElement.querySelector('.e-gridcontent')) {\n      return;\n    }\n\n    this.hidePopUp();\n    this.clearSelection();\n    this.removeEventListener();\n    this.unWireEvents();\n    EventHandler.remove(this.parent.getContent(), 'mousedown', this.mouseDownHandler);\n    EventHandler.remove(this.parent.getHeaderContent(), 'mousedown', this.mouseDownHandler);\n  };\n\n  Selection.prototype.isEditing = function () {\n    return (this.parent.editSettings.mode === 'Normal' || this.parent.editSettings.mode === 'Batch' && this.parent.editModule && this.parent.editModule.formObj && !this.parent.editModule.formObj.validate()) && this.parent.isEdit && !this.parent.isPersistSelection;\n  };\n\n  Selection.prototype.getSelectedMovableRow = function (index) {\n    var gObj = this.parent;\n\n    if (gObj.getFrozenColumns() && this.parent.getContent().querySelector('.e-movablecontent')) {\n      return gObj.getMovableRowByIndex(index);\n    }\n\n    return null;\n  };\n\n  Selection.prototype.getCurrentBatchRecordChanges = function () {\n    var gObj = this.parent;\n    var added = 'addedRecords';\n    var deleted = 'deletedRecords';\n\n    if (gObj.editSettings.mode === 'Batch' && gObj.editModule) {\n      var currentRecords = iterateExtend(this.parent.getCurrentViewRecords());\n      currentRecords = gObj.editSettings.newRowPosition === 'Bottom' ? currentRecords.concat(this.parent.editModule.getBatchChanges()[added]) : this.parent.editModule.getBatchChanges()[added].concat(currentRecords);\n      var deletedRecords = this.parent.editModule.getBatchChanges()[deleted];\n      var primaryKey = this.parent.getPrimaryKeyFieldNames()[0];\n\n      for (var i = 0; i < deletedRecords.length; i++) {\n        for (var j = 0; j < currentRecords.length; j++) {\n          if (deletedRecords[i][primaryKey] === currentRecords[j][primaryKey]) {\n            currentRecords.splice(j, 1);\n            break;\n          }\n        }\n      }\n\n      return currentRecords;\n    } else {\n      return gObj.getCurrentViewRecords();\n    }\n  };\n  /**\n   * Selects a row by the given index.\n   * @param  {number} index - Defines the row index.\n   * @param  {boolean} isToggle - If set to true, then it toggles the selection.\n   * @return {void}\n   */\n\n\n  Selection.prototype.selectRow = function (index, isToggle) {\n    if (this.selectedRowIndexes.length && this.selectionSettings.enableSimpleMultiRowSelection) {\n      this.addRowsToSelection([index]);\n      return;\n    }\n\n    var gObj = this.parent;\n    var selectedRow = gObj.getRowByIndex(index);\n    var selectedMovableRow = this.getSelectedMovableRow(index);\n    var selectData;\n    var isRemoved = false;\n\n    if (gObj.enableVirtualization && index > -1) {\n      this.parent.notify(events.selectVirtualRow, {\n        selectedIndex: index\n      });\n      var frozenData = gObj.getFrozenColumns() ? gObj.contentModule.getRowObjectByIndex(index) : null;\n\n      if (selectedRow && (gObj.getRowObjectFromUID(selectedRow.getAttribute('data-uid')) || frozenData)) {\n        selectData = frozenData ? frozenData : gObj.getRowObjectFromUID(selectedRow.getAttribute('data-uid')).data;\n      } else {\n        var prevSelectedData = this.parent.getSelectedRecords();\n\n        if (prevSelectedData.length > 0) {\n          this.clearRowSelection();\n        }\n\n        return;\n      }\n    } else {\n      selectData = this.getCurrentBatchRecordChanges()[index];\n    }\n\n    if (!this.isRowType() || !selectedRow || this.isEditing()) {\n      // if (this.isEditing()) {\n      //     gObj.selectedRowIndex = index;\n      // }\n      return;\n    }\n\n    var isRowSelected = selectedRow.hasAttribute('aria-selected');\n    this.activeTarget();\n    isToggle = !isToggle ? isToggle : !this.selectedRowIndexes.length ? false : this.selectedRowIndexes.length === 1 ? index === this.selectedRowIndexes[0] : false;\n    var args;\n    var can = 'cancel';\n\n    if (!isToggle) {\n      var isHybrid = 'isHybrid';\n\n      if (!isBlazor() || this.parent.isJsComponent || this.parent[isHybrid]) {\n        args = {\n          data: selectData,\n          rowIndex: index,\n          isCtrlPressed: this.isMultiCtrlRequest,\n          isShiftPressed: this.isMultiShiftRequest,\n          row: selectedRow,\n          previousRow: gObj.getRowByIndex(this.prevRowIndex),\n          previousRowIndex: this.prevRowIndex,\n          target: this.actualTarget,\n          cancel: false,\n          isInteracted: this.isInteracted,\n          isHeaderCheckboxClicked: this.isHeaderCheckboxClicked\n        };\n        args = this.addMovableArgs(args, selectedMovableRow);\n      } else {\n        args = {\n          data: selectData,\n          rowIndex: index,\n          isCtrlPressed: this.isMultiCtrlRequest,\n          isShiftPressed: this.isMultiShiftRequest,\n          previousRowIndex: this.prevRowIndex,\n          cancel: false,\n          isInteracted: this.isInteracted,\n          isHeaderCheckboxClicked: this.isHeaderCheckboxClicked\n        };\n      }\n\n      this.parent.trigger(events.rowSelecting, this.fDataUpdate(args), this.rowSelectingCallBack(args, isToggle, index, selectData, isRemoved, isRowSelected, can));\n    } else {\n      this.rowSelectingCallBack(args, isToggle, index, selectData, isRemoved, isRowSelected, can)(args);\n    }\n  };\n\n  Selection.prototype.rowSelectingCallBack = function (args, isToggle, index, selectData, isRemoved, isRowSelected, can) {\n    var _this = this;\n\n    return function (args) {\n      if (!isNullOrUndefined(args) && args[can] === true) {\n        _this.disableInteracted();\n\n        return;\n      }\n\n      _this.index = index;\n      _this.toggle = isToggle;\n      _this.data = selectData;\n      _this.removed = isRemoved;\n\n      if (isRowSelected && _this.selectionSettings.persistSelection && !(_this.selectionSettings.checkboxMode === 'ResetOnRowClick')) {\n        _this.clearSelectedRow(index);\n\n        isRemoved = true;\n        _this.removed = isRemoved;\n\n        _this.selectRowCallBack();\n      } else if (!isRowSelected && _this.selectionSettings.persistSelection && _this.selectionSettings.checkboxMode !== 'ResetOnRowClick') {\n        _this.selectRowCallBack();\n      }\n\n      if (_this.selectionSettings.checkboxMode === 'ResetOnRowClick') {\n        _this.clearSelection();\n      }\n\n      if (!_this.selectionSettings.persistSelection || _this.selectionSettings.checkboxMode === 'ResetOnRowClick') {\n        _this.selectRowCheck = true;\n\n        _this.clearRow();\n      }\n    };\n  };\n\n  Selection.prototype.selectRowCallBack = function () {\n    var gObj = this.parent;\n    var args;\n    var index = this.index;\n    var isToggle = this.toggle;\n    var selectData = this.data;\n    var isRemoved = this.removed;\n    var selectedRow = gObj.getRowByIndex(index);\n    var selectedMovableRow = this.getSelectedMovableRow(index);\n\n    if (!isToggle && !isRemoved) {\n      if (this.selectedRowIndexes.indexOf(index) <= -1) {\n        this.updateRowSelection(selectedRow, index);\n\n        if (gObj.getFrozenColumns()) {\n          this.updateRowSelection(selectedMovableRow, index);\n        }\n      }\n\n      this.selectRowIndex(index);\n    }\n\n    if (!isToggle) {\n      var isHybrid = 'isHybrid';\n\n      if (!isBlazor() || this.parent.isJsComponent || this.parent[isHybrid]) {\n        args = {\n          data: selectData,\n          rowIndex: index,\n          row: selectedRow,\n          previousRow: gObj.getRowByIndex(this.prevRowIndex),\n          previousRowIndex: this.prevRowIndex,\n          target: this.actualTarget,\n          isInteracted: this.isInteracted,\n          isHeaderCheckBoxClicked: this.isHeaderCheckboxClicked\n        };\n        args = this.addMovableArgs(args, selectedMovableRow);\n      } else {\n        args = {\n          data: selectData,\n          rowIndex: index,\n          row: selectedRow,\n          previousRow: gObj.getRowByIndex(this.prevRowIndex),\n          previousRowIndex: this.prevRowIndex,\n          isInteracted: this.isInteracted,\n          isHeaderCheckBoxClicked: this.isHeaderCheckboxClicked\n        };\n      }\n\n      this.onActionComplete(args, events.rowSelected);\n    }\n\n    if (isBlazor() && this.parent.isServerRendered && this.parent.enableVirtualization) {\n      var interopAdaptor = 'interopAdaptor';\n      var invokeMethodAsync = 'invokeMethodAsync';\n      this.parent[interopAdaptor][invokeMethodAsync]('MaintainSelection', true, 'normal', [index]);\n    }\n\n    this.isInteracted = false;\n    this.updateRowProps(index);\n  };\n\n  Selection.prototype.addMovableArgs = function (targetObj, mRow) {\n    if (this.parent.getFrozenColumns()) {\n      var mObj = {\n        mRow: mRow,\n        previousMovRow: this.parent.getMovableRows()[this.prevRowIndex]\n      };\n      targetObj = __assign({}, targetObj, mObj);\n    }\n\n    return targetObj;\n  };\n  /**\n   * Selects a range of rows from start and end row indexes.\n   * @param  {number} startIndex - Specifies the start row index.\n   * @param  {number} endIndex - Specifies the end row index.\n   * @return {void}\n   */\n\n\n  Selection.prototype.selectRowsByRange = function (startIndex, endIndex) {\n    this.selectRows(this.getCollectionFromIndexes(startIndex, endIndex));\n    this.selectRowIndex(endIndex);\n  };\n  /**\n   * Selects a collection of rows by index.\n   * @param  {number[]} rowIndexes - Specifies an array of row indexes.\n   * @return {void}\n   */\n\n\n  Selection.prototype.selectRows = function (rowIndexes) {\n    var _this = this;\n\n    var gObj = this.parent;\n    var rowIndex = !this.isSingleSel() ? rowIndexes[0] : rowIndexes[rowIndexes.length - 1];\n    this.isMultiSelection = true;\n    var selectedRows = [];\n    var foreignKeyData = [];\n    var selectedMovableRow = this.getSelectedMovableRow(rowIndex);\n    var frzCols = gObj.getFrozenColumns();\n    var can = 'cancel';\n    var selectedData = [];\n\n    if (!this.isRowType() || this.isEditing()) {\n      return;\n    }\n\n    for (var i = 0, len = rowIndexes.length; i < len; i++) {\n      var currentRow = this.parent.getDataRows()[rowIndexes[i]];\n      var rowObj = this.getRowObj(currentRow);\n\n      if (rowObj) {\n        selectedData.push(rowObj.data);\n        selectedRows.push(currentRow);\n        foreignKeyData.push(rowObj.foreignKeyData);\n      }\n    }\n\n    var isHybrid = 'isHybrid';\n    this.activeTarget();\n    var args;\n\n    if (!isBlazor() || this.parent.isJsComponent || this.parent[isHybrid]) {\n      args = {\n        cancel: false,\n        rowIndexes: rowIndexes,\n        row: selectedRows,\n        rowIndex: rowIndex,\n        target: this.actualTarget,\n        prevRow: gObj.getRows()[this.prevRowIndex],\n        previousRowIndex: this.prevRowIndex,\n        isInteracted: this.isInteracted,\n        isCtrlPressed: this.isMultiCtrlRequest,\n        isShiftPressed: this.isMultiShiftRequest,\n        data: selectedData,\n        isHeaderCheckboxClicked: this.isHeaderCheckboxClicked,\n        foreignKeyData: foreignKeyData\n      };\n      args = this.addMovableArgs(args, selectedMovableRow);\n    } else {\n      args = {\n        cancel: false,\n        rowIndexes: rowIndexes,\n        rowIndex: rowIndex,\n        previousRowIndex: this.prevRowIndex,\n        isCtrlPressed: this.isMultiCtrlRequest,\n        isShiftPressed: this.isMultiShiftRequest,\n        data: selectedData,\n        isHeaderCheckboxClicked: this.isHeaderCheckboxClicked,\n        foreignKeyData: foreignKeyData\n      };\n    }\n\n    this.parent.trigger(events.rowSelecting, this.fDataUpdate(args), function (args) {\n      if (!isNullOrUndefined(args) && args[can] === true) {\n        _this.disableInteracted();\n\n        return;\n      }\n\n      _this.clearRow();\n\n      _this.selectRowIndex(rowIndexes.slice(-1)[0]);\n\n      if (!_this.isSingleSel()) {\n        for (var _i = 0, rowIndexes_1 = rowIndexes; _i < rowIndexes_1.length; _i++) {\n          var rowIdx = rowIndexes_1[_i];\n\n          _this.updateRowSelection(gObj.getRowByIndex(rowIdx), rowIdx);\n\n          if (frzCols) {\n            _this.updateRowSelection(gObj.getMovableRowByIndex(rowIdx), rowIdx);\n          }\n\n          _this.updateRowProps(rowIndex);\n        }\n      } else {\n        _this.updateRowSelection(gObj.getRowByIndex(rowIndex), rowIndex);\n\n        if (frzCols) {\n          _this.updateRowSelection(gObj.getMovableRowByIndex(rowIndex), rowIndex);\n        }\n\n        _this.updateRowProps(rowIndex);\n      }\n\n      var isHybrid = 'isHybrid';\n\n      if (!isBlazor() || _this.parent.isJsComponent || _this.parent[isHybrid]) {\n        args = {\n          rowIndexes: rowIndexes,\n          row: selectedRows,\n          rowIndex: rowIndex,\n          target: _this.actualTarget,\n          prevRow: gObj.getRows()[_this.prevRowIndex],\n          previousRowIndex: _this.prevRowIndex,\n          data: isBlazor() ? selectedData : _this.getSelectedRecords(),\n          isInteracted: _this.isInteracted,\n          isHeaderCheckboxClicked: _this.isHeaderCheckboxClicked,\n          foreignKeyData: foreignKeyData\n        };\n        args = _this.addMovableArgs(args, selectedMovableRow);\n      } else {\n        args = {\n          rowIndexes: rowIndexes,\n          rowIndex: rowIndex,\n          previousRowIndex: _this.prevRowIndex,\n          row: selectedRows,\n          prevRow: gObj.getRows()[_this.prevRowIndex],\n          data: isBlazor() ? selectedData : _this.getSelectedRecords(),\n          isInteracted: _this.isInteracted,\n          isHeaderCheckboxClicked: _this.isHeaderCheckboxClicked,\n          foreignKeyData: foreignKeyData\n        };\n      }\n\n      if (_this.isRowSelected) {\n        _this.onActionComplete(args, events.rowSelected);\n      }\n    });\n  };\n  /**\n   * Select rows with existing row selection by passing row indexes.\n   * @param  {number} startIndex - Specifies the row indexes.\n   * @return {void}\n   * @hidden\n   */\n\n\n  Selection.prototype.addRowsToSelection = function (rowIndexes) {\n    var _this = this;\n\n    var gObj = this.parent;\n    var can = 'cancel';\n    var target = this.target;\n    this.isMultiSelection = true;\n    var indexes = gObj.getSelectedRowIndexes().concat(rowIndexes);\n    var selectedRow = !this.isSingleSel() ? gObj.getRowByIndex(rowIndexes[0]) : gObj.getRowByIndex(rowIndexes[rowIndexes.length - 1]);\n    var selectedMovableRow = !this.isSingleSel() ? this.getSelectedMovableRow(rowIndexes[0]) : this.getSelectedMovableRow(rowIndexes[rowIndexes.length - 1]);\n    var frzCols = gObj.getFrozenColumns();\n\n    if (!this.isRowType() || this.isEditing()) {\n      return;\n    }\n\n    var args;\n    var checkboxColumn = this.parent.getColumns().filter(function (col) {\n      return col.type === 'checkbox';\n    });\n\n    var _loop_1 = function (rowIndex) {\n      var rowObj = this_1.getRowObj(rowIndex);\n      var isUnSelected = this_1.selectedRowIndexes.indexOf(rowIndex) > -1;\n      this_1.selectRowIndex(rowIndex);\n\n      if (isUnSelected && ((checkboxColumn.length ? true : this_1.selectionSettings.enableToggle) || this_1.isMultiCtrlRequest)) {\n        this_1.isAddRowsToSelection = true;\n        this_1.rowDeselect(events.rowDeselecting, [rowIndex], [rowObj.data], [selectedRow], [rowObj.foreignKeyData], target);\n\n        if (this_1.isCancelDeSelect) {\n          return {\n            value: void 0\n          };\n        }\n\n        this_1.selectedRowIndexes.splice(this_1.selectedRowIndexes.indexOf(rowIndex), 1);\n        this_1.selectedRecords.splice(this_1.selectedRecords.indexOf(selectedRow), 1);\n        selectedRow.removeAttribute('aria-selected');\n        this_1.addRemoveClassesForRow(selectedRow, false, null, 'e-selectionbackground', 'e-active');\n\n        if (selectedMovableRow) {\n          this_1.selectedRecords.splice(this_1.selectedRecords.indexOf(selectedMovableRow), 1);\n          selectedMovableRow.removeAttribute('aria-selected');\n          this_1.addRemoveClassesForRow(selectedMovableRow, false, null, 'e-selectionbackground', 'e-active');\n        }\n\n        this_1.rowDeselect(events.rowDeselected, [rowIndex], [rowObj.data], [selectedRow], [rowObj.foreignKeyData], target, [selectedMovableRow]);\n        this_1.isInteracted = false;\n        this_1.isMultiSelection = false;\n        this_1.isAddRowsToSelection = false;\n      } else {\n        var isHybrid = 'isHybrid';\n        this_1.activeTarget();\n\n        if (!isBlazor() || this_1.parent.isJsComponent || this_1.parent[isHybrid]) {\n          args = {\n            cancel: false,\n            data: rowObj.data,\n            rowIndex: rowIndex,\n            row: selectedRow,\n            target: this_1.actualTarget,\n            prevRow: gObj.getRows()[this_1.prevRowIndex],\n            previousRowIndex: this_1.prevRowIndex,\n            isCtrlPressed: this_1.isMultiCtrlRequest,\n            isShiftPressed: this_1.isMultiShiftRequest,\n            foreignKeyData: rowObj.foreignKeyData,\n            isInteracted: this_1.isInteracted,\n            isHeaderCheckboxClicked: this_1.isHeaderCheckboxClicked,\n            rowIndexes: indexes\n          };\n          args = this_1.addMovableArgs(args, selectedMovableRow);\n        } else {\n          args = {\n            cancel: false,\n            data: rowObj.data,\n            rowIndex: rowIndex,\n            previousRowIndex: this_1.prevRowIndex,\n            isCtrlPressed: this_1.isMultiCtrlRequest,\n            isShiftPressed: this_1.isMultiShiftRequest,\n            foreignKeyData: rowObj.foreignKeyData,\n            isInteracted: this_1.isInteracted,\n            isHeaderCheckboxClicked: this_1.isHeaderCheckboxClicked,\n            rowIndexes: indexes\n          };\n        }\n\n        this_1.parent.trigger(events.rowSelecting, this_1.fDataUpdate(args), function (args) {\n          if (!isNullOrUndefined(args) && args[can] === true) {\n            _this.disableInteracted();\n\n            return;\n          }\n\n          if (_this.isSingleSel()) {\n            _this.clearRow();\n          }\n\n          _this.updateRowSelection(selectedRow, rowIndex);\n\n          if (frzCols) {\n            _this.updateRowSelection(selectedMovableRow, rowIndex);\n          }\n        });\n      }\n\n      if (!isUnSelected) {\n        var isHybrid = 'isHybrid';\n\n        if (!isBlazor() || this_1.parent.isJsComponent || this_1.parent[isHybrid]) {\n          args = {\n            data: rowObj.data,\n            rowIndex: rowIndex,\n            row: selectedRow,\n            target: this_1.actualTarget,\n            prevRow: gObj.getRows()[this_1.prevRowIndex],\n            previousRowIndex: this_1.prevRowIndex,\n            foreignKeyData: rowObj.foreignKeyData,\n            isInteracted: this_1.isInteracted,\n            isHeaderCheckboxClicked: this_1.isHeaderCheckboxClicked,\n            rowIndexes: indexes\n          };\n          args = this_1.addMovableArgs(args, selectedMovableRow);\n        } else {\n          args = {\n            data: rowObj.data,\n            rowIndex: rowIndex,\n            previousRowIndex: this_1.prevRowIndex,\n            row: selectedRow,\n            prevRow: gObj.getRows()[this_1.prevRowIndex],\n            foreignKeyData: rowObj.foreignKeyData,\n            isInteracted: this_1.isInteracted,\n            isHeaderCheckboxClicked: this_1.isHeaderCheckboxClicked,\n            rowIndexes: indexes\n          };\n        }\n\n        this_1.onActionComplete(args, events.rowSelected);\n      }\n\n      this_1.isInteracted = false;\n      this_1.updateRowProps(rowIndex);\n\n      if (this_1.isSingleSel()) {\n        return \"break\";\n      }\n    };\n\n    var this_1 = this;\n\n    for (var _i = 0, rowIndexes_2 = rowIndexes; _i < rowIndexes_2.length; _i++) {\n      var rowIndex = rowIndexes_2[_i];\n\n      var state_1 = _loop_1(rowIndex);\n\n      if (typeof state_1 === \"object\") return state_1.value;\n      if (state_1 === \"break\") break;\n    }\n  };\n\n  Selection.prototype.getCollectionFromIndexes = function (startIndex, endIndex) {\n    var indexes = [];\n\n    var _a = startIndex <= endIndex ? {\n      i: startIndex,\n      max: endIndex\n    } : {\n      i: endIndex,\n      max: startIndex\n    },\n        i = _a.i,\n        max = _a.max;\n\n    for (; i <= max; i++) {\n      indexes.push(i);\n    }\n\n    if (startIndex > endIndex) {\n      indexes.reverse();\n    }\n\n    return indexes;\n  };\n\n  Selection.prototype.clearRow = function () {\n    this.clearRowCheck = true;\n    this.clearRowSelection();\n  };\n\n  Selection.prototype.clearRowCallBack = function () {\n    if (this.isCancelDeSelect && this.parent.checkAllRows !== 'Check') {\n      return;\n    }\n\n    this.selectedRowIndexes = [];\n    this.selectedRecords = [];\n    this.selectRowIndex(-1);\n\n    if (this.isSingleSel() && this.parent.isPersistSelection) {\n      this.selectedRowState = {};\n    }\n  };\n\n  Selection.prototype.clearSelectedRow = function (index) {\n    if (this.target) {\n      var selectedEle = this.target.parentElement;\n\n      if (!this.disableUI) {\n        selectedEle.removeAttribute('aria-selected');\n        this.addRemoveClassesForRow(selectedEle, false, true, 'e-selectionbackground', 'e-active');\n      }\n\n      this.updatePersistCollection(selectedEle, false);\n      this.updateCheckBoxes(selectedEle);\n      this.selectedRowIndexes.splice(this.selectedRowIndexes.indexOf(index), 1);\n      this.selectedRecords.splice(this.selectedRecords.indexOf(this.parent.getRowByIndex(index)), 1);\n    }\n  };\n\n  Selection.prototype.updateRowProps = function (startIndex) {\n    this.prevRowIndex = startIndex;\n    this.isRowSelected = this.selectedRowIndexes.length && true;\n  };\n\n  Selection.prototype.updatePersistCollection = function (selectedRow, chkState) {\n    var _this = this;\n\n    if ((this.parent.isPersistSelection || this.parent.selectionSettings.persistSelection && this.parent.getPrimaryKeyFieldNames().length > 0) && !isNullOrUndefined(selectedRow)) {\n      if (!this.parent.isPersistSelection) {\n        this.ensureCheckboxFieldSelection();\n      }\n\n      var rowObj = this.getRowObj(selectedRow);\n      var pKey_1 = rowObj.data ? rowObj.data[this.primaryKey] : null;\n\n      if (pKey_1 === null) {\n        return;\n      }\n\n      rowObj.isSelected = chkState;\n\n      if (chkState) {\n        this.selectedRowState[pKey_1] = chkState;\n\n        if (!this.persistSelectedData.some(function (data) {\n          return data[_this.primaryKey] === pKey_1;\n        })) {\n          this.persistSelectedData.push(rowObj.data);\n        }\n      } else {\n        this.updatePersistDelete(pKey_1);\n      }\n    }\n  };\n\n  Selection.prototype.updatePersistDelete = function (pKey) {\n    var _this = this;\n\n    delete this.selectedRowState[pKey];\n    var index;\n    var isPresent = this.persistSelectedData.some(function (data, i) {\n      index = i;\n      return data[_this.primaryKey] === pKey;\n    });\n\n    if (isPresent) {\n      this.persistSelectedData.splice(index, 1);\n    }\n  };\n\n  Selection.prototype.updateCheckBoxes = function (row, chkState, rowIndex) {\n    if (!isNullOrUndefined(row)) {\n      var chkBox = row.querySelector('.e-checkselect');\n\n      if (!isNullOrUndefined(chkBox)) {\n        removeAddCboxClasses(chkBox.nextElementSibling, chkState);\n        setChecked(chkBox, chkState);\n\n        if (isNullOrUndefined(this.checkedTarget) || !isNullOrUndefined(this.checkedTarget) && !this.checkedTarget.classList.contains('e-checkselectall')) {\n          this.setCheckAllState(rowIndex);\n        }\n      }\n    }\n  };\n\n  Selection.prototype.updateRowSelection = function (selectedRow, startIndex) {\n    if (!selectedRow) {\n      return;\n    }\n\n    this.selectedRowIndexes.push(startIndex);\n    var len = this.selectedRowIndexes.length;\n\n    if (this.parent.getFrozenColumns() && len > 1) {\n      if (this.selectedRowIndexes[len - 2] === this.selectedRowIndexes[len - 1]) {\n        this.selectedRowIndexes.pop();\n      }\n    }\n\n    this.selectedRecords.push(selectedRow);\n    selectedRow.setAttribute('aria-selected', 'true');\n    this.updatePersistCollection(selectedRow, true);\n    this.updateCheckBoxes(selectedRow, true);\n    this.addRemoveClassesForRow(selectedRow, true, null, 'e-selectionbackground', 'e-active');\n\n    if (!this.preventFocus) {\n      var target = this.focus.getPrevIndexes().cellIndex ? selectedRow.cells[this.focus.getPrevIndexes().cellIndex] : selectedRow.querySelector('.e-selectionbackground:not(.e-hide):not(.e-detailrowcollapse):not(.e-detailrowexpand)');\n\n      if (this.parent.contextMenuModule && this.mouseButton === 2) {\n        target = this.parent.contextMenuModule.cell;\n      }\n\n      if (!target) {\n        return;\n      }\n\n      this.focus.onClick({\n        target: target\n      }, true);\n    }\n  };\n  /**\n   * Deselects the currently selected rows and cells.\n   * @return {void}\n   */\n\n\n  Selection.prototype.clearSelection = function () {\n    if (!this.parent.isPersistSelection || this.parent.isPersistSelection && !this.parent.isEdit || !isNullOrUndefined(this.checkedTarget) && this.checkedTarget.classList.contains('e-checkselectall')) {\n      var span = this.parent.element.querySelector('.e-gridpopup').querySelector('span');\n\n      if (span.classList.contains('e-rowselect')) {\n        span.classList.remove('e-spanclicked');\n      }\n\n      if (this.parent.isPersistSelection) {\n        this.persistSelectedData = [];\n        this.selectedRowState = {};\n      }\n\n      this.clearRowSelection();\n      this.clearCellSelection();\n      this.prevRowIndex = undefined;\n      this.enableSelectMultiTouch = false;\n      this.isInteracted = false;\n    }\n  };\n  /**\n   * Deselects the currently selected rows.\n   * @return {void}\n   */\n\n\n  Selection.prototype.clearRowSelection = function () {\n    var _this = this;\n\n    if (this.isRowSelected) {\n      var gObj = this.parent;\n      var rows_1 = this.parent.getDataRows();\n      var data_1 = [];\n      var row_1 = [];\n      var mRow_1 = [];\n      var rowIndex_1 = [];\n      var frzCols = gObj.getFrozenColumns();\n      var foreignKeyData_1 = [];\n      var target_1 = this.target;\n      var currentViewData = this.parent.getCurrentViewRecords();\n\n      for (var i = 0, len = this.selectedRowIndexes.length; i < len; i++) {\n        var currentRow = this.parent.editSettings.mode === 'Batch' ? this.parent.getRows()[this.selectedRowIndexes[i]] : this.parent.getDataRows()[this.selectedRowIndexes[i]];\n        var rowObj = this.getRowObj(currentRow);\n\n        if (rowObj) {\n          data_1.push(rowObj.data);\n          row_1.push(currentRow);\n          rowIndex_1.push(this.selectedRowIndexes[i]);\n          foreignKeyData_1.push(rowObj.foreignKeyData);\n        }\n\n        if (frzCols) {\n          mRow_1.push(gObj.getMovableRows()[this.selectedRowIndexes[i]]);\n        }\n      }\n\n      if (this.selectionSettings.persistSelection && this.selectionSettings.checkboxMode !== 'ResetOnRowClick') {\n        this.isInteracted = this.checkSelectAllClicked ? true : false;\n      }\n\n      this.rowDeselect(events.rowDeselecting, rowIndex_1, data_1, row_1, foreignKeyData_1, target_1, mRow_1, function () {\n        if (_this.isCancelDeSelect && (_this.isInteracted || _this.checkSelectAllClicked)) {\n          if (_this.parent.isPersistSelection) {\n            if (_this.getCheckAllStatus(_this.parent.element.querySelector('.e-checkselectall')) === 'Intermediate') {\n              for (var i = 0; i < _this.selectedRecords.length; i++) {\n                _this.updatePersistCollection(_this.selectedRecords[i], true);\n              }\n            } else {\n              _this.parent.checkAllRows = 'Check';\n\n              _this.updatePersistSelectedData(true);\n            }\n          }\n\n          if (_this.clearRowCheck) {\n            _this.clearRowCallBack();\n\n            _this.clearRowCheck = false;\n\n            if (_this.selectRowCheck) {\n              _this.selectRowCallBack();\n\n              _this.selectRowCheck = false;\n            }\n          }\n\n          return;\n        }\n\n        var element = [].slice.call(rows_1.filter(function (record) {\n          return record.hasAttribute('aria-selected');\n        }));\n\n        for (var j = 0; j < element.length; j++) {\n          if (!_this.disableUI || isBlazor()) {\n            element[j].removeAttribute('aria-selected');\n\n            _this.addRemoveClassesForRow(element[j], false, true, 'e-selectionbackground', 'e-active');\n          } // tslint:disable-next-line:align\n\n\n          _this.updatePersistCollection(element[j], false);\n\n          _this.updateCheckBoxes(element[j]);\n        }\n\n        if (isBlazor() && _this.parent.isServerRendered && _this.parent.enableVirtualization) {\n          _this.getRenderer().setSelection(null, false, true);\n        }\n\n        for (var i = 0, len = _this.selectedRowIndexes.length; i < len; i++) {\n          var movableRow = _this.getSelectedMovableRow(_this.selectedRowIndexes[i]);\n\n          if (movableRow) {\n            if (!_this.disableUI || isBlazor()) {\n              movableRow.removeAttribute('aria-selected');\n\n              _this.addRemoveClassesForRow(movableRow, false, true, 'e-selectionbackground', 'e-active');\n            }\n\n            _this.updatePersistCollection(movableRow, false);\n          }\n        }\n\n        _this.selectedRowIndexes = [];\n        _this.selectedRecords = [];\n        _this.isRowSelected = false;\n\n        _this.selectRowIndex(-1);\n\n        _this.rowDeselect(events.rowDeselected, rowIndex_1, data_1, row_1, foreignKeyData_1, target_1, mRow_1);\n\n        if (_this.clearRowCheck) {\n          _this.clearRowCallBack();\n\n          _this.clearRowCheck = false;\n\n          if (_this.selectRowCheck) {\n            _this.selectRowCallBack();\n\n            _this.selectRowCheck = false;\n          }\n        }\n      });\n    } else {\n      if (this.clearRowCheck) {\n        this.clearRowCallBack();\n        this.clearRowCheck = false;\n\n        if (this.selectRowCheck) {\n          this.selectRowCallBack();\n          this.selectRowCheck = false;\n        }\n      }\n    }\n  };\n\n  Selection.prototype.rowDeselect = function (type, rowIndex, data, row, foreignKeyData, target, mRow, rowDeselectCallBack) {\n    var _this = this;\n\n    if (this.selectionSettings.persistSelection && this.isInteracted || !this.selectionSettings.persistSelection) {\n      var cancl_1 = 'cancel';\n      var rowDeselectObj = {\n        rowIndex: rowIndex[0],\n        data: this.selectionSettings.persistSelection && this.parent.checkAllRows === 'Uncheck' && this.selectionSettings.checkboxMode !== 'ResetOnRowClick' ? this.persistSelectedData : data,\n        foreignKeyData: foreignKeyData,\n        cancel: false,\n        isInteracted: this.isInteracted,\n        isHeaderCheckboxClicked: this.isHeaderCheckboxClicked\n      };\n\n      if (type === 'rowDeselected') {\n        delete rowDeselectObj.cancel;\n      }\n\n      var isHybrid = 'isHybrid';\n\n      if (!isBlazor() || this.parent.isJsComponent || this.parent[isHybrid]) {\n        var rowInString = 'row';\n        var target_2 = 'target';\n        var rowidx = 'rowIndex';\n        var rowidxex = 'rowIndexes';\n        var data_2 = 'data';\n        var foreignKey = 'foreignKeyData';\n        rowDeselectObj[rowInString] = row;\n        rowDeselectObj[target_2] = this.actualTarget;\n        var isHeaderCheckBxClick = this.actualTarget && !isNullOrUndefined(closest(this.actualTarget, 'thead'));\n\n        if (isHeaderCheckBxClick || rowIndex.length > 1) {\n          rowDeselectObj[rowidx] = rowIndex[0];\n          rowDeselectObj[rowidxex] = rowIndex;\n        } else if (rowIndex.length === 1) {\n          rowDeselectObj[data_2] = rowDeselectObj[data_2][0];\n          rowDeselectObj[rowInString] = rowDeselectObj[rowInString][0];\n          rowDeselectObj[foreignKey] = rowDeselectObj[foreignKey][0];\n\n          if (this.isAddRowsToSelection) {\n            rowDeselectObj[rowidxex] = rowIndex;\n          }\n        }\n      } else {\n        var rowIndex_2 = 'rowIndex';\n        var data_3 = 'data';\n        rowDeselectObj[rowIndex_2] = rowDeselectObj[rowIndex_2][rowDeselectObj[rowIndex_2].length - 1];\n        rowDeselectObj[data_3] = rowDeselectObj[data_3][rowDeselectObj[data_3].length - 1];\n      }\n\n      this.parent.trigger(type, (!isBlazor() || this.parent.isJsComponent) && this.parent.getFrozenColumns() !== 0 ? __assign({}, rowDeselectObj, {\n        mRow: mRow\n      }) : rowDeselectObj, function (args) {\n        _this.isCancelDeSelect = args[cancl_1];\n\n        if (!_this.isCancelDeSelect || !_this.isInteracted && !_this.checkSelectAllClicked) {\n          _this.updatePersistCollection(row[0], false);\n\n          _this.updateCheckBoxes(row[0], undefined, rowIndex[0]);\n        }\n\n        if (rowDeselectCallBack !== undefined) {\n          rowDeselectCallBack();\n        }\n      });\n    } else if (this.selectionSettings.persistSelection && !this.isInteracted) {\n      if (rowDeselectCallBack !== undefined) {\n        rowDeselectCallBack();\n      }\n    }\n  };\n\n  Selection.prototype.getRowObj = function (row) {\n    if (row === void 0) {\n      row = this.currentIndex;\n    }\n\n    if (isNullOrUndefined(row)) {\n      return {};\n    }\n\n    if (typeof row === 'number') {\n      row = this.parent.getRowByIndex(row);\n    }\n\n    if (row) {\n      return this.parent.getRowObjectFromUID(row.getAttribute('data-uid')) || {};\n    }\n\n    return {};\n  };\n\n  Selection.prototype.getSelectedMovableCell = function (cellIndex) {\n    var gObj = this.parent;\n    var frzCols = gObj.getFrozenColumns();\n\n    if (frzCols) {\n      if (cellIndex.cellIndex >= frzCols) {\n        return gObj.getMovableCellFromIndex(cellIndex.rowIndex, this.getColIndex(cellIndex.rowIndex, cellIndex.cellIndex));\n      }\n\n      return null;\n    }\n\n    return null;\n  };\n  /**\n   * Selects a cell by the given index.\n   * @param  {IIndex} cellIndex - Defines the row and column indexes.\n   * @param  {boolean} isToggle - If set to true, then it toggles the selection.\n   * @return {void}\n   */\n\n\n  Selection.prototype.selectCell = function (cellIndex, isToggle) {\n    if (!this.isCellType()) {\n      return;\n    }\n\n    var gObj = this.parent;\n    var selectedCell = this.getSelectedMovableCell(cellIndex);\n    var args;\n\n    if (!selectedCell) {\n      selectedCell = gObj.getCellFromIndex(cellIndex.rowIndex, this.getColIndex(cellIndex.rowIndex, cellIndex.cellIndex));\n    }\n\n    var selectedTable;\n    var cIdx;\n    this.currentIndex = cellIndex.rowIndex;\n    var selectedData = this.getCurrentBatchRecordChanges()[this.currentIndex];\n\n    if (!this.isCellType() || !selectedCell || this.isEditing()) {\n      return;\n    }\n\n    var isCellSelected = selectedCell.classList.contains('e-cellselectionbackground');\n    isToggle = !isToggle ? isToggle : !isUndefined(this.prevCIdxs) && cellIndex.rowIndex === this.prevCIdxs.rowIndex && cellIndex.cellIndex === this.prevCIdxs.cellIndex && isCellSelected;\n\n    if (!isToggle) {\n      args = {\n        data: selectedData,\n        cellIndex: cellIndex,\n        isCtrlPressed: this.isMultiCtrlRequest,\n        isShiftPressed: this.isMultiShiftRequest,\n        previousRowCell: this.prevECIdxs ? this.getCellIndex(this.prevECIdxs.rowIndex, this.prevECIdxs.cellIndex) : undefined,\n        cancel: false\n      };\n\n      if (!isBlazor() || this.parent.isJsComponent) {\n        var currentCell = 'currentCell';\n        args[currentCell] = selectedCell;\n        var previousRowCellIndex = 'previousRowCellIndex';\n        args[previousRowCellIndex] = this.prevECIdxs;\n      }\n\n      this.parent.trigger(events.cellSelecting, this.fDataUpdate(args), this.successCallBack(args, isToggle, cellIndex, selectedCell, selectedData));\n      this.cellselected = true;\n    } else {\n      this.successCallBack(args, isToggle, cellIndex, selectedCell, selectedData)(args);\n    }\n  };\n\n  Selection.prototype.successCallBack = function (cellSelectingArgs, isToggle, cellIndex, selectedCell, selectedData) {\n    var _this = this;\n\n    return function (cellSelectingArgs) {\n      var cncl = 'cancel';\n      var currentCell = 'currentCell';\n\n      if (!isNullOrUndefined(cellSelectingArgs) && cellSelectingArgs[cncl] === true) {\n        return;\n      }\n\n      if (!isToggle) {\n        cellSelectingArgs[currentCell] = cellSelectingArgs[currentCell] ? cellSelectingArgs[currentCell] : selectedCell;\n      }\n\n      _this.clearCell();\n\n      if (!isToggle) {\n        _this.updateCellSelection(selectedCell, cellIndex.rowIndex, cellIndex.cellIndex);\n      }\n\n      if (!isToggle) {\n        var args = void 0;\n        var isHybrid = 'isHybrid';\n\n        if (!isBlazor() || _this.parent.isJsComponent || _this.parent[isHybrid]) {\n          args = {\n            data: selectedData,\n            cellIndex: cellIndex,\n            currentCell: selectedCell,\n            selectedRowCellIndex: _this.selectedRowCellIndexes,\n            previousRowCell: _this.prevECIdxs ? _this.getCellIndex(_this.prevECIdxs.rowIndex, _this.prevECIdxs.cellIndex) : undefined\n          };\n          var previousRowCellIndex = 'previousRowCellIndex';\n          args[previousRowCellIndex] = _this.prevECIdxs;\n        } else {\n          args = {\n            data: selectedData,\n            cellIndex: cellIndex,\n            selectedRowCellIndex: _this.selectedRowCellIndexes\n          };\n        }\n\n        _this.updateCellProps(cellIndex, cellIndex);\n\n        _this.onActionComplete(args, events.cellSelected);\n      }\n    };\n  };\n\n  Selection.prototype.getCellIndex = function (rIdx, cIdx) {\n    return this.parent.getFrozenColumns() ? cIdx >= this.parent.getFrozenColumns() ? this.parent.getMovableCellFromIndex(rIdx, cIdx) : this.parent.getCellFromIndex(rIdx, cIdx) : this.parent.getCellFromIndex(rIdx, cIdx);\n  };\n  /**\n   * Selects a range of cells from start and end indexes.\n   * @param  {IIndex} startIndex - Specifies the row and column's start index.\n   * @param  {IIndex} endIndex - Specifies the row and column's end index.\n   * @return {void}\n   */\n\n\n  Selection.prototype.selectCellsByRange = function (startIndex, endIndex) {\n    var _this = this;\n\n    if (!this.isCellType()) {\n      return;\n    }\n\n    var gObj = this.parent;\n    var selectedCell = this.getSelectedMovableCell(startIndex);\n    var frzCols = gObj.getFrozenColumns();\n\n    if (!selectedCell) {\n      selectedCell = gObj.getCellFromIndex(startIndex.rowIndex, startIndex.cellIndex);\n    }\n\n    var min;\n    var max;\n    var stIndex = startIndex;\n    var edIndex = endIndex = endIndex ? endIndex : startIndex;\n    var cellIndexes;\n    this.currentIndex = startIndex.rowIndex;\n    var cncl = 'cancel';\n    var selectedData = this.getCurrentBatchRecordChanges()[this.currentIndex];\n\n    if (this.isSingleSel() || !this.isCellType() || this.isEditing()) {\n      return;\n    }\n\n    var args = {\n      data: selectedData,\n      cellIndex: startIndex,\n      currentCell: selectedCell,\n      isCtrlPressed: this.isMultiCtrlRequest,\n      isShiftPressed: this.isMultiShiftRequest,\n      previousRowCell: this.prevECIdxs ? this.getCellIndex(this.prevECIdxs.rowIndex, this.prevECIdxs.cellIndex) : undefined\n    };\n\n    if (!isBlazor()) {\n      var previousRowCellIndex = 'previousRowCellIndex';\n      args[previousRowCellIndex] = this.prevECIdxs;\n    }\n\n    this.parent.trigger(events.cellSelecting, this.fDataUpdate(args), function (cellSelectingArgs) {\n      if (!isNullOrUndefined(cellSelectingArgs) && cellSelectingArgs[cncl] === true) {\n        return;\n      }\n\n      _this.clearCell();\n\n      if (startIndex.rowIndex > endIndex.rowIndex) {\n        var temp = startIndex;\n        startIndex = endIndex;\n        endIndex = temp;\n      }\n\n      for (var i = startIndex.rowIndex; i <= endIndex.rowIndex; i++) {\n        if (_this.selectionSettings.cellSelectionMode.indexOf('Box') < 0) {\n          min = i === startIndex.rowIndex ? startIndex.cellIndex : 0;\n          max = i === endIndex.rowIndex ? endIndex.cellIndex : _this.getLastColIndex(i);\n        } else {\n          min = startIndex.cellIndex;\n          max = endIndex.cellIndex;\n        }\n\n        cellIndexes = [];\n\n        for (var j = min < max ? min : max, len = min > max ? min : max; j <= len; j++) {\n          if (frzCols) {\n            if (j < frzCols) {\n              selectedCell = gObj.getCellFromIndex(i, j);\n            } else {\n              selectedCell = gObj.getMovableCellFromIndex(i, j);\n            }\n          } else {\n            selectedCell = gObj.getCellFromIndex(i, j);\n          }\n\n          if (!selectedCell) {\n            continue;\n          }\n\n          cellIndexes.push(j);\n\n          _this.updateCellSelection(selectedCell);\n\n          _this.addAttribute(selectedCell);\n        }\n\n        _this.selectedRowCellIndexes.push({\n          rowIndex: i,\n          cellIndexes: cellIndexes\n        });\n      }\n\n      var cellSelectedArgs;\n      var isHybrid = 'isHybrid';\n\n      if (!isBlazor() || _this.parent.isJsComponent || _this.parent[isHybrid]) {\n        cellSelectedArgs = {\n          data: selectedData,\n          cellIndex: edIndex,\n          currentCell: gObj.getCellFromIndex(edIndex.rowIndex, edIndex.cellIndex),\n          selectedRowCellIndex: _this.selectedRowCellIndexes,\n          previousRowCell: _this.prevECIdxs ? _this.getCellIndex(_this.prevECIdxs.rowIndex, _this.prevECIdxs.cellIndex) : undefined\n        };\n        var previousRowCellIndex = 'previousRowCellIndex';\n        cellSelectedArgs[previousRowCellIndex] = _this.prevECIdxs;\n      } else {\n        cellSelectedArgs = {\n          data: selectedData,\n          cellIndex: edIndex,\n          selectedRowCellIndex: _this.selectedRowCellIndexes\n        };\n      }\n\n      if (!_this.isDragged) {\n        _this.onActionComplete(cellSelectedArgs, events.cellSelected);\n\n        _this.cellselected = true;\n      }\n\n      _this.updateCellProps(stIndex, edIndex);\n    });\n  };\n  /**\n   * Selects a collection of cells by row and column indexes.\n   * @param  {ISelectedCell[]} rowCellIndexes - Specifies the row and column indexes.\n   * @return {void}\n   */\n\n\n  Selection.prototype.selectCells = function (rowCellIndexes) {\n    if (!this.isCellType()) {\n      return;\n    }\n\n    var gObj = this.parent;\n    var selectedCell = this.getSelectedMovableCell(rowCellIndexes[0]);\n    var frzCols = gObj.getFrozenColumns();\n\n    if (!selectedCell) {\n      selectedCell = gObj.getCellFromIndex(rowCellIndexes[0].rowIndex, rowCellIndexes[0].cellIndexes[0]);\n    }\n\n    this.currentIndex = rowCellIndexes[0].rowIndex;\n    var selectedData = this.getCurrentBatchRecordChanges()[this.currentIndex];\n\n    if (this.isSingleSel() || !this.isCellType() || this.isEditing()) {\n      return;\n    }\n\n    var cellSelectArgs;\n    var isHybrid = 'isHybrid';\n\n    if (!isBlazor() || this.parent.isJsComponent || this.parent[isHybrid]) {\n      cellSelectArgs = {\n        data: selectedData,\n        cellIndex: rowCellIndexes[0].cellIndexes[0],\n        currentCell: selectedCell,\n        isCtrlPressed: this.isMultiCtrlRequest,\n        isShiftPressed: this.isMultiShiftRequest,\n        previousRowCell: this.prevECIdxs ? this.getCellIndex(this.prevECIdxs.rowIndex, this.prevECIdxs.cellIndex) : undefined\n      };\n      var previousRowCellIndex = 'previousRowCellIndex';\n      cellSelectArgs[previousRowCellIndex] = this.prevECIdxs;\n    } else {\n      cellSelectArgs = {\n        data: selectedData,\n        cellIndex: rowCellIndexes[0].cellIndexes[0],\n        isCtrlPressed: this.isMultiCtrlRequest,\n        isShiftPressed: this.isMultiShiftRequest\n      };\n    }\n\n    this.onActionBegin(cellSelectArgs, events.cellSelecting);\n\n    for (var i = 0, len = rowCellIndexes.length; i < len; i++) {\n      for (var j = 0, cellLen = rowCellIndexes[i].cellIndexes.length; j < cellLen; j++) {\n        if (frzCols) {\n          if (rowCellIndexes[i].cellIndexes[j] < frzCols) {\n            selectedCell = gObj.getCellFromIndex(rowCellIndexes[i].rowIndex, rowCellIndexes[i].cellIndexes[j]);\n          } else {\n            selectedCell = gObj.getMovableCellFromIndex(rowCellIndexes[i].rowIndex, rowCellIndexes[i].cellIndexes[j]);\n          }\n        } else {\n          selectedCell = gObj.getCellFromIndex(rowCellIndexes[i].rowIndex, rowCellIndexes[i].cellIndexes[j]);\n        }\n\n        if (!selectedCell) {\n          continue;\n        }\n\n        this.updateCellSelection(selectedCell);\n        this.addAttribute(selectedCell);\n        this.addRowCellIndex({\n          rowIndex: rowCellIndexes[i].rowIndex,\n          cellIndex: rowCellIndexes[i].cellIndexes[j]\n        });\n      }\n    }\n\n    this.updateCellProps({\n      rowIndex: rowCellIndexes[0].rowIndex,\n      cellIndex: rowCellIndexes[0].cellIndexes[0]\n    }, {\n      rowIndex: rowCellIndexes[0].rowIndex,\n      cellIndex: rowCellIndexes[0].cellIndexes[0]\n    });\n    var cellSelectedArgs;\n\n    if (!isBlazor() || this.parent.isJsComponent || this.parent[isHybrid]) {\n      cellSelectedArgs = {\n        data: selectedData,\n        cellIndex: rowCellIndexes[0].cellIndexes[0],\n        currentCell: selectedCell,\n        selectedRowCellIndex: this.selectedRowCellIndexes,\n        previousRowCell: this.prevECIdxs ? this.getCellIndex(this.prevECIdxs.rowIndex, this.prevECIdxs.cellIndex) : undefined\n      };\n      var previousRowCellIndex = 'previousRowCellIndex';\n      cellSelectedArgs[previousRowCellIndex] = this.prevECIdxs;\n    } else {\n      cellSelectedArgs = {\n        data: selectedData,\n        cellIndex: rowCellIndexes[0].cellIndexes[0],\n        selectedRowCellIndex: this.selectedRowCellIndexes\n      };\n    }\n\n    this.onActionComplete(cellSelectedArgs, events.cellSelected);\n  };\n  /**\n   * Select cells with existing cell selection by passing row and column index.\n   * @param  {IIndex} startIndex - Defines the collection of row and column index.\n   * @return {void}\n   * @hidden\n   */\n\n\n  Selection.prototype.addCellsToSelection = function (cellIndexes) {\n    if (!this.isCellType()) {\n      return;\n    }\n\n    var gObj = this.parent;\n    var selectedTable;\n    var cIdx;\n    var selectedCell;\n    var frzCols = gObj.getFrozenColumns();\n    var index;\n    this.currentIndex = cellIndexes[0].rowIndex;\n    var cncl = 'cancel';\n    var selectedData = this.getCurrentBatchRecordChanges()[this.currentIndex];\n    var isHybrid = 'isHybrid';\n\n    if (this.isSingleSel() || !this.isCellType() || this.isEditing()) {\n      return;\n    }\n\n    this.hideAutoFill();\n    var rowObj;\n\n    if (frzCols && cellIndexes[0].cellIndex >= frzCols) {\n      rowObj = gObj.getMovableRowsObject()[cellIndexes[0].rowIndex];\n    } else {\n      rowObj = this.getRowObj(cellIndexes[0].rowIndex);\n    }\n\n    var foreignKeyData = [];\n\n    for (var _i = 0, cellIndexes_1 = cellIndexes; _i < cellIndexes_1.length; _i++) {\n      var cellIndex = cellIndexes_1[_i];\n\n      for (var i = 0, len = this.selectedRowCellIndexes.length; i < len; i++) {\n        if (this.selectedRowCellIndexes[i].rowIndex === cellIndex.rowIndex) {\n          index = i;\n          break;\n        }\n      }\n\n      selectedCell = this.getSelectedMovableCell(cellIndex);\n\n      if (!selectedCell) {\n        selectedCell = gObj.getCellFromIndex(cellIndex.rowIndex, this.getColIndex(cellIndex.rowIndex, cellIndex.cellIndex));\n      }\n\n      foreignKeyData.push(rowObj.cells[frzCols && cellIndexes[0].cellIndex >= frzCols ? cellIndex.cellIndex - frzCols : cellIndex.cellIndex].foreignKeyData);\n      var args = void 0;\n\n      if (!isBlazor() || this.parent.isJsComponent || this.parent[isHybrid]) {\n        args = {\n          cancel: false,\n          data: selectedData,\n          cellIndex: cellIndexes[0],\n          isShiftPressed: this.isMultiShiftRequest,\n          currentCell: selectedCell,\n          isCtrlPressed: this.isMultiCtrlRequest,\n          previousRowCell: this.prevECIdxs ? gObj.getCellFromIndex(this.prevECIdxs.rowIndex, this.prevECIdxs.cellIndex) : undefined\n        };\n        var previousRowCellIndex = 'previousRowCellIndex';\n        args[previousRowCellIndex] = this.prevECIdxs;\n      } else {\n        args = {\n          cancel: false,\n          data: selectedData,\n          cellIndex: cellIndexes[0],\n          isShiftPressed: this.isMultiShiftRequest,\n          isCtrlPressed: this.isMultiCtrlRequest\n        };\n      }\n\n      var isUnSelected = index > -1;\n\n      if (isUnSelected) {\n        var selectedCellIdx = this.selectedRowCellIndexes[index].cellIndexes;\n\n        if (selectedCellIdx.indexOf(cellIndex.cellIndex) > -1) {\n          this.cellDeselect(events.cellDeselecting, [{\n            rowIndex: cellIndex.rowIndex,\n            cellIndexes: [cellIndex.cellIndex]\n          }], selectedData, [selectedCell], foreignKeyData);\n          selectedCellIdx.splice(selectedCellIdx.indexOf(cellIndex.cellIndex), 1);\n\n          if (selectedCellIdx.length === 0) {\n            this.selectedRowCellIndexes.splice(index, 1);\n          }\n\n          selectedCell.classList.remove('e-cellselectionbackground');\n          selectedCell.removeAttribute('aria-selected');\n          this.cellDeselect(events.cellDeselected, [{\n            rowIndex: cellIndex.rowIndex,\n            cellIndexes: [cellIndex.cellIndex]\n          }], selectedData, [selectedCell], foreignKeyData);\n        } else {\n          isUnSelected = false;\n          this.onActionBegin(args, events.cellSelecting);\n          this.addRowCellIndex({\n            rowIndex: cellIndex.rowIndex,\n            cellIndex: cellIndex.cellIndex\n          });\n          this.updateCellSelection(selectedCell);\n          this.addAttribute(selectedCell);\n        }\n      } else {\n        this.onActionBegin(args, events.cellSelecting);\n\n        if (!isNullOrUndefined(args) && args[cncl] === true) {\n          return;\n        }\n\n        this.updateCellSelection(selectedCell, cellIndex.rowIndex, cellIndex.cellIndex);\n      }\n\n      if (!isUnSelected) {\n        var cellSelectedArgs = void 0;\n\n        if (!isBlazor() || this.parent.isJsComponent || this.parent[isHybrid]) {\n          cellSelectedArgs = {\n            data: selectedData,\n            cellIndex: cellIndexes[0],\n            currentCell: selectedCell,\n            previousRowCell: this.prevECIdxs ? this.getCellIndex(this.prevECIdxs.rowIndex, this.prevECIdxs.cellIndex) : undefined,\n            selectedRowCellIndex: this.selectedRowCellIndexes\n          };\n          var previousRowCellIndex = 'previousRowCellIndex';\n          cellSelectedArgs[previousRowCellIndex] = this.prevECIdxs;\n        } else {\n          cellSelectedArgs = {\n            data: selectedData,\n            cellIndex: cellIndexes[0],\n            selectedRowCellIndex: this.selectedRowCellIndexes\n          };\n        }\n\n        this.onActionComplete(cellSelectedArgs, events.cellSelected);\n        this.cellselected = true;\n      }\n\n      this.updateCellProps(cellIndex, cellIndex);\n    }\n  };\n\n  Selection.prototype.getColIndex = function (rowIndex, index) {\n    var cells;\n    var frzCols = this.parent.getFrozenColumns();\n\n    if (frzCols) {\n      if (index >= frzCols) {\n        cells = this.parent.getMovableDataRows()[rowIndex] && this.parent.getMovableDataRows()[rowIndex].querySelectorAll('td.e-rowcell');\n      }\n    }\n\n    if (!cells) {\n      cells = this.parent.getDataRows()[rowIndex] && this.parent.getDataRows()[rowIndex].querySelectorAll('td.e-rowcell');\n    }\n\n    if (cells) {\n      for (var m = 0; m < cells.length; m++) {\n        var colIndex = parseInt(cells[m].getAttribute('aria-colindex'), 10);\n\n        if (colIndex === index) {\n          if (frzCols) {\n            if (index >= frzCols) {\n              m += frzCols;\n            }\n          }\n\n          return m;\n        }\n      }\n    }\n\n    return -1;\n  };\n\n  Selection.prototype.getLastColIndex = function (rowIndex) {\n    var cells = this.parent.getFrozenColumns() ? this.parent.getMovableDataRows()[rowIndex].querySelectorAll('td.e-rowcell') : this.parent.getDataRows()[rowIndex].querySelectorAll('td.e-rowcell');\n    return parseInt(cells[cells.length - 1].getAttribute('aria-colindex'), 10);\n  };\n\n  Selection.prototype.clearCell = function () {\n    this.clearCellSelection();\n  };\n\n  Selection.prototype.cellDeselect = function (type, cellIndexes, data, cells, foreignKeyData) {\n    var cancl = 'cancel';\n\n    if (cells[0] && cells[0].classList.contains('e-gridchkbox')) {\n      this.updateCheckBoxes(closest(cells[0], 'tr'));\n    }\n\n    var args = {\n      cells: cells,\n      data: data,\n      cellIndexes: cellIndexes,\n      foreignKeyData: foreignKeyData,\n      cancel: false\n    };\n    this.parent.trigger(type, args);\n    this.isPreventCellSelect = args[cancl];\n  };\n\n  Selection.prototype.updateCellSelection = function (selectedCell, rowIndex, cellIndex) {\n    if (!isNullOrUndefined(rowIndex)) {\n      this.addRowCellIndex({\n        rowIndex: rowIndex,\n        cellIndex: cellIndex\n      });\n    }\n\n    selectedCell.classList.add('e-cellselectionbackground');\n\n    if (selectedCell.classList.contains('e-gridchkbox')) {\n      this.updateCheckBoxes(closest(selectedCell, 'tr'), true);\n    }\n\n    this.addAttribute(selectedCell);\n  };\n\n  Selection.prototype.addAttribute = function (cell) {\n    this.target = cell;\n\n    if (!isNullOrUndefined(cell)) {\n      cell.setAttribute('aria-selected', 'true');\n\n      if (!this.preventFocus) {\n        this.focus.onClick({\n          target: cell\n        }, true);\n      }\n    }\n  };\n\n  Selection.prototype.updateCellProps = function (startIndex, endIndex) {\n    this.prevCIdxs = startIndex;\n    this.prevECIdxs = endIndex;\n    this.isCellSelected = this.selectedRowCellIndexes.length && true;\n  };\n\n  Selection.prototype.addRowCellIndex = function (rowCellIndex) {\n    var isRowAvail;\n    var index;\n\n    for (var i = 0, len = this.selectedRowCellIndexes.length; i < len; i++) {\n      if (this.selectedRowCellIndexes[i].rowIndex === rowCellIndex.rowIndex) {\n        isRowAvail = true;\n        index = i;\n        break;\n      }\n    }\n\n    if (isRowAvail) {\n      if (this.selectedRowCellIndexes[index].cellIndexes.indexOf(rowCellIndex.cellIndex) < 0) {\n        this.selectedRowCellIndexes[index].cellIndexes.push(rowCellIndex.cellIndex);\n      }\n    } else {\n      this.selectedRowCellIndexes.push({\n        rowIndex: rowCellIndex.rowIndex,\n        cellIndexes: [rowCellIndex.cellIndex]\n      });\n    }\n  };\n  /**\n   * Deselects the currently selected cells.\n   * @return {void}\n   */\n\n\n  Selection.prototype.clearCellSelection = function () {\n    if (this.isCellSelected) {\n      var gObj = this.parent;\n      var selectedCells = this.getSelectedCellsElement();\n      var rowCell = this.selectedRowCellIndexes;\n      var data = [];\n      var cells = [];\n      var foreignKeyData = [];\n      var currentViewData = this.getCurrentBatchRecordChanges();\n      var selectedTable = void 0;\n      var frzCols = gObj.getFrozenColumns();\n      this.hideAutoFill();\n\n      for (var i = 0, len = rowCell.length; i < len; i++) {\n        data.push(currentViewData[rowCell[i].rowIndex]);\n        var rowObj = this.getRowObj(rowCell[i].rowIndex);\n\n        for (var j = 0, cLen = rowCell[i].cellIndexes.length; j < cLen; j++) {\n          if (frzCols) {\n            if (rowCell[i].cellIndexes[j] < frzCols) {\n              cells.push(gObj.getCellFromIndex(rowCell[i].rowIndex, rowCell[i].cellIndexes[j]));\n            } else {\n              cells.push(gObj.getMovableCellFromIndex(rowCell[i].rowIndex, rowCell[i].cellIndexes[j]));\n            }\n          } else {\n            if (rowObj.cells) {\n              foreignKeyData.push(rowObj.cells[rowCell[i].cellIndexes[j]].foreignKeyData);\n            }\n\n            cells.push(gObj.getCellFromIndex(rowCell[i].rowIndex, rowCell[i].cellIndexes[j]));\n          }\n        }\n      }\n\n      this.cellDeselect(events.cellDeselecting, rowCell, data, cells, foreignKeyData);\n\n      if (this.isPreventCellSelect === true) {\n        return;\n      }\n\n      for (var i = 0, len = selectedCells.length; i < len; i++) {\n        selectedCells[i].classList.remove('e-cellselectionbackground');\n        selectedCells[i].removeAttribute('aria-selected');\n      }\n\n      if (this.bdrElement) {\n        this.showHideBorders('none');\n      }\n\n      this.selectedRowCellIndexes = [];\n      this.isCellSelected = false;\n\n      if (!this.isDragged && this.cellselected) {\n        this.cellDeselect(events.cellDeselected, rowCell, data, cells, foreignKeyData);\n      }\n    }\n  };\n\n  Selection.prototype.getSelectedCellsElement = function () {\n    var gObj = this.parent;\n    var rows = gObj.getDataRows();\n    var mRows;\n\n    if (gObj.getFrozenColumns()) {\n      mRows = gObj.getMovableDataRows();\n      rows = gObj.addMovableRows(rows, mRows);\n    }\n\n    var cells = [];\n\n    for (var i = 0, len = rows.length; i < len; i++) {\n      cells = cells.concat([].slice.call(rows[i].querySelectorAll('.e-cellselectionbackground')));\n    }\n\n    return cells;\n  };\n\n  Selection.prototype.mouseMoveHandler = function (e) {\n    e.preventDefault();\n    var gBRect = this.parent.element.getBoundingClientRect();\n    var x1 = this.x;\n    var y1 = this.y;\n    var position = getPosition(e);\n    var x2 = position.x - gBRect.left;\n    var y2 = position.y - gBRect.top;\n    var tmp;\n    var target = closest(e.target, 'tr');\n    this.isDragged = true;\n\n    if (!this.isCellDrag) {\n      if (!target) {\n        target = closest(document.elementFromPoint(this.parent.element.offsetLeft + 2, e.clientY), 'tr');\n      }\n\n      if (x1 > x2) {\n        tmp = x2;\n        x2 = x1;\n        x1 = tmp;\n      }\n\n      if (y1 > y2) {\n        tmp = y2;\n        y2 = y1;\n        y1 = tmp;\n      }\n\n      this.element.style.left = x1 + 'px';\n      this.element.style.top = y1 + 'px';\n      this.element.style.width = x2 - x1 + 'px';\n      this.element.style.height = y2 - y1 + 'px';\n    }\n\n    if (target && !e.ctrlKey && !e.shiftKey) {\n      var rowIndex = parseInt(target.getAttribute('aria-rowindex'), 10);\n\n      if (!this.isCellDrag) {\n        this.hideAutoFill();\n        this.selectRowsByRange(this.startDIndex, rowIndex);\n      } else {\n        var td = parentsUntil(e.target, 'e-rowcell');\n\n        if (td) {\n          this.startAFCell = this.startCell;\n          this.endAFCell = parentsUntil(e.target, 'e-rowcell');\n          this.selectLikeExcel(e, rowIndex, parseInt(td.getAttribute('aria-colindex'), 10));\n        }\n      }\n    }\n  };\n\n  Selection.prototype.selectLikeExcel = function (e, rowIndex, cellIndex) {\n    if (!this.isAutoFillSel) {\n      this.clearCellSelection();\n      this.selectCellsByRange({\n        rowIndex: this.startDIndex,\n        cellIndex: this.startDCellIndex\n      }, {\n        rowIndex: rowIndex,\n        cellIndex: cellIndex\n      });\n      this.drawBorders();\n    } else {\n      //Autofill\n      this.showAFBorders();\n      this.selectLikeAutoFill(e);\n    }\n  };\n\n  Selection.prototype.drawBorders = function () {\n    if (this.selectionSettings.cellSelectionMode === 'BoxWithBorder' && this.selectedRowCellIndexes.length && !this.parent.isEdit) {\n      this.parent.element.classList.add('e-enabledboxbdr');\n\n      if (!this.bdrElement) {\n        this.createBorders();\n      }\n\n      this.positionBorders();\n    } else {\n      this.showHideBorders('none');\n    }\n  };\n\n  Selection.prototype.isLastCell = function (cell) {\n    var cells = [].slice.call(cell.parentElement.querySelectorAll('.e-rowcell:not(.e-hide)'));\n    return cells[cells.length - 1] === cell;\n  };\n\n  Selection.prototype.isLastRow = function (cell) {\n    var rows = [].slice.call(closest(cell, 'tbody').querySelectorAll('.e-row:not(.e-hiddenrow)'));\n    return cell.parentElement === rows[rows.length - 1];\n  };\n\n  Selection.prototype.isFirstRow = function (cell) {\n    var rows = [].slice.call(closest(cell, 'tbody').querySelectorAll('.e-row:not(.e-hiddenrow)'));\n    return cell.parentElement === rows[0];\n  };\n\n  Selection.prototype.isFirstCell = function (cell) {\n    var cells = [].slice.call(cell.parentElement.querySelectorAll('.e-rowcell:not(.e-hide)'));\n    return cells[0] === cell;\n  };\n\n  Selection.prototype.setBorders = function (parentEle, border, bdrStr) {\n    var cells = [].slice.call(parentEle.querySelectorAll('.e-cellselectionbackground')).filter(function (ele) {\n      return ele.style.display === '';\n    });\n\n    if (cells.length) {\n      var start = cells[0];\n      var end = cells[cells.length - 1];\n      var stOff = start.getBoundingClientRect();\n      var endOff = end.getBoundingClientRect();\n      var parentOff = start.offsetParent.getBoundingClientRect();\n      var rowHeight = this.isLastRow(end) && (bdrStr === '1' || bdrStr === '2') ? 2 : 0;\n      var topOffSet = this.parent.frozenRows && (bdrStr === '1' || bdrStr === '2') && this.isFirstRow(start) ? 1.5 : 0;\n      var leftOffset = this.parent.getFrozenColumns() && (bdrStr === '2' || bdrStr === '4') && this.isFirstCell(start) ? 1 : 0;\n\n      if (this.parent.enableRtl) {\n        border.style.right = parentOff.right - stOff.right - leftOffset + 'px';\n        border.style.width = stOff.right - endOff.left + leftOffset + 1 + 'px';\n      } else {\n        border.style.left = stOff.left - parentOff.left - leftOffset + 'px';\n        border.style.width = endOff.right - stOff.left + leftOffset + 1 + 'px';\n      }\n\n      border.style.top = stOff.top - parentOff.top - topOffSet + 'px';\n      border.style.height = endOff.top - stOff.top > 0 ? endOff.top - parentOff.top + endOff.height + 1 - (stOff.top - parentOff.top) - rowHeight + topOffSet + 'px' : endOff.height + topOffSet - rowHeight + 1 + 'px';\n      this.selectDirection += bdrStr;\n    } else {\n      border.style.display = 'none';\n    }\n  };\n\n  Selection.prototype.positionBorders = function () {\n    this.updateStartEndCells();\n\n    if (!this.startCell || !this.bdrElement || !this.selectedRowCellIndexes.length) {\n      return;\n    }\n\n    this.selectDirection = '';\n    this.showHideBorders('');\n    this.setBorders(this.parent.getContentTable(), this.bdrElement, '1');\n\n    if (this.parent.getFrozenColumns()) {\n      this.setBorders(this.parent.contentModule.getMovableContent(), this.mcBdrElement, '2');\n    }\n\n    if (this.parent.frozenRows) {\n      this.setBorders(this.parent.getHeaderTable(), this.fhBdrElement, '3');\n\n      if (this.parent.getFrozenColumns()) {\n        this.setBorders(this.parent.headerModule.getMovableHeader(), this.mhBdrElement, '4');\n      }\n    }\n\n    this.applyBorders(this.selectDirection);\n  };\n\n  Selection.prototype.applyBorders = function (str) {\n    var rtl = this.parent.enableRtl;\n\n    switch (str.length) {\n      case 4:\n        {\n          this.bdrElement.style.borderWidth = rtl ? '0 2px 2px 0' : '0 0 2px 2px';\n          this.mcBdrElement.style.borderWidth = rtl ? '0 0 2px 2px' : '0 2px 2px 0';\n          this.fhBdrElement.style.borderWidth = rtl ? '2px 2px 0 0' : '2px 0 0 2px';\n          this.mhBdrElement.style.borderWidth = rtl ? '2px 0 0 2px' : '2px 2px 0 0';\n        }\n        break;\n\n      case 2:\n        {\n          this.bdrElement.style.borderWidth = str.includes('2') ? rtl ? '2px 2px 2px 0' : '2px 0 2px 2px' : '0 2px 2px 2px';\n\n          if (this.parent.getFrozenColumns()) {\n            this.mcBdrElement.style.borderWidth = str.includes('1') ? rtl ? '2px 0 2px 2px' : '2px 2px 2px 0' : '0 2px 2px 2px';\n          }\n\n          if (this.parent.frozenRows) {\n            this.fhBdrElement.style.borderWidth = str.includes('1') ? '2px 2px 0 2px' : rtl ? '2px 2px 2px 0' : '2px 0 2px 2px';\n\n            if (this.parent.getFrozenColumns()) {\n              this.mhBdrElement.style.borderWidth = str.includes('2') ? '2px 2px 0 2px' : rtl ? '2px 0 2px 2px' : '2px 2px 2px 0';\n            }\n          }\n        }\n        break;\n\n      default:\n        this.bdrElement.style.borderWidth = '2px';\n\n        if (this.parent.getFrozenColumns()) {\n          this.mcBdrElement.style.borderWidth = '2px';\n        }\n\n        if (this.parent.frozenRows) {\n          this.fhBdrElement.style.borderWidth = '2px';\n\n          if (this.parent.getFrozenColumns()) {\n            this.mhBdrElement.style.borderWidth = '2px';\n          }\n        }\n\n        break;\n    }\n  };\n\n  Selection.prototype.createBorders = function () {\n    if (!this.bdrElement) {\n      this.bdrElement = this.parent.getContentTable().parentElement.appendChild(createElement('div', {\n        className: 'e-xlsel',\n        id: this.parent.element.id + '_bdr',\n        styles: 'width: 2px; border-width: 0;'\n      }));\n\n      if (this.parent.getFrozenColumns()) {\n        this.mcBdrElement = this.parent.contentModule.getMovableContent().appendChild(createElement('div', {\n          className: 'e-xlsel',\n          id: this.parent.element.id + '_mcbdr',\n          styles: 'height: 2px; border-width: 0;'\n        }));\n      }\n\n      if (this.parent.frozenRows) {\n        this.fhBdrElement = this.parent.getHeaderTable().parentElement.appendChild(createElement('div', {\n          className: 'e-xlsel',\n          id: this.parent.element.id + '_fhbdr',\n          styles: 'height: 2px;'\n        }));\n      }\n\n      if (this.parent.frozenRows && this.parent.getFrozenColumns()) {\n        this.mhBdrElement = this.parent.headerModule.getMovableHeader().appendChild(createElement('div', {\n          className: 'e-xlsel',\n          id: this.parent.element.id + '_mhbdr',\n          styles: 'height: 2px;'\n        }));\n      }\n    }\n  };\n\n  Selection.prototype.showHideBorders = function (display) {\n    if (this.bdrElement) {\n      this.bdrElement.style.display = display;\n\n      if (this.parent.getFrozenColumns()) {\n        this.mcBdrElement.style.display = display;\n      }\n\n      if (this.parent.frozenRows) {\n        this.fhBdrElement.style.display = display;\n      }\n\n      if (this.parent.frozenRows && this.parent.getFrozenColumns()) {\n        this.mhBdrElement.style.display = display;\n      }\n    }\n  };\n\n  Selection.prototype.drawAFBorders = function () {\n    if (!this.bdrAFBottom) {\n      this.createAFBorders();\n    }\n\n    this.positionAFBorders();\n  };\n\n  Selection.prototype.positionAFBorders = function () {\n    if (!this.startCell || !this.bdrAFLeft) {\n      return;\n    }\n\n    var stOff = this.startAFCell.getBoundingClientRect();\n    var endOff = this.endAFCell.getBoundingClientRect();\n    var top = endOff.top - stOff.top > 0 ? 1 : 0;\n    var firstCellTop = endOff.top - stOff.top >= 0 && (parentsUntil(this.startAFCell, 'e-movablecontent') || parentsUntil(this.startAFCell, 'e-frozencontent')) && this.isFirstRow(this.startAFCell) ? 1.5 : 0;\n    var firstCellLeft = (parentsUntil(this.startAFCell, 'e-movablecontent') || parentsUntil(this.startAFCell, 'e-movableheader')) && this.isFirstCell(this.startAFCell) ? 1 : 0;\n    var rowHeight = this.isLastRow(this.endAFCell) && (parentsUntil(this.endAFCell, 'e-movablecontent') || parentsUntil(this.endAFCell, 'e-frozencontent')) ? 2 : 0;\n    var parentOff = this.startAFCell.offsetParent.getBoundingClientRect();\n    var parentRect = this.parent.element.getBoundingClientRect();\n    var sTop = this.startAFCell.offsetParent.parentElement.scrollTop;\n    var sLeft = this.startAFCell.offsetParent.parentElement.scrollLeft;\n    var scrollTop = sTop - this.startAFCell.offsetTop;\n    var scrollLeft = sLeft - this.startAFCell.offsetLeft;\n    var totalHeight = this.parent.element.clientHeight;\n    var totalWidth = this.parent.element.clientWidth;\n    scrollTop = scrollTop > 0 ? Math.floor(scrollTop) - 1 : 0;\n    scrollLeft = scrollLeft > 0 ? scrollLeft : 0;\n    var left = stOff.left - parentRect.left;\n\n    if (!this.parent.enableRtl) {\n      this.bdrAFLeft.style.left = left - firstCellLeft + scrollLeft - 1 + 'px';\n      this.bdrAFRight.style.left = endOff.left - parentRect.left - 2 + endOff.width + 'px';\n      this.bdrAFRight.style.width = totalWidth <= parseInt(this.bdrAFRight.style.left, 10) ? '0px' : '2px';\n      this.bdrAFTop.style.left = left + scrollLeft - 0.5 + 'px';\n      this.bdrAFTop.style.width = parseInt(this.bdrAFRight.style.left, 10) - parseInt(this.bdrAFLeft.style.left, 10) - firstCellLeft + 1 + 'px';\n\n      if (totalWidth <= parseInt(this.bdrAFTop.style.width, 10) + parseInt(this.bdrAFTop.style.left, 10)) {\n        var leftRemove = parseInt(this.bdrAFTop.style.width, 10) + parseInt(this.bdrAFTop.style.left, 10) - totalWidth;\n        this.bdrAFTop.style.width = parseInt(this.bdrAFTop.style.width, 10) - leftRemove + 'px';\n      }\n    } else {\n      var scrolloffSet = parentsUntil(this.startAFCell, 'e-movablecontent') || parentsUntil(this.startAFCell, 'e-movableheader') ? stOff.right - this.startAFCell.offsetParent.parentElement.getBoundingClientRect().width - parentRect.left : 0;\n      this.bdrAFLeft.style.right = parentRect.right - endOff.right - 2 + endOff.width + 'px';\n      this.bdrAFLeft.style.width = totalWidth <= parseInt(this.bdrAFLeft.style.right, 10) ? '0px' : '2px';\n      this.bdrAFRight.style.right = parentRect.right - stOff.right - firstCellLeft + scrolloffSet - 1 + 'px';\n      this.bdrAFTop.style.left = endOff.left - parentRect.left - 0.5 + 'px';\n      this.bdrAFTop.style.width = parseInt(this.bdrAFLeft.style.right, 10) - parseInt(this.bdrAFRight.style.right, 10) - firstCellLeft + 1 + 'px';\n\n      if (parseInt(this.bdrAFTop.style.left, 10) < 0) {\n        this.bdrAFTop.style.width = parseInt(this.bdrAFTop.style.width, 10) + parseInt(this.bdrAFTop.style.left, 10) + 'px';\n        this.bdrAFTop.style.left = '0px';\n      }\n    }\n\n    this.bdrAFLeft.style.top = stOff.top - parentRect.top - firstCellTop + scrollTop + 'px';\n    this.bdrAFLeft.style.height = endOff.top - stOff.top > 0 ? endOff.top - parentOff.top + endOff.height + 1 - (stOff.top - parentOff.top) + firstCellTop - rowHeight - scrollTop + 'px' : endOff.height + firstCellTop - rowHeight - scrollTop + 'px';\n    this.bdrAFRight.style.top = this.bdrAFLeft.style.top;\n    this.bdrAFRight.style.height = parseInt(this.bdrAFLeft.style.height, 10) + 'px';\n    this.bdrAFTop.style.top = this.bdrAFRight.style.top;\n    this.bdrAFBottom.style.left = this.bdrAFTop.style.left;\n    this.bdrAFBottom.style.top = parseFloat(this.bdrAFLeft.style.top) + parseFloat(this.bdrAFLeft.style.height) - top - 1 + 'px';\n    this.bdrAFBottom.style.width = totalHeight <= parseFloat(this.bdrAFBottom.style.top) ? '0px' : this.bdrAFTop.style.width;\n\n    if (totalHeight <= parseInt(this.bdrAFLeft.style.height, 10) + parseInt(this.bdrAFLeft.style.top, 10)) {\n      var topRemove = parseInt(this.bdrAFLeft.style.height, 10) + parseInt(this.bdrAFLeft.style.top, 10) - totalHeight;\n      this.bdrAFLeft.style.height = parseInt(this.bdrAFLeft.style.height, 10) - topRemove + 'px';\n      this.bdrAFRight.style.height = parseInt(this.bdrAFLeft.style.height, 10) + 'px';\n    }\n  };\n\n  Selection.prototype.createAFBorders = function () {\n    if (!this.bdrAFLeft) {\n      this.bdrAFLeft = this.parent.element.appendChild(createElement('div', {\n        className: 'e-xlselaf',\n        id: this.parent.element.id + '_bdrafleft',\n        styles: 'width: 2px;'\n      }));\n      this.bdrAFRight = this.parent.element.appendChild(createElement('div', {\n        className: 'e-xlselaf',\n        id: this.parent.element.id + '_bdrafright',\n        styles: 'width: 2px;'\n      }));\n      this.bdrAFBottom = this.parent.element.appendChild(createElement('div', {\n        className: 'e-xlselaf',\n        id: this.parent.element.id + '_bdrafbottom',\n        styles: 'height: 2px;'\n      }));\n      this.bdrAFTop = this.parent.element.appendChild(createElement('div', {\n        className: 'e-xlselaf',\n        id: this.parent.element.id + '_bdraftop',\n        styles: 'height: 2px;'\n      }));\n    }\n  };\n\n  Selection.prototype.showAFBorders = function () {\n    if (this.bdrAFLeft) {\n      this.bdrAFLeft.style.display = '';\n      this.bdrAFRight.style.display = '';\n      this.bdrAFBottom.style.display = '';\n      this.bdrAFTop.style.display = '';\n    }\n  };\n\n  Selection.prototype.hideAFBorders = function () {\n    if (this.bdrAFLeft) {\n      this.bdrAFLeft.style.display = 'none';\n      this.bdrAFRight.style.display = 'none';\n      this.bdrAFBottom.style.display = 'none';\n      this.bdrAFTop.style.display = 'none';\n    }\n  };\n\n  Selection.prototype.updateValue = function (rIdx, cIdx, cell) {\n    var args = this.createBeforeAutoFill(rIdx, cIdx, cell);\n\n    if (!args.cancel) {\n      var col = this.parent.getColumnByIndex(cIdx);\n\n      if (this.parent.editModule && cell) {\n        if (col.type === 'number') {\n          this.parent.editModule.updateCell(rIdx, col.field, parseInt(args.value, 10));\n        } else {\n          this.parent.editModule.updateCell(rIdx, col.field, args.value);\n        }\n      }\n    }\n  };\n\n  Selection.prototype.createBeforeAutoFill = function (rowIndex, colIndex, cell) {\n    var col = this.parent.getColumnByIndex(colIndex);\n    var args = {\n      column: col,\n      value: cell.innerText\n    };\n    this.parent.trigger(events.beforeAutoFill, args);\n    return args;\n  };\n\n  Selection.prototype.getAutoFillCells = function (rowIndex, startCellIdx) {\n    var cells = [].slice.call(this.parent.getDataRows()[rowIndex].querySelectorAll('.e-cellselectionbackground'));\n\n    if (this.parent.getFrozenColumns()) {\n      cells = cells.concat([].slice.call(this.parent.getMovableDataRows()[rowIndex].querySelectorAll('.e-cellselectionbackground')));\n    }\n\n    return cells;\n  };\n  /* tslint:disable-next-line:max-func-body-length */\n\n\n  Selection.prototype.selectLikeAutoFill = function (e, isApply) {\n    var startrowIdx = parseInt(parentsUntil(this.startAFCell, 'e-row').getAttribute('aria-rowindex'), 10);\n    var startCellIdx = parseInt(this.startAFCell.getAttribute('aria-colindex'), 10);\n    var endrowIdx = parseInt(parentsUntil(this.endAFCell, 'e-row').getAttribute('aria-rowindex'), 10);\n    var endCellIdx = parseInt(this.endAFCell.getAttribute('aria-colindex'), 10);\n    var rowLen = this.selectedRowCellIndexes.length - 1;\n    var colLen = this.selectedRowCellIndexes[0].cellIndexes.length - 1;\n    var col;\n\n    switch (true) {\n      //direction         \n      case !isApply && this.endAFCell.classList.contains('e-cellselectionbackground') && !!parentsUntil(e.target, 'e-rowcell'):\n        this.startAFCell = this.parent.getCellFromIndex(startrowIdx, startCellIdx);\n        this.endAFCell = this.parent.getCellFromIndex(startrowIdx + rowLen, startCellIdx + colLen);\n        this.drawAFBorders();\n        break;\n\n      case this.autoFillRLselection && startCellIdx + colLen < endCellIdx && //right\n      endCellIdx - startCellIdx - colLen + 1 > endrowIdx - startrowIdx - rowLen // right bottom\n      && endCellIdx - startCellIdx - colLen + 1 > startrowIdx - endrowIdx:\n        //right top\n        this.endAFCell = this.parent.getCellFromIndex(startrowIdx + rowLen, endCellIdx);\n        endrowIdx = parseInt(parentsUntil(this.endAFCell, 'e-row').getAttribute('aria-rowindex'), 10);\n        endCellIdx = parseInt(this.endAFCell.getAttribute('aria-colindex'), 10);\n\n        if (!isApply) {\n          this.drawAFBorders();\n        } else {\n          var cellIdx = parseInt(this.endCell.getAttribute('aria-colindex'), 10);\n\n          for (var i = startrowIdx; i <= endrowIdx; i++) {\n            var cells = this.getAutoFillCells(i, startCellIdx);\n            var c = 0;\n\n            for (var j = cellIdx + 1; j <= endCellIdx; j++) {\n              if (c > colLen) {\n                c = 0;\n              }\n\n              this.updateValue(i, j, cells[c]);\n              c++;\n            }\n          }\n\n          this.selectCellsByRange({\n            rowIndex: startrowIdx,\n            cellIndex: this.startCellIndex\n          }, {\n            rowIndex: endrowIdx,\n            cellIndex: endCellIdx\n          });\n        }\n\n        break;\n\n      case this.autoFillRLselection && startCellIdx > endCellIdx && // left\n      startCellIdx - endCellIdx + 1 > endrowIdx - startrowIdx - rowLen && //left top\n      startCellIdx - endCellIdx + 1 > startrowIdx - endrowIdx:\n        // left bottom\n        this.startAFCell = this.parent.getCellFromIndex(startrowIdx, endCellIdx);\n        this.endAFCell = this.endCell;\n\n        if (!isApply) {\n          this.drawAFBorders();\n        } else {\n          for (var i = startrowIdx; i <= startrowIdx + rowLen; i++) {\n            var cells = this.getAutoFillCells(i, startCellIdx);\n            cells.reverse();\n            var c = 0;\n\n            for (var j = this.startCellIndex - 1; j >= endCellIdx; j--) {\n              if (c > colLen) {\n                c = 0;\n              }\n\n              this.updateValue(i, j, cells[c]);\n              c++;\n            }\n          }\n\n          this.selectCellsByRange({\n            rowIndex: startrowIdx,\n            cellIndex: endCellIdx\n          }, {\n            rowIndex: startrowIdx + rowLen,\n            cellIndex: this.startCellIndex + colLen\n          });\n        }\n\n        break;\n\n      case startrowIdx > endrowIdx:\n        //up\n        this.startAFCell = this.parent.getCellFromIndex(endrowIdx, startCellIdx);\n        this.endAFCell = this.endCell;\n\n        if (!isApply) {\n          this.drawAFBorders();\n        } else {\n          var trIdx = parseInt(this.endCell.parentElement.getAttribute('aria-rowindex'), 10);\n          var r = trIdx;\n\n          for (var i = startrowIdx - 1; i >= endrowIdx; i--) {\n            if (r === this.startIndex - 1) {\n              r = trIdx;\n            }\n\n            var cells = this.getAutoFillCells(r, startCellIdx);\n            var c = 0;\n            r--;\n\n            for (var j = this.startCellIndex; j <= this.startCellIndex + colLen; j++) {\n              this.updateValue(i, j, cells[c]);\n              c++;\n            }\n          }\n\n          this.selectCellsByRange({\n            rowIndex: endrowIdx,\n            cellIndex: startCellIdx + colLen\n          }, {\n            rowIndex: startrowIdx + rowLen,\n            cellIndex: startCellIdx\n          });\n        }\n\n        break;\n\n      default:\n        //down\n        this.endAFCell = this.parent.getCellFromIndex(endrowIdx, startCellIdx + colLen);\n\n        if (!isApply) {\n          this.drawAFBorders();\n        } else {\n          var trIdx = parseInt(this.endCell.parentElement.getAttribute('aria-rowindex'), 10);\n          var r = this.startIndex;\n\n          for (var i = trIdx + 1; i <= endrowIdx; i++) {\n            if (r === trIdx + 1) {\n              r = this.startIndex;\n            }\n\n            var cells = this.getAutoFillCells(r, startCellIdx);\n            r++;\n            var c = 0;\n\n            for (var m = this.startCellIndex; m <= this.startCellIndex + colLen; m++) {\n              this.updateValue(i, m, cells[c]);\n              c++;\n            }\n          }\n\n          this.selectCellsByRange({\n            rowIndex: trIdx - rowLen,\n            cellIndex: startCellIdx\n          }, {\n            rowIndex: endrowIdx,\n            cellIndex: startCellIdx + colLen\n          });\n        }\n\n        break;\n    }\n  };\n\n  Selection.prototype.mouseUpHandler = function (e) {\n    document.body.classList.remove('e-disableuserselect');\n\n    if (this.element) {\n      remove(this.element);\n    }\n\n    if (this.isDragged && this.selectedRowCellIndexes.length === 1 && this.selectedRowCellIndexes[0].cellIndexes.length === 1) {\n      this.mUPTarget = parentsUntil(e.target, 'e-rowcell');\n    } else {\n      this.mUPTarget = null;\n    }\n\n    if (this.isDragged && !this.isAutoFillSel && this.selectionSettings.mode === 'Cell') {\n      var target = e.target;\n      var rowIndex = parseInt(target.parentElement.getAttribute('aria-rowindex'), 10);\n      var cellIndex = parseInt(target.getAttribute('aria-colindex'), 10);\n      this.isDragged = false;\n      this.clearCellSelection();\n      this.selectCellsByRange({\n        rowIndex: this.startDIndex,\n        cellIndex: this.startDCellIndex\n      }, {\n        rowIndex: rowIndex,\n        cellIndex: cellIndex\n      });\n    }\n\n    this.isDragged = false;\n    this.updateAutoFillPosition();\n\n    if (this.isAutoFillSel) {\n      var lastCell = parentsUntil(e.target, 'e-rowcell');\n      this.endAFCell = lastCell ? lastCell : this.endCell === this.endAFCell ? this.startAFCell : this.endAFCell;\n      this.startAFCell = this.startCell;\n      this.updateStartCellsIndex();\n      this.selectLikeAutoFill(e, true);\n      this.updateAutoFillPosition();\n      this.hideAFBorders();\n      this.positionBorders();\n      this.isAutoFillSel = false;\n    }\n\n    EventHandler.remove(this.parent.getContent(), 'mousemove', this.mouseMoveHandler);\n\n    if (this.parent.frozenRows) {\n      EventHandler.remove(this.parent.getHeaderContent(), 'mousemove', this.mouseMoveHandler);\n    }\n\n    EventHandler.remove(document.body, 'mouseup', this.mouseUpHandler);\n  };\n\n  Selection.prototype.hideAutoFill = function () {\n    if (this.autofill) {\n      this.autofill.style.display = 'none';\n    }\n  };\n  /**\n   * @hidden\n   */\n\n\n  Selection.prototype.updateAutoFillPosition = function () {\n    if (this.parent.enableAutoFill && !this.parent.isEdit && this.selectionSettings.cellSelectionMode.indexOf('Box') > -1 && !this.isRowType() && !this.isSingleSel() && this.selectedRowCellIndexes.length) {\n      var frzCols = this.parent.getFrozenColumns();\n      var index = parseInt(this.target.getAttribute('aria-colindex'), 10);\n      var rindex = parseInt(this.target.getAttribute('index'), 10);\n      var rowIndex = this.selectedRowCellIndexes[this.selectedRowCellIndexes.length - 1].rowIndex;\n      var cells = this.getAutoFillCells(rowIndex, index).filter(function (ele) {\n        return ele.style.display === '';\n      });\n      var isFrozenCol = void 0;\n      var isFrozenRow = void 0;\n\n      if (frzCols && index >= frzCols) {\n        isFrozenCol = true;\n      }\n\n      if (rindex < this.parent.frozenRows) {\n        isFrozenRow = true;\n      }\n\n      if (!parentsUntil(this.target, 'e-table').querySelector('#' + this.parent.element.id + '_autofill')) {\n        if (this.parent.element.querySelector('#' + this.parent.element.id + '_autofill')) {\n          this.parent.element.querySelector('#' + this.parent.element.id + '_autofill').remove();\n        }\n\n        this.autofill = createElement('div', {\n          className: 'e-autofill',\n          id: this.parent.element.id + '_autofill'\n        });\n        this.autofill.style.display = 'none';\n        !isFrozenRow ? !isFrozenCol ? this.parent.getContentTable().parentElement.appendChild(this.autofill) : this.parent.contentModule.getMovableContent().appendChild(this.autofill) : !isFrozenCol ? this.parent.getHeaderTable().parentElement.appendChild(this.autofill) : this.parent.headerModule.getMovableHeader().appendChild(this.autofill);\n      }\n\n      var cell = cells[cells.length - 1];\n\n      if (cell && cell.offsetParent) {\n        var clientRect = cell.getBoundingClientRect();\n        var parentOff = cell.offsetParent.getBoundingClientRect();\n        var colWidth = this.isLastCell(cell) ? 4 : 0;\n        var rowHeight = this.isLastRow(cell) ? 3 : 0;\n\n        if (!this.parent.enableRtl) {\n          this.autofill.style.left = clientRect.left - parentOff.left + clientRect.width - 4 - colWidth + 'px';\n        } else {\n          this.autofill.style.right = parentOff.right - clientRect.right + clientRect.width - 4 - colWidth + 'px';\n        }\n\n        this.autofill.style.top = clientRect.top - parentOff.top + clientRect.height - 5 - rowHeight + 'px';\n      }\n\n      this.autofill.style.display = '';\n    } else {\n      this.hideAutoFill();\n    }\n  };\n\n  Selection.prototype.mouseDownHandler = function (e) {\n    this.mouseButton = e.button;\n    var target = e.target;\n    var gObj = this.parent;\n    var isDrag;\n    var gridElement = parentsUntil(target, 'e-grid');\n\n    if (gridElement && gridElement.id !== gObj.element.id || parentsUntil(target, 'e-headercontent') && !this.parent.frozenRows || parentsUntil(target, 'e-editedbatchcell') || parentsUntil(target, 'e-editedrow')) {\n      return;\n    }\n\n    if (e.shiftKey || e.ctrlKey) {\n      e.preventDefault();\n    }\n\n    if (parentsUntil(target, 'e-rowcell') && !e.shiftKey && !e.ctrlKey) {\n      if (gObj.selectionSettings.cellSelectionMode.indexOf('Box') > -1 && !this.isRowType() && !this.isSingleSel()) {\n        this.isCellDrag = true;\n        isDrag = true;\n      } else if (gObj.allowRowDragAndDrop && !gObj.isEdit) {\n        if (!this.isRowType() || this.isSingleSel() || closest(target, 'td').classList.contains('e-selectionbackground')) {\n          this.isDragged = false;\n          return;\n        }\n\n        isDrag = true;\n        this.element = this.parent.createElement('div', {\n          className: 'e-griddragarea'\n        });\n        gObj.getContent().appendChild(this.element);\n      }\n\n      if (isDrag) {\n        this.enableDrag(e, true);\n      }\n    }\n\n    this.updateStartEndCells();\n\n    if (target.classList.contains('e-autofill') || target.classList.contains('e-xlsel')) {\n      this.isCellDrag = true;\n      this.isAutoFillSel = true;\n      this.enableDrag(e);\n    }\n  };\n\n  Selection.prototype.updateStartEndCells = function () {\n    var cells = [].slice.call(this.parent.element.querySelectorAll('.e-cellselectionbackground'));\n    this.startCell = cells[0];\n    this.endCell = cells[cells.length - 1];\n\n    if (this.startCell) {\n      this.startIndex = parseInt(this.startCell.parentElement.getAttribute('aria-rowindex'), 10);\n      this.startCellIndex = parseInt(parentsUntil(this.startCell, 'e-rowcell').getAttribute('aria-colindex'), 10);\n    }\n  };\n\n  Selection.prototype.updateStartCellsIndex = function () {\n    if (this.startCell) {\n      this.startIndex = parseInt(this.startCell.parentElement.getAttribute('aria-rowindex'), 10);\n      this.startCellIndex = parseInt(parentsUntil(this.startCell, 'e-rowcell').getAttribute('aria-colindex'), 10);\n    }\n  };\n\n  Selection.prototype.enableDrag = function (e, isUpdate) {\n    var gObj = this.parent;\n\n    if (isUpdate) {\n      var tr = closest(e.target, 'tr');\n      this.startDIndex = parseInt(tr.getAttribute('aria-rowindex'), 10);\n      this.startDCellIndex = parseInt(parentsUntil(e.target, 'e-rowcell').getAttribute('aria-colindex'), 10);\n    }\n\n    document.body.classList.add('e-disableuserselect');\n    var gBRect = gObj.element.getBoundingClientRect();\n    var postion = getPosition(e);\n    this.x = postion.x - gBRect.left;\n    this.y = postion.y - gBRect.top;\n    EventHandler.add(gObj.getContent(), 'mousemove', this.mouseMoveHandler, this);\n\n    if (this.parent.frozenRows) {\n      EventHandler.add(gObj.getHeaderContent(), 'mousemove', this.mouseMoveHandler, this);\n    }\n\n    EventHandler.add(document.body, 'mouseup', this.mouseUpHandler, this);\n  };\n\n  Selection.prototype.clearSelAfterRefresh = function (e) {\n    var isInfiniteScroll = this.parent.enableInfiniteScrolling && e.requestType === 'infiniteScroll';\n\n    if (e.requestType !== 'virtualscroll' && !this.parent.isPersistSelection && !isInfiniteScroll) {\n      this.clearSelection();\n    }\n  };\n  /**\n   * @hidden\n   */\n\n\n  Selection.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.uiUpdate, this.enableAfterRender, this);\n    this.parent.on(events.initialEnd, this.initializeSelection, this);\n    this.parent.on(events.rowSelectionComplete, this.onActionComplete, this);\n    this.parent.on(events.cellSelectionComplete, this.onActionComplete, this);\n    this.parent.on(events.inBoundModelChanged, this.onPropertyChanged, this);\n    this.parent.on(events.cellFocused, this.onCellFocused, this);\n    this.parent.on(events.beforeFragAppend, this.clearSelAfterRefresh, this);\n    this.parent.on(events.columnPositionChanged, this.columnPositionChanged, this);\n    this.parent.on(events.contentReady, this.initialEnd, this);\n    this.actionBeginFunction = this.actionBegin.bind(this);\n    this.actionCompleteFunction = this.actionComplete.bind(this);\n    this.parent.addEventListener(events.actionBegin, this.actionBeginFunction);\n    this.parent.addEventListener(events.actionComplete, this.actionCompleteFunction);\n    this.parent.on(events.rowsRemoved, this.rowsRemoved, this);\n    this.parent.on(events.headerRefreshed, this.refreshHeader, this);\n    this.addEventListener_checkbox();\n  };\n  /**\n   * @hidden\n   */\n\n\n  Selection.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.uiUpdate, this.enableAfterRender);\n    this.parent.off(events.initialEnd, this.initializeSelection);\n    this.parent.off(events.rowSelectionComplete, this.onActionComplete);\n    this.parent.off(events.cellSelectionComplete, this.onActionComplete);\n    this.parent.off(events.inBoundModelChanged, this.onPropertyChanged);\n    this.parent.off(events.cellFocused, this.onCellFocused);\n    this.parent.off(events.beforeFragAppend, this.clearSelAfterRefresh);\n    this.parent.off(events.columnPositionChanged, this.columnPositionChanged);\n    this.parent.removeEventListener(events.actionBegin, this.actionBeginFunction);\n    this.parent.removeEventListener(events.actionComplete, this.actionCompleteFunction);\n    this.parent.off(events.rowsRemoved, this.rowsRemoved);\n    this.parent.off(events.headerRefreshed, this.refreshHeader);\n    this.removeEventListener_checkbox();\n  };\n\n  Selection.prototype.wireEvents = function () {\n    this.isMacOS = navigator.userAgent.indexOf('Mac OS') !== -1;\n\n    if (this.isMacOS) {\n      EventHandler.add(this.parent.element, 'keydown', this.keyDownHandler, this);\n      EventHandler.add(this.parent.element, 'keyup', this.keyUpHandler, this);\n    }\n  };\n\n  Selection.prototype.unWireEvents = function () {\n    if (this.isMacOS) {\n      EventHandler.remove(this.parent.element, 'keydown', this.keyDownHandler);\n      EventHandler.remove(this.parent.element, 'keyup', this.keyUpHandler);\n    }\n  };\n\n  Selection.prototype.columnPositionChanged = function () {\n    if (!this.parent.isPersistSelection) {\n      this.clearSelection();\n    }\n  };\n\n  Selection.prototype.refreshHeader = function () {\n    this.setCheckAllState();\n  };\n\n  Selection.prototype.rowsRemoved = function (e) {\n    for (var i = 0; i < e.records.length; i++) {\n      delete this.selectedRowState[e.records[i][this.primaryKey]];\n      --this.totalRecordsCount;\n    }\n\n    this.setCheckAllState();\n  };\n\n  ;\n\n  Selection.prototype.beforeFragAppend = function (e) {\n    if (e.requestType !== 'virtualscroll' && !this.parent.isPersistSelection) {\n      this.clearSelection();\n    }\n  };\n\n  ;\n\n  Selection.prototype.getCheckAllBox = function () {\n    return this.parent.getHeaderContent().querySelector('.e-checkselectall');\n  };\n\n  Selection.prototype.enableAfterRender = function (e) {\n    if (e.module === this.getModuleName() && e.enable) {\n      this.render();\n      this.initPerisistSelection();\n    }\n  };\n\n  Selection.prototype.render = function (e) {\n    EventHandler.add(this.parent.getContent(), 'mousedown', this.mouseDownHandler, this);\n    EventHandler.add(this.parent.getHeaderContent(), 'mousedown', this.mouseDownHandler, this);\n  };\n\n  Selection.prototype.onPropertyChanged = function (e) {\n    if (e.module !== this.getModuleName()) {\n      return;\n    }\n\n    var gObj = this.parent;\n\n    if (!isNullOrUndefined(e.properties.type) && this.selectionSettings.type === 'Single') {\n      if (this.selectedRowCellIndexes.length > 1) {\n        this.clearCellSelection();\n        this.prevCIdxs = undefined;\n      }\n\n      if (this.selectedRowIndexes.length > 1) {\n        this.clearRowSelection();\n        this.prevRowIndex = undefined;\n      }\n\n      this.enableSelectMultiTouch = false;\n      this.hidePopUp();\n    }\n\n    if (!isNullOrUndefined(e.properties.mode) || !isNullOrUndefined(e.properties.cellSelectionMode)) {\n      this.clearSelection();\n      this.prevRowIndex = undefined;\n      this.prevCIdxs = undefined;\n    }\n\n    this.isPersisted = true;\n    this.checkBoxSelectionChanged();\n    this.isPersisted = false;\n    this.initPerisistSelection();\n    var checkboxColumn = this.parent.getColumns().filter(function (col) {\n      return col.type === 'checkbox';\n    });\n\n    if (checkboxColumn.length) {\n      gObj.isCheckBoxSelection = !(this.selectionSettings.checkboxMode === 'ResetOnRowClick');\n    }\n\n    this.drawBorders();\n  };\n\n  Selection.prototype.hidePopUp = function () {\n    if (this.parent.element.querySelector('.e-gridpopup').querySelectorAll('.e-rowselect').length) {\n      this.parent.element.querySelector('.e-gridpopup').style.display = 'none';\n    }\n  };\n\n  Selection.prototype.initialEnd = function () {\n    this.parent.off(events.contentReady, this.initialEnd);\n    this.selectRow(this.parent.selectedRowIndex);\n  };\n\n  Selection.prototype.checkBoxSelectionChanged = function () {\n    this.parent.off(events.contentReady, this.checkBoxSelectionChanged);\n    var gobj = this.parent;\n    var checkboxColumn = gobj.getColumns().filter(function (col) {\n      return col.type === 'checkbox';\n    });\n\n    if (checkboxColumn.length > 0) {\n      gobj.isCheckBoxSelection = true;\n      this.chkField = checkboxColumn[0].field;\n      this.totalRecordsCount = this.parent.pageSettings.totalRecordsCount;\n\n      if (isNullOrUndefined(this.totalRecordsCount)) {\n        this.totalRecordsCount = this.getCurrentBatchRecordChanges().length;\n      }\n\n      if (this.isSingleSel()) {\n        gobj.selectionSettings.type = 'Multiple';\n        gobj.dataBind();\n      } else {\n        this.initPerisistSelection();\n      }\n    }\n\n    if (!gobj.isCheckBoxSelection && !this.isPersisted) {\n      this.chkField = null;\n      this.initPerisistSelection();\n    }\n  };\n\n  Selection.prototype.initPerisistSelection = function () {\n    var gobj = this.parent;\n\n    if (this.parent.selectionSettings.persistSelection && this.parent.getPrimaryKeyFieldNames().length > 0) {\n      gobj.isPersistSelection = true;\n      this.ensureCheckboxFieldSelection();\n    } else if (this.parent.getPrimaryKeyFieldNames().length > 0) {\n      gobj.isPersistSelection = false;\n      this.ensureCheckboxFieldSelection();\n    } else {\n      gobj.isPersistSelection = false;\n      this.selectedRowState = {};\n    }\n  };\n\n  Selection.prototype.ensureCheckboxFieldSelection = function () {\n    var gobj = this.parent;\n    this.primaryKey = this.parent.getPrimaryKeyFieldNames()[0];\n\n    if (!gobj.enableVirtualization && this.chkField && (gobj.isPersistSelection && Object.keys(this.selectedRowState).length === 0 || !gobj.isPersistSelection)) {\n      var data = this.parent.getDataModule();\n      var query = new Query().where(this.chkField, 'equal', true);\n\n      if (!query.params) {\n        query.params = this.parent.query.params;\n      }\n\n      var dataManager = data.getData({}, query);\n      var proxy_1 = this;\n      this.parent.showSpinner();\n      dataManager.then(function (e) {\n        proxy_1.dataSuccess(e.result);\n        proxy_1.refreshPersistSelection();\n        proxy_1.parent.hideSpinner();\n      });\n    }\n  };\n\n  Selection.prototype.dataSuccess = function (res) {\n    for (var i = 0; i < res.length; i++) {\n      if (isNullOrUndefined(this.selectedRowState[res[i][this.primaryKey]]) && res[i][this.chkField]) {\n        this.selectedRowState[res[i][this.primaryKey]] = res[i][this.chkField];\n      }\n    }\n\n    this.persistSelectedData = res;\n  };\n\n  Selection.prototype.setRowSelection = function (state) {\n    if (!this.parent.getDataModule().isRemote() && !isBlazor()) {\n      if (state) {\n        if (this.parent.groupSettings.columns.length) {\n          for (var _i = 0, _a = this.getData().records; _i < _a.length; _i++) {\n            var data = _a[_i];\n            this.selectedRowState[data[this.primaryKey]] = true;\n          }\n        } else {\n          for (var _b = 0, _c = this.getData(); _b < _c.length; _b++) {\n            var data = _c[_b];\n            this.selectedRowState[data[this.primaryKey]] = true;\n          }\n        }\n      } else {\n        this.selectedRowState = {};\n      } // (this.getData()).forEach(function (data) {\n      //     this.selectedRowState[data[this.primaryKey]] = true;\n      // })\n\n    }\n  };\n\n  Selection.prototype.getData = function () {\n    return this.parent.getDataModule().dataManager.executeLocal(this.parent.getDataModule().generateQuery(true));\n  };\n\n  Selection.prototype.refreshPersistSelection = function () {\n    var rows = this.parent.getRows();\n\n    if (rows !== null && rows.length > 0 && (this.parent.isPersistSelection || this.chkField)) {\n      var indexes = [];\n\n      for (var j = 0; j < rows.length; j++) {\n        var rowObj = this.getRowObj(rows[j]);\n        var pKey = rowObj ? rowObj.data ? rowObj.data[this.primaryKey] : null : null;\n\n        if (pKey === null) {\n          return;\n        }\n\n        var checkState = void 0;\n        var chkBox = rows[j].querySelector('.e-checkselect');\n\n        if (this.selectedRowState[pKey] || this.parent.checkAllRows === 'Check' && this.chkAllCollec.indexOf(pKey) < 0 || this.parent.checkAllRows === 'Uncheck' && this.chkAllCollec.indexOf(pKey) > 0 || this.parent.checkAllRows === 'Intermediate' && !isNullOrUndefined(this.chkField) && rowObj.data[this.chkField]) {\n          indexes.push(parseInt(rows[j].getAttribute('aria-rowindex'), 10));\n          checkState = true;\n        } else {\n          checkState = false;\n\n          if (this.checkedTarget !== chkBox && this.parent.isCheckBoxSelection) {\n            removeAddCboxClasses(chkBox.nextElementSibling, checkState);\n          }\n        }\n\n        this.updatePersistCollection(rows[j], checkState);\n      }\n\n      this.isSingleSel() && indexes.length > 0 ? this.selectRow(indexes[0], true) : this.selectRows(indexes);\n    }\n\n    if (this.parent.isCheckBoxSelection && this.getCurrentBatchRecordChanges().length > 0) {\n      this.setCheckAllState();\n    }\n  };\n\n  Selection.prototype.actionBegin = function (e) {\n    if (e.requestType === 'save' && this.parent.isPersistSelection) {\n      var editChkBox = this.parent.element.querySelector('.e-edit-checkselect');\n\n      if (!isNullOrUndefined(editChkBox)) {\n        var row = closest(editChkBox, '.e-editedrow');\n\n        if (row) {\n          if (this.parent.editSettings.mode === 'Dialog') {\n            row = this.parent.element.querySelector('.e-dlgeditrow');\n          }\n\n          var rowObj = this.getRowObj(row);\n\n          if (!rowObj) {\n            return;\n          }\n\n          this.selectedRowState[rowObj.data[this.primaryKey]] = rowObj.isSelected = editChkBox.checked;\n        } else {\n          this.isCheckedOnAdd = editChkBox.checked;\n        }\n      }\n    }\n  };\n\n  Selection.prototype.actionComplete = function (e) {\n    if (e.requestType === 'save' && this.parent.isPersistSelection) {\n      if (e.action === 'add' && this.isCheckedOnAdd) {\n        var rowObj = this.parent.getRowObjectFromUID(this.parent.getRows()[e.selectedRow].getAttribute('data-uid'));\n        this.selectedRowState[rowObj.data[this.primaryKey]] = rowObj.isSelected = this.isCheckedOnAdd;\n      }\n\n      this.refreshPersistSelection();\n    }\n\n    if (e.requestType === 'delete' && this.parent.isPersistSelection) {\n      var records = [];\n\n      if (!isBlazor()) {\n        records = e.data;\n      } else {\n        records = this.getSelectedRecords();\n      }\n\n      var data = records.slice();\n\n      for (var i = 0; i < data.length; i++) {\n        if (!isNullOrUndefined(data[i][this.primaryKey])) {\n          this.updatePersistDelete(data[i][this.primaryKey]);\n        }\n      }\n\n      this.setCheckAllState();\n      this.totalRecordsCount = this.parent.pageSettings.totalRecordsCount;\n    }\n\n    if (e.requestType === 'paging') {\n      this.prevRowIndex = undefined;\n      this.prevCIdxs = undefined;\n      this.prevECIdxs = undefined;\n    }\n  };\n\n  Selection.prototype.onDataBound = function () {\n    if (!this.parent.enableVirtualization && this.parent.isPersistSelection) {\n      this.refreshPersistSelection();\n    }\n\n    if (this.parent.enableVirtualization) {\n      this.setCheckAllState();\n    }\n\n    if (this.parent.isCheckBoxSelection && !this.initialRowSelection) {\n      var totalRecords = this.parent.getRowsObject();\n      var indexes = [];\n\n      for (var i = 0; i < totalRecords.length; i++) {\n        if (totalRecords[i].isSelected) {\n          indexes.push(i);\n        }\n      }\n\n      if (indexes.length) {\n        this.selectRows(indexes);\n      }\n\n      this.initialRowSelection = true;\n    }\n  };\n\n  Selection.prototype.updatePersistSelectedData = function (checkState) {\n    if (this.parent.isPersistSelection) {\n      var rows = this.parent.getRows();\n\n      for (var i = 0; i < rows.length; i++) {\n        this.updatePersistCollection(rows[i], checkState);\n      }\n\n      if (this.parent.checkAllRows === 'Uncheck') {\n        this.setRowSelection(false);\n        this.persistSelectedData = this.parent.getDataModule().isRemote() ? this.persistSelectedData : [];\n      } else if (this.parent.checkAllRows === 'Check') {\n        this.setRowSelection(true);\n        this.persistSelectedData = !this.parent.getDataModule().isRemote() && !isBlazor() ? this.parent.groupSettings.columns.length ? this.getData().records.slice() : this.getData().slice() : this.persistSelectedData;\n      }\n    }\n  };\n\n  Selection.prototype.checkSelectAllAction = function (checkState) {\n    var cRenderer = this.getRenderer();\n    var editForm = this.parent.element.querySelector('.e-gridform');\n    this.checkedTarget = this.getCheckAllBox();\n\n    if (checkState && this.getCurrentBatchRecordChanges().length) {\n      this.parent.checkAllRows = 'Check';\n      this.updatePersistSelectedData(checkState);\n\n      if (isBlazor() && this.parent.enableVirtualization && !isNullOrUndefined(this.parent.contentModule.currentInfo.endIndex)) {\n        this.selectRowsByRange(this.parent.contentModule.currentInfo.startIndex, this.parent.contentModule.currentInfo.endIndex);\n      } else {\n        this.selectRowsByRange(cRenderer.getVirtualRowIndex(0), cRenderer.getVirtualRowIndex(this.getCurrentBatchRecordChanges().length - 1));\n      }\n    } else {\n      this.parent.checkAllRows = 'Uncheck';\n      this.updatePersistSelectedData(checkState);\n      this.clearSelection();\n    }\n\n    this.chkAllCollec = [];\n\n    if (!isNullOrUndefined(editForm)) {\n      var editChkBox = editForm.querySelector('.e-edit-checkselect');\n\n      if (!isNullOrUndefined(editChkBox)) {\n        removeAddCboxClasses(editChkBox.nextElementSibling, checkState);\n      }\n    }\n  };\n\n  Selection.prototype.checkSelectAll = function (checkBox) {\n    var _this = this;\n\n    var stateStr = this.getCheckAllStatus(checkBox);\n    var state = stateStr === 'Check';\n    this.isHeaderCheckboxClicked = true;\n\n    if (stateStr === 'Intermediate') {\n      state = this.getCurrentBatchRecordChanges().some(function (data) {\n        return data[_this.primaryKey] in _this.selectedRowState;\n      });\n    }\n\n    if (this.parent.isPersistSelection && this.parent.allowPaging) {\n      this.totalRecordsCount = this.parent.pageSettings.totalRecordsCount;\n    }\n\n    this.checkSelectAllAction(!state);\n\n    if (isBlazor() && this.parent.isServerRendered && this.parent.enableVirtualization) {\n      var interopAdaptor = 'interopAdaptor';\n      var invokeMethodAsync = 'invokeMethodAsync';\n      this.parent[interopAdaptor][invokeMethodAsync]('MaintainSelection', !state, 'checkbox', null);\n      this.checkBoxState = !state;\n\n      if (!state) {\n        var values = 'values';\n        var vgenerator = 'vgenerator';\n        var rowCache = this.parent.contentModule[vgenerator].rowCache;\n        Object[values](rowCache).forEach(function (x) {\n          return x.isSelected = true;\n        });\n\n        for (var i = 0; i < Object.keys(rowCache).length; i++) {\n          if (this.parent.selectionModule.selectedRowIndexes.indexOf(Number(Object.keys(rowCache)[i])) === -1) {\n            this.parent.selectionModule.selectedRowIndexes.push(Number(Object.keys(rowCache)[i]));\n          }\n        }\n      }\n    }\n\n    this.target = null;\n\n    if (this.getCurrentBatchRecordChanges().length > 0) {\n      this.setCheckAllState();\n    }\n\n    this.triggerChkChangeEvent(checkBox, !state);\n  };\n\n  Selection.prototype.getCheckAllStatus = function (ele) {\n    var classes = ele ? ele.nextElementSibling.classList : this.getCheckAllBox().nextElementSibling.classList;\n    var status;\n\n    if (classes.contains('e-check')) {\n      status = 'Check';\n    } else if (classes.contains('e-uncheck')) {\n      status = 'Uncheck';\n    } else if (classes.contains('e-stop')) {\n      status = 'Intermediate';\n    } else {\n      status = 'None';\n    }\n\n    return status;\n  };\n\n  Selection.prototype.checkSelect = function (checkBox) {\n    var target = closest(this.checkedTarget, '.e-rowcell');\n    var checkObj = checkBox;\n    var gObj = this.parent;\n    this.isMultiCtrlRequest = true;\n    var rIndex = 0;\n    this.isHeaderCheckboxClicked = false;\n\n    if (isGroupAdaptive(gObj)) {\n      var uid = target.parentElement.getAttribute('data-uid');\n      rIndex = gObj.getRows().map(function (m) {\n        return m.getAttribute('data-uid');\n      }).indexOf(uid);\n    } else {\n      rIndex = parseInt(target.parentElement.getAttribute('aria-rowindex'), 10);\n    }\n\n    if (this.parent.isPersistSelection && this.parent.element.querySelectorAll('.e-addedrow').length > 0 && this.parent.editSettings.newRowPosition === 'Top') {\n      ++rIndex;\n    }\n\n    this.rowCellSelectionHandler(rIndex, parseInt(target.getAttribute('aria-colindex'), 10));\n    this.moveIntoUncheckCollection(closest(target, '.e-row'));\n    this.setCheckAllState();\n    this.isMultiCtrlRequest = false;\n    this.triggerChkChangeEvent(checkBox, checkBox.nextElementSibling.classList.contains('e-check'));\n  };\n\n  Selection.prototype.moveIntoUncheckCollection = function (row) {\n    if (this.parent.checkAllRows === 'Check' || this.parent.checkAllRows === 'Uncheck') {\n      var rowObj = this.getRowObj(row);\n      var pKey = rowObj && rowObj.data ? rowObj.data[this.primaryKey] : null;\n\n      if (!pKey) {\n        return;\n      }\n\n      if (this.chkAllCollec.indexOf(pKey) < 0) {\n        this.chkAllCollec.push(pKey);\n      } else {\n        this.chkAllCollec.splice(this.chkAllCollec.indexOf(pKey), 1);\n      }\n    }\n  };\n\n  Selection.prototype.triggerChkChangeEvent = function (checkBox, checkState) {\n    this.parent.trigger(events.checkBoxChange, {\n      checked: checkState,\n      selectedRowIndexes: this.parent.getSelectedRowIndexes(),\n      target: checkBox\n    });\n\n    if (!this.parent.isEdit) {\n      this.checkedTarget = null;\n    }\n  };\n\n  Selection.prototype.updateSelectedRowIndex = function (index) {\n    if (this.parent.isCheckBoxSelection && (this.parent.enableVirtualization || this.parent.enableInfiniteScrolling) && !this.parent.getDataModule().isRemote() && !(isBlazor() && this.parent.isServerRendered)) {\n      if (this.parent.checkAllRows === 'Check') {\n        this.selectedRowIndexes = [];\n        var dataLength = this.getData().length;\n\n        for (var data = 0; data < dataLength; data++) {\n          this.selectedRowIndexes.push(data);\n        }\n      } else if (this.parent.checkAllRows === 'Uncheck') {\n        this.selectedRowIndexes = [];\n      } else {\n        if (index && this.parent.getRowByIndex(index).getAttribute('aria-selected') === 'false') {\n          var selectedVal = this.selectedRowIndexes.indexOf(index);\n          this.selectedRowIndexes.splice(selectedVal, 1);\n        }\n      }\n    }\n  };\n\n  ;\n\n  Selection.prototype.setCheckAllState = function (index, isInteraction) {\n    if (this.parent.isCheckBoxSelection || this.parent.selectionSettings.checkboxMode === 'ResetOnRowClick') {\n      var checkToSelectAll = void 0;\n      var isServerRenderedVirtualization = isBlazor() && this.parent.isServerRendered && this.parent.enableVirtualization;\n\n      if (isServerRenderedVirtualization) {\n        var values = 'values';\n        var vgenerator = 'vgenerator';\n        checkToSelectAll = !Object[values](this.parent.contentModule[vgenerator].rowCache).filter(function (x) {\n          return x.isSelected === undefined || x.isSelected === false;\n        }).length && Object[values](this.parent.contentModule[vgenerator].rowCache).filter(function (x) {\n          return x.isSelected;\n        }).length === this.selectedRowIndexes.length;\n      }\n\n      var checkedLen = Object.keys(this.selectedRowState).length;\n\n      if (!this.parent.isPersistSelection && !isServerRenderedVirtualization) {\n        checkedLen = this.selectedRowIndexes.length;\n        this.totalRecordsCount = this.getCurrentBatchRecordChanges().length;\n      }\n\n      var input = this.getCheckAllBox();\n\n      if (input) {\n        var spanEle = input.nextElementSibling;\n        removeClass([spanEle], ['e-check', 'e-stop', 'e-uncheck']);\n        setChecked(input, false);\n        input.indeterminate = false;\n\n        if (checkToSelectAll || checkedLen === this.totalRecordsCount && this.totalRecordsCount || (this.parent.enableVirtualization || this.parent.enableInfiniteScrolling) && !this.parent.allowPaging && !this.parent.getDataModule().isRemote() && !(isBlazor() && this.parent.isServerRendered) && checkedLen === this.getData().length) {\n          addClass([spanEle], ['e-check']);\n          setChecked(input, true);\n\n          if (isInteraction) {\n            this.getRenderer().setSelection(null, true, true);\n          }\n\n          this.parent.checkAllRows = 'Check';\n        } else if (isServerRenderedVirtualization && !this.selectedRowIndexes.length || checkedLen === 0 && !isServerRenderedVirtualization || this.getCurrentBatchRecordChanges().length === 0) {\n          addClass([spanEle], ['e-uncheck']);\n\n          if (isInteraction) {\n            this.getRenderer().setSelection(null, false, true);\n          }\n\n          this.parent.checkAllRows = 'Uncheck';\n\n          if (checkedLen === 0 && this.getCurrentBatchRecordChanges().length === 0) {\n            addClass([spanEle.parentElement], ['e-checkbox-disabled']);\n          } else {\n            removeClass([spanEle.parentElement], ['e-checkbox-disabled']);\n          }\n        } else {\n          addClass([spanEle], ['e-stop']);\n          this.parent.checkAllRows = 'Intermediate';\n          input.indeterminate = true;\n        }\n\n        if ((this.parent.enableVirtualization || this.parent.enableInfiniteScrolling) && !this.parent.allowPaging && !this.parent.getDataModule().isRemote()) {\n          this.updateSelectedRowIndex(index);\n        }\n      }\n    }\n  };\n\n  Selection.prototype.keyDownHandler = function (e) {\n    // Below are keyCode for command key in MAC OS. Safari/Chrome(91-Left command, 93-Right Command), Opera(17), FireFox(224)\n    if ((Browser.info.name === 'chrome' || Browser.info.name === 'safari') && (e.keyCode === 91 || e.keyCode === 93) || Browser.info.name === 'opera' && e.keyCode === 17 || Browser.info.name === 'mozilla' && e.keyCode === 224) {\n      this.cmdKeyPressed = true;\n    }\n  };\n\n  Selection.prototype.keyUpHandler = function (e) {\n    if ((Browser.info.name === 'chrome' || Browser.info.name === 'safari') && (e.keyCode === 91 || e.keyCode === 93) || Browser.info.name === 'opera' && e.keyCode === 17 || Browser.info.name === 'mozilla' && e.keyCode === 224) {\n      this.cmdKeyPressed = false;\n    }\n  };\n\n  Selection.prototype.clickHandler = function (e) {\n    var target = e.target;\n    this.actualTarget = target;\n\n    if (parentsUntil(target, 'e-row') || parentsUntil(target, 'e-headerchkcelldiv')) {\n      this.isInteracted = true;\n    }\n\n    this.isMultiCtrlRequest = e.ctrlKey || this.enableSelectMultiTouch || this.isMacOS && this.cmdKeyPressed;\n    this.isMultiShiftRequest = e.shiftKey;\n    this.popUpClickHandler(e);\n    var chkSelect = false;\n    this.preventFocus = true;\n    var checkBox;\n    var checkWrap = parentsUntil(target, 'e-checkbox-wrapper');\n    this.checkSelectAllClicked = checkWrap && checkWrap.querySelectorAll('.e-checkselectall') ? true : false;\n\n    if (checkWrap && checkWrap.querySelectorAll('.e-checkselect,.e-checkselectall').length > 0) {\n      checkBox = checkWrap.querySelector('input[type=\"checkbox\"]');\n      chkSelect = true;\n    }\n\n    this.drawBorders();\n    this.updateAutoFillPosition();\n    target = parentsUntil(target, 'e-rowcell');\n\n    if (target && target.parentElement.classList.contains('e-row') && !this.parent.selectionSettings.checkboxOnly || chkSelect) {\n      if (this.parent.isCheckBoxSelection) {\n        this.isMultiCtrlRequest = true;\n      }\n\n      this.target = target;\n\n      if (!isNullOrUndefined(checkBox)) {\n        this.checkedTarget = checkBox;\n\n        if (checkBox.classList.contains('e-checkselectall')) {\n          this.checkSelectAll(checkBox);\n        } else {\n          this.checkSelect(checkBox);\n        }\n      } else {\n        var gObj = this.parent;\n        var rIndex = 0;\n\n        if (isGroupAdaptive(gObj)) {\n          var uid = target.parentElement.getAttribute('data-uid');\n          rIndex = gObj.getRows().map(function (m) {\n            return m.getAttribute('data-uid');\n          }).indexOf(uid);\n        } else {\n          rIndex = parseInt(target.parentElement.getAttribute('aria-rowindex'), 10);\n        }\n\n        if (this.parent.isPersistSelection && this.parent.element.querySelectorAll('.e-addedrow').length > 0) {\n          ++rIndex;\n        }\n\n        if (!this.mUPTarget || !this.mUPTarget.isEqualNode(target)) {\n          this.rowCellSelectionHandler(rIndex, parseInt(target.getAttribute('aria-colindex'), 10));\n        }\n\n        this.parent.hoverFrozenRows(e);\n\n        if (this.parent.isCheckBoxSelection) {\n          this.moveIntoUncheckCollection(closest(target, '.e-row'));\n          this.setCheckAllState();\n        }\n      }\n\n      if (!this.parent.isCheckBoxSelection && Browser.isDevice && !this.isSingleSel()) {\n        this.showPopup(e);\n      }\n    }\n\n    this.isMultiCtrlRequest = false;\n    this.isMultiShiftRequest = false;\n\n    if (isNullOrUndefined(closest(e.target, '.e-unboundcell'))) {\n      this.preventFocus = false;\n    }\n  };\n\n  Selection.prototype.popUpClickHandler = function (e) {\n    var target = e.target;\n\n    if (closest(target, '.e-headercell') || e.target.classList.contains('e-rowcell') || closest(target, '.e-gridpopup')) {\n      if (target.classList.contains('e-rowselect')) {\n        if (!target.classList.contains('e-spanclicked')) {\n          target.classList.add('e-spanclicked');\n          this.enableSelectMultiTouch = true;\n        } else {\n          target.classList.remove('e-spanclicked');\n          this.enableSelectMultiTouch = false;\n          this.parent.element.querySelector('.e-gridpopup').style.display = 'none';\n        }\n      }\n    } else {\n      this.parent.element.querySelector('.e-gridpopup').style.display = 'none';\n    }\n  };\n\n  Selection.prototype.showPopup = function (e) {\n    if (!this.selectionSettings.enableSimpleMultiRowSelection) {\n      setCssInGridPopUp(this.parent.element.querySelector('.e-gridpopup'), e, 'e-rowselect e-icons e-icon-rowselect' + (!this.isSingleSel() && (this.selectedRecords.length > (this.parent.getFrozenColumns() ? 2 : 1) || this.selectedRowCellIndexes.length > 1) ? ' e-spanclicked' : ''));\n    }\n  };\n\n  Selection.prototype.rowCellSelectionHandler = function (rowIndex, cellIndex) {\n    var gObj = this.parent;\n\n    if (!this.isMultiCtrlRequest && !this.isMultiShiftRequest || this.isSingleSel()) {\n      if (!this.isDragged) {\n        this.selectRow(rowIndex, this.selectionSettings.enableToggle);\n      }\n\n      this.selectCell({\n        rowIndex: rowIndex,\n        cellIndex: cellIndex\n      }, this.selectionSettings.enableToggle);\n\n      if (this.selectedRowCellIndexes.length) {\n        this.updateAutoFillPosition();\n      }\n\n      this.drawBorders();\n    } else if (this.isMultiShiftRequest) {\n      if (this.parent.isCheckBoxSelection || !this.parent.isCheckBoxSelection && !closest(this.target, '.e-rowcell').classList.contains('e-gridchkbox')) {\n        this.selectRowsByRange(isUndefined(this.prevRowIndex) ? rowIndex : this.prevRowIndex, rowIndex);\n      } else {\n        this.addRowsToSelection([rowIndex]);\n      }\n\n      this.selectCellsByRange(isUndefined(this.prevCIdxs) ? {\n        rowIndex: rowIndex,\n        cellIndex: cellIndex\n      } : this.prevCIdxs, {\n        rowIndex: rowIndex,\n        cellIndex: cellIndex\n      });\n      this.updateAutoFillPosition();\n      this.drawBorders();\n    } else {\n      this.addRowsToSelection([rowIndex]);\n\n      if (isBlazor() && this.parent.enableVirtualization && this.parent.isServerRendered) {\n        var rowIndexes = this.parent.getSelectedRowIndexes();\n        var interopAdaptor = 'interopAdaptor';\n        var invokeMethodAsync = 'invokeMethodAsync';\n        this.parent[interopAdaptor][invokeMethodAsync]('MaintainSelection', true, 'normal', rowIndexes);\n      }\n\n      this.addCellsToSelection([{\n        rowIndex: rowIndex,\n        cellIndex: cellIndex\n      }]);\n      this.showHideBorders('none');\n    }\n\n    this.isDragged = false;\n  };\n  /* tslint:disable-next-line:max-func-body-length */\n\n\n  Selection.prototype.onCellFocused = function (e) {\n    if (this.parent.frozenRows && e.container.isHeader && e.byKey) {\n      if (e.keyArgs.action === 'upArrow') {\n        if (this.parent.allowFiltering) {\n          e.isJump = e.element.tagName === 'INPUT' ? true : false;\n        } else {\n          e.isJump = e.element.tagName === 'TH' ? true : false;\n        }\n      } else {\n        if (e.keyArgs.action === 'downArrow') {\n          var rIdx = Number(e.element.parentElement.getAttribute('aria-rowindex'));\n          e.isJump = rIdx === 0 ? true : false;\n        } else {\n          if (e.keyArgs.action === 'ctrlHome') {\n            e.isJump = true;\n          }\n        }\n      }\n    }\n\n    var clear = this.parent.getFrozenColumns() ? (e.container.isHeader && e.element.tagName !== 'TD' && e.isJump || (e.container.isContent || e.element.tagName === 'TD') && !(e.container.isSelectable || e.element.tagName === 'TD')) && !(e.byKey && e.keyArgs.action === 'space') : (e.container.isHeader && e.isJump || e.container.isContent && !e.container.isSelectable) && !(e.byKey && e.keyArgs.action === 'space') && !(e.element.classList.contains('e-detailrowexpand') || e.element.classList.contains('e-detailrowcollapse'));\n    var headerAction = e.container.isHeader && e.element.tagName !== 'TD' && !closest(e.element, '.e-rowcell') && !(e.byKey && e.keyArgs.action === 'space');\n\n    if (!e.byKey || clear) {\n      if (clear && !this.parent.isCheckBoxSelection) {\n        this.clearSelection();\n      }\n\n      return;\n    }\n\n    var _a = e.container.isContent ? e.container.indexes : e.indexes,\n        rowIndex = _a[0],\n        cellIndex = _a[1];\n\n    var prev = this.focus.getPrevIndexes();\n\n    if (this.parent.frozenRows) {\n      if (e.container.isHeader && (e.element.tagName === 'TD' || closest(e.element, '.e-rowcell'))) {\n        var thLen = this.parent.getHeaderTable().querySelector('thead').childElementCount;\n        rowIndex -= thLen;\n        prev.rowIndex = !isNullOrUndefined(prev.rowIndex) ? prev.rowIndex - thLen : null;\n      } else {\n        rowIndex += this.parent.frozenRows;\n        prev.rowIndex = prev.rowIndex === 0 || !isNullOrUndefined(prev.rowIndex) ? prev.rowIndex + this.parent.frozenRows : null;\n      }\n    }\n\n    if (this.parent.getFrozenColumns()) {\n      var cIdx = Number(e.element.getAttribute('aria-colindex'));\n      var selectedIndexes = this.parent.getSelectedRowCellIndexes();\n\n      if (selectedIndexes.length && prev.cellIndex === 0) {\n        prev.cellIndex = selectedIndexes[selectedIndexes.length - 1].cellIndexes[0];\n      }\n\n      prev.cellIndex = !isNullOrUndefined(prev.cellIndex) ? prev.cellIndex === cellIndex ? cIdx : cIdx - 1 : null;\n      cellIndex = cIdx;\n    }\n\n    if (headerAction || ['ctrlPlusA', 'escape'].indexOf(e.keyArgs.action) === -1 && e.keyArgs.action !== 'space' && rowIndex === prev.rowIndex && cellIndex === prev.cellIndex) {\n      return;\n    }\n\n    this.preventFocus = true;\n\n    switch (e.keyArgs.action) {\n      case 'downArrow':\n      case 'upArrow':\n      case 'enter':\n      case 'shiftEnter':\n        this.target = e.element;\n        this.applyDownUpKey(rowIndex, cellIndex);\n        break;\n\n      case 'rightArrow':\n      case 'leftArrow':\n        this.applyRightLeftKey(rowIndex, cellIndex);\n        break;\n\n      case 'shiftDown':\n      case 'shiftUp':\n        this.shiftDownKey(rowIndex, cellIndex);\n        break;\n\n      case 'shiftLeft':\n      case 'shiftRight':\n        this.applyShiftLeftRightKey(rowIndex, cellIndex);\n        break;\n\n      case 'home':\n      case 'end':\n        cellIndex = e.keyArgs.action === 'end' ? this.getLastColIndex(rowIndex) : 0;\n        this.applyHomeEndKey(rowIndex, cellIndex);\n        break;\n\n      case 'ctrlHome':\n      case 'ctrlEnd':\n        this.applyCtrlHomeEndKey(rowIndex, cellIndex);\n        break;\n\n      case 'escape':\n        this.clearSelection();\n        break;\n\n      case 'ctrlPlusA':\n        this.ctrlPlusA();\n        break;\n\n      case 'space':\n        this.applySpaceSelection(e.element);\n        break;\n\n      case 'tab':\n        if (this.parent.editSettings.allowNextRowEdit) {\n          this.selectRow(rowIndex);\n        }\n\n        break;\n    }\n\n    this.preventFocus = false;\n    this.positionBorders();\n    this.updateAutoFillPosition();\n  };\n  /**\n   * Apply ctrl + A key selection\n   * @return {void}\n   * @hidden\n   */\n\n\n  Selection.prototype.ctrlPlusA = function () {\n    if (this.isRowType() && !this.isSingleSel()) {\n      this.selectRowsByRange(0, this.getCurrentBatchRecordChanges().length - 1);\n    }\n\n    if (this.isCellType() && !this.isSingleSel()) {\n      this.selectCellsByRange({\n        rowIndex: 0,\n        cellIndex: 0\n      }, {\n        rowIndex: this.parent.getRows().length - 1,\n        cellIndex: this.parent.getColumns().length - 1\n      });\n    }\n  };\n\n  Selection.prototype.applySpaceSelection = function (target) {\n    if (target.classList.contains('e-checkselectall')) {\n      this.checkedTarget = target;\n      this.checkSelectAll(this.checkedTarget);\n    } else {\n      if (target.classList.contains('e-checkselect')) {\n        this.checkedTarget = target;\n        this.checkSelect(this.checkedTarget);\n      }\n    }\n  };\n\n  Selection.prototype.applyDownUpKey = function (rowIndex, cellIndex) {\n    var gObj = this.parent;\n\n    if (this.parent.isCheckBoxSelection && this.parent.checkAllRows === 'Check' && !this.selectionSettings.persistSelection) {\n      this.checkSelectAllAction(false);\n      this.checkedTarget = null;\n    }\n\n    if (this.isRowType()) {\n      if (this.parent.frozenRows) {\n        this.selectRow(rowIndex, true);\n        this.applyUpDown(gObj.selectedRowIndex);\n      } else {\n        this.selectRow(rowIndex, true);\n        this.applyUpDown(gObj.selectedRowIndex);\n      }\n    }\n\n    if (this.isCellType()) {\n      this.selectCell({\n        rowIndex: rowIndex,\n        cellIndex: cellIndex\n      }, true);\n    }\n  };\n\n  Selection.prototype.applyUpDown = function (rowIndex) {\n    if (rowIndex < 0) {\n      return;\n    }\n\n    if (!this.target) {\n      this.target = this.parent.getRows()[0].children[this.parent.groupSettings.columns.length || 0];\n    }\n\n    var cIndex = parseInt(this.target.getAttribute('aria-colindex'), 10);\n    var frzCols = this.parent.getFrozenColumns();\n\n    if (frzCols) {\n      if (cIndex >= frzCols) {\n        this.target = this.contentRenderer.getMovableRowByIndex(rowIndex).querySelectorAll('.e-rowcell')[cIndex - frzCols];\n      } else {\n        this.target = this.contentRenderer.getRowByIndex(rowIndex).querySelectorAll('.e-rowcell')[cIndex];\n      }\n    } else {\n      this.target = this.contentRenderer.getRowByIndex(rowIndex).querySelectorAll('.e-rowcell')[cIndex];\n    }\n\n    this.addAttribute(this.target);\n  };\n\n  Selection.prototype.applyRightLeftKey = function (rowIndex, cellIndex) {\n    var gObj = this.parent;\n\n    if (this.isCellType()) {\n      this.selectCell({\n        rowIndex: rowIndex,\n        cellIndex: cellIndex\n      }, true);\n      this.addAttribute(this.target);\n    }\n  };\n\n  Selection.prototype.applyHomeEndKey = function (rowIndex, cellIndex) {\n    if (this.isCellType()) {\n      this.selectCell({\n        rowIndex: rowIndex,\n        cellIndex: cellIndex\n      }, true);\n    } else {\n      this.addAttribute(this.parent.getCellFromIndex(rowIndex, cellIndex));\n    }\n  };\n  /**\n   * Apply shift+down key selection\n   * @return {void}\n   * @hidden\n   */\n\n\n  Selection.prototype.shiftDownKey = function (rowIndex, cellIndex) {\n    var gObj = this.parent;\n    this.isMultiShiftRequest = true;\n\n    if (this.isRowType() && !this.isSingleSel()) {\n      if (!isUndefined(this.prevRowIndex)) {\n        this.selectRowsByRange(this.prevRowIndex, rowIndex);\n        this.applyUpDown(rowIndex);\n      } else {\n        this.selectRow(0, true);\n      }\n    }\n\n    if (this.isCellType() && !this.isSingleSel()) {\n      this.selectCellsByRange(this.prevCIdxs || {\n        rowIndex: 0,\n        cellIndex: 0\n      }, {\n        rowIndex: rowIndex,\n        cellIndex: cellIndex\n      });\n    }\n\n    this.isMultiShiftRequest = false;\n  };\n\n  Selection.prototype.applyShiftLeftRightKey = function (rowIndex, cellIndex) {\n    var gObj = this.parent;\n    this.isMultiShiftRequest = true;\n    this.selectCellsByRange(this.prevCIdxs, {\n      rowIndex: rowIndex,\n      cellIndex: cellIndex\n    });\n    this.isMultiShiftRequest = false;\n  };\n\n  Selection.prototype.applyCtrlHomeEndKey = function (rowIndex, cellIndex) {\n    if (this.isRowType()) {\n      this.selectRow(rowIndex, true);\n      this.addAttribute(this.parent.getCellFromIndex(rowIndex, cellIndex));\n    }\n\n    if (this.isCellType()) {\n      this.selectCell({\n        rowIndex: rowIndex,\n        cellIndex: cellIndex\n      }, true);\n    }\n  };\n\n  Selection.prototype.addRemoveClassesForRow = function (row, isAdd, clearAll) {\n    var args = [];\n\n    for (var _i = 3; _i < arguments.length; _i++) {\n      args[_i - 3] = arguments[_i];\n    }\n\n    if (row) {\n      var cells = [].slice.call(row.querySelectorAll('.e-rowcell'));\n      var detailIndentCell = row.querySelector('.e-detailrowcollapse') || row.querySelector('.e-detailrowexpand');\n      var dragdropIndentCell = row.querySelector('.e-rowdragdrop');\n\n      if (detailIndentCell) {\n        cells.push(detailIndentCell);\n      }\n\n      if (dragdropIndentCell) {\n        cells.push(dragdropIndentCell);\n      }\n\n      addRemoveActiveClasses.apply(void 0, [cells, isAdd].concat(args));\n    }\n\n    this.getRenderer().setSelection(row ? row.getAttribute('data-uid') : null, isAdd, clearAll);\n  };\n\n  Selection.prototype.isRowType = function () {\n    return this.selectionSettings.mode === 'Row' || this.selectionSettings.mode === 'Both';\n  };\n\n  Selection.prototype.isCellType = function () {\n    return this.selectionSettings.mode === 'Cell' || this.selectionSettings.mode === 'Both';\n  };\n\n  Selection.prototype.isSingleSel = function () {\n    return this.selectionSettings.type === 'Single';\n  };\n\n  Selection.prototype.getRenderer = function () {\n    if (isNullOrUndefined(this.contentRenderer)) {\n      this.contentRenderer = this.factory.getRenderer(RenderType.Content);\n    }\n\n    return this.contentRenderer;\n  };\n  /**\n   * Gets the collection of selected records.\n   * @return {Object[]}\n   */\n\n\n  Selection.prototype.getSelectedRecords = function () {\n    var selectedData = [];\n\n    if (!this.selectionSettings.persistSelection) {\n      selectedData = this.parent.getRowsObject().filter(function (row) {\n        return row.isSelected;\n      }).map(function (m) {\n        return m.data;\n      });\n    } else {\n      selectedData = this.persistSelectedData;\n    }\n\n    return selectedData;\n  };\n\n  Selection.prototype.addEventListener_checkbox = function () {\n    var _this = this;\n\n    this.parent.on(events.dataReady, this.dataReady, this);\n    this.onDataBoundFunction = this.onDataBound.bind(this);\n    this.parent.addEventListener(events.dataBound, this.onDataBoundFunction);\n    this.parent.on(events.contentReady, this.checkBoxSelectionChanged, this);\n    this.parent.on(events.onEmpty, this.setCheckAllForEmptyGrid, this);\n    this.actionCompleteFunc = this.actionCompleteHandler.bind(this);\n    this.parent.addEventListener(events.actionComplete, this.actionCompleteFunc);\n    this.parent.on(events.click, this.clickHandler, this);\n\n    this.resizeEndFn = function () {\n      _this.updateAutoFillPosition();\n\n      _this.drawBorders();\n    };\n\n    this.resizeEndFn.bind(this);\n    this.parent.addEventListener(events.resizeStop, this.resizeEndFn);\n  };\n\n  Selection.prototype.removeEventListener_checkbox = function () {\n    this.parent.off(events.dataReady, this.dataReady);\n    this.parent.removeEventListener(events.dataBound, this.onDataBoundFunction);\n    this.parent.removeEventListener(events.actionComplete, this.actionCompleteFunc);\n    this.parent.off(events.onEmpty, this.setCheckAllForEmptyGrid);\n    this.parent.off(events.click, this.clickHandler);\n  };\n\n  Selection.prototype.setCheckAllForEmptyGrid = function () {\n    var checkAllBox = this.getCheckAllBox();\n\n    if (checkAllBox) {\n      this.parent.isCheckBoxSelection = true;\n      var spanEle = checkAllBox.nextElementSibling;\n      removeClass([spanEle], ['e-check', 'e-stop', 'e-uncheck']);\n    }\n  };\n\n  Selection.prototype.dataReady = function (e) {\n    this.isHeaderCheckboxClicked = false;\n    var isInfinitecroll = this.parent.enableInfiniteScrolling && e.requestType === 'infiniteScroll';\n\n    if (e.requestType !== 'virtualscroll' && !this.parent.isPersistSelection && !isInfinitecroll) {\n      this.disableUI = !this.parent.enableImmutableMode;\n      this.clearSelection();\n      this.setCheckAllState();\n      this.disableUI = false;\n    }\n  };\n\n  Selection.prototype.actionCompleteHandler = function (e) {\n    if (e.requestType === 'save' && this.parent.isPersistSelection) {\n      this.refreshPersistSelection();\n    }\n  };\n\n  Selection.prototype.selectRowIndex = function (index) {\n    this.parent.isSelectedRowIndexUpdating = true;\n    this.parent.selectedRowIndex = index;\n  };\n\n  Selection.prototype.disableInteracted = function () {\n    this.isInteracted = false;\n  };\n\n  Selection.prototype.activeTarget = function () {\n    this.actualTarget = this.isInteracted ? this.actualTarget : null;\n  };\n\n  return Selection;\n}();\n\nexport { Selection };","map":{"version":3,"sources":["D:/Projects/TCC/Finances/qub29a--run/node_modules/@syncfusion/ej2-grids/src/grid/actions/selection.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","Browser","EventHandler","createElement","isBlazor","isNullOrUndefined","isUndefined","addClass","removeClass","remove","closest","Query","setCssInGridPopUp","getPosition","isGroupAdaptive","parentsUntil","addRemoveActiveClasses","removeAddCboxClasses","events","RenderType","iterateExtend","setChecked","Selection","parent","selectionSettings","locator","selectedRowIndexes","selectedRowCellIndexes","selectedRecords","preventFocus","checkBoxState","isMultiShiftRequest","isMultiCtrlRequest","enableSelectMultiTouch","clearRowCheck","selectRowCheck","selectedRowState","totalRecordsCount","chkAllCollec","isCheckedOnAdd","persistSelectedData","isCancelDeSelect","isPreventCellSelect","disableUI","isPersisted","cmdKeyPressed","cellselected","isMultiSelection","isAddRowsToSelection","initialRowSelection","autoFillRLselection","factory","getService","focus","addEventListener","wireEvents","initializeSelection","log","render","onActionBegin","args","type","trigger","fDataUpdate","cellIndex","rowIndex","rowObj","getRowObj","currentIndex","foreignKeyData","onActionComplete","getModuleName","destroy","gridElement","element","querySelector","hidePopUp","clearSelection","removeEventListener","unWireEvents","getContent","mouseDownHandler","getHeaderContent","isEditing","editSettings","mode","editModule","formObj","validate","isEdit","isPersistSelection","getSelectedMovableRow","index","gObj","getFrozenColumns","getMovableRowByIndex","getCurrentBatchRecordChanges","added","deleted","currentRecords","getCurrentViewRecords","newRowPosition","concat","getBatchChanges","deletedRecords","primaryKey","getPrimaryKeyFieldNames","j","splice","selectRow","isToggle","enableSimpleMultiRowSelection","addRowsToSelection","selectedRow","getRowByIndex","selectedMovableRow","selectData","isRemoved","enableVirtualization","notify","selectVirtualRow","selectedIndex","frozenData","contentModule","getRowObjectByIndex","getRowObjectFromUID","getAttribute","data","prevSelectedData","getSelectedRecords","clearRowSelection","isRowType","isRowSelected","hasAttribute","activeTarget","can","isHybrid","isJsComponent","isCtrlPressed","isShiftPressed","row","previousRow","prevRowIndex","previousRowIndex","target","actualTarget","cancel","isInteracted","isHeaderCheckboxClicked","addMovableArgs","rowSelecting","rowSelectingCallBack","_this","disableInteracted","toggle","removed","persistSelection","checkboxMode","clearSelectedRow","selectRowCallBack","clearRow","indexOf","updateRowSelection","selectRowIndex","isHeaderCheckBoxClicked","rowSelected","isServerRendered","interopAdaptor","invokeMethodAsync","updateRowProps","targetObj","mRow","mObj","previousMovRow","getMovableRows","selectRowsByRange","startIndex","endIndex","selectRows","getCollectionFromIndexes","rowIndexes","isSingleSel","selectedRows","frzCols","selectedData","len","currentRow","getDataRows","push","prevRow","getRows","slice","_i","rowIndexes_1","rowIdx","indexes","getSelectedRowIndexes","checkboxColumn","getColumns","filter","col","_loop_1","this_1","isUnSelected","enableToggle","rowDeselect","rowDeselecting","value","removeAttribute","addRemoveClassesForRow","rowDeselected","rowIndexes_2","state_1","_a","max","reverse","clearRowCallBack","checkAllRows","selectedEle","parentElement","updatePersistCollection","updateCheckBoxes","chkState","ensureCheckboxFieldSelection","pKey_1","isSelected","some","updatePersistDelete","pKey","isPresent","chkBox","nextElementSibling","checkedTarget","classList","contains","setCheckAllState","pop","setAttribute","getPrevIndexes","cells","contextMenuModule","mouseButton","cell","onClick","span","clearCellSelection","undefined","rows_1","data_1","row_1","mRow_1","rowIndex_1","foreignKeyData_1","target_1","currentViewData","checkSelectAllClicked","getCheckAllStatus","updatePersistSelectedData","record","getRenderer","setSelection","movableRow","rowDeselectCallBack","cancl_1","rowDeselectObj","rowInString","target_2","rowidx","rowidxex","data_2","foreignKey","isHeaderCheckBxClick","rowIndex_2","data_3","getSelectedMovableCell","getMovableCellFromIndex","getColIndex","selectCell","isCellType","selectedCell","getCellFromIndex","selectedTable","cIdx","isCellSelected","prevCIdxs","previousRowCell","prevECIdxs","getCellIndex","currentCell","previousRowCellIndex","cellSelecting","successCallBack","cellSelectingArgs","cncl","clearCell","updateCellSelection","selectedRowCellIndex","updateCellProps","cellSelected","rIdx","selectCellsByRange","min","stIndex","edIndex","cellIndexes","temp","cellSelectionMode","getLastColIndex","addAttribute","cellSelectedArgs","isDragged","selectCells","rowCellIndexes","cellSelectArgs","cellLen","addRowCellIndex","addCellsToSelection","hideAutoFill","getMovableRowsObject","cellIndexes_1","selectedCellIdx","cellDeselect","cellDeselecting","cellDeselected","getMovableDataRows","querySelectorAll","m","colIndex","parseInt","cancl","add","rowCellIndex","isRowAvail","selectedCells","getSelectedCellsElement","rowCell","cLen","bdrElement","showHideBorders","rows","mRows","addMovableRows","mouseMoveHandler","e","preventDefault","gBRect","getBoundingClientRect","x1","x","y1","y","position","x2","left","y2","top","tmp","isCellDrag","document","elementFromPoint","offsetLeft","clientY","style","width","height","ctrlKey","shiftKey","startDIndex","td","startAFCell","startCell","endAFCell","selectLikeExcel","isAutoFillSel","startDCellIndex","drawBorders","showAFBorders","selectLikeAutoFill","createBorders","positionBorders","isLastCell","isLastRow","isFirstRow","isFirstCell","setBorders","parentEle","border","bdrStr","ele","display","start","end","stOff","endOff","parentOff","offsetParent","rowHeight","topOffSet","frozenRows","leftOffset","enableRtl","right","selectDirection","updateStartEndCells","getContentTable","getMovableContent","mcBdrElement","getHeaderTable","fhBdrElement","headerModule","getMovableHeader","mhBdrElement","applyBorders","str","rtl","borderWidth","includes","appendChild","className","id","styles","drawAFBorders","bdrAFBottom","createAFBorders","positionAFBorders","bdrAFLeft","firstCellTop","firstCellLeft","parentRect","sTop","scrollTop","sLeft","scrollLeft","offsetTop","totalHeight","clientHeight","totalWidth","clientWidth","Math","floor","bdrAFRight","bdrAFTop","leftRemove","scrolloffSet","parseFloat","topRemove","hideAFBorders","updateValue","createBeforeAutoFill","getColumnByIndex","updateCell","field","column","innerText","beforeAutoFill","getAutoFillCells","startCellIdx","isApply","startrowIdx","endrowIdx","endCellIdx","rowLen","colLen","cellIdx","endCell","c","startCellIndex","trIdx","r","mouseUpHandler","body","mUPTarget","updateAutoFillPosition","lastCell","updateStartCellsIndex","autofill","enableAutoFill","rindex","isFrozenCol","isFrozenRow","clientRect","colWidth","button","isDrag","allowRowDragAndDrop","enableDrag","isUpdate","tr","postion","clearSelAfterRefresh","isInfiniteScroll","enableInfiniteScrolling","requestType","isDestroyed","on","uiUpdate","enableAfterRender","initialEnd","rowSelectionComplete","cellSelectionComplete","inBoundModelChanged","onPropertyChanged","cellFocused","onCellFocused","beforeFragAppend","columnPositionChanged","contentReady","actionBeginFunction","actionBegin","bind","actionCompleteFunction","actionComplete","rowsRemoved","headerRefreshed","refreshHeader","addEventListener_checkbox","off","removeEventListener_checkbox","isMacOS","navigator","userAgent","keyDownHandler","keyUpHandler","records","getCheckAllBox","module","enable","initPerisistSelection","properties","checkBoxSelectionChanged","isCheckBoxSelection","selectedRowIndex","gobj","chkField","pageSettings","dataBind","keys","getDataModule","query","where","params","dataManager","getData","proxy_1","showSpinner","then","dataSuccess","result","refreshPersistSelection","hideSpinner","res","setRowSelection","state","isRemote","groupSettings","columns","_b","_c","executeLocal","generateQuery","checkState","editChkBox","checked","action","onDataBound","totalRecords","getRowsObject","checkSelectAllAction","cRenderer","editForm","currentInfo","getVirtualRowIndex","checkSelectAll","checkBox","stateStr","allowPaging","values","vgenerator","rowCache","forEach","selectionModule","Number","triggerChkChangeEvent","classes","status","checkSelect","checkObj","rIndex","uid","map","rowCellSelectionHandler","moveIntoUncheckCollection","checkBoxChange","updateSelectedRowIndex","dataLength","selectedVal","isInteraction","checkToSelectAll","isServerRenderedVirtualization","checkedLen","input","spanEle","indeterminate","info","name","keyCode","clickHandler","popUpClickHandler","chkSelect","checkWrap","checkboxOnly","isEqualNode","hoverFrozenRows","isDevice","showPopup","container","isHeader","byKey","keyArgs","allowFiltering","isJump","tagName","clear","isContent","isSelectable","headerAction","prev","thLen","childElementCount","selectedIndexes","getSelectedRowCellIndexes","applyDownUpKey","applyRightLeftKey","shiftDownKey","applyShiftLeftRightKey","applyHomeEndKey","applyCtrlHomeEndKey","ctrlPlusA","applySpaceSelection","allowNextRowEdit","applyUpDown","children","cIndex","contentRenderer","isAdd","clearAll","detailIndentCell","dragdropIndentCell","Content","dataReady","onDataBoundFunction","dataBound","onEmpty","setCheckAllForEmptyGrid","actionCompleteFunc","actionCompleteHandler","click","resizeEndFn","resizeStop","checkAllBox","isInfinitecroll","enableImmutableMode","isSelectedRowIndexUpdating"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { Browser, EventHandler, createElement, isBlazor } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, isUndefined, addClass, removeClass } from '@syncfusion/ej2-base';\nimport { remove, closest } from '@syncfusion/ej2-base';\nimport { Query } from '@syncfusion/ej2-data';\nimport { setCssInGridPopUp, getPosition, isGroupAdaptive, parentsUntil, addRemoveActiveClasses, removeAddCboxClasses } from '../base/util';\nimport * as events from '../base/constant';\nimport { RenderType } from '../base/enum';\nimport { iterateExtend, setChecked } from '../base/util';\n/**\n * The `Selection` module is used to handle cell and row selection.\n */\nvar Selection = /** @class */ (function () {\n    /**\n     * Constructor for the Grid selection module\n     * @hidden\n     */\n    function Selection(parent, selectionSettings, locator) {\n        //Internal letiables       \n        /**\n         * @hidden\n         */\n        this.selectedRowIndexes = [];\n        /**\n         * @hidden\n         */\n        this.selectedRowCellIndexes = [];\n        /**\n         * @hidden\n         */\n        this.selectedRecords = [];\n        /**\n         * @hidden\n         */\n        this.preventFocus = false;\n        this.checkBoxState = false;\n        this.isMultiShiftRequest = false;\n        this.isMultiCtrlRequest = false;\n        this.enableSelectMultiTouch = false;\n        this.clearRowCheck = false;\n        this.selectRowCheck = false;\n        this.selectedRowState = {};\n        this.totalRecordsCount = 0;\n        this.chkAllCollec = [];\n        this.isCheckedOnAdd = false;\n        this.persistSelectedData = [];\n        this.isCancelDeSelect = false;\n        this.isPreventCellSelect = false;\n        this.disableUI = false;\n        this.isPersisted = false;\n        this.cmdKeyPressed = false;\n        this.cellselected = false;\n        this.isMultiSelection = false;\n        this.isAddRowsToSelection = false;\n        this.initialRowSelection = false;\n        /**\n         * @hidden\n         */\n        this.autoFillRLselection = true;\n        this.parent = parent;\n        this.selectionSettings = selectionSettings;\n        this.factory = locator.getService('rendererFactory');\n        this.focus = locator.getService('focus');\n        this.addEventListener();\n        this.wireEvents();\n    }\n    Selection.prototype.initializeSelection = function () {\n        this.parent.log('selection_key_missing');\n        this.render();\n    };\n    /**\n     * The function used to trigger onActionBegin\n     * @return {void}\n     * @hidden\n     */\n    Selection.prototype.onActionBegin = function (args, type) {\n        this.parent.trigger(type, this.fDataUpdate(args));\n    };\n    Selection.prototype.fDataUpdate = function (args) {\n        if (!this.isMultiSelection && (!isNullOrUndefined(args.cellIndex) || !isNullOrUndefined(args.rowIndex))) {\n            var rowObj = this.getRowObj(isNullOrUndefined(args.rowIndex) ? isNullOrUndefined(args.cellIndex) ?\n                this.currentIndex : args.cellIndex.rowIndex : args.rowIndex);\n            args.foreignKeyData = rowObj.foreignKeyData;\n        }\n        return args;\n    };\n    /**\n     * The function used to trigger onActionComplete\n     * @return {void}\n     * @hidden\n     */\n    Selection.prototype.onActionComplete = function (args, type) {\n        this.parent.trigger(type, this.fDataUpdate(args));\n        this.isMultiSelection = false;\n    };\n    /**\n     * For internal use only - Get the module name.\n     * @private\n     */\n    Selection.prototype.getModuleName = function () {\n        return 'selection';\n    };\n    /**\n     * To destroy the selection\n     * @return {void}\n     * @hidden\n     */\n    Selection.prototype.destroy = function () {\n        var gridElement = this.parent.element;\n        if (!gridElement || (!gridElement.querySelector('.e-gridheader') && !gridElement.querySelector('.e-gridcontent'))) {\n            return;\n        }\n        this.hidePopUp();\n        this.clearSelection();\n        this.removeEventListener();\n        this.unWireEvents();\n        EventHandler.remove(this.parent.getContent(), 'mousedown', this.mouseDownHandler);\n        EventHandler.remove(this.parent.getHeaderContent(), 'mousedown', this.mouseDownHandler);\n    };\n    Selection.prototype.isEditing = function () {\n        return (this.parent.editSettings.mode === 'Normal' || (this.parent.editSettings.mode === 'Batch' && this.parent.editModule &&\n            this.parent.editModule.formObj && !this.parent.editModule.formObj.validate())) &&\n            this.parent.isEdit && !this.parent.isPersistSelection;\n    };\n    Selection.prototype.getSelectedMovableRow = function (index) {\n        var gObj = this.parent;\n        if (gObj.getFrozenColumns() && this.parent.getContent().querySelector('.e-movablecontent')) {\n            return gObj.getMovableRowByIndex(index);\n        }\n        return null;\n    };\n    Selection.prototype.getCurrentBatchRecordChanges = function () {\n        var gObj = this.parent;\n        var added = 'addedRecords';\n        var deleted = 'deletedRecords';\n        if (gObj.editSettings.mode === 'Batch' && gObj.editModule) {\n            var currentRecords = iterateExtend(this.parent.getCurrentViewRecords());\n            currentRecords = gObj.editSettings.newRowPosition === 'Bottom' ?\n                currentRecords.concat(this.parent.editModule.getBatchChanges()[added]) :\n                this.parent.editModule.getBatchChanges()[added].concat(currentRecords);\n            var deletedRecords = this.parent.editModule.getBatchChanges()[deleted];\n            var primaryKey = this.parent.getPrimaryKeyFieldNames()[0];\n            for (var i = 0; i < (deletedRecords.length); i++) {\n                for (var j = 0; j < currentRecords.length; j++) {\n                    if (deletedRecords[i][primaryKey] === currentRecords[j][primaryKey]) {\n                        currentRecords.splice(j, 1);\n                        break;\n                    }\n                }\n            }\n            return currentRecords;\n        }\n        else {\n            return gObj.getCurrentViewRecords();\n        }\n    };\n    /**\n     * Selects a row by the given index.\n     * @param  {number} index - Defines the row index.\n     * @param  {boolean} isToggle - If set to true, then it toggles the selection.\n     * @return {void}\n     */\n    Selection.prototype.selectRow = function (index, isToggle) {\n        if (this.selectedRowIndexes.length && this.selectionSettings.enableSimpleMultiRowSelection) {\n            this.addRowsToSelection([index]);\n            return;\n        }\n        var gObj = this.parent;\n        var selectedRow = gObj.getRowByIndex(index);\n        var selectedMovableRow = this.getSelectedMovableRow(index);\n        var selectData;\n        var isRemoved = false;\n        if (gObj.enableVirtualization && index > -1) {\n            this.parent.notify(events.selectVirtualRow, { selectedIndex: index });\n            var frozenData = gObj.getFrozenColumns() ? gObj.contentModule.getRowObjectByIndex(index)\n                : null;\n            if (selectedRow && (gObj.getRowObjectFromUID(selectedRow.getAttribute('data-uid')) || frozenData)) {\n                selectData = frozenData ? frozenData : gObj.getRowObjectFromUID(selectedRow.getAttribute('data-uid')).data;\n            }\n            else {\n                var prevSelectedData = this.parent.getSelectedRecords();\n                if (prevSelectedData.length > 0) {\n                    this.clearRowSelection();\n                }\n                return;\n            }\n        }\n        else {\n            selectData = this.getCurrentBatchRecordChanges()[index];\n        }\n        if (!this.isRowType() || !selectedRow || this.isEditing()) {\n            // if (this.isEditing()) {\n            //     gObj.selectedRowIndex = index;\n            // }\n            return;\n        }\n        var isRowSelected = selectedRow.hasAttribute('aria-selected');\n        this.activeTarget();\n        isToggle = !isToggle ? isToggle :\n            !this.selectedRowIndexes.length ? false :\n                (this.selectedRowIndexes.length === 1 ? (index === this.selectedRowIndexes[0]) : false);\n        var args;\n        var can = 'cancel';\n        if (!isToggle) {\n            var isHybrid = 'isHybrid';\n            if (!isBlazor() || this.parent.isJsComponent || this.parent[isHybrid]) {\n                args = {\n                    data: selectData, rowIndex: index, isCtrlPressed: this.isMultiCtrlRequest,\n                    isShiftPressed: this.isMultiShiftRequest, row: selectedRow,\n                    previousRow: gObj.getRowByIndex(this.prevRowIndex),\n                    previousRowIndex: this.prevRowIndex, target: this.actualTarget, cancel: false, isInteracted: this.isInteracted,\n                    isHeaderCheckboxClicked: this.isHeaderCheckboxClicked\n                };\n                args = this.addMovableArgs(args, selectedMovableRow);\n            }\n            else {\n                args = {\n                    data: selectData, rowIndex: index, isCtrlPressed: this.isMultiCtrlRequest,\n                    isShiftPressed: this.isMultiShiftRequest, previousRowIndex: this.prevRowIndex,\n                    cancel: false, isInteracted: this.isInteracted, isHeaderCheckboxClicked: this.isHeaderCheckboxClicked\n                };\n            }\n            this.parent.trigger(events.rowSelecting, this.fDataUpdate(args), this.rowSelectingCallBack(args, isToggle, index, selectData, isRemoved, isRowSelected, can));\n        }\n        else {\n            this.rowSelectingCallBack(args, isToggle, index, selectData, isRemoved, isRowSelected, can)(args);\n        }\n    };\n    Selection.prototype.rowSelectingCallBack = function (args, isToggle, index, selectData, isRemoved, isRowSelected, can) {\n        var _this = this;\n        return function (args) {\n            if (!isNullOrUndefined(args) && args[can] === true) {\n                _this.disableInteracted();\n                return;\n            }\n            _this.index = index;\n            _this.toggle = isToggle;\n            _this.data = selectData;\n            _this.removed = isRemoved;\n            if (isRowSelected && _this.selectionSettings.persistSelection && !(_this.selectionSettings.checkboxMode === 'ResetOnRowClick')) {\n                _this.clearSelectedRow(index);\n                isRemoved = true;\n                _this.removed = isRemoved;\n                _this.selectRowCallBack();\n            }\n            else if (!isRowSelected && _this.selectionSettings.persistSelection &&\n                _this.selectionSettings.checkboxMode !== 'ResetOnRowClick') {\n                _this.selectRowCallBack();\n            }\n            if (_this.selectionSettings.checkboxMode === 'ResetOnRowClick') {\n                _this.clearSelection();\n            }\n            if (!_this.selectionSettings.persistSelection || _this.selectionSettings.checkboxMode === 'ResetOnRowClick') {\n                _this.selectRowCheck = true;\n                _this.clearRow();\n            }\n        };\n    };\n    Selection.prototype.selectRowCallBack = function () {\n        var gObj = this.parent;\n        var args;\n        var index = this.index;\n        var isToggle = this.toggle;\n        var selectData = this.data;\n        var isRemoved = this.removed;\n        var selectedRow = gObj.getRowByIndex(index);\n        var selectedMovableRow = this.getSelectedMovableRow(index);\n        if (!isToggle && !isRemoved) {\n            if (this.selectedRowIndexes.indexOf(index) <= -1) {\n                this.updateRowSelection(selectedRow, index);\n                if (gObj.getFrozenColumns()) {\n                    this.updateRowSelection(selectedMovableRow, index);\n                }\n            }\n            this.selectRowIndex(index);\n        }\n        if (!isToggle) {\n            var isHybrid = 'isHybrid';\n            if (!isBlazor() || this.parent.isJsComponent || this.parent[isHybrid]) {\n                args = {\n                    data: selectData, rowIndex: index,\n                    row: selectedRow, previousRow: gObj.getRowByIndex(this.prevRowIndex),\n                    previousRowIndex: this.prevRowIndex, target: this.actualTarget, isInteracted: this.isInteracted,\n                    isHeaderCheckBoxClicked: this.isHeaderCheckboxClicked\n                };\n                args = this.addMovableArgs(args, selectedMovableRow);\n            }\n            else {\n                args = {\n                    data: selectData, rowIndex: index,\n                    row: selectedRow, previousRow: gObj.getRowByIndex(this.prevRowIndex),\n                    previousRowIndex: this.prevRowIndex, isInteracted: this.isInteracted,\n                    isHeaderCheckBoxClicked: this.isHeaderCheckboxClicked\n                };\n            }\n            this.onActionComplete(args, events.rowSelected);\n        }\n        if (isBlazor() && this.parent.isServerRendered && this.parent.enableVirtualization) {\n            var interopAdaptor = 'interopAdaptor';\n            var invokeMethodAsync = 'invokeMethodAsync';\n            this.parent[interopAdaptor][invokeMethodAsync]('MaintainSelection', true, 'normal', [index]);\n        }\n        this.isInteracted = false;\n        this.updateRowProps(index);\n    };\n    Selection.prototype.addMovableArgs = function (targetObj, mRow) {\n        if (this.parent.getFrozenColumns()) {\n            var mObj = { mRow: mRow, previousMovRow: this.parent.getMovableRows()[this.prevRowIndex] };\n            targetObj = __assign({}, targetObj, mObj);\n        }\n        return targetObj;\n    };\n    /**\n     * Selects a range of rows from start and end row indexes.\n     * @param  {number} startIndex - Specifies the start row index.\n     * @param  {number} endIndex - Specifies the end row index.\n     * @return {void}\n     */\n    Selection.prototype.selectRowsByRange = function (startIndex, endIndex) {\n        this.selectRows(this.getCollectionFromIndexes(startIndex, endIndex));\n        this.selectRowIndex(endIndex);\n    };\n    /**\n     * Selects a collection of rows by index.\n     * @param  {number[]} rowIndexes - Specifies an array of row indexes.\n     * @return {void}\n     */\n    Selection.prototype.selectRows = function (rowIndexes) {\n        var _this = this;\n        var gObj = this.parent;\n        var rowIndex = !this.isSingleSel() ? rowIndexes[0] : rowIndexes[rowIndexes.length - 1];\n        this.isMultiSelection = true;\n        var selectedRows = [];\n        var foreignKeyData = [];\n        var selectedMovableRow = this.getSelectedMovableRow(rowIndex);\n        var frzCols = gObj.getFrozenColumns();\n        var can = 'cancel';\n        var selectedData = [];\n        if (!this.isRowType() || this.isEditing()) {\n            return;\n        }\n        for (var i = 0, len = rowIndexes.length; i < len; i++) {\n            var currentRow = this.parent.getDataRows()[rowIndexes[i]];\n            var rowObj = this.getRowObj(currentRow);\n            if (rowObj) {\n                selectedData.push(rowObj.data);\n                selectedRows.push(currentRow);\n                foreignKeyData.push(rowObj.foreignKeyData);\n            }\n        }\n        var isHybrid = 'isHybrid';\n        this.activeTarget();\n        var args;\n        if (!isBlazor() || this.parent.isJsComponent || this.parent[isHybrid]) {\n            args = {\n                cancel: false,\n                rowIndexes: rowIndexes, row: selectedRows, rowIndex: rowIndex, target: this.actualTarget,\n                prevRow: gObj.getRows()[this.prevRowIndex], previousRowIndex: this.prevRowIndex,\n                isInteracted: this.isInteracted, isCtrlPressed: this.isMultiCtrlRequest, isShiftPressed: this.isMultiShiftRequest,\n                data: selectedData, isHeaderCheckboxClicked: this.isHeaderCheckboxClicked, foreignKeyData: foreignKeyData\n            };\n            args = this.addMovableArgs(args, selectedMovableRow);\n        }\n        else {\n            args = {\n                cancel: false,\n                rowIndexes: rowIndexes, rowIndex: rowIndex, previousRowIndex: this.prevRowIndex,\n                isCtrlPressed: this.isMultiCtrlRequest, isShiftPressed: this.isMultiShiftRequest,\n                data: selectedData, isHeaderCheckboxClicked: this.isHeaderCheckboxClicked, foreignKeyData: foreignKeyData\n            };\n        }\n        this.parent.trigger(events.rowSelecting, this.fDataUpdate(args), function (args) {\n            if (!isNullOrUndefined(args) && args[can] === true) {\n                _this.disableInteracted();\n                return;\n            }\n            _this.clearRow();\n            _this.selectRowIndex(rowIndexes.slice(-1)[0]);\n            if (!_this.isSingleSel()) {\n                for (var _i = 0, rowIndexes_1 = rowIndexes; _i < rowIndexes_1.length; _i++) {\n                    var rowIdx = rowIndexes_1[_i];\n                    _this.updateRowSelection(gObj.getRowByIndex(rowIdx), rowIdx);\n                    if (frzCols) {\n                        _this.updateRowSelection(gObj.getMovableRowByIndex(rowIdx), rowIdx);\n                    }\n                    _this.updateRowProps(rowIndex);\n                }\n            }\n            else {\n                _this.updateRowSelection(gObj.getRowByIndex(rowIndex), rowIndex);\n                if (frzCols) {\n                    _this.updateRowSelection(gObj.getMovableRowByIndex(rowIndex), rowIndex);\n                }\n                _this.updateRowProps(rowIndex);\n            }\n            var isHybrid = 'isHybrid';\n            if (!isBlazor() || _this.parent.isJsComponent || _this.parent[isHybrid]) {\n                args = {\n                    rowIndexes: rowIndexes, row: selectedRows, rowIndex: rowIndex, target: _this.actualTarget,\n                    prevRow: gObj.getRows()[_this.prevRowIndex], previousRowIndex: _this.prevRowIndex,\n                    data: isBlazor() ? selectedData : _this.getSelectedRecords(), isInteracted: _this.isInteracted,\n                    isHeaderCheckboxClicked: _this.isHeaderCheckboxClicked, foreignKeyData: foreignKeyData\n                };\n                args = _this.addMovableArgs(args, selectedMovableRow);\n            }\n            else {\n                args = {\n                    rowIndexes: rowIndexes, rowIndex: rowIndex, previousRowIndex: _this.prevRowIndex,\n                    row: selectedRows, prevRow: gObj.getRows()[_this.prevRowIndex],\n                    data: isBlazor() ? selectedData : _this.getSelectedRecords(), isInteracted: _this.isInteracted,\n                    isHeaderCheckboxClicked: _this.isHeaderCheckboxClicked, foreignKeyData: foreignKeyData\n                };\n            }\n            if (_this.isRowSelected) {\n                _this.onActionComplete(args, events.rowSelected);\n            }\n        });\n    };\n    /**\n     * Select rows with existing row selection by passing row indexes.\n     * @param  {number} startIndex - Specifies the row indexes.\n     * @return {void}\n     * @hidden\n     */\n    Selection.prototype.addRowsToSelection = function (rowIndexes) {\n        var _this = this;\n        var gObj = this.parent;\n        var can = 'cancel';\n        var target = this.target;\n        this.isMultiSelection = true;\n        var indexes = gObj.getSelectedRowIndexes().concat(rowIndexes);\n        var selectedRow = !this.isSingleSel() ? gObj.getRowByIndex(rowIndexes[0]) :\n            gObj.getRowByIndex(rowIndexes[rowIndexes.length - 1]);\n        var selectedMovableRow = !this.isSingleSel() ? this.getSelectedMovableRow(rowIndexes[0]) :\n            this.getSelectedMovableRow(rowIndexes[rowIndexes.length - 1]);\n        var frzCols = gObj.getFrozenColumns();\n        if (!this.isRowType() || this.isEditing()) {\n            return;\n        }\n        var args;\n        var checkboxColumn = this.parent.getColumns().filter(function (col) { return col.type === 'checkbox'; });\n        var _loop_1 = function (rowIndex) {\n            var rowObj = this_1.getRowObj(rowIndex);\n            var isUnSelected = this_1.selectedRowIndexes.indexOf(rowIndex) > -1;\n            this_1.selectRowIndex(rowIndex);\n            if (isUnSelected && ((checkboxColumn.length ? true : this_1.selectionSettings.enableToggle) || this_1.isMultiCtrlRequest)) {\n                this_1.isAddRowsToSelection = true;\n                this_1.rowDeselect(events.rowDeselecting, [rowIndex], [rowObj.data], [selectedRow], [rowObj.foreignKeyData], target);\n                if (this_1.isCancelDeSelect) {\n                    return { value: void 0 };\n                }\n                this_1.selectedRowIndexes.splice(this_1.selectedRowIndexes.indexOf(rowIndex), 1);\n                this_1.selectedRecords.splice(this_1.selectedRecords.indexOf(selectedRow), 1);\n                selectedRow.removeAttribute('aria-selected');\n                this_1.addRemoveClassesForRow(selectedRow, false, null, 'e-selectionbackground', 'e-active');\n                if (selectedMovableRow) {\n                    this_1.selectedRecords.splice(this_1.selectedRecords.indexOf(selectedMovableRow), 1);\n                    selectedMovableRow.removeAttribute('aria-selected');\n                    this_1.addRemoveClassesForRow(selectedMovableRow, false, null, 'e-selectionbackground', 'e-active');\n                }\n                this_1.rowDeselect(events.rowDeselected, [rowIndex], [rowObj.data], [selectedRow], [rowObj.foreignKeyData], target, [selectedMovableRow]);\n                this_1.isInteracted = false;\n                this_1.isMultiSelection = false;\n                this_1.isAddRowsToSelection = false;\n            }\n            else {\n                var isHybrid = 'isHybrid';\n                this_1.activeTarget();\n                if (!isBlazor() || this_1.parent.isJsComponent || this_1.parent[isHybrid]) {\n                    args = {\n                        cancel: false,\n                        data: rowObj.data, rowIndex: rowIndex, row: selectedRow, target: this_1.actualTarget,\n                        prevRow: gObj.getRows()[this_1.prevRowIndex], previousRowIndex: this_1.prevRowIndex,\n                        isCtrlPressed: this_1.isMultiCtrlRequest, isShiftPressed: this_1.isMultiShiftRequest,\n                        foreignKeyData: rowObj.foreignKeyData, isInteracted: this_1.isInteracted,\n                        isHeaderCheckboxClicked: this_1.isHeaderCheckboxClicked, rowIndexes: indexes\n                    };\n                    args = this_1.addMovableArgs(args, selectedMovableRow);\n                }\n                else {\n                    args = {\n                        cancel: false,\n                        data: rowObj.data, rowIndex: rowIndex, previousRowIndex: this_1.prevRowIndex,\n                        isCtrlPressed: this_1.isMultiCtrlRequest, isShiftPressed: this_1.isMultiShiftRequest,\n                        foreignKeyData: rowObj.foreignKeyData, isInteracted: this_1.isInteracted,\n                        isHeaderCheckboxClicked: this_1.isHeaderCheckboxClicked, rowIndexes: indexes\n                    };\n                }\n                this_1.parent.trigger(events.rowSelecting, this_1.fDataUpdate(args), function (args) {\n                    if (!isNullOrUndefined(args) && args[can] === true) {\n                        _this.disableInteracted();\n                        return;\n                    }\n                    if (_this.isSingleSel()) {\n                        _this.clearRow();\n                    }\n                    _this.updateRowSelection(selectedRow, rowIndex);\n                    if (frzCols) {\n                        _this.updateRowSelection(selectedMovableRow, rowIndex);\n                    }\n                });\n            }\n            if (!isUnSelected) {\n                var isHybrid = 'isHybrid';\n                if (!isBlazor() || this_1.parent.isJsComponent || this_1.parent[isHybrid]) {\n                    args = {\n                        data: rowObj.data, rowIndex: rowIndex, row: selectedRow, target: this_1.actualTarget,\n                        prevRow: gObj.getRows()[this_1.prevRowIndex], previousRowIndex: this_1.prevRowIndex,\n                        foreignKeyData: rowObj.foreignKeyData, isInteracted: this_1.isInteracted,\n                        isHeaderCheckboxClicked: this_1.isHeaderCheckboxClicked, rowIndexes: indexes\n                    };\n                    args = this_1.addMovableArgs(args, selectedMovableRow);\n                }\n                else {\n                    args = {\n                        data: rowObj.data, rowIndex: rowIndex, previousRowIndex: this_1.prevRowIndex,\n                        row: selectedRow, prevRow: gObj.getRows()[this_1.prevRowIndex],\n                        foreignKeyData: rowObj.foreignKeyData, isInteracted: this_1.isInteracted,\n                        isHeaderCheckboxClicked: this_1.isHeaderCheckboxClicked, rowIndexes: indexes\n                    };\n                }\n                this_1.onActionComplete(args, events.rowSelected);\n            }\n            this_1.isInteracted = false;\n            this_1.updateRowProps(rowIndex);\n            if (this_1.isSingleSel()) {\n                return \"break\";\n            }\n        };\n        var this_1 = this;\n        for (var _i = 0, rowIndexes_2 = rowIndexes; _i < rowIndexes_2.length; _i++) {\n            var rowIndex = rowIndexes_2[_i];\n            var state_1 = _loop_1(rowIndex);\n            if (typeof state_1 === \"object\")\n                return state_1.value;\n            if (state_1 === \"break\")\n                break;\n        }\n    };\n    Selection.prototype.getCollectionFromIndexes = function (startIndex, endIndex) {\n        var indexes = [];\n        var _a = (startIndex <= endIndex) ?\n            { i: startIndex, max: endIndex } : { i: endIndex, max: startIndex }, i = _a.i, max = _a.max;\n        for (; i <= max; i++) {\n            indexes.push(i);\n        }\n        if (startIndex > endIndex) {\n            indexes.reverse();\n        }\n        return indexes;\n    };\n    Selection.prototype.clearRow = function () {\n        this.clearRowCheck = true;\n        this.clearRowSelection();\n    };\n    Selection.prototype.clearRowCallBack = function () {\n        if (this.isCancelDeSelect && this.parent.checkAllRows !== 'Check') {\n            return;\n        }\n        this.selectedRowIndexes = [];\n        this.selectedRecords = [];\n        this.selectRowIndex(-1);\n        if (this.isSingleSel() && this.parent.isPersistSelection) {\n            this.selectedRowState = {};\n        }\n    };\n    Selection.prototype.clearSelectedRow = function (index) {\n        if (this.target) {\n            var selectedEle = this.target.parentElement;\n            if (!this.disableUI) {\n                selectedEle.removeAttribute('aria-selected');\n                this.addRemoveClassesForRow(selectedEle, false, true, 'e-selectionbackground', 'e-active');\n            }\n            this.updatePersistCollection(selectedEle, false);\n            this.updateCheckBoxes(selectedEle);\n            this.selectedRowIndexes.splice(this.selectedRowIndexes.indexOf(index), 1);\n            this.selectedRecords.splice(this.selectedRecords.indexOf(this.parent.getRowByIndex(index)), 1);\n        }\n    };\n    Selection.prototype.updateRowProps = function (startIndex) {\n        this.prevRowIndex = startIndex;\n        this.isRowSelected = this.selectedRowIndexes.length && true;\n    };\n    Selection.prototype.updatePersistCollection = function (selectedRow, chkState) {\n        var _this = this;\n        if ((this.parent.isPersistSelection || this.parent.selectionSettings.persistSelection &&\n            this.parent.getPrimaryKeyFieldNames().length > 0) && !isNullOrUndefined(selectedRow)) {\n            if (!this.parent.isPersistSelection) {\n                this.ensureCheckboxFieldSelection();\n            }\n            var rowObj = this.getRowObj(selectedRow);\n            var pKey_1 = rowObj.data ? rowObj.data[this.primaryKey] : null;\n            if (pKey_1 === null) {\n                return;\n            }\n            rowObj.isSelected = chkState;\n            if (chkState) {\n                this.selectedRowState[pKey_1] = chkState;\n                if (!this.persistSelectedData.some(function (data) { return data[_this.primaryKey] === pKey_1; })) {\n                    this.persistSelectedData.push(rowObj.data);\n                }\n            }\n            else {\n                this.updatePersistDelete(pKey_1);\n            }\n        }\n    };\n    Selection.prototype.updatePersistDelete = function (pKey) {\n        var _this = this;\n        delete (this.selectedRowState[pKey]);\n        var index;\n        var isPresent = this.persistSelectedData.some(function (data, i) {\n            index = i;\n            return data[_this.primaryKey] === pKey;\n        });\n        if (isPresent) {\n            this.persistSelectedData.splice(index, 1);\n        }\n    };\n    Selection.prototype.updateCheckBoxes = function (row, chkState, rowIndex) {\n        if (!isNullOrUndefined(row)) {\n            var chkBox = row.querySelector('.e-checkselect');\n            if (!isNullOrUndefined(chkBox)) {\n                removeAddCboxClasses(chkBox.nextElementSibling, chkState);\n                setChecked(chkBox, chkState);\n                if (isNullOrUndefined(this.checkedTarget) || (!isNullOrUndefined(this.checkedTarget)\n                    && !this.checkedTarget.classList.contains('e-checkselectall'))) {\n                    this.setCheckAllState(rowIndex);\n                }\n            }\n        }\n    };\n    Selection.prototype.updateRowSelection = function (selectedRow, startIndex) {\n        if (!selectedRow) {\n            return;\n        }\n        this.selectedRowIndexes.push(startIndex);\n        var len = this.selectedRowIndexes.length;\n        if (this.parent.getFrozenColumns() && len > 1) {\n            if ((this.selectedRowIndexes[len - 2] === this.selectedRowIndexes[len - 1])) {\n                this.selectedRowIndexes.pop();\n            }\n        }\n        this.selectedRecords.push(selectedRow);\n        selectedRow.setAttribute('aria-selected', 'true');\n        this.updatePersistCollection(selectedRow, true);\n        this.updateCheckBoxes(selectedRow, true);\n        this.addRemoveClassesForRow(selectedRow, true, null, 'e-selectionbackground', 'e-active');\n        if (!this.preventFocus) {\n            var target = this.focus.getPrevIndexes().cellIndex ?\n                selectedRow.cells[this.focus.getPrevIndexes().cellIndex] :\n                selectedRow.querySelector('.e-selectionbackground:not(.e-hide):not(.e-detailrowcollapse):not(.e-detailrowexpand)');\n            if (this.parent.contextMenuModule && this.mouseButton === 2) {\n                target = this.parent.contextMenuModule.cell;\n            }\n            if (!target) {\n                return;\n            }\n            this.focus.onClick({ target: target }, true);\n        }\n    };\n    /**\n     * Deselects the currently selected rows and cells.\n     * @return {void}\n     */\n    Selection.prototype.clearSelection = function () {\n        if (!this.parent.isPersistSelection || (this.parent.isPersistSelection && !this.parent.isEdit) ||\n            (!isNullOrUndefined(this.checkedTarget) && this.checkedTarget.classList.contains('e-checkselectall'))) {\n            var span = this.parent.element.querySelector('.e-gridpopup').querySelector('span');\n            if (span.classList.contains('e-rowselect')) {\n                span.classList.remove('e-spanclicked');\n            }\n            if (this.parent.isPersistSelection) {\n                this.persistSelectedData = [];\n                this.selectedRowState = {};\n            }\n            this.clearRowSelection();\n            this.clearCellSelection();\n            this.prevRowIndex = undefined;\n            this.enableSelectMultiTouch = false;\n            this.isInteracted = false;\n        }\n    };\n    /**\n     * Deselects the currently selected rows.\n     * @return {void}\n     */\n    Selection.prototype.clearRowSelection = function () {\n        var _this = this;\n        if (this.isRowSelected) {\n            var gObj = this.parent;\n            var rows_1 = this.parent.getDataRows();\n            var data_1 = [];\n            var row_1 = [];\n            var mRow_1 = [];\n            var rowIndex_1 = [];\n            var frzCols = gObj.getFrozenColumns();\n            var foreignKeyData_1 = [];\n            var target_1 = this.target;\n            var currentViewData = this.parent.getCurrentViewRecords();\n            for (var i = 0, len = this.selectedRowIndexes.length; i < len; i++) {\n                var currentRow = this.parent.editSettings.mode === 'Batch' ?\n                    this.parent.getRows()[this.selectedRowIndexes[i]]\n                    : this.parent.getDataRows()[this.selectedRowIndexes[i]];\n                var rowObj = this.getRowObj(currentRow);\n                if (rowObj) {\n                    data_1.push(rowObj.data);\n                    row_1.push(currentRow);\n                    rowIndex_1.push(this.selectedRowIndexes[i]);\n                    foreignKeyData_1.push(rowObj.foreignKeyData);\n                }\n                if (frzCols) {\n                    mRow_1.push(gObj.getMovableRows()[this.selectedRowIndexes[i]]);\n                }\n            }\n            if (this.selectionSettings.persistSelection && this.selectionSettings.checkboxMode !== 'ResetOnRowClick') {\n                this.isInteracted = this.checkSelectAllClicked ? true : false;\n            }\n            this.rowDeselect(events.rowDeselecting, rowIndex_1, data_1, row_1, foreignKeyData_1, target_1, mRow_1, function () {\n                if (_this.isCancelDeSelect && (_this.isInteracted || _this.checkSelectAllClicked)) {\n                    if (_this.parent.isPersistSelection) {\n                        if (_this.getCheckAllStatus(_this.parent.element.querySelector('.e-checkselectall')) === 'Intermediate') {\n                            for (var i = 0; i < _this.selectedRecords.length; i++) {\n                                _this.updatePersistCollection(_this.selectedRecords[i], true);\n                            }\n                        }\n                        else {\n                            _this.parent.checkAllRows = 'Check';\n                            _this.updatePersistSelectedData(true);\n                        }\n                    }\n                    if (_this.clearRowCheck) {\n                        _this.clearRowCallBack();\n                        _this.clearRowCheck = false;\n                        if (_this.selectRowCheck) {\n                            _this.selectRowCallBack();\n                            _this.selectRowCheck = false;\n                        }\n                    }\n                    return;\n                }\n                var element = [].slice.call(rows_1.filter(function (record) { return record.hasAttribute('aria-selected'); }));\n                for (var j = 0; j < element.length; j++) {\n                    if (!_this.disableUI || isBlazor()) {\n                        element[j].removeAttribute('aria-selected');\n                        _this.addRemoveClassesForRow(element[j], false, true, 'e-selectionbackground', 'e-active');\n                    }\n                    // tslint:disable-next-line:align\n                    _this.updatePersistCollection(element[j], false);\n                    _this.updateCheckBoxes(element[j]);\n                }\n                if (isBlazor() && _this.parent.isServerRendered && _this.parent.enableVirtualization) {\n                    _this.getRenderer().setSelection(null, false, true);\n                }\n                for (var i = 0, len = _this.selectedRowIndexes.length; i < len; i++) {\n                    var movableRow = _this.getSelectedMovableRow(_this.selectedRowIndexes[i]);\n                    if (movableRow) {\n                        if (!_this.disableUI || isBlazor()) {\n                            movableRow.removeAttribute('aria-selected');\n                            _this.addRemoveClassesForRow(movableRow, false, true, 'e-selectionbackground', 'e-active');\n                        }\n                        _this.updatePersistCollection(movableRow, false);\n                    }\n                }\n                _this.selectedRowIndexes = [];\n                _this.selectedRecords = [];\n                _this.isRowSelected = false;\n                _this.selectRowIndex(-1);\n                _this.rowDeselect(events.rowDeselected, rowIndex_1, data_1, row_1, foreignKeyData_1, target_1, mRow_1);\n                if (_this.clearRowCheck) {\n                    _this.clearRowCallBack();\n                    _this.clearRowCheck = false;\n                    if (_this.selectRowCheck) {\n                        _this.selectRowCallBack();\n                        _this.selectRowCheck = false;\n                    }\n                }\n            });\n        }\n        else {\n            if (this.clearRowCheck) {\n                this.clearRowCallBack();\n                this.clearRowCheck = false;\n                if (this.selectRowCheck) {\n                    this.selectRowCallBack();\n                    this.selectRowCheck = false;\n                }\n            }\n        }\n    };\n    Selection.prototype.rowDeselect = function (type, rowIndex, data, row, foreignKeyData, target, mRow, rowDeselectCallBack) {\n        var _this = this;\n        if ((this.selectionSettings.persistSelection && this.isInteracted) || !this.selectionSettings.persistSelection) {\n            var cancl_1 = 'cancel';\n            var rowDeselectObj = {\n                rowIndex: rowIndex[0], data: this.selectionSettings.persistSelection && this.parent.checkAllRows === 'Uncheck'\n                    && this.selectionSettings.checkboxMode !== 'ResetOnRowClick' ?\n                    this.persistSelectedData : data, foreignKeyData: foreignKeyData,\n                cancel: false, isInteracted: this.isInteracted, isHeaderCheckboxClicked: this.isHeaderCheckboxClicked\n            };\n            if (type === 'rowDeselected') {\n                delete rowDeselectObj.cancel;\n            }\n            var isHybrid = 'isHybrid';\n            if (!isBlazor() || this.parent.isJsComponent || this.parent[isHybrid]) {\n                var rowInString = 'row';\n                var target_2 = 'target';\n                var rowidx = 'rowIndex';\n                var rowidxex = 'rowIndexes';\n                var data_2 = 'data';\n                var foreignKey = 'foreignKeyData';\n                rowDeselectObj[rowInString] = row;\n                rowDeselectObj[target_2] = this.actualTarget;\n                var isHeaderCheckBxClick = this.actualTarget && !isNullOrUndefined(closest(this.actualTarget, 'thead'));\n                if (isHeaderCheckBxClick || rowIndex.length > 1) {\n                    rowDeselectObj[rowidx] = rowIndex[0];\n                    rowDeselectObj[rowidxex] = rowIndex;\n                }\n                else if (rowIndex.length === 1) {\n                    rowDeselectObj[data_2] = rowDeselectObj[data_2][0];\n                    rowDeselectObj[rowInString] = rowDeselectObj[rowInString][0];\n                    rowDeselectObj[foreignKey] = rowDeselectObj[foreignKey][0];\n                    if (this.isAddRowsToSelection) {\n                        rowDeselectObj[rowidxex] = rowIndex;\n                    }\n                }\n            }\n            else {\n                var rowIndex_2 = 'rowIndex';\n                var data_3 = 'data';\n                rowDeselectObj[rowIndex_2] = rowDeselectObj[rowIndex_2][rowDeselectObj[rowIndex_2].length - 1];\n                rowDeselectObj[data_3] = rowDeselectObj[data_3][rowDeselectObj[data_3].length - 1];\n            }\n            this.parent.trigger(type, (!isBlazor() || this.parent.isJsComponent) && this.parent.getFrozenColumns() !== 0 ? __assign({}, rowDeselectObj, { mRow: mRow }) : rowDeselectObj, function (args) {\n                _this.isCancelDeSelect = args[cancl_1];\n                if (!_this.isCancelDeSelect || (!_this.isInteracted && !_this.checkSelectAllClicked)) {\n                    _this.updatePersistCollection(row[0], false);\n                    _this.updateCheckBoxes(row[0], undefined, rowIndex[0]);\n                }\n                if (rowDeselectCallBack !== undefined) {\n                    rowDeselectCallBack();\n                }\n            });\n        }\n        else if (this.selectionSettings.persistSelection && !this.isInteracted) {\n            if (rowDeselectCallBack !== undefined) {\n                rowDeselectCallBack();\n            }\n        }\n    };\n    Selection.prototype.getRowObj = function (row) {\n        if (row === void 0) { row = this.currentIndex; }\n        if (isNullOrUndefined(row)) {\n            return {};\n        }\n        if (typeof row === 'number') {\n            row = this.parent.getRowByIndex(row);\n        }\n        if (row) {\n            return this.parent.getRowObjectFromUID(row.getAttribute('data-uid')) || {};\n        }\n        return {};\n    };\n    Selection.prototype.getSelectedMovableCell = function (cellIndex) {\n        var gObj = this.parent;\n        var frzCols = gObj.getFrozenColumns();\n        if (frzCols) {\n            if (cellIndex.cellIndex >= frzCols) {\n                return gObj.getMovableCellFromIndex(cellIndex.rowIndex, this.getColIndex(cellIndex.rowIndex, cellIndex.cellIndex));\n            }\n            return null;\n        }\n        return null;\n    };\n    /**\n     * Selects a cell by the given index.\n     * @param  {IIndex} cellIndex - Defines the row and column indexes.\n     * @param  {boolean} isToggle - If set to true, then it toggles the selection.\n     * @return {void}\n     */\n    Selection.prototype.selectCell = function (cellIndex, isToggle) {\n        if (!this.isCellType()) {\n            return;\n        }\n        var gObj = this.parent;\n        var selectedCell = this.getSelectedMovableCell(cellIndex);\n        var args;\n        if (!selectedCell) {\n            selectedCell = gObj.getCellFromIndex(cellIndex.rowIndex, this.getColIndex(cellIndex.rowIndex, cellIndex.cellIndex));\n        }\n        var selectedTable;\n        var cIdx;\n        this.currentIndex = cellIndex.rowIndex;\n        var selectedData = this.getCurrentBatchRecordChanges()[this.currentIndex];\n        if (!this.isCellType() || !selectedCell || this.isEditing()) {\n            return;\n        }\n        var isCellSelected = selectedCell.classList.contains('e-cellselectionbackground');\n        isToggle = !isToggle ? isToggle : (!isUndefined(this.prevCIdxs) &&\n            cellIndex.rowIndex === this.prevCIdxs.rowIndex && cellIndex.cellIndex === this.prevCIdxs.cellIndex &&\n            isCellSelected);\n        if (!isToggle) {\n            args = {\n                data: selectedData, cellIndex: cellIndex,\n                isCtrlPressed: this.isMultiCtrlRequest, isShiftPressed: this.isMultiShiftRequest,\n                previousRowCell: this.prevECIdxs ?\n                    this.getCellIndex(this.prevECIdxs.rowIndex, this.prevECIdxs.cellIndex) : undefined,\n                cancel: false\n            };\n            if (!isBlazor() || this.parent.isJsComponent) {\n                var currentCell = 'currentCell';\n                args[currentCell] = selectedCell;\n                var previousRowCellIndex = 'previousRowCellIndex';\n                args[previousRowCellIndex] = this.prevECIdxs;\n            }\n            this.parent.trigger(events.cellSelecting, this.fDataUpdate(args), this.successCallBack(args, isToggle, cellIndex, selectedCell, selectedData));\n            this.cellselected = true;\n        }\n        else {\n            this.successCallBack(args, isToggle, cellIndex, selectedCell, selectedData)(args);\n        }\n    };\n    Selection.prototype.successCallBack = function (cellSelectingArgs, isToggle, cellIndex, selectedCell, selectedData) {\n        var _this = this;\n        return function (cellSelectingArgs) {\n            var cncl = 'cancel';\n            var currentCell = 'currentCell';\n            if (!isNullOrUndefined(cellSelectingArgs) && cellSelectingArgs[cncl] === true) {\n                return;\n            }\n            if (!isToggle) {\n                cellSelectingArgs[currentCell] = cellSelectingArgs[currentCell] ? cellSelectingArgs[currentCell] : selectedCell;\n            }\n            _this.clearCell();\n            if (!isToggle) {\n                _this.updateCellSelection(selectedCell, cellIndex.rowIndex, cellIndex.cellIndex);\n            }\n            if (!isToggle) {\n                var args = void 0;\n                var isHybrid = 'isHybrid';\n                if (!isBlazor() || _this.parent.isJsComponent || _this.parent[isHybrid]) {\n                    args = {\n                        data: selectedData, cellIndex: cellIndex, currentCell: selectedCell,\n                        selectedRowCellIndex: _this.selectedRowCellIndexes,\n                        previousRowCell: _this.prevECIdxs ?\n                            _this.getCellIndex(_this.prevECIdxs.rowIndex, _this.prevECIdxs.cellIndex) : undefined\n                    };\n                    var previousRowCellIndex = 'previousRowCellIndex';\n                    args[previousRowCellIndex] = _this.prevECIdxs;\n                }\n                else {\n                    args = { data: selectedData, cellIndex: cellIndex, selectedRowCellIndex: _this.selectedRowCellIndexes };\n                }\n                _this.updateCellProps(cellIndex, cellIndex);\n                _this.onActionComplete(args, events.cellSelected);\n            }\n        };\n    };\n    Selection.prototype.getCellIndex = function (rIdx, cIdx) {\n        return (this.parent.getFrozenColumns() ? (cIdx >= this.parent.getFrozenColumns() ? this.parent.getMovableCellFromIndex(rIdx, cIdx)\n            : this.parent.getCellFromIndex(rIdx, cIdx)) : this.parent.getCellFromIndex(rIdx, cIdx));\n    };\n    /**\n     * Selects a range of cells from start and end indexes.\n     * @param  {IIndex} startIndex - Specifies the row and column's start index.\n     * @param  {IIndex} endIndex - Specifies the row and column's end index.\n     * @return {void}\n     */\n    Selection.prototype.selectCellsByRange = function (startIndex, endIndex) {\n        var _this = this;\n        if (!this.isCellType()) {\n            return;\n        }\n        var gObj = this.parent;\n        var selectedCell = this.getSelectedMovableCell(startIndex);\n        var frzCols = gObj.getFrozenColumns();\n        if (!selectedCell) {\n            selectedCell = gObj.getCellFromIndex(startIndex.rowIndex, startIndex.cellIndex);\n        }\n        var min;\n        var max;\n        var stIndex = startIndex;\n        var edIndex = endIndex = endIndex ? endIndex : startIndex;\n        var cellIndexes;\n        this.currentIndex = startIndex.rowIndex;\n        var cncl = 'cancel';\n        var selectedData = this.getCurrentBatchRecordChanges()[this.currentIndex];\n        if (this.isSingleSel() || !this.isCellType() || this.isEditing()) {\n            return;\n        }\n        var args = {\n            data: selectedData, cellIndex: startIndex, currentCell: selectedCell,\n            isCtrlPressed: this.isMultiCtrlRequest, isShiftPressed: this.isMultiShiftRequest,\n            previousRowCell: this.prevECIdxs ? this.getCellIndex(this.prevECIdxs.rowIndex, this.prevECIdxs.cellIndex) : undefined\n        };\n        if (!isBlazor()) {\n            var previousRowCellIndex = 'previousRowCellIndex';\n            args[previousRowCellIndex] = this.prevECIdxs;\n        }\n        this.parent.trigger(events.cellSelecting, this.fDataUpdate(args), function (cellSelectingArgs) {\n            if (!isNullOrUndefined(cellSelectingArgs) && cellSelectingArgs[cncl] === true) {\n                return;\n            }\n            _this.clearCell();\n            if (startIndex.rowIndex > endIndex.rowIndex) {\n                var temp = startIndex;\n                startIndex = endIndex;\n                endIndex = temp;\n            }\n            for (var i = startIndex.rowIndex; i <= endIndex.rowIndex; i++) {\n                if (_this.selectionSettings.cellSelectionMode.indexOf('Box') < 0) {\n                    min = i === startIndex.rowIndex ? (startIndex.cellIndex) : 0;\n                    max = i === endIndex.rowIndex ? (endIndex.cellIndex) : _this.getLastColIndex(i);\n                }\n                else {\n                    min = startIndex.cellIndex;\n                    max = endIndex.cellIndex;\n                }\n                cellIndexes = [];\n                for (var j = min < max ? min : max, len = min > max ? min : max; j <= len; j++) {\n                    if (frzCols) {\n                        if (j < frzCols) {\n                            selectedCell = gObj.getCellFromIndex(i, j);\n                        }\n                        else {\n                            selectedCell = gObj.getMovableCellFromIndex(i, j);\n                        }\n                    }\n                    else {\n                        selectedCell = gObj.getCellFromIndex(i, j);\n                    }\n                    if (!selectedCell) {\n                        continue;\n                    }\n                    cellIndexes.push(j);\n                    _this.updateCellSelection(selectedCell);\n                    _this.addAttribute(selectedCell);\n                }\n                _this.selectedRowCellIndexes.push({ rowIndex: i, cellIndexes: cellIndexes });\n            }\n            var cellSelectedArgs;\n            var isHybrid = 'isHybrid';\n            if (!isBlazor() || _this.parent.isJsComponent || _this.parent[isHybrid]) {\n                cellSelectedArgs = {\n                    data: selectedData, cellIndex: edIndex, currentCell: gObj.getCellFromIndex(edIndex.rowIndex, edIndex.cellIndex),\n                    selectedRowCellIndex: _this.selectedRowCellIndexes,\n                    previousRowCell: _this.prevECIdxs ? _this.getCellIndex(_this.prevECIdxs.rowIndex, _this.prevECIdxs.cellIndex) : undefined\n                };\n                var previousRowCellIndex = 'previousRowCellIndex';\n                cellSelectedArgs[previousRowCellIndex] = _this.prevECIdxs;\n            }\n            else {\n                cellSelectedArgs = { data: selectedData, cellIndex: edIndex, selectedRowCellIndex: _this.selectedRowCellIndexes };\n            }\n            if (!_this.isDragged) {\n                _this.onActionComplete(cellSelectedArgs, events.cellSelected);\n                _this.cellselected = true;\n            }\n            _this.updateCellProps(stIndex, edIndex);\n        });\n    };\n    /**\n     * Selects a collection of cells by row and column indexes.\n     * @param  {ISelectedCell[]} rowCellIndexes - Specifies the row and column indexes.\n     * @return {void}\n     */\n    Selection.prototype.selectCells = function (rowCellIndexes) {\n        if (!this.isCellType()) {\n            return;\n        }\n        var gObj = this.parent;\n        var selectedCell = this.getSelectedMovableCell(rowCellIndexes[0]);\n        var frzCols = gObj.getFrozenColumns();\n        if (!selectedCell) {\n            selectedCell = gObj.getCellFromIndex(rowCellIndexes[0].rowIndex, rowCellIndexes[0].cellIndexes[0]);\n        }\n        this.currentIndex = rowCellIndexes[0].rowIndex;\n        var selectedData = this.getCurrentBatchRecordChanges()[this.currentIndex];\n        if (this.isSingleSel() || !this.isCellType() || this.isEditing()) {\n            return;\n        }\n        var cellSelectArgs;\n        var isHybrid = 'isHybrid';\n        if (!isBlazor() || this.parent.isJsComponent || this.parent[isHybrid]) {\n            cellSelectArgs = {\n                data: selectedData, cellIndex: rowCellIndexes[0].cellIndexes[0],\n                currentCell: selectedCell, isCtrlPressed: this.isMultiCtrlRequest,\n                isShiftPressed: this.isMultiShiftRequest,\n                previousRowCell: this.prevECIdxs ? this.getCellIndex(this.prevECIdxs.rowIndex, this.prevECIdxs.cellIndex) : undefined\n            };\n            var previousRowCellIndex = 'previousRowCellIndex';\n            cellSelectArgs[previousRowCellIndex] = this.prevECIdxs;\n        }\n        else {\n            cellSelectArgs = {\n                data: selectedData, cellIndex: rowCellIndexes[0].cellIndexes[0],\n                isCtrlPressed: this.isMultiCtrlRequest, isShiftPressed: this.isMultiShiftRequest\n            };\n        }\n        this.onActionBegin(cellSelectArgs, events.cellSelecting);\n        for (var i = 0, len = rowCellIndexes.length; i < len; i++) {\n            for (var j = 0, cellLen = rowCellIndexes[i].cellIndexes.length; j < cellLen; j++) {\n                if (frzCols) {\n                    if (rowCellIndexes[i].cellIndexes[j] < frzCols) {\n                        selectedCell = gObj.getCellFromIndex(rowCellIndexes[i].rowIndex, rowCellIndexes[i].cellIndexes[j]);\n                    }\n                    else {\n                        selectedCell = gObj.getMovableCellFromIndex(rowCellIndexes[i].rowIndex, rowCellIndexes[i].cellIndexes[j]);\n                    }\n                }\n                else {\n                    selectedCell = gObj.getCellFromIndex(rowCellIndexes[i].rowIndex, rowCellIndexes[i].cellIndexes[j]);\n                }\n                if (!selectedCell) {\n                    continue;\n                }\n                this.updateCellSelection(selectedCell);\n                this.addAttribute(selectedCell);\n                this.addRowCellIndex({ rowIndex: rowCellIndexes[i].rowIndex, cellIndex: rowCellIndexes[i].cellIndexes[j] });\n            }\n        }\n        this.updateCellProps({ rowIndex: rowCellIndexes[0].rowIndex, cellIndex: rowCellIndexes[0].cellIndexes[0] }, { rowIndex: rowCellIndexes[0].rowIndex, cellIndex: rowCellIndexes[0].cellIndexes[0] });\n        var cellSelectedArgs;\n        if (!isBlazor() || this.parent.isJsComponent || this.parent[isHybrid]) {\n            cellSelectedArgs = {\n                data: selectedData, cellIndex: rowCellIndexes[0].cellIndexes[0],\n                currentCell: selectedCell, selectedRowCellIndex: this.selectedRowCellIndexes,\n                previousRowCell: this.prevECIdxs ? this.getCellIndex(this.prevECIdxs.rowIndex, this.prevECIdxs.cellIndex) : undefined\n            };\n            var previousRowCellIndex = 'previousRowCellIndex';\n            cellSelectedArgs[previousRowCellIndex] = this.prevECIdxs;\n        }\n        else {\n            cellSelectedArgs = { data: selectedData, cellIndex: rowCellIndexes[0].cellIndexes[0],\n                selectedRowCellIndex: this.selectedRowCellIndexes };\n        }\n        this.onActionComplete(cellSelectedArgs, events.cellSelected);\n    };\n    /**\n     * Select cells with existing cell selection by passing row and column index.\n     * @param  {IIndex} startIndex - Defines the collection of row and column index.\n     * @return {void}\n     * @hidden\n     */\n    Selection.prototype.addCellsToSelection = function (cellIndexes) {\n        if (!this.isCellType()) {\n            return;\n        }\n        var gObj = this.parent;\n        var selectedTable;\n        var cIdx;\n        var selectedCell;\n        var frzCols = gObj.getFrozenColumns();\n        var index;\n        this.currentIndex = cellIndexes[0].rowIndex;\n        var cncl = 'cancel';\n        var selectedData = this.getCurrentBatchRecordChanges()[this.currentIndex];\n        var isHybrid = 'isHybrid';\n        if (this.isSingleSel() || !this.isCellType() || this.isEditing()) {\n            return;\n        }\n        this.hideAutoFill();\n        var rowObj;\n        if (frzCols && cellIndexes[0].cellIndex >= frzCols) {\n            rowObj = gObj.getMovableRowsObject()[cellIndexes[0].rowIndex];\n        }\n        else {\n            rowObj = this.getRowObj(cellIndexes[0].rowIndex);\n        }\n        var foreignKeyData = [];\n        for (var _i = 0, cellIndexes_1 = cellIndexes; _i < cellIndexes_1.length; _i++) {\n            var cellIndex = cellIndexes_1[_i];\n            for (var i = 0, len = this.selectedRowCellIndexes.length; i < len; i++) {\n                if (this.selectedRowCellIndexes[i].rowIndex === cellIndex.rowIndex) {\n                    index = i;\n                    break;\n                }\n            }\n            selectedCell = this.getSelectedMovableCell(cellIndex);\n            if (!selectedCell) {\n                selectedCell = gObj.getCellFromIndex(cellIndex.rowIndex, this.getColIndex(cellIndex.rowIndex, cellIndex.cellIndex));\n            }\n            foreignKeyData.push(rowObj.cells[frzCols && cellIndexes[0].cellIndex >= frzCols\n                ? cellIndex.cellIndex - frzCols : cellIndex.cellIndex].foreignKeyData);\n            var args = void 0;\n            if (!isBlazor() || this.parent.isJsComponent || this.parent[isHybrid]) {\n                args = {\n                    cancel: false, data: selectedData, cellIndex: cellIndexes[0],\n                    isShiftPressed: this.isMultiShiftRequest,\n                    currentCell: selectedCell, isCtrlPressed: this.isMultiCtrlRequest,\n                    previousRowCell: this.prevECIdxs ?\n                        gObj.getCellFromIndex(this.prevECIdxs.rowIndex, this.prevECIdxs.cellIndex) : undefined,\n                };\n                var previousRowCellIndex = 'previousRowCellIndex';\n                args[previousRowCellIndex] = this.prevECIdxs;\n            }\n            else {\n                args = {\n                    cancel: false, data: selectedData, cellIndex: cellIndexes[0],\n                    isShiftPressed: this.isMultiShiftRequest, isCtrlPressed: this.isMultiCtrlRequest\n                };\n            }\n            var isUnSelected = index > -1;\n            if (isUnSelected) {\n                var selectedCellIdx = this.selectedRowCellIndexes[index].cellIndexes;\n                if (selectedCellIdx.indexOf(cellIndex.cellIndex) > -1) {\n                    this.cellDeselect(events.cellDeselecting, [{ rowIndex: cellIndex.rowIndex, cellIndexes: [cellIndex.cellIndex] }], selectedData, [selectedCell], foreignKeyData);\n                    selectedCellIdx.splice(selectedCellIdx.indexOf(cellIndex.cellIndex), 1);\n                    if (selectedCellIdx.length === 0) {\n                        this.selectedRowCellIndexes.splice(index, 1);\n                    }\n                    selectedCell.classList.remove('e-cellselectionbackground');\n                    selectedCell.removeAttribute('aria-selected');\n                    this.cellDeselect(events.cellDeselected, [{ rowIndex: cellIndex.rowIndex, cellIndexes: [cellIndex.cellIndex] }], selectedData, [selectedCell], foreignKeyData);\n                }\n                else {\n                    isUnSelected = false;\n                    this.onActionBegin(args, events.cellSelecting);\n                    this.addRowCellIndex({ rowIndex: cellIndex.rowIndex, cellIndex: cellIndex.cellIndex });\n                    this.updateCellSelection(selectedCell);\n                    this.addAttribute(selectedCell);\n                }\n            }\n            else {\n                this.onActionBegin(args, events.cellSelecting);\n                if (!isNullOrUndefined(args) && args[cncl] === true) {\n                    return;\n                }\n                this.updateCellSelection(selectedCell, cellIndex.rowIndex, cellIndex.cellIndex);\n            }\n            if (!isUnSelected) {\n                var cellSelectedArgs = void 0;\n                if (!isBlazor() || this.parent.isJsComponent || this.parent[isHybrid]) {\n                    cellSelectedArgs = {\n                        data: selectedData, cellIndex: cellIndexes[0], currentCell: selectedCell,\n                        previousRowCell: this.prevECIdxs ? this.getCellIndex(this.prevECIdxs.rowIndex, this.prevECIdxs.cellIndex) :\n                            undefined, selectedRowCellIndex: this.selectedRowCellIndexes\n                    };\n                    var previousRowCellIndex = 'previousRowCellIndex';\n                    cellSelectedArgs[previousRowCellIndex] = this.prevECIdxs;\n                }\n                else {\n                    cellSelectedArgs = { data: selectedData, cellIndex: cellIndexes[0], selectedRowCellIndex: this.selectedRowCellIndexes };\n                }\n                this.onActionComplete(cellSelectedArgs, events.cellSelected);\n                this.cellselected = true;\n            }\n            this.updateCellProps(cellIndex, cellIndex);\n        }\n    };\n    Selection.prototype.getColIndex = function (rowIndex, index) {\n        var cells;\n        var frzCols = this.parent.getFrozenColumns();\n        if (frzCols) {\n            if (index >= frzCols) {\n                cells = this.parent.getMovableDataRows()[rowIndex] &&\n                    this.parent.getMovableDataRows()[rowIndex].querySelectorAll('td.e-rowcell');\n            }\n        }\n        if (!cells) {\n            cells = this.parent.getDataRows()[rowIndex] &&\n                this.parent.getDataRows()[rowIndex].querySelectorAll('td.e-rowcell');\n        }\n        if (cells) {\n            for (var m = 0; m < cells.length; m++) {\n                var colIndex = parseInt(cells[m].getAttribute('aria-colindex'), 10);\n                if (colIndex === index) {\n                    if (frzCols) {\n                        if (index >= frzCols) {\n                            m += frzCols;\n                        }\n                    }\n                    return m;\n                }\n            }\n        }\n        return -1;\n    };\n    Selection.prototype.getLastColIndex = function (rowIndex) {\n        var cells = this.parent.getFrozenColumns() ? this.parent.getMovableDataRows()[rowIndex].querySelectorAll('td.e-rowcell')\n            : this.parent.getDataRows()[rowIndex].querySelectorAll('td.e-rowcell');\n        return parseInt(cells[cells.length - 1].getAttribute('aria-colindex'), 10);\n    };\n    Selection.prototype.clearCell = function () {\n        this.clearCellSelection();\n    };\n    Selection.prototype.cellDeselect = function (type, cellIndexes, data, cells, foreignKeyData) {\n        var cancl = 'cancel';\n        if (cells[0] && cells[0].classList.contains('e-gridchkbox')) {\n            this.updateCheckBoxes(closest(cells[0], 'tr'));\n        }\n        var args = {\n            cells: cells, data: data, cellIndexes: cellIndexes, foreignKeyData: foreignKeyData, cancel: false\n        };\n        this.parent.trigger(type, args);\n        this.isPreventCellSelect = args[cancl];\n    };\n    Selection.prototype.updateCellSelection = function (selectedCell, rowIndex, cellIndex) {\n        if (!isNullOrUndefined(rowIndex)) {\n            this.addRowCellIndex({ rowIndex: rowIndex, cellIndex: cellIndex });\n        }\n        selectedCell.classList.add('e-cellselectionbackground');\n        if (selectedCell.classList.contains('e-gridchkbox')) {\n            this.updateCheckBoxes(closest(selectedCell, 'tr'), true);\n        }\n        this.addAttribute(selectedCell);\n    };\n    Selection.prototype.addAttribute = function (cell) {\n        this.target = cell;\n        if (!isNullOrUndefined(cell)) {\n            cell.setAttribute('aria-selected', 'true');\n            if (!this.preventFocus) {\n                this.focus.onClick({ target: cell }, true);\n            }\n        }\n    };\n    Selection.prototype.updateCellProps = function (startIndex, endIndex) {\n        this.prevCIdxs = startIndex;\n        this.prevECIdxs = endIndex;\n        this.isCellSelected = this.selectedRowCellIndexes.length && true;\n    };\n    Selection.prototype.addRowCellIndex = function (rowCellIndex) {\n        var isRowAvail;\n        var index;\n        for (var i = 0, len = this.selectedRowCellIndexes.length; i < len; i++) {\n            if (this.selectedRowCellIndexes[i].rowIndex === rowCellIndex.rowIndex) {\n                isRowAvail = true;\n                index = i;\n                break;\n            }\n        }\n        if (isRowAvail) {\n            if (this.selectedRowCellIndexes[index].cellIndexes.indexOf(rowCellIndex.cellIndex) < 0) {\n                this.selectedRowCellIndexes[index].cellIndexes.push(rowCellIndex.cellIndex);\n            }\n        }\n        else {\n            this.selectedRowCellIndexes.push({ rowIndex: rowCellIndex.rowIndex, cellIndexes: [rowCellIndex.cellIndex] });\n        }\n    };\n    /**\n     * Deselects the currently selected cells.\n     * @return {void}\n     */\n    Selection.prototype.clearCellSelection = function () {\n        if (this.isCellSelected) {\n            var gObj = this.parent;\n            var selectedCells = this.getSelectedCellsElement();\n            var rowCell = this.selectedRowCellIndexes;\n            var data = [];\n            var cells = [];\n            var foreignKeyData = [];\n            var currentViewData = this.getCurrentBatchRecordChanges();\n            var selectedTable = void 0;\n            var frzCols = gObj.getFrozenColumns();\n            this.hideAutoFill();\n            for (var i = 0, len = rowCell.length; i < len; i++) {\n                data.push(currentViewData[rowCell[i].rowIndex]);\n                var rowObj = this.getRowObj(rowCell[i].rowIndex);\n                for (var j = 0, cLen = rowCell[i].cellIndexes.length; j < cLen; j++) {\n                    if (frzCols) {\n                        if (rowCell[i].cellIndexes[j] < frzCols) {\n                            cells.push(gObj.getCellFromIndex(rowCell[i].rowIndex, rowCell[i].cellIndexes[j]));\n                        }\n                        else {\n                            cells.push(gObj.getMovableCellFromIndex(rowCell[i].rowIndex, rowCell[i].cellIndexes[j]));\n                        }\n                    }\n                    else {\n                        if (rowObj.cells) {\n                            foreignKeyData.push(rowObj.cells[rowCell[i].cellIndexes[j]].foreignKeyData);\n                        }\n                        cells.push(gObj.getCellFromIndex(rowCell[i].rowIndex, rowCell[i].cellIndexes[j]));\n                    }\n                }\n            }\n            this.cellDeselect(events.cellDeselecting, rowCell, data, cells, foreignKeyData);\n            if (this.isPreventCellSelect === true) {\n                return;\n            }\n            for (var i = 0, len = selectedCells.length; i < len; i++) {\n                selectedCells[i].classList.remove('e-cellselectionbackground');\n                selectedCells[i].removeAttribute('aria-selected');\n            }\n            if (this.bdrElement) {\n                this.showHideBorders('none');\n            }\n            this.selectedRowCellIndexes = [];\n            this.isCellSelected = false;\n            if (!this.isDragged && this.cellselected) {\n                this.cellDeselect(events.cellDeselected, rowCell, data, cells, foreignKeyData);\n            }\n        }\n    };\n    Selection.prototype.getSelectedCellsElement = function () {\n        var gObj = this.parent;\n        var rows = gObj.getDataRows();\n        var mRows;\n        if (gObj.getFrozenColumns()) {\n            mRows = gObj.getMovableDataRows();\n            rows = gObj.addMovableRows(rows, mRows);\n        }\n        var cells = [];\n        for (var i = 0, len = rows.length; i < len; i++) {\n            cells = cells.concat([].slice.call(rows[i].querySelectorAll('.e-cellselectionbackground')));\n        }\n        return cells;\n    };\n    Selection.prototype.mouseMoveHandler = function (e) {\n        e.preventDefault();\n        var gBRect = this.parent.element.getBoundingClientRect();\n        var x1 = this.x;\n        var y1 = this.y;\n        var position = getPosition(e);\n        var x2 = position.x - gBRect.left;\n        var y2 = position.y - gBRect.top;\n        var tmp;\n        var target = closest(e.target, 'tr');\n        this.isDragged = true;\n        if (!this.isCellDrag) {\n            if (!target) {\n                target = closest(document.elementFromPoint(this.parent.element.offsetLeft + 2, e.clientY), 'tr');\n            }\n            if (x1 > x2) {\n                tmp = x2;\n                x2 = x1;\n                x1 = tmp;\n            }\n            if (y1 > y2) {\n                tmp = y2;\n                y2 = y1;\n                y1 = tmp;\n            }\n            this.element.style.left = x1 + 'px';\n            this.element.style.top = y1 + 'px';\n            this.element.style.width = x2 - x1 + 'px';\n            this.element.style.height = y2 - y1 + 'px';\n        }\n        if (target && !e.ctrlKey && !e.shiftKey) {\n            var rowIndex = parseInt(target.getAttribute('aria-rowindex'), 10);\n            if (!this.isCellDrag) {\n                this.hideAutoFill();\n                this.selectRowsByRange(this.startDIndex, rowIndex);\n            }\n            else {\n                var td = parentsUntil(e.target, 'e-rowcell');\n                if (td) {\n                    this.startAFCell = this.startCell;\n                    this.endAFCell = parentsUntil(e.target, 'e-rowcell');\n                    this.selectLikeExcel(e, rowIndex, parseInt(td.getAttribute('aria-colindex'), 10));\n                }\n            }\n        }\n    };\n    Selection.prototype.selectLikeExcel = function (e, rowIndex, cellIndex) {\n        if (!this.isAutoFillSel) {\n            this.clearCellSelection();\n            this.selectCellsByRange({ rowIndex: this.startDIndex, cellIndex: this.startDCellIndex }, { rowIndex: rowIndex, cellIndex: cellIndex });\n            this.drawBorders();\n        }\n        else { //Autofill\n            this.showAFBorders();\n            this.selectLikeAutoFill(e);\n        }\n    };\n    Selection.prototype.drawBorders = function () {\n        if (this.selectionSettings.cellSelectionMode === 'BoxWithBorder' && this.selectedRowCellIndexes.length && !this.parent.isEdit) {\n            this.parent.element.classList.add('e-enabledboxbdr');\n            if (!this.bdrElement) {\n                this.createBorders();\n            }\n            this.positionBorders();\n        }\n        else {\n            this.showHideBorders('none');\n        }\n    };\n    Selection.prototype.isLastCell = function (cell) {\n        var cells = [].slice.call(cell.parentElement.querySelectorAll('.e-rowcell:not(.e-hide)'));\n        return cells[cells.length - 1] === cell;\n    };\n    Selection.prototype.isLastRow = function (cell) {\n        var rows = [].slice.call(closest(cell, 'tbody').querySelectorAll('.e-row:not(.e-hiddenrow)'));\n        return cell.parentElement === rows[rows.length - 1];\n    };\n    Selection.prototype.isFirstRow = function (cell) {\n        var rows = [].slice.call(closest(cell, 'tbody').querySelectorAll('.e-row:not(.e-hiddenrow)'));\n        return cell.parentElement === rows[0];\n    };\n    Selection.prototype.isFirstCell = function (cell) {\n        var cells = [].slice.call(cell.parentElement.querySelectorAll('.e-rowcell:not(.e-hide)'));\n        return cells[0] === cell;\n    };\n    Selection.prototype.setBorders = function (parentEle, border, bdrStr) {\n        var cells = [].slice.call(parentEle.querySelectorAll('.e-cellselectionbackground')).\n            filter(function (ele) { return ele.style.display === ''; });\n        if (cells.length) {\n            var start = cells[0];\n            var end = cells[cells.length - 1];\n            var stOff = start.getBoundingClientRect();\n            var endOff = end.getBoundingClientRect();\n            var parentOff = start.offsetParent.getBoundingClientRect();\n            var rowHeight = this.isLastRow(end) && (bdrStr === '1' || bdrStr === '2') ? 2 : 0;\n            var topOffSet = this.parent.frozenRows && (bdrStr === '1' || bdrStr === '2') &&\n                this.isFirstRow(start) ? 1.5 : 0;\n            var leftOffset = this.parent.getFrozenColumns() && (bdrStr === '2' || bdrStr === '4') &&\n                this.isFirstCell(start) ? 1 : 0;\n            if (this.parent.enableRtl) {\n                border.style.right = parentOff.right - stOff.right - leftOffset + 'px';\n                border.style.width = stOff.right - endOff.left + leftOffset + 1 + 'px';\n            }\n            else {\n                border.style.left = stOff.left - parentOff.left - leftOffset + 'px';\n                border.style.width = endOff.right - stOff.left + leftOffset + 1 + 'px';\n            }\n            border.style.top = stOff.top - parentOff.top - topOffSet + 'px';\n            border.style.height = endOff.top - stOff.top > 0 ?\n                (endOff.top - parentOff.top + endOff.height + 1) - (stOff.top - parentOff.top) - rowHeight + topOffSet + 'px' :\n                endOff.height + topOffSet - rowHeight + 1 + 'px';\n            this.selectDirection += bdrStr;\n        }\n        else {\n            border.style.display = 'none';\n        }\n    };\n    Selection.prototype.positionBorders = function () {\n        this.updateStartEndCells();\n        if (!this.startCell || !this.bdrElement || !this.selectedRowCellIndexes.length) {\n            return;\n        }\n        this.selectDirection = '';\n        this.showHideBorders('');\n        this.setBorders(this.parent.getContentTable(), this.bdrElement, '1');\n        if (this.parent.getFrozenColumns()) {\n            this.setBorders(this.parent.contentModule.getMovableContent(), this.mcBdrElement, '2');\n        }\n        if (this.parent.frozenRows) {\n            this.setBorders(this.parent.getHeaderTable(), this.fhBdrElement, '3');\n            if (this.parent.getFrozenColumns()) {\n                this.setBorders(this.parent.headerModule.getMovableHeader(), this.mhBdrElement, '4');\n            }\n        }\n        this.applyBorders(this.selectDirection);\n    };\n    Selection.prototype.applyBorders = function (str) {\n        var rtl = this.parent.enableRtl;\n        switch (str.length) {\n            case 4:\n                {\n                    this.bdrElement.style.borderWidth = rtl ? '0 2px 2px 0' : '0 0 2px 2px';\n                    this.mcBdrElement.style.borderWidth = rtl ? '0 0 2px 2px' : '0 2px 2px 0';\n                    this.fhBdrElement.style.borderWidth = rtl ? '2px 2px 0 0' : '2px 0 0 2px';\n                    this.mhBdrElement.style.borderWidth = rtl ? '2px 0 0 2px' : '2px 2px 0 0';\n                }\n                break;\n            case 2:\n                {\n                    this.bdrElement.style.borderWidth = str.includes('2') ? rtl ? '2px 2px 2px 0' : '2px 0 2px 2px' : '0 2px 2px 2px';\n                    if (this.parent.getFrozenColumns()) {\n                        this.mcBdrElement.style.borderWidth = str.includes('1') ? rtl ? '2px 0 2px 2px' : '2px 2px 2px 0' : '0 2px 2px 2px';\n                    }\n                    if (this.parent.frozenRows) {\n                        this.fhBdrElement.style.borderWidth = str.includes('1') ? '2px 2px 0 2px' : rtl ? '2px 2px 2px 0' : '2px 0 2px 2px';\n                        if (this.parent.getFrozenColumns()) {\n                            this.mhBdrElement.style.borderWidth = str.includes('2') ? '2px 2px 0 2px' : rtl ? '2px 0 2px 2px' : '2px 2px 2px 0';\n                        }\n                    }\n                }\n                break;\n            default:\n                this.bdrElement.style.borderWidth = '2px';\n                if (this.parent.getFrozenColumns()) {\n                    this.mcBdrElement.style.borderWidth = '2px';\n                }\n                if (this.parent.frozenRows) {\n                    this.fhBdrElement.style.borderWidth = '2px';\n                    if (this.parent.getFrozenColumns()) {\n                        this.mhBdrElement.style.borderWidth = '2px';\n                    }\n                }\n                break;\n        }\n    };\n    Selection.prototype.createBorders = function () {\n        if (!this.bdrElement) {\n            this.bdrElement = this.parent.getContentTable().parentElement.appendChild(createElement('div', {\n                className: 'e-xlsel', id: this.parent.element.id + '_bdr',\n                styles: 'width: 2px; border-width: 0;'\n            }));\n            if (this.parent.getFrozenColumns()) {\n                this.mcBdrElement = this.parent.contentModule.getMovableContent().appendChild(createElement('div', {\n                    className: 'e-xlsel', id: this.parent.element.id + '_mcbdr',\n                    styles: 'height: 2px; border-width: 0;'\n                }));\n            }\n            if (this.parent.frozenRows) {\n                this.fhBdrElement = this.parent.getHeaderTable().parentElement.appendChild(createElement('div', { className: 'e-xlsel', id: this.parent.element.id + '_fhbdr', styles: 'height: 2px;' }));\n            }\n            if (this.parent.frozenRows && this.parent.getFrozenColumns()) {\n                this.mhBdrElement = this.parent.headerModule.getMovableHeader().appendChild(createElement('div', { className: 'e-xlsel', id: this.parent.element.id + '_mhbdr', styles: 'height: 2px;' }));\n            }\n        }\n    };\n    Selection.prototype.showHideBorders = function (display) {\n        if (this.bdrElement) {\n            this.bdrElement.style.display = display;\n            if (this.parent.getFrozenColumns()) {\n                this.mcBdrElement.style.display = display;\n            }\n            if (this.parent.frozenRows) {\n                this.fhBdrElement.style.display = display;\n            }\n            if (this.parent.frozenRows && this.parent.getFrozenColumns()) {\n                this.mhBdrElement.style.display = display;\n            }\n        }\n    };\n    Selection.prototype.drawAFBorders = function () {\n        if (!this.bdrAFBottom) {\n            this.createAFBorders();\n        }\n        this.positionAFBorders();\n    };\n    Selection.prototype.positionAFBorders = function () {\n        if (!this.startCell || !this.bdrAFLeft) {\n            return;\n        }\n        var stOff = this.startAFCell.getBoundingClientRect();\n        var endOff = this.endAFCell.getBoundingClientRect();\n        var top = endOff.top - stOff.top > 0 ? 1 : 0;\n        var firstCellTop = endOff.top - stOff.top >= 0 && (parentsUntil(this.startAFCell, 'e-movablecontent') ||\n            parentsUntil(this.startAFCell, 'e-frozencontent')) && this.isFirstRow(this.startAFCell) ? 1.5 : 0;\n        var firstCellLeft = (parentsUntil(this.startAFCell, 'e-movablecontent') ||\n            parentsUntil(this.startAFCell, 'e-movableheader')) && this.isFirstCell(this.startAFCell) ? 1 : 0;\n        var rowHeight = this.isLastRow(this.endAFCell) && (parentsUntil(this.endAFCell, 'e-movablecontent') ||\n            parentsUntil(this.endAFCell, 'e-frozencontent')) ? 2 : 0;\n        var parentOff = this.startAFCell.offsetParent.getBoundingClientRect();\n        var parentRect = this.parent.element.getBoundingClientRect();\n        var sTop = this.startAFCell.offsetParent.parentElement.scrollTop;\n        var sLeft = this.startAFCell.offsetParent.parentElement.scrollLeft;\n        var scrollTop = sTop - this.startAFCell.offsetTop;\n        var scrollLeft = sLeft - this.startAFCell.offsetLeft;\n        var totalHeight = this.parent.element.clientHeight;\n        var totalWidth = this.parent.element.clientWidth;\n        scrollTop = scrollTop > 0 ? Math.floor(scrollTop) - 1 : 0;\n        scrollLeft = scrollLeft > 0 ? scrollLeft : 0;\n        var left = stOff.left - parentRect.left;\n        if (!this.parent.enableRtl) {\n            this.bdrAFLeft.style.left = left - firstCellLeft + scrollLeft - 1 + 'px';\n            this.bdrAFRight.style.left = endOff.left - parentRect.left - 2 + endOff.width + 'px';\n            this.bdrAFRight.style.width = totalWidth <= parseInt(this.bdrAFRight.style.left, 10) ? '0px' : '2px';\n            this.bdrAFTop.style.left = left + scrollLeft - 0.5 + 'px';\n            this.bdrAFTop.style.width = parseInt(this.bdrAFRight.style.left, 10) - parseInt(this.bdrAFLeft.style.left, 10)\n                - firstCellLeft + 1 + 'px';\n            if (totalWidth <= (parseInt(this.bdrAFTop.style.width, 10) + parseInt(this.bdrAFTop.style.left, 10))) {\n                var leftRemove = (parseInt(this.bdrAFTop.style.width, 10) + parseInt(this.bdrAFTop.style.left, 10)) - totalWidth;\n                this.bdrAFTop.style.width = parseInt(this.bdrAFTop.style.width, 10) - leftRemove + 'px';\n            }\n        }\n        else {\n            var scrolloffSet = (parentsUntil(this.startAFCell, 'e-movablecontent') ||\n                parentsUntil(this.startAFCell, 'e-movableheader')) ? stOff.right -\n                this.startAFCell.offsetParent.parentElement.getBoundingClientRect().width -\n                parentRect.left : 0;\n            this.bdrAFLeft.style.right = parentRect.right - endOff.right - 2 + endOff.width + 'px';\n            this.bdrAFLeft.style.width = totalWidth <= parseInt(this.bdrAFLeft.style.right, 10) ? '0px' : '2px';\n            this.bdrAFRight.style.right = parentRect.right - stOff.right - firstCellLeft + scrolloffSet - 1 + 'px';\n            this.bdrAFTop.style.left = endOff.left - parentRect.left - 0.5 + 'px';\n            this.bdrAFTop.style.width = parseInt(this.bdrAFLeft.style.right, 10) - parseInt(this.bdrAFRight.style.right, 10)\n                - firstCellLeft + 1 + 'px';\n            if (parseInt(this.bdrAFTop.style.left, 10) < 0) {\n                this.bdrAFTop.style.width = parseInt(this.bdrAFTop.style.width, 10) + parseInt(this.bdrAFTop.style.left, 10) + 'px';\n                this.bdrAFTop.style.left = '0px';\n            }\n        }\n        this.bdrAFLeft.style.top = stOff.top - parentRect.top - firstCellTop + scrollTop + 'px';\n        this.bdrAFLeft.style.height = endOff.top - stOff.top > 0 ?\n            (endOff.top - parentOff.top + endOff.height + 1) - (stOff.top - parentOff.top) + firstCellTop - rowHeight - scrollTop + 'px' :\n            endOff.height + firstCellTop - rowHeight - scrollTop + 'px';\n        this.bdrAFRight.style.top = this.bdrAFLeft.style.top;\n        this.bdrAFRight.style.height = parseInt(this.bdrAFLeft.style.height, 10) + 'px';\n        this.bdrAFTop.style.top = this.bdrAFRight.style.top;\n        this.bdrAFBottom.style.left = this.bdrAFTop.style.left;\n        this.bdrAFBottom.style.top = parseFloat(this.bdrAFLeft.style.top) + parseFloat(this.bdrAFLeft.style.height) - top - 1 + 'px';\n        this.bdrAFBottom.style.width = totalHeight <= parseFloat(this.bdrAFBottom.style.top) ? '0px' : this.bdrAFTop.style.width;\n        if (totalHeight <= (parseInt(this.bdrAFLeft.style.height, 10) + parseInt(this.bdrAFLeft.style.top, 10))) {\n            var topRemove = parseInt(this.bdrAFLeft.style.height, 10) + parseInt(this.bdrAFLeft.style.top, 10) - totalHeight;\n            this.bdrAFLeft.style.height = parseInt(this.bdrAFLeft.style.height, 10) - topRemove + 'px';\n            this.bdrAFRight.style.height = parseInt(this.bdrAFLeft.style.height, 10) + 'px';\n        }\n    };\n    Selection.prototype.createAFBorders = function () {\n        if (!this.bdrAFLeft) {\n            this.bdrAFLeft = this.parent.element.appendChild(createElement('div', { className: 'e-xlselaf', id: this.parent.element.id + '_bdrafleft', styles: 'width: 2px;' }));\n            this.bdrAFRight = this.parent.element.appendChild(createElement('div', { className: 'e-xlselaf', id: this.parent.element.id + '_bdrafright', styles: 'width: 2px;' }));\n            this.bdrAFBottom = this.parent.element.appendChild(createElement('div', { className: 'e-xlselaf', id: this.parent.element.id + '_bdrafbottom', styles: 'height: 2px;' }));\n            this.bdrAFTop = this.parent.element.appendChild(createElement('div', { className: 'e-xlselaf', id: this.parent.element.id + '_bdraftop', styles: 'height: 2px;' }));\n        }\n    };\n    Selection.prototype.showAFBorders = function () {\n        if (this.bdrAFLeft) {\n            this.bdrAFLeft.style.display = '';\n            this.bdrAFRight.style.display = '';\n            this.bdrAFBottom.style.display = '';\n            this.bdrAFTop.style.display = '';\n        }\n    };\n    Selection.prototype.hideAFBorders = function () {\n        if (this.bdrAFLeft) {\n            this.bdrAFLeft.style.display = 'none';\n            this.bdrAFRight.style.display = 'none';\n            this.bdrAFBottom.style.display = 'none';\n            this.bdrAFTop.style.display = 'none';\n        }\n    };\n    Selection.prototype.updateValue = function (rIdx, cIdx, cell) {\n        var args = this.createBeforeAutoFill(rIdx, cIdx, cell);\n        if (!args.cancel) {\n            var col = this.parent.getColumnByIndex(cIdx);\n            if (this.parent.editModule && cell) {\n                if (col.type === 'number') {\n                    this.parent.editModule.updateCell(rIdx, col.field, parseInt(args.value, 10));\n                }\n                else {\n                    this.parent.editModule.updateCell(rIdx, col.field, args.value);\n                }\n            }\n        }\n    };\n    Selection.prototype.createBeforeAutoFill = function (rowIndex, colIndex, cell) {\n        var col = this.parent.getColumnByIndex(colIndex);\n        var args = {\n            column: col,\n            value: cell.innerText\n        };\n        this.parent.trigger(events.beforeAutoFill, args);\n        return args;\n    };\n    Selection.prototype.getAutoFillCells = function (rowIndex, startCellIdx) {\n        var cells = [].slice.call(this.parent.getDataRows()[rowIndex].querySelectorAll('.e-cellselectionbackground'));\n        if (this.parent.getFrozenColumns()) {\n            cells = cells.concat([].slice.call(this.parent.getMovableDataRows()[rowIndex].querySelectorAll('.e-cellselectionbackground')));\n        }\n        return cells;\n    };\n    /* tslint:disable-next-line:max-func-body-length */\n    Selection.prototype.selectLikeAutoFill = function (e, isApply) {\n        var startrowIdx = parseInt(parentsUntil(this.startAFCell, 'e-row').getAttribute('aria-rowindex'), 10);\n        var startCellIdx = parseInt(this.startAFCell.getAttribute('aria-colindex'), 10);\n        var endrowIdx = parseInt(parentsUntil(this.endAFCell, 'e-row').getAttribute('aria-rowindex'), 10);\n        var endCellIdx = parseInt(this.endAFCell.getAttribute('aria-colindex'), 10);\n        var rowLen = this.selectedRowCellIndexes.length - 1;\n        var colLen = this.selectedRowCellIndexes[0].cellIndexes.length - 1;\n        var col;\n        switch (true) { //direction         \n            case !isApply && this.endAFCell.classList.contains('e-cellselectionbackground') &&\n                !!parentsUntil(e.target, 'e-rowcell'):\n                this.startAFCell = this.parent.getCellFromIndex(startrowIdx, startCellIdx);\n                this.endAFCell = this.parent.getCellFromIndex(startrowIdx + rowLen, startCellIdx + colLen);\n                this.drawAFBorders();\n                break;\n            case this.autoFillRLselection && startCellIdx + colLen < endCellIdx && //right\n                endCellIdx - startCellIdx - colLen + 1 > endrowIdx - startrowIdx - rowLen // right bottom\n                && endCellIdx - startCellIdx - colLen + 1 > startrowIdx - endrowIdx: //right top\n                this.endAFCell = this.parent.getCellFromIndex(startrowIdx + rowLen, endCellIdx);\n                endrowIdx = parseInt(parentsUntil(this.endAFCell, 'e-row').getAttribute('aria-rowindex'), 10);\n                endCellIdx = parseInt(this.endAFCell.getAttribute('aria-colindex'), 10);\n                if (!isApply) {\n                    this.drawAFBorders();\n                }\n                else {\n                    var cellIdx = parseInt(this.endCell.getAttribute('aria-colindex'), 10);\n                    for (var i = startrowIdx; i <= endrowIdx; i++) {\n                        var cells = this.getAutoFillCells(i, startCellIdx);\n                        var c = 0;\n                        for (var j = cellIdx + 1; j <= endCellIdx; j++) {\n                            if (c > colLen) {\n                                c = 0;\n                            }\n                            this.updateValue(i, j, cells[c]);\n                            c++;\n                        }\n                    }\n                    this.selectCellsByRange({ rowIndex: startrowIdx, cellIndex: this.startCellIndex }, { rowIndex: endrowIdx, cellIndex: endCellIdx });\n                }\n                break;\n            case this.autoFillRLselection && startCellIdx > endCellIdx && // left\n                startCellIdx - endCellIdx + 1 > endrowIdx - startrowIdx - rowLen && //left top\n                startCellIdx - endCellIdx + 1 > startrowIdx - endrowIdx: // left bottom\n                this.startAFCell = this.parent.getCellFromIndex(startrowIdx, endCellIdx);\n                this.endAFCell = this.endCell;\n                if (!isApply) {\n                    this.drawAFBorders();\n                }\n                else {\n                    for (var i = startrowIdx; i <= startrowIdx + rowLen; i++) {\n                        var cells = this.getAutoFillCells(i, startCellIdx);\n                        cells.reverse();\n                        var c = 0;\n                        for (var j = this.startCellIndex - 1; j >= endCellIdx; j--) {\n                            if (c > colLen) {\n                                c = 0;\n                            }\n                            this.updateValue(i, j, cells[c]);\n                            c++;\n                        }\n                    }\n                    this.selectCellsByRange({ rowIndex: startrowIdx, cellIndex: endCellIdx }, { rowIndex: startrowIdx + rowLen, cellIndex: this.startCellIndex + colLen });\n                }\n                break;\n            case startrowIdx > endrowIdx: //up\n                this.startAFCell = this.parent.getCellFromIndex(endrowIdx, startCellIdx);\n                this.endAFCell = this.endCell;\n                if (!isApply) {\n                    this.drawAFBorders();\n                }\n                else {\n                    var trIdx = parseInt(this.endCell.parentElement.getAttribute('aria-rowindex'), 10);\n                    var r = trIdx;\n                    for (var i = startrowIdx - 1; i >= endrowIdx; i--) {\n                        if (r === this.startIndex - 1) {\n                            r = trIdx;\n                        }\n                        var cells = this.getAutoFillCells(r, startCellIdx);\n                        var c = 0;\n                        r--;\n                        for (var j = this.startCellIndex; j <= this.startCellIndex + colLen; j++) {\n                            this.updateValue(i, j, cells[c]);\n                            c++;\n                        }\n                    }\n                    this.selectCellsByRange({ rowIndex: endrowIdx, cellIndex: startCellIdx + colLen }, { rowIndex: startrowIdx + rowLen, cellIndex: startCellIdx });\n                }\n                break;\n            default: //down\n                this.endAFCell = this.parent.getCellFromIndex(endrowIdx, startCellIdx + colLen);\n                if (!isApply) {\n                    this.drawAFBorders();\n                }\n                else {\n                    var trIdx = parseInt(this.endCell.parentElement.getAttribute('aria-rowindex'), 10);\n                    var r = this.startIndex;\n                    for (var i = trIdx + 1; i <= endrowIdx; i++) {\n                        if (r === trIdx + 1) {\n                            r = this.startIndex;\n                        }\n                        var cells = this.getAutoFillCells(r, startCellIdx);\n                        r++;\n                        var c = 0;\n                        for (var m = this.startCellIndex; m <= this.startCellIndex + colLen; m++) {\n                            this.updateValue(i, m, cells[c]);\n                            c++;\n                        }\n                    }\n                    this.selectCellsByRange({ rowIndex: trIdx - rowLen, cellIndex: startCellIdx }, { rowIndex: endrowIdx, cellIndex: startCellIdx + colLen });\n                }\n                break;\n        }\n    };\n    Selection.prototype.mouseUpHandler = function (e) {\n        document.body.classList.remove('e-disableuserselect');\n        if (this.element) {\n            remove(this.element);\n        }\n        if (this.isDragged && this.selectedRowCellIndexes.length === 1 && this.selectedRowCellIndexes[0].cellIndexes.length === 1) {\n            this.mUPTarget = parentsUntil(e.target, 'e-rowcell');\n        }\n        else {\n            this.mUPTarget = null;\n        }\n        if (this.isDragged && !this.isAutoFillSel && this.selectionSettings.mode === 'Cell') {\n            var target = e.target;\n            var rowIndex = parseInt(target.parentElement.getAttribute('aria-rowindex'), 10);\n            var cellIndex = parseInt(target.getAttribute('aria-colindex'), 10);\n            this.isDragged = false;\n            this.clearCellSelection();\n            this.selectCellsByRange({ rowIndex: this.startDIndex, cellIndex: this.startDCellIndex }, { rowIndex: rowIndex, cellIndex: cellIndex });\n        }\n        this.isDragged = false;\n        this.updateAutoFillPosition();\n        if (this.isAutoFillSel) {\n            var lastCell = parentsUntil(e.target, 'e-rowcell');\n            this.endAFCell = lastCell ? lastCell : this.endCell === this.endAFCell ? this.startAFCell : this.endAFCell;\n            this.startAFCell = this.startCell;\n            this.updateStartCellsIndex();\n            this.selectLikeAutoFill(e, true);\n            this.updateAutoFillPosition();\n            this.hideAFBorders();\n            this.positionBorders();\n            this.isAutoFillSel = false;\n        }\n        EventHandler.remove(this.parent.getContent(), 'mousemove', this.mouseMoveHandler);\n        if (this.parent.frozenRows) {\n            EventHandler.remove(this.parent.getHeaderContent(), 'mousemove', this.mouseMoveHandler);\n        }\n        EventHandler.remove(document.body, 'mouseup', this.mouseUpHandler);\n    };\n    Selection.prototype.hideAutoFill = function () {\n        if (this.autofill) {\n            this.autofill.style.display = 'none';\n        }\n    };\n    /**\n     * @hidden\n     */\n    Selection.prototype.updateAutoFillPosition = function () {\n        if (this.parent.enableAutoFill && !this.parent.isEdit &&\n            this.selectionSettings.cellSelectionMode.indexOf('Box') > -1 && !this.isRowType() && !this.isSingleSel()\n            && this.selectedRowCellIndexes.length) {\n            var frzCols = this.parent.getFrozenColumns();\n            var index = parseInt(this.target.getAttribute('aria-colindex'), 10);\n            var rindex = parseInt(this.target.getAttribute('index'), 10);\n            var rowIndex = this.selectedRowCellIndexes[this.selectedRowCellIndexes.length - 1].rowIndex;\n            var cells = this.getAutoFillCells(rowIndex, index).filter(function (ele) { return ele.style.display === ''; });\n            var isFrozenCol = void 0;\n            var isFrozenRow = void 0;\n            if (frzCols && index >= frzCols) {\n                isFrozenCol = true;\n            }\n            if (rindex < this.parent.frozenRows) {\n                isFrozenRow = true;\n            }\n            if (!parentsUntil(this.target, 'e-table').querySelector('#' + this.parent.element.id + '_autofill')) {\n                if (this.parent.element.querySelector('#' + this.parent.element.id + '_autofill')) {\n                    this.parent.element.querySelector('#' + this.parent.element.id + '_autofill').remove();\n                }\n                this.autofill = createElement('div', { className: 'e-autofill', id: this.parent.element.id + '_autofill' });\n                this.autofill.style.display = 'none';\n                !isFrozenRow ? !isFrozenCol ? this.parent.getContentTable().parentElement.appendChild(this.autofill) :\n                    this.parent.contentModule.getMovableContent().appendChild(this.autofill) :\n                    !isFrozenCol ? this.parent.getHeaderTable().parentElement.appendChild(this.autofill) :\n                        this.parent.headerModule.getMovableHeader().appendChild(this.autofill);\n            }\n            var cell = cells[cells.length - 1];\n            if (cell && cell.offsetParent) {\n                var clientRect = cell.getBoundingClientRect();\n                var parentOff = cell.offsetParent.getBoundingClientRect();\n                var colWidth = this.isLastCell(cell) ? 4 : 0;\n                var rowHeight = this.isLastRow(cell) ? 3 : 0;\n                if (!this.parent.enableRtl) {\n                    this.autofill.style.left = clientRect.left - parentOff.left + clientRect.width - 4 - colWidth + 'px';\n                }\n                else {\n                    this.autofill.style.right = parentOff.right - clientRect.right + clientRect.width - 4 - colWidth + 'px';\n                }\n                this.autofill.style.top = clientRect.top - parentOff.top + clientRect.height - 5 - rowHeight + 'px';\n            }\n            this.autofill.style.display = '';\n        }\n        else {\n            this.hideAutoFill();\n        }\n    };\n    Selection.prototype.mouseDownHandler = function (e) {\n        this.mouseButton = e.button;\n        var target = e.target;\n        var gObj = this.parent;\n        var isDrag;\n        var gridElement = parentsUntil(target, 'e-grid');\n        if (gridElement && gridElement.id !== gObj.element.id || parentsUntil(target, 'e-headercontent') && !this.parent.frozenRows ||\n            parentsUntil(target, 'e-editedbatchcell') || parentsUntil(target, 'e-editedrow')) {\n            return;\n        }\n        if (e.shiftKey || e.ctrlKey) {\n            e.preventDefault();\n        }\n        if (parentsUntil(target, 'e-rowcell') && !e.shiftKey && !e.ctrlKey) {\n            if (gObj.selectionSettings.cellSelectionMode.indexOf('Box') > -1 && !this.isRowType() && !this.isSingleSel()) {\n                this.isCellDrag = true;\n                isDrag = true;\n            }\n            else if (gObj.allowRowDragAndDrop && !gObj.isEdit) {\n                if (!this.isRowType() || this.isSingleSel() || closest(target, 'td').classList.contains('e-selectionbackground')) {\n                    this.isDragged = false;\n                    return;\n                }\n                isDrag = true;\n                this.element = this.parent.createElement('div', { className: 'e-griddragarea' });\n                gObj.getContent().appendChild(this.element);\n            }\n            if (isDrag) {\n                this.enableDrag(e, true);\n            }\n        }\n        this.updateStartEndCells();\n        if (target.classList.contains('e-autofill') || target.classList.contains('e-xlsel')) {\n            this.isCellDrag = true;\n            this.isAutoFillSel = true;\n            this.enableDrag(e);\n        }\n    };\n    Selection.prototype.updateStartEndCells = function () {\n        var cells = [].slice.call(this.parent.element.querySelectorAll('.e-cellselectionbackground'));\n        this.startCell = cells[0];\n        this.endCell = cells[cells.length - 1];\n        if (this.startCell) {\n            this.startIndex = parseInt(this.startCell.parentElement.getAttribute('aria-rowindex'), 10);\n            this.startCellIndex = parseInt(parentsUntil(this.startCell, 'e-rowcell').getAttribute('aria-colindex'), 10);\n        }\n    };\n    Selection.prototype.updateStartCellsIndex = function () {\n        if (this.startCell) {\n            this.startIndex = parseInt(this.startCell.parentElement.getAttribute('aria-rowindex'), 10);\n            this.startCellIndex = parseInt(parentsUntil(this.startCell, 'e-rowcell').getAttribute('aria-colindex'), 10);\n        }\n    };\n    Selection.prototype.enableDrag = function (e, isUpdate) {\n        var gObj = this.parent;\n        if (isUpdate) {\n            var tr = closest(e.target, 'tr');\n            this.startDIndex = parseInt(tr.getAttribute('aria-rowindex'), 10);\n            this.startDCellIndex = parseInt(parentsUntil(e.target, 'e-rowcell').getAttribute('aria-colindex'), 10);\n        }\n        document.body.classList.add('e-disableuserselect');\n        var gBRect = gObj.element.getBoundingClientRect();\n        var postion = getPosition(e);\n        this.x = postion.x - gBRect.left;\n        this.y = postion.y - gBRect.top;\n        EventHandler.add(gObj.getContent(), 'mousemove', this.mouseMoveHandler, this);\n        if (this.parent.frozenRows) {\n            EventHandler.add(gObj.getHeaderContent(), 'mousemove', this.mouseMoveHandler, this);\n        }\n        EventHandler.add(document.body, 'mouseup', this.mouseUpHandler, this);\n    };\n    Selection.prototype.clearSelAfterRefresh = function (e) {\n        var isInfiniteScroll = this.parent.enableInfiniteScrolling && e.requestType === 'infiniteScroll';\n        if (e.requestType !== 'virtualscroll' && !this.parent.isPersistSelection && !isInfiniteScroll) {\n            this.clearSelection();\n        }\n    };\n    /**\n     * @hidden\n     */\n    Selection.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.uiUpdate, this.enableAfterRender, this);\n        this.parent.on(events.initialEnd, this.initializeSelection, this);\n        this.parent.on(events.rowSelectionComplete, this.onActionComplete, this);\n        this.parent.on(events.cellSelectionComplete, this.onActionComplete, this);\n        this.parent.on(events.inBoundModelChanged, this.onPropertyChanged, this);\n        this.parent.on(events.cellFocused, this.onCellFocused, this);\n        this.parent.on(events.beforeFragAppend, this.clearSelAfterRefresh, this);\n        this.parent.on(events.columnPositionChanged, this.columnPositionChanged, this);\n        this.parent.on(events.contentReady, this.initialEnd, this);\n        this.actionBeginFunction = this.actionBegin.bind(this);\n        this.actionCompleteFunction = this.actionComplete.bind(this);\n        this.parent.addEventListener(events.actionBegin, this.actionBeginFunction);\n        this.parent.addEventListener(events.actionComplete, this.actionCompleteFunction);\n        this.parent.on(events.rowsRemoved, this.rowsRemoved, this);\n        this.parent.on(events.headerRefreshed, this.refreshHeader, this);\n        this.addEventListener_checkbox();\n    };\n    /**\n     * @hidden\n     */\n    Selection.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.uiUpdate, this.enableAfterRender);\n        this.parent.off(events.initialEnd, this.initializeSelection);\n        this.parent.off(events.rowSelectionComplete, this.onActionComplete);\n        this.parent.off(events.cellSelectionComplete, this.onActionComplete);\n        this.parent.off(events.inBoundModelChanged, this.onPropertyChanged);\n        this.parent.off(events.cellFocused, this.onCellFocused);\n        this.parent.off(events.beforeFragAppend, this.clearSelAfterRefresh);\n        this.parent.off(events.columnPositionChanged, this.columnPositionChanged);\n        this.parent.removeEventListener(events.actionBegin, this.actionBeginFunction);\n        this.parent.removeEventListener(events.actionComplete, this.actionCompleteFunction);\n        this.parent.off(events.rowsRemoved, this.rowsRemoved);\n        this.parent.off(events.headerRefreshed, this.refreshHeader);\n        this.removeEventListener_checkbox();\n    };\n    Selection.prototype.wireEvents = function () {\n        this.isMacOS = navigator.userAgent.indexOf('Mac OS') !== -1;\n        if (this.isMacOS) {\n            EventHandler.add(this.parent.element, 'keydown', this.keyDownHandler, this);\n            EventHandler.add(this.parent.element, 'keyup', this.keyUpHandler, this);\n        }\n    };\n    Selection.prototype.unWireEvents = function () {\n        if (this.isMacOS) {\n            EventHandler.remove(this.parent.element, 'keydown', this.keyDownHandler);\n            EventHandler.remove(this.parent.element, 'keyup', this.keyUpHandler);\n        }\n    };\n    Selection.prototype.columnPositionChanged = function () {\n        if (!this.parent.isPersistSelection) {\n            this.clearSelection();\n        }\n    };\n    Selection.prototype.refreshHeader = function () {\n        this.setCheckAllState();\n    };\n    Selection.prototype.rowsRemoved = function (e) {\n        for (var i = 0; i < e.records.length; i++) {\n            delete (this.selectedRowState[e.records[i][this.primaryKey]]);\n            --this.totalRecordsCount;\n        }\n        this.setCheckAllState();\n    };\n    ;\n    Selection.prototype.beforeFragAppend = function (e) {\n        if (e.requestType !== 'virtualscroll' && !this.parent.isPersistSelection) {\n            this.clearSelection();\n        }\n    };\n    ;\n    Selection.prototype.getCheckAllBox = function () {\n        return this.parent.getHeaderContent().querySelector('.e-checkselectall');\n    };\n    Selection.prototype.enableAfterRender = function (e) {\n        if (e.module === this.getModuleName() && e.enable) {\n            this.render();\n            this.initPerisistSelection();\n        }\n    };\n    Selection.prototype.render = function (e) {\n        EventHandler.add(this.parent.getContent(), 'mousedown', this.mouseDownHandler, this);\n        EventHandler.add(this.parent.getHeaderContent(), 'mousedown', this.mouseDownHandler, this);\n    };\n    Selection.prototype.onPropertyChanged = function (e) {\n        if (e.module !== this.getModuleName()) {\n            return;\n        }\n        var gObj = this.parent;\n        if (!isNullOrUndefined(e.properties.type) && this.selectionSettings.type === 'Single') {\n            if (this.selectedRowCellIndexes.length > 1) {\n                this.clearCellSelection();\n                this.prevCIdxs = undefined;\n            }\n            if (this.selectedRowIndexes.length > 1) {\n                this.clearRowSelection();\n                this.prevRowIndex = undefined;\n            }\n            this.enableSelectMultiTouch = false;\n            this.hidePopUp();\n        }\n        if (!isNullOrUndefined(e.properties.mode) ||\n            !isNullOrUndefined(e.properties.cellSelectionMode)) {\n            this.clearSelection();\n            this.prevRowIndex = undefined;\n            this.prevCIdxs = undefined;\n        }\n        this.isPersisted = true;\n        this.checkBoxSelectionChanged();\n        this.isPersisted = false;\n        this.initPerisistSelection();\n        var checkboxColumn = this.parent.getColumns().filter(function (col) { return col.type === 'checkbox'; });\n        if (checkboxColumn.length) {\n            gObj.isCheckBoxSelection = !(this.selectionSettings.checkboxMode === 'ResetOnRowClick');\n        }\n        this.drawBorders();\n    };\n    Selection.prototype.hidePopUp = function () {\n        if (this.parent.element.querySelector('.e-gridpopup').querySelectorAll('.e-rowselect').length) {\n            this.parent.element.querySelector('.e-gridpopup').style.display = 'none';\n        }\n    };\n    Selection.prototype.initialEnd = function () {\n        this.parent.off(events.contentReady, this.initialEnd);\n        this.selectRow(this.parent.selectedRowIndex);\n    };\n    Selection.prototype.checkBoxSelectionChanged = function () {\n        this.parent.off(events.contentReady, this.checkBoxSelectionChanged);\n        var gobj = this.parent;\n        var checkboxColumn = gobj.getColumns().filter(function (col) { return col.type === 'checkbox'; });\n        if (checkboxColumn.length > 0) {\n            gobj.isCheckBoxSelection = true;\n            this.chkField = checkboxColumn[0].field;\n            this.totalRecordsCount = this.parent.pageSettings.totalRecordsCount;\n            if (isNullOrUndefined(this.totalRecordsCount)) {\n                this.totalRecordsCount = this.getCurrentBatchRecordChanges().length;\n            }\n            if (this.isSingleSel()) {\n                gobj.selectionSettings.type = 'Multiple';\n                gobj.dataBind();\n            }\n            else {\n                this.initPerisistSelection();\n            }\n        }\n        if (!gobj.isCheckBoxSelection && !this.isPersisted) {\n            this.chkField = null;\n            this.initPerisistSelection();\n        }\n    };\n    Selection.prototype.initPerisistSelection = function () {\n        var gobj = this.parent;\n        if (this.parent.selectionSettings.persistSelection && this.parent.getPrimaryKeyFieldNames().length > 0) {\n            gobj.isPersistSelection = true;\n            this.ensureCheckboxFieldSelection();\n        }\n        else if (this.parent.getPrimaryKeyFieldNames().length > 0) {\n            gobj.isPersistSelection = false;\n            this.ensureCheckboxFieldSelection();\n        }\n        else {\n            gobj.isPersistSelection = false;\n            this.selectedRowState = {};\n        }\n    };\n    Selection.prototype.ensureCheckboxFieldSelection = function () {\n        var gobj = this.parent;\n        this.primaryKey = this.parent.getPrimaryKeyFieldNames()[0];\n        if (!gobj.enableVirtualization && this.chkField\n            && ((gobj.isPersistSelection && Object.keys(this.selectedRowState).length === 0) ||\n                !gobj.isPersistSelection)) {\n            var data = this.parent.getDataModule();\n            var query = new Query().where(this.chkField, 'equal', true);\n            if (!query.params) {\n                query.params = this.parent.query.params;\n            }\n            var dataManager = data.getData({}, query);\n            var proxy_1 = this;\n            this.parent.showSpinner();\n            dataManager.then(function (e) {\n                proxy_1.dataSuccess(e.result);\n                proxy_1.refreshPersistSelection();\n                proxy_1.parent.hideSpinner();\n            });\n        }\n    };\n    Selection.prototype.dataSuccess = function (res) {\n        for (var i = 0; i < res.length; i++) {\n            if (isNullOrUndefined(this.selectedRowState[res[i][this.primaryKey]]) && res[i][this.chkField]) {\n                this.selectedRowState[res[i][this.primaryKey]] = res[i][this.chkField];\n            }\n        }\n        this.persistSelectedData = res;\n    };\n    Selection.prototype.setRowSelection = function (state) {\n        if (!this.parent.getDataModule().isRemote() && !isBlazor()) {\n            if (state) {\n                if (this.parent.groupSettings.columns.length) {\n                    for (var _i = 0, _a = this.getData().records; _i < _a.length; _i++) {\n                        var data = _a[_i];\n                        this.selectedRowState[data[this.primaryKey]] = true;\n                    }\n                }\n                else {\n                    for (var _b = 0, _c = this.getData(); _b < _c.length; _b++) {\n                        var data = _c[_b];\n                        this.selectedRowState[data[this.primaryKey]] = true;\n                    }\n                }\n            }\n            else {\n                this.selectedRowState = {};\n            }\n            // (this.getData()).forEach(function (data) {\n            //     this.selectedRowState[data[this.primaryKey]] = true;\n            // })\n        }\n    };\n    Selection.prototype.getData = function () {\n        return this.parent.getDataModule().dataManager.executeLocal(this.parent.getDataModule().generateQuery(true));\n    };\n    Selection.prototype.refreshPersistSelection = function () {\n        var rows = this.parent.getRows();\n        if (rows !== null && rows.length > 0 && (this.parent.isPersistSelection || this.chkField)) {\n            var indexes = [];\n            for (var j = 0; j < rows.length; j++) {\n                var rowObj = this.getRowObj(rows[j]);\n                var pKey = rowObj ? rowObj.data ? rowObj.data[this.primaryKey] : null : null;\n                if (pKey === null) {\n                    return;\n                }\n                var checkState = void 0;\n                var chkBox = rows[j].querySelector('.e-checkselect');\n                if (this.selectedRowState[pKey] || (this.parent.checkAllRows === 'Check' && this.chkAllCollec.indexOf(pKey) < 0)\n                    || (this.parent.checkAllRows === 'Uncheck' && this.chkAllCollec.indexOf(pKey) > 0)\n                    || (this.parent.checkAllRows === 'Intermediate' && !isNullOrUndefined(this.chkField) && rowObj.data[this.chkField])) {\n                    indexes.push(parseInt(rows[j].getAttribute('aria-rowindex'), 10));\n                    checkState = true;\n                }\n                else {\n                    checkState = false;\n                    if (this.checkedTarget !== chkBox && this.parent.isCheckBoxSelection) {\n                        removeAddCboxClasses(chkBox.nextElementSibling, checkState);\n                    }\n                }\n                this.updatePersistCollection(rows[j], checkState);\n            }\n            this.isSingleSel() && indexes.length > 0 ? this.selectRow(indexes[0], true) : this.selectRows(indexes);\n        }\n        if (this.parent.isCheckBoxSelection && this.getCurrentBatchRecordChanges().length > 0) {\n            this.setCheckAllState();\n        }\n    };\n    Selection.prototype.actionBegin = function (e) {\n        if (e.requestType === 'save' && this.parent.isPersistSelection) {\n            var editChkBox = this.parent.element.querySelector('.e-edit-checkselect');\n            if (!isNullOrUndefined(editChkBox)) {\n                var row = closest(editChkBox, '.e-editedrow');\n                if (row) {\n                    if (this.parent.editSettings.mode === 'Dialog') {\n                        row = this.parent.element.querySelector('.e-dlgeditrow');\n                    }\n                    var rowObj = this.getRowObj(row);\n                    if (!rowObj) {\n                        return;\n                    }\n                    this.selectedRowState[rowObj.data[this.primaryKey]] = rowObj.isSelected = editChkBox.checked;\n                }\n                else {\n                    this.isCheckedOnAdd = editChkBox.checked;\n                }\n            }\n        }\n    };\n    Selection.prototype.actionComplete = function (e) {\n        if (e.requestType === 'save' && this.parent.isPersistSelection) {\n            if (e.action === 'add' && this.isCheckedOnAdd) {\n                var rowObj = this.parent.getRowObjectFromUID(this.parent.getRows()[e.selectedRow].getAttribute('data-uid'));\n                this.selectedRowState[rowObj.data[this.primaryKey]] = rowObj.isSelected = this.isCheckedOnAdd;\n            }\n            this.refreshPersistSelection();\n        }\n        if (e.requestType === 'delete' && this.parent.isPersistSelection) {\n            var records = [];\n            if (!isBlazor()) {\n                records = e.data;\n            }\n            else {\n                records = this.getSelectedRecords();\n            }\n            var data = records.slice();\n            for (var i = 0; i < data.length; i++) {\n                if (!isNullOrUndefined(data[i][this.primaryKey])) {\n                    this.updatePersistDelete(data[i][this.primaryKey]);\n                }\n            }\n            this.setCheckAllState();\n            this.totalRecordsCount = this.parent.pageSettings.totalRecordsCount;\n        }\n        if (e.requestType === 'paging') {\n            this.prevRowIndex = undefined;\n            this.prevCIdxs = undefined;\n            this.prevECIdxs = undefined;\n        }\n    };\n    Selection.prototype.onDataBound = function () {\n        if (!this.parent.enableVirtualization && this.parent.isPersistSelection) {\n            this.refreshPersistSelection();\n        }\n        if (this.parent.enableVirtualization) {\n            this.setCheckAllState();\n        }\n        if (this.parent.isCheckBoxSelection && !this.initialRowSelection) {\n            var totalRecords = this.parent.getRowsObject();\n            var indexes = [];\n            for (var i = 0; i < totalRecords.length; i++) {\n                if (totalRecords[i].isSelected) {\n                    indexes.push(i);\n                }\n            }\n            if (indexes.length) {\n                this.selectRows(indexes);\n            }\n            this.initialRowSelection = true;\n        }\n    };\n    Selection.prototype.updatePersistSelectedData = function (checkState) {\n        if (this.parent.isPersistSelection) {\n            var rows = this.parent.getRows();\n            for (var i = 0; i < rows.length; i++) {\n                this.updatePersistCollection(rows[i], checkState);\n            }\n            if (this.parent.checkAllRows === 'Uncheck') {\n                this.setRowSelection(false);\n                this.persistSelectedData = this.parent.getDataModule().isRemote() ? this.persistSelectedData : [];\n            }\n            else if (this.parent.checkAllRows === 'Check') {\n                this.setRowSelection(true);\n                this.persistSelectedData = (!this.parent.getDataModule().isRemote() && !isBlazor()) ?\n                    this.parent.groupSettings.columns.length ? this.getData().records.slice() :\n                        this.getData().slice() : this.persistSelectedData;\n            }\n        }\n    };\n    Selection.prototype.checkSelectAllAction = function (checkState) {\n        var cRenderer = this.getRenderer();\n        var editForm = this.parent.element.querySelector('.e-gridform');\n        this.checkedTarget = this.getCheckAllBox();\n        if (checkState && this.getCurrentBatchRecordChanges().length) {\n            this.parent.checkAllRows = 'Check';\n            this.updatePersistSelectedData(checkState);\n            if (isBlazor() && this.parent.enableVirtualization &&\n                !isNullOrUndefined(this.parent.contentModule.currentInfo.endIndex)) {\n                this.selectRowsByRange(this.parent.contentModule.currentInfo.startIndex, this.parent.contentModule.currentInfo.endIndex);\n            }\n            else {\n                this.selectRowsByRange(cRenderer.getVirtualRowIndex(0), cRenderer.getVirtualRowIndex(this.getCurrentBatchRecordChanges().length - 1));\n            }\n        }\n        else {\n            this.parent.checkAllRows = 'Uncheck';\n            this.updatePersistSelectedData(checkState);\n            this.clearSelection();\n        }\n        this.chkAllCollec = [];\n        if (!isNullOrUndefined(editForm)) {\n            var editChkBox = editForm.querySelector('.e-edit-checkselect');\n            if (!isNullOrUndefined(editChkBox)) {\n                removeAddCboxClasses(editChkBox.nextElementSibling, checkState);\n            }\n        }\n    };\n    Selection.prototype.checkSelectAll = function (checkBox) {\n        var _this = this;\n        var stateStr = this.getCheckAllStatus(checkBox);\n        var state = stateStr === 'Check';\n        this.isHeaderCheckboxClicked = true;\n        if (stateStr === 'Intermediate') {\n            state = this.getCurrentBatchRecordChanges().some(function (data) {\n                return data[_this.primaryKey] in _this.selectedRowState;\n            });\n        }\n        if (this.parent.isPersistSelection && this.parent.allowPaging) {\n            this.totalRecordsCount = this.parent.pageSettings.totalRecordsCount;\n        }\n        this.checkSelectAllAction(!state);\n        if (isBlazor() && this.parent.isServerRendered && this.parent.enableVirtualization) {\n            var interopAdaptor = 'interopAdaptor';\n            var invokeMethodAsync = 'invokeMethodAsync';\n            this.parent[interopAdaptor][invokeMethodAsync]('MaintainSelection', !state, 'checkbox', null);\n            this.checkBoxState = !state;\n            if (!state) {\n                var values = 'values';\n                var vgenerator = 'vgenerator';\n                var rowCache = this.parent.contentModule[vgenerator].rowCache;\n                Object[values](rowCache).forEach(function (x) { return x.isSelected = true; });\n                for (var i = 0; i < Object.keys(rowCache).length; i++) {\n                    if (this.parent.selectionModule.selectedRowIndexes.indexOf(Number(Object.keys(rowCache)[i])) === -1) {\n                        this.parent.selectionModule.selectedRowIndexes.push(Number(Object.keys(rowCache)[i]));\n                    }\n                }\n            }\n        }\n        this.target = null;\n        if (this.getCurrentBatchRecordChanges().length > 0) {\n            this.setCheckAllState();\n        }\n        this.triggerChkChangeEvent(checkBox, !state);\n    };\n    Selection.prototype.getCheckAllStatus = function (ele) {\n        var classes = ele ? ele.nextElementSibling.classList :\n            this.getCheckAllBox().nextElementSibling.classList;\n        var status;\n        if (classes.contains('e-check')) {\n            status = 'Check';\n        }\n        else if (classes.contains('e-uncheck')) {\n            status = 'Uncheck';\n        }\n        else if (classes.contains('e-stop')) {\n            status = 'Intermediate';\n        }\n        else {\n            status = 'None';\n        }\n        return status;\n    };\n    Selection.prototype.checkSelect = function (checkBox) {\n        var target = closest(this.checkedTarget, '.e-rowcell');\n        var checkObj = checkBox;\n        var gObj = this.parent;\n        this.isMultiCtrlRequest = true;\n        var rIndex = 0;\n        this.isHeaderCheckboxClicked = false;\n        if (isGroupAdaptive(gObj)) {\n            var uid = target.parentElement.getAttribute('data-uid');\n            rIndex = gObj.getRows().map(function (m) { return m.getAttribute('data-uid'); }).indexOf(uid);\n        }\n        else {\n            rIndex = parseInt(target.parentElement.getAttribute('aria-rowindex'), 10);\n        }\n        if (this.parent.isPersistSelection && this.parent.element.querySelectorAll('.e-addedrow').length > 0 &&\n            this.parent.editSettings.newRowPosition === 'Top') {\n            ++rIndex;\n        }\n        this.rowCellSelectionHandler(rIndex, parseInt(target.getAttribute('aria-colindex'), 10));\n        this.moveIntoUncheckCollection(closest(target, '.e-row'));\n        this.setCheckAllState();\n        this.isMultiCtrlRequest = false;\n        this.triggerChkChangeEvent(checkBox, checkBox.nextElementSibling.classList.contains('e-check'));\n    };\n    Selection.prototype.moveIntoUncheckCollection = function (row) {\n        if (this.parent.checkAllRows === 'Check' || this.parent.checkAllRows === 'Uncheck') {\n            var rowObj = this.getRowObj(row);\n            var pKey = rowObj && rowObj.data ? rowObj.data[this.primaryKey] : null;\n            if (!pKey) {\n                return;\n            }\n            if (this.chkAllCollec.indexOf(pKey) < 0) {\n                this.chkAllCollec.push(pKey);\n            }\n            else {\n                this.chkAllCollec.splice(this.chkAllCollec.indexOf(pKey), 1);\n            }\n        }\n    };\n    Selection.prototype.triggerChkChangeEvent = function (checkBox, checkState) {\n        this.parent.trigger(events.checkBoxChange, {\n            checked: checkState, selectedRowIndexes: this.parent.getSelectedRowIndexes(),\n            target: checkBox\n        });\n        if (!this.parent.isEdit) {\n            this.checkedTarget = null;\n        }\n    };\n    Selection.prototype.updateSelectedRowIndex = function (index) {\n        if (this.parent.isCheckBoxSelection && (this.parent.enableVirtualization || this.parent.enableInfiniteScrolling)\n            && !this.parent.getDataModule().isRemote()\n            && !(isBlazor() && this.parent.isServerRendered)) {\n            if (this.parent.checkAllRows === 'Check') {\n                this.selectedRowIndexes = [];\n                var dataLength = this.getData().length;\n                for (var data = 0; data < dataLength; data++) {\n                    this.selectedRowIndexes.push(data);\n                }\n            }\n            else if (this.parent.checkAllRows === 'Uncheck') {\n                this.selectedRowIndexes = [];\n            }\n            else {\n                if (index && this.parent.getRowByIndex(index).getAttribute('aria-selected') === 'false') {\n                    var selectedVal = this.selectedRowIndexes.indexOf(index);\n                    this.selectedRowIndexes.splice(selectedVal, 1);\n                }\n            }\n        }\n    };\n    ;\n    Selection.prototype.setCheckAllState = function (index, isInteraction) {\n        if (this.parent.isCheckBoxSelection || this.parent.selectionSettings.checkboxMode === 'ResetOnRowClick') {\n            var checkToSelectAll = void 0;\n            var isServerRenderedVirtualization = isBlazor() && this.parent.isServerRendered && this.parent.enableVirtualization;\n            if (isServerRenderedVirtualization) {\n                var values = 'values';\n                var vgenerator = 'vgenerator';\n                checkToSelectAll = !Object[values](this.parent.contentModule[vgenerator].rowCache).\n                    filter(function (x) { return x.isSelected === undefined || x.isSelected === false; }).length &&\n                    Object[values](this.parent.contentModule[vgenerator].rowCache).\n                        filter(function (x) { return x.isSelected; }).length === this.selectedRowIndexes.length;\n            }\n            var checkedLen = Object.keys(this.selectedRowState).length;\n            if (!this.parent.isPersistSelection && !(isServerRenderedVirtualization)) {\n                checkedLen = this.selectedRowIndexes.length;\n                this.totalRecordsCount = this.getCurrentBatchRecordChanges().length;\n            }\n            var input = this.getCheckAllBox();\n            if (input) {\n                var spanEle = input.nextElementSibling;\n                removeClass([spanEle], ['e-check', 'e-stop', 'e-uncheck']);\n                setChecked(input, false);\n                input.indeterminate = false;\n                if (checkToSelectAll || checkedLen === this.totalRecordsCount && this.totalRecordsCount\n                    || ((this.parent.enableVirtualization || this.parent.enableInfiniteScrolling)\n                        && !this.parent.allowPaging && !this.parent.getDataModule().isRemote()\n                        && !(isBlazor() && this.parent.isServerRendered)\n                        && checkedLen === this.getData().length)) {\n                    addClass([spanEle], ['e-check']);\n                    setChecked(input, true);\n                    if (isInteraction) {\n                        this.getRenderer().setSelection(null, true, true);\n                    }\n                    this.parent.checkAllRows = 'Check';\n                }\n                else if (isServerRenderedVirtualization && !this.selectedRowIndexes.length ||\n                    checkedLen === 0 && !isServerRenderedVirtualization || this.getCurrentBatchRecordChanges().length === 0) {\n                    addClass([spanEle], ['e-uncheck']);\n                    if (isInteraction) {\n                        this.getRenderer().setSelection(null, false, true);\n                    }\n                    this.parent.checkAllRows = 'Uncheck';\n                    if (checkedLen === 0 && this.getCurrentBatchRecordChanges().length === 0) {\n                        addClass([spanEle.parentElement], ['e-checkbox-disabled']);\n                    }\n                    else {\n                        removeClass([spanEle.parentElement], ['e-checkbox-disabled']);\n                    }\n                }\n                else {\n                    addClass([spanEle], ['e-stop']);\n                    this.parent.checkAllRows = 'Intermediate';\n                    input.indeterminate = true;\n                }\n                if ((this.parent.enableVirtualization || this.parent.enableInfiniteScrolling)\n                    && !this.parent.allowPaging && !this.parent.getDataModule().isRemote()) {\n                    this.updateSelectedRowIndex(index);\n                }\n            }\n        }\n    };\n    Selection.prototype.keyDownHandler = function (e) {\n        // Below are keyCode for command key in MAC OS. Safari/Chrome(91-Left command, 93-Right Command), Opera(17), FireFox(224)\n        if ((((Browser.info.name === 'chrome') || (Browser.info.name === 'safari')) && (e.keyCode === 91 || e.keyCode === 93)) ||\n            (Browser.info.name === 'opera' && e.keyCode === 17) || (Browser.info.name === 'mozilla' && e.keyCode === 224)) {\n            this.cmdKeyPressed = true;\n        }\n    };\n    Selection.prototype.keyUpHandler = function (e) {\n        if ((((Browser.info.name === 'chrome') || (Browser.info.name === 'safari')) && (e.keyCode === 91 || e.keyCode === 93)) ||\n            (Browser.info.name === 'opera' && e.keyCode === 17) || (Browser.info.name === 'mozilla' && e.keyCode === 224)) {\n            this.cmdKeyPressed = false;\n        }\n    };\n    Selection.prototype.clickHandler = function (e) {\n        var target = e.target;\n        this.actualTarget = target;\n        if (parentsUntil(target, 'e-row') || parentsUntil(target, 'e-headerchkcelldiv')) {\n            this.isInteracted = true;\n        }\n        this.isMultiCtrlRequest = e.ctrlKey || this.enableSelectMultiTouch ||\n            (this.isMacOS && this.cmdKeyPressed);\n        this.isMultiShiftRequest = e.shiftKey;\n        this.popUpClickHandler(e);\n        var chkSelect = false;\n        this.preventFocus = true;\n        var checkBox;\n        var checkWrap = parentsUntil(target, 'e-checkbox-wrapper');\n        this.checkSelectAllClicked = checkWrap && checkWrap.querySelectorAll('.e-checkselectall') ? true : false;\n        if (checkWrap && checkWrap.querySelectorAll('.e-checkselect,.e-checkselectall').length > 0) {\n            checkBox = checkWrap.querySelector('input[type=\"checkbox\"]');\n            chkSelect = true;\n        }\n        this.drawBorders();\n        this.updateAutoFillPosition();\n        target = parentsUntil(target, 'e-rowcell');\n        if ((target && target.parentElement.classList.contains('e-row') && !this.parent.selectionSettings.checkboxOnly) || chkSelect) {\n            if (this.parent.isCheckBoxSelection) {\n                this.isMultiCtrlRequest = true;\n            }\n            this.target = target;\n            if (!isNullOrUndefined(checkBox)) {\n                this.checkedTarget = checkBox;\n                if (checkBox.classList.contains('e-checkselectall')) {\n                    this.checkSelectAll(checkBox);\n                }\n                else {\n                    this.checkSelect(checkBox);\n                }\n            }\n            else {\n                var gObj = this.parent;\n                var rIndex = 0;\n                if (isGroupAdaptive(gObj)) {\n                    var uid = target.parentElement.getAttribute('data-uid');\n                    rIndex = gObj.getRows().map(function (m) { return m.getAttribute('data-uid'); }).indexOf(uid);\n                }\n                else {\n                    rIndex = parseInt(target.parentElement.getAttribute('aria-rowindex'), 10);\n                }\n                if (this.parent.isPersistSelection && this.parent.element.querySelectorAll('.e-addedrow').length > 0) {\n                    ++rIndex;\n                }\n                if (!this.mUPTarget || !this.mUPTarget.isEqualNode(target)) {\n                    this.rowCellSelectionHandler(rIndex, parseInt(target.getAttribute('aria-colindex'), 10));\n                }\n                this.parent.hoverFrozenRows(e);\n                if (this.parent.isCheckBoxSelection) {\n                    this.moveIntoUncheckCollection(closest(target, '.e-row'));\n                    this.setCheckAllState();\n                }\n            }\n            if (!this.parent.isCheckBoxSelection && Browser.isDevice && !this.isSingleSel()) {\n                this.showPopup(e);\n            }\n        }\n        this.isMultiCtrlRequest = false;\n        this.isMultiShiftRequest = false;\n        if (isNullOrUndefined(closest(e.target, '.e-unboundcell'))) {\n            this.preventFocus = false;\n        }\n    };\n    Selection.prototype.popUpClickHandler = function (e) {\n        var target = e.target;\n        if (closest(target, '.e-headercell') || e.target.classList.contains('e-rowcell') ||\n            closest(target, '.e-gridpopup')) {\n            if (target.classList.contains('e-rowselect')) {\n                if (!target.classList.contains('e-spanclicked')) {\n                    target.classList.add('e-spanclicked');\n                    this.enableSelectMultiTouch = true;\n                }\n                else {\n                    target.classList.remove('e-spanclicked');\n                    this.enableSelectMultiTouch = false;\n                    this.parent.element.querySelector('.e-gridpopup').style.display = 'none';\n                }\n            }\n        }\n        else {\n            this.parent.element.querySelector('.e-gridpopup').style.display = 'none';\n        }\n    };\n    Selection.prototype.showPopup = function (e) {\n        if (!this.selectionSettings.enableSimpleMultiRowSelection) {\n            setCssInGridPopUp(this.parent.element.querySelector('.e-gridpopup'), e, 'e-rowselect e-icons e-icon-rowselect' +\n                (!this.isSingleSel() && (this.selectedRecords.length > (this.parent.getFrozenColumns() ? 2 : 1)\n                    || this.selectedRowCellIndexes.length > 1) ? ' e-spanclicked' : ''));\n        }\n    };\n    Selection.prototype.rowCellSelectionHandler = function (rowIndex, cellIndex) {\n        var gObj = this.parent;\n        if ((!this.isMultiCtrlRequest && !this.isMultiShiftRequest) || this.isSingleSel()) {\n            if (!this.isDragged) {\n                this.selectRow(rowIndex, this.selectionSettings.enableToggle);\n            }\n            this.selectCell({ rowIndex: rowIndex, cellIndex: cellIndex }, this.selectionSettings.enableToggle);\n            if (this.selectedRowCellIndexes.length) {\n                this.updateAutoFillPosition();\n            }\n            this.drawBorders();\n        }\n        else if (this.isMultiShiftRequest) {\n            if (this.parent.isCheckBoxSelection || (!this.parent.isCheckBoxSelection &&\n                !closest(this.target, '.e-rowcell').classList.contains('e-gridchkbox'))) {\n                this.selectRowsByRange(isUndefined(this.prevRowIndex) ? rowIndex : this.prevRowIndex, rowIndex);\n            }\n            else {\n                this.addRowsToSelection([rowIndex]);\n            }\n            this.selectCellsByRange(isUndefined(this.prevCIdxs) ? { rowIndex: rowIndex, cellIndex: cellIndex } : this.prevCIdxs, { rowIndex: rowIndex, cellIndex: cellIndex });\n            this.updateAutoFillPosition();\n            this.drawBorders();\n        }\n        else {\n            this.addRowsToSelection([rowIndex]);\n            if (isBlazor() && this.parent.enableVirtualization && this.parent.isServerRendered) {\n                var rowIndexes = this.parent.getSelectedRowIndexes();\n                var interopAdaptor = 'interopAdaptor';\n                var invokeMethodAsync = 'invokeMethodAsync';\n                this.parent[interopAdaptor][invokeMethodAsync]('MaintainSelection', true, 'normal', rowIndexes);\n            }\n            this.addCellsToSelection([{ rowIndex: rowIndex, cellIndex: cellIndex }]);\n            this.showHideBorders('none');\n        }\n        this.isDragged = false;\n    };\n    /* tslint:disable-next-line:max-func-body-length */\n    Selection.prototype.onCellFocused = function (e) {\n        if (this.parent.frozenRows && e.container.isHeader && e.byKey) {\n            if (e.keyArgs.action === 'upArrow') {\n                if (this.parent.allowFiltering) {\n                    e.isJump = e.element.tagName === 'INPUT' ? true : false;\n                }\n                else {\n                    e.isJump = e.element.tagName === 'TH' ? true : false;\n                }\n            }\n            else {\n                if (e.keyArgs.action === 'downArrow') {\n                    var rIdx = Number(e.element.parentElement.getAttribute('aria-rowindex'));\n                    e.isJump = rIdx === 0 ? true : false;\n                }\n                else {\n                    if (e.keyArgs.action === 'ctrlHome') {\n                        e.isJump = true;\n                    }\n                }\n            }\n        }\n        var clear = this.parent.getFrozenColumns() ? (((e.container.isHeader && e.element.tagName !== 'TD' && e.isJump) ||\n            ((e.container.isContent || e.element.tagName === 'TD') && !(e.container.isSelectable || e.element.tagName === 'TD')))\n            && !(e.byKey && e.keyArgs.action === 'space')) : ((e.container.isHeader && e.isJump) ||\n            (e.container.isContent && !e.container.isSelectable)) && !(e.byKey && e.keyArgs.action === 'space')\n            && !(e.element.classList.contains('e-detailrowexpand') || e.element.classList.contains('e-detailrowcollapse'));\n        var headerAction = (e.container.isHeader && e.element.tagName !== 'TD' && !closest(e.element, '.e-rowcell'))\n            && !(e.byKey && e.keyArgs.action === 'space');\n        if (!e.byKey || clear) {\n            if (clear && !this.parent.isCheckBoxSelection) {\n                this.clearSelection();\n            }\n            return;\n        }\n        var _a = e.container.isContent ? e.container.indexes : e.indexes, rowIndex = _a[0], cellIndex = _a[1];\n        var prev = this.focus.getPrevIndexes();\n        if (this.parent.frozenRows) {\n            if (e.container.isHeader && (e.element.tagName === 'TD' || closest(e.element, '.e-rowcell'))) {\n                var thLen = this.parent.getHeaderTable().querySelector('thead').childElementCount;\n                rowIndex -= thLen;\n                prev.rowIndex = !isNullOrUndefined(prev.rowIndex) ? prev.rowIndex - thLen : null;\n            }\n            else {\n                rowIndex += this.parent.frozenRows;\n                prev.rowIndex = prev.rowIndex === 0 || !isNullOrUndefined(prev.rowIndex) ? prev.rowIndex + this.parent.frozenRows : null;\n            }\n        }\n        if (this.parent.getFrozenColumns()) {\n            var cIdx = Number(e.element.getAttribute('aria-colindex'));\n            var selectedIndexes = this.parent.getSelectedRowCellIndexes();\n            if (selectedIndexes.length && prev.cellIndex === 0) {\n                prev.cellIndex = selectedIndexes[selectedIndexes.length - 1].cellIndexes[0];\n            }\n            prev.cellIndex = !isNullOrUndefined(prev.cellIndex) ? (prev.cellIndex === cellIndex ? cIdx : cIdx - 1) : null;\n            cellIndex = cIdx;\n        }\n        if (headerAction || (['ctrlPlusA', 'escape'].indexOf(e.keyArgs.action) === -1 && e.keyArgs.action !== 'space' &&\n            rowIndex === prev.rowIndex && cellIndex === prev.cellIndex)) {\n            return;\n        }\n        this.preventFocus = true;\n        switch (e.keyArgs.action) {\n            case 'downArrow':\n            case 'upArrow':\n            case 'enter':\n            case 'shiftEnter':\n                this.target = e.element;\n                this.applyDownUpKey(rowIndex, cellIndex);\n                break;\n            case 'rightArrow':\n            case 'leftArrow':\n                this.applyRightLeftKey(rowIndex, cellIndex);\n                break;\n            case 'shiftDown':\n            case 'shiftUp':\n                this.shiftDownKey(rowIndex, cellIndex);\n                break;\n            case 'shiftLeft':\n            case 'shiftRight':\n                this.applyShiftLeftRightKey(rowIndex, cellIndex);\n                break;\n            case 'home':\n            case 'end':\n                cellIndex = e.keyArgs.action === 'end' ? this.getLastColIndex(rowIndex) : 0;\n                this.applyHomeEndKey(rowIndex, cellIndex);\n                break;\n            case 'ctrlHome':\n            case 'ctrlEnd':\n                this.applyCtrlHomeEndKey(rowIndex, cellIndex);\n                break;\n            case 'escape':\n                this.clearSelection();\n                break;\n            case 'ctrlPlusA':\n                this.ctrlPlusA();\n                break;\n            case 'space':\n                this.applySpaceSelection(e.element);\n                break;\n            case 'tab':\n                if (this.parent.editSettings.allowNextRowEdit) {\n                    this.selectRow(rowIndex);\n                }\n                break;\n        }\n        this.preventFocus = false;\n        this.positionBorders();\n        this.updateAutoFillPosition();\n    };\n    /**\n     * Apply ctrl + A key selection\n     * @return {void}\n     * @hidden\n     */\n    Selection.prototype.ctrlPlusA = function () {\n        if (this.isRowType() && !this.isSingleSel()) {\n            this.selectRowsByRange(0, this.getCurrentBatchRecordChanges().length - 1);\n        }\n        if (this.isCellType() && !this.isSingleSel()) {\n            this.selectCellsByRange({ rowIndex: 0, cellIndex: 0 }, { rowIndex: this.parent.getRows().length - 1, cellIndex: this.parent.getColumns().length - 1 });\n        }\n    };\n    Selection.prototype.applySpaceSelection = function (target) {\n        if (target.classList.contains('e-checkselectall')) {\n            this.checkedTarget = target;\n            this.checkSelectAll(this.checkedTarget);\n        }\n        else {\n            if (target.classList.contains('e-checkselect')) {\n                this.checkedTarget = target;\n                this.checkSelect(this.checkedTarget);\n            }\n        }\n    };\n    Selection.prototype.applyDownUpKey = function (rowIndex, cellIndex) {\n        var gObj = this.parent;\n        if (this.parent.isCheckBoxSelection && this.parent.checkAllRows === 'Check' && !this.selectionSettings.persistSelection) {\n            this.checkSelectAllAction(false);\n            this.checkedTarget = null;\n        }\n        if (this.isRowType()) {\n            if (this.parent.frozenRows) {\n                this.selectRow(rowIndex, true);\n                this.applyUpDown(gObj.selectedRowIndex);\n            }\n            else {\n                this.selectRow(rowIndex, true);\n                this.applyUpDown(gObj.selectedRowIndex);\n            }\n        }\n        if (this.isCellType()) {\n            this.selectCell({ rowIndex: rowIndex, cellIndex: cellIndex }, true);\n        }\n    };\n    Selection.prototype.applyUpDown = function (rowIndex) {\n        if (rowIndex < 0) {\n            return;\n        }\n        if (!this.target) {\n            this.target = this.parent.getRows()[0].children[this.parent.groupSettings.columns.length || 0];\n        }\n        var cIndex = parseInt(this.target.getAttribute('aria-colindex'), 10);\n        var frzCols = this.parent.getFrozenColumns();\n        if (frzCols) {\n            if (cIndex >= frzCols) {\n                this.target =\n                    this.contentRenderer.getMovableRowByIndex(rowIndex).querySelectorAll('.e-rowcell')[cIndex - frzCols];\n            }\n            else {\n                this.target = this.contentRenderer.getRowByIndex(rowIndex).querySelectorAll('.e-rowcell')[cIndex];\n            }\n        }\n        else {\n            this.target = this.contentRenderer.getRowByIndex(rowIndex).querySelectorAll('.e-rowcell')[cIndex];\n        }\n        this.addAttribute(this.target);\n    };\n    Selection.prototype.applyRightLeftKey = function (rowIndex, cellIndex) {\n        var gObj = this.parent;\n        if (this.isCellType()) {\n            this.selectCell({ rowIndex: rowIndex, cellIndex: cellIndex }, true);\n            this.addAttribute(this.target);\n        }\n    };\n    Selection.prototype.applyHomeEndKey = function (rowIndex, cellIndex) {\n        if (this.isCellType()) {\n            this.selectCell({ rowIndex: rowIndex, cellIndex: cellIndex }, true);\n        }\n        else {\n            this.addAttribute(this.parent.getCellFromIndex(rowIndex, cellIndex));\n        }\n    };\n    /**\n     * Apply shift+down key selection\n     * @return {void}\n     * @hidden\n     */\n    Selection.prototype.shiftDownKey = function (rowIndex, cellIndex) {\n        var gObj = this.parent;\n        this.isMultiShiftRequest = true;\n        if (this.isRowType() && !this.isSingleSel()) {\n            if (!isUndefined(this.prevRowIndex)) {\n                this.selectRowsByRange(this.prevRowIndex, rowIndex);\n                this.applyUpDown(rowIndex);\n            }\n            else {\n                this.selectRow(0, true);\n            }\n        }\n        if (this.isCellType() && !this.isSingleSel()) {\n            this.selectCellsByRange(this.prevCIdxs || { rowIndex: 0, cellIndex: 0 }, { rowIndex: rowIndex, cellIndex: cellIndex });\n        }\n        this.isMultiShiftRequest = false;\n    };\n    Selection.prototype.applyShiftLeftRightKey = function (rowIndex, cellIndex) {\n        var gObj = this.parent;\n        this.isMultiShiftRequest = true;\n        this.selectCellsByRange(this.prevCIdxs, { rowIndex: rowIndex, cellIndex: cellIndex });\n        this.isMultiShiftRequest = false;\n    };\n    Selection.prototype.applyCtrlHomeEndKey = function (rowIndex, cellIndex) {\n        if (this.isRowType()) {\n            this.selectRow(rowIndex, true);\n            this.addAttribute(this.parent.getCellFromIndex(rowIndex, cellIndex));\n        }\n        if (this.isCellType()) {\n            this.selectCell({ rowIndex: rowIndex, cellIndex: cellIndex }, true);\n        }\n    };\n    Selection.prototype.addRemoveClassesForRow = function (row, isAdd, clearAll) {\n        var args = [];\n        for (var _i = 3; _i < arguments.length; _i++) {\n            args[_i - 3] = arguments[_i];\n        }\n        if (row) {\n            var cells = [].slice.call(row.querySelectorAll('.e-rowcell'));\n            var detailIndentCell = row.querySelector('.e-detailrowcollapse') || row.querySelector('.e-detailrowexpand');\n            var dragdropIndentCell = row.querySelector('.e-rowdragdrop');\n            if (detailIndentCell) {\n                cells.push(detailIndentCell);\n            }\n            if (dragdropIndentCell) {\n                cells.push(dragdropIndentCell);\n            }\n            addRemoveActiveClasses.apply(void 0, [cells, isAdd].concat(args));\n        }\n        this.getRenderer().setSelection(row ? row.getAttribute('data-uid') : null, isAdd, clearAll);\n    };\n    Selection.prototype.isRowType = function () {\n        return this.selectionSettings.mode === 'Row' || this.selectionSettings.mode === 'Both';\n    };\n    Selection.prototype.isCellType = function () {\n        return this.selectionSettings.mode === 'Cell' || this.selectionSettings.mode === 'Both';\n    };\n    Selection.prototype.isSingleSel = function () {\n        return this.selectionSettings.type === 'Single';\n    };\n    Selection.prototype.getRenderer = function () {\n        if (isNullOrUndefined(this.contentRenderer)) {\n            this.contentRenderer = this.factory.getRenderer(RenderType.Content);\n        }\n        return this.contentRenderer;\n    };\n    /**\n     * Gets the collection of selected records.\n     * @return {Object[]}\n     */\n    Selection.prototype.getSelectedRecords = function () {\n        var selectedData = [];\n        if (!this.selectionSettings.persistSelection) {\n            selectedData = this.parent.getRowsObject().filter(function (row) { return row.isSelected; })\n                .map(function (m) { return m.data; });\n        }\n        else {\n            selectedData = this.persistSelectedData;\n        }\n        return selectedData;\n    };\n    Selection.prototype.addEventListener_checkbox = function () {\n        var _this = this;\n        this.parent.on(events.dataReady, this.dataReady, this);\n        this.onDataBoundFunction = this.onDataBound.bind(this);\n        this.parent.addEventListener(events.dataBound, this.onDataBoundFunction);\n        this.parent.on(events.contentReady, this.checkBoxSelectionChanged, this);\n        this.parent.on(events.onEmpty, this.setCheckAllForEmptyGrid, this);\n        this.actionCompleteFunc = this.actionCompleteHandler.bind(this);\n        this.parent.addEventListener(events.actionComplete, this.actionCompleteFunc);\n        this.parent.on(events.click, this.clickHandler, this);\n        this.resizeEndFn = function () {\n            _this.updateAutoFillPosition();\n            _this.drawBorders();\n        };\n        this.resizeEndFn.bind(this);\n        this.parent.addEventListener(events.resizeStop, this.resizeEndFn);\n    };\n    Selection.prototype.removeEventListener_checkbox = function () {\n        this.parent.off(events.dataReady, this.dataReady);\n        this.parent.removeEventListener(events.dataBound, this.onDataBoundFunction);\n        this.parent.removeEventListener(events.actionComplete, this.actionCompleteFunc);\n        this.parent.off(events.onEmpty, this.setCheckAllForEmptyGrid);\n        this.parent.off(events.click, this.clickHandler);\n    };\n    Selection.prototype.setCheckAllForEmptyGrid = function () {\n        var checkAllBox = this.getCheckAllBox();\n        if (checkAllBox) {\n            this.parent.isCheckBoxSelection = true;\n            var spanEle = checkAllBox.nextElementSibling;\n            removeClass([spanEle], ['e-check', 'e-stop', 'e-uncheck']);\n        }\n    };\n    Selection.prototype.dataReady = function (e) {\n        this.isHeaderCheckboxClicked = false;\n        var isInfinitecroll = this.parent.enableInfiniteScrolling && e.requestType === 'infiniteScroll';\n        if (e.requestType !== 'virtualscroll' && !this.parent.isPersistSelection && !isInfinitecroll) {\n            this.disableUI = !this.parent.enableImmutableMode;\n            this.clearSelection();\n            this.setCheckAllState();\n            this.disableUI = false;\n        }\n    };\n    Selection.prototype.actionCompleteHandler = function (e) {\n        if (e.requestType === 'save' && this.parent.isPersistSelection) {\n            this.refreshPersistSelection();\n        }\n    };\n    Selection.prototype.selectRowIndex = function (index) {\n        this.parent.isSelectedRowIndexUpdating = true;\n        this.parent.selectedRowIndex = index;\n    };\n    Selection.prototype.disableInteracted = function () {\n        this.isInteracted = false;\n    };\n    Selection.prototype.activeTarget = function () {\n        this.actualTarget = this.isInteracted ? this.actualTarget : null;\n    };\n    return Selection;\n}());\nexport { Selection };\n"]},"metadata":{},"sourceType":"module"}